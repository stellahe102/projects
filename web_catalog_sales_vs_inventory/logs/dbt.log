[0m18:50:27.018702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd8460a680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd828bf790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd828bdcc0>]}


============================== 18:50:27.022114 | ae761923-a830-4fc0-b475-218b7c9eb96d ==============================
[0m18:50:27.022114 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:50:27.022898 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m18:50:27.023614 [info ] [MainThread]: dbt version: 1.7.3
[0m18:50:27.024205 [info ] [MainThread]: python version: 3.10.12
[0m18:50:27.024745 [info ] [MainThread]: python path: /usr/bin/python3
[0m18:50:27.025289 [info ] [MainThread]: os info: Linux-6.2.0-1017-aws-x86_64-with-glibc2.35
[0m18:50:27.669808 [info ] [MainThread]: Using profiles dir at /home/ubuntu/.dbt
[0m18:50:27.670583 [info ] [MainThread]: Using profiles.yml file at /home/ubuntu/.dbt/profiles.yml
[0m18:50:27.671194 [info ] [MainThread]: Using dbt_project.yml file at /home/ubuntu/capstone_dbt_project/capstone/dbt_project.yml
[0m18:50:27.672562 [info ] [MainThread]: adapter type: snowflake
[0m18:50:27.673146 [info ] [MainThread]: adapter version: 1.7.1
[0m18:50:27.794928 [info ] [MainThread]: Configuration:
[0m18:50:27.795981 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m18:50:27.796759 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m18:50:27.797529 [info ] [MainThread]: Required dependencies:
[0m18:50:27.798320 [debug] [MainThread]: Executing "git --help"
[0m18:50:27.802942 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m18:50:27.803698 [debug] [MainThread]: STDERR: "b''"
[0m18:50:27.804213 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m18:50:27.804769 [info ] [MainThread]: Connection:
[0m18:50:27.805359 [info ] [MainThread]:   account: dt97533.us-east-2.aws
[0m18:50:27.805905 [info ] [MainThread]:   user: stellahe102
[0m18:50:27.806452 [info ] [MainThread]:   database: tpcds
[0m18:50:27.806988 [info ] [MainThread]:   warehouse: tpcds
[0m18:50:27.808235 [info ] [MainThread]:   role: accountadmin
[0m18:50:27.809109 [info ] [MainThread]:   schema: intermediate
[0m18:50:27.809992 [info ] [MainThread]:   authenticator: None
[0m18:50:27.810760 [info ] [MainThread]:   private_key_path: None
[0m18:50:27.811532 [info ] [MainThread]:   token: None
[0m18:50:27.812290 [info ] [MainThread]:   oauth_client_id: None
[0m18:50:27.813055 [info ] [MainThread]:   query_tag: None
[0m18:50:27.813811 [info ] [MainThread]:   client_session_keep_alive: False
[0m18:50:27.814576 [info ] [MainThread]:   host: None
[0m18:50:27.815427 [info ] [MainThread]:   port: None
[0m18:50:27.816182 [info ] [MainThread]:   proxy_host: None
[0m18:50:27.816928 [info ] [MainThread]:   proxy_port: None
[0m18:50:27.817693 [info ] [MainThread]:   protocol: None
[0m18:50:27.818457 [info ] [MainThread]:   connect_retries: 1
[0m18:50:27.819227 [info ] [MainThread]:   connect_timeout: None
[0m18:50:27.820008 [info ] [MainThread]:   retry_on_database_errors: False
[0m18:50:27.820763 [info ] [MainThread]:   retry_all: False
[0m18:50:27.821524 [info ] [MainThread]:   insecure_mode: False
[0m18:50:27.822267 [info ] [MainThread]:   reuse_connections: None
[0m18:50:27.823181 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:50:27.824290 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m18:50:27.825583 [debug] [MainThread]: Using snowflake connection "debug"
[0m18:50:27.826346 [debug] [MainThread]: On debug: select 1 as id
[0m18:50:27.827096 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:50:29.084390 [debug] [MainThread]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:50:29.086035 [debug] [MainThread]: On debug: Close
[0m18:50:29.165563 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m18:50:29.166318 [info ] [MainThread]: [32mAll checks passed![0m
[0m18:50:29.167583 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 2.216975, "process_user_time": 3.972983, "process_kernel_time": 0.243419, "process_mem_max_rss": "150416", "process_in_blocks": "2128", "process_out_blocks": "832"}
[0m18:50:29.168458 [debug] [MainThread]: Command `dbt debug` succeeded at 18:50:29.168225 after 2.22 seconds
[0m18:50:29.169029 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m18:50:29.169611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd8460a680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a1ea800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7ab08ee0>]}
[0m18:50:29.170249 [debug] [MainThread]: Flushing usage events
[0m19:24:38.731675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f700d690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f5215420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f5214b80>]}


============================== 19:24:38.735420 | 110c3580-6030-4809-a81e-4aa3fedd55fd ==============================
[0m19:24:38.735420 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:24:38.736320 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select models.staging.tpcds*', 'send_anonymous_usage_stats': 'True'}
[0m19:24:39.518992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f5214d00>]}
[0m19:24:39.657058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ecc22920>]}
[0m19:24:39.658304 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:24:39.669577 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:24:39.670522 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m19:24:39.671250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ecbcd810>]}
[0m19:24:41.304746 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m19:24:41.312104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ec2700d0>]}
[0m19:24:41.325447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ec270070>]}
[0m19:24:41.326130 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:24:41.326725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '110c3580-6030-4809-a81e-4aa3fedd55fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ec31f730>]}
[0m19:24:41.327654 [warn ] [MainThread]: The selection criterion 'models.staging.tpcds*' does not match any nodes
[0m19:24:41.328936 [info ] [MainThread]: 
[0m19:24:41.329499 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m19:24:41.330274 [debug] [MainThread]: Command end result
[0m19:24:41.340582 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6755905, "process_user_time": 5.23226, "process_kernel_time": 0.236281, "process_mem_max_rss": "154640", "process_in_blocks": "2008", "process_out_blocks": "2680"}
[0m19:24:41.341451 [debug] [MainThread]: Command `dbt run` succeeded at 19:24:41.341233 after 2.68 seconds
[0m19:24:41.342070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44f700d690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ecbcd1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ec30cc40>]}
[0m19:24:41.342680 [debug] [MainThread]: Flushing usage events
[0m19:26:37.298647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425fddec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425db60fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425db60bb0>]}


============================== 19:26:37.302042 | f36b3cd5-692f-4a70-a2b7-d422f2427fe9 ==============================
[0m19:26:37.302042 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:26:37.302814 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging.tpcds*', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:26:38.043720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425db1fd30>]}
[0m19:26:38.185445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4255388f70>]}
[0m19:26:38.186633 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:26:38.197583 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:26:38.236905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:26:38.237552 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:26:38.238632 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m19:26:38.246674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4255195510>]}
[0m19:26:38.260421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425515f700>]}
[0m19:26:38.261191 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:26:38.261810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425515f640>]}
[0m19:26:38.264262 [info ] [MainThread]: 
[0m19:26:38.265416 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:26:38.267773 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:26:38.287096 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:26:38.287971 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:26:38.288699 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:26:38.648790 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:26:38.651301 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:26:38.691940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m19:26:38.704310 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:26:38.705059 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:26:38.705725 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:26:38.993287 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m19:26:38.995679 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:26:39.036959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42551bfb50>]}
[0m19:26:39.038454 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:26:39.039215 [info ] [MainThread]: 
[0m19:26:39.043212 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:26:39.044014 [info ] [Thread-1 (]: 1 of 8 START sql view model intermediate.stg_tpcds__catalog_sales .............. [RUN]
[0m19:26:39.045355 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m19:26:39.046280 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:26:39.057918 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:26:39.060236 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:26:39.046800 => 19:26:39.059847
[0m19:26:39.060977 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:26:39.100188 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:26:39.103331 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:26:39.104016 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate.stg_tpcds__catalog_sales
  
   as (
    SELECT 
    WAREHOUSE_SK, 
    SHIP_DATE_SK, 
    EXT_LIST_PRICE, 
    QUANTITY, 
    NET_PAID_INC_TAX, 
    SOLD_TIME_SK, 
    PROMO_SK, 
    LIST_PRICE, 
    EXT_SHIP_COST, 
    NET_PAID, 
    SOLD_DATE_SK, 
    EXT_DISCOUNT_AMT,
    SHIP_ADDR_SK, 
    EXT_TAX, 
    CATALOG_PAGE_SK, 
    NET_PROFIT, 
    ITEM_SK, 
    BILL_CDEMO_SK, 
    BILL_HDEMO_SK, 
    NET_PAID_INC_SHIP, 
    COUPON_AMT, 
    NET_PAID_INC_SHIP_TAX, 
    ORDER_NUMBER, 
    EXT_WHOLESALE_COST, 
    SHIP_MODE_SK, 
    EXT_SALES_PRICE, 
    SHIP_CUSTOMER_SK, 
    BILL_ADDR_SK, 
    SHIP_CDEMO_SK, 
    SHIP_HDEMO_SK, 
    WHOLESALE_COST, 
    SALES_PRICE, 
    CALL_CENTER_SK, 
    BILL_CUSTOMER_SK,
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.staging.catalog_sales
  );
[0m19:26:39.104686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:39.494831 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8e96-0004-d6ae0008c0c6
[0m19:26:39.495646 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.CATALOG_SALES' does not exist or not authorized.
[0m19:26:39.496579 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:26:39.061481 => 19:26:39.496183
[0m19:26:39.497232 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:26:39.550635 [debug] [Thread-1 (]: Database Error in model stg_tpcds__catalog_sales (models/staging/tpcds/stg_tpcds__catalog_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CATALOG_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m19:26:39.551569 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42550ad300>]}
[0m19:26:39.552525 [error] [Thread-1 (]: 1 of 8 ERROR creating sql view model intermediate.stg_tpcds__catalog_sales ..... [[31mERROR[0m in 0.51s]
[0m19:26:39.553533 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:26:39.554270 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m19:26:39.555299 [info ] [Thread-1 (]: 2 of 8 START sql view model intermediate.stg_tpcds__customer ................... [RUN]
[0m19:26:39.556440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m19:26:39.557171 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m19:26:39.562049 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m19:26:39.563465 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 19:26:39.557682 => 19:26:39.563093
[0m19:26:39.564193 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m19:26:39.569222 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m19:26:39.571220 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m19:26:39.571974 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer
  
   as (
    select 
    SALUTATION, 
    PREFERRED_CUST_FLAG, 
    FIRST_SALES_DATE_SK, 
    CUSTOMER_SK, 
    LOGIN, 
    CURRENT_CDEMO_SK, 
    FIRST_NAME, 
    CURRENT_HDEMO_SK, 
    CURRENT_ADDR_SK, 
    LAST_NAME, 
    CUSTOMER_ID, 
    LAST_REVIEW_DATE_SK, 
    BIRTH_MONTH, 
    BIRTH_COUNTRY, 
    BIRTH_YEAR, 
    BIRTH_DAY, 
    EMAIL_ADDRESS, 
    FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.staging.customer
  );
[0m19:26:39.572739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:40.019417 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8ebc-0004-d6ae0008b0c6
[0m19:26:40.020341 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.CUSTOMER' does not exist or not authorized.
[0m19:26:40.021344 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 19:26:39.564695 => 19:26:40.020958
[0m19:26:40.022110 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m19:26:40.074416 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer (models/staging/tpcds/stg_tpcds__customer.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer.sql
[0m19:26:40.075500 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42547ce620>]}
[0m19:26:40.076571 [error] [Thread-1 (]: 2 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer .......... [[31mERROR[0m in 0.52s]
[0m19:26:40.077675 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m19:26:40.078529 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m19:26:40.079554 [info ] [Thread-1 (]: 3 of 8 START sql view model intermediate.stg_tpcds__customer_address ........... [RUN]
[0m19:26:40.080742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m19:26:40.081499 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m19:26:40.086589 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m19:26:40.088123 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 19:26:40.082009 => 19:26:40.087723
[0m19:26:40.088865 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m19:26:40.094113 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m19:26:40.095574 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m19:26:40.096245 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_address
  
   as (
    select
    STREET_NAME, 
    SUITE_NUMBER, 
    STATE, 
    LOCATION_TYPE, 
    ADDRESS_SK, 
    COUNTRY, 
    ADDRESS_ID,
    COUNTY, 
    STREET_NUMBER,
    ZIP, 
    CITY, 
    STREET_TYPE, 
    GMT_OFFSET
FROM 
    tpcds.staging.customer_address
  );
[0m19:26:40.096883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:40.390941 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8eb8-0004-d6ae0008916a
[0m19:26:40.391781 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.CUSTOMER_ADDRESS' does not exist or not authorized.
[0m19:26:40.392718 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 19:26:40.089389 => 19:26:40.392325
[0m19:26:40.393408 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m19:26:40.480840 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER_ADDRESS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m19:26:40.481772 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42551aeda0>]}
[0m19:26:40.482709 [error] [Thread-1 (]: 3 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer_address .. [[31mERROR[0m in 0.40s]
[0m19:26:40.483742 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m19:26:40.484470 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m19:26:40.485426 [info ] [Thread-1 (]: 4 of 8 START sql view model intermediate.stg_tpcds__customer_demographics ...... [RUN]
[0m19:26:40.486555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m19:26:40.487357 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m19:26:40.492032 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:26:40.493476 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 19:26:40.487873 => 19:26:40.493091
[0m19:26:40.494189 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m19:26:40.499090 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:26:40.500471 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m19:26:40.501124 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_demographics
  
   as (
    select
    DEP_EMPLOYED_COUNT, 
    DEMO_SK, 
    DEP_COUNT, 
    CREDIT_RATING, 
    EDUCATION_STATUS, 
    PURCHASE_ESTIMATE, 
    MARITAL_STATUS, 
    DEP_COLLEGE_COUNT, 
    GENDER
FROM 
    tpcds.staging.customer_demographics
  );
[0m19:26:40.501751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:40.861426 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8e96-0004-d6ae0008c0ca
[0m19:26:40.862192 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.CUSTOMER_DEMOGRAPHICS' does not exist or not authorized.
[0m19:26:40.863124 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 19:26:40.494691 => 19:26:40.862713
[0m19:26:40.863788 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m19:26:40.906095 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER_DEMOGRAPHICS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m19:26:40.906995 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42547cc970>]}
[0m19:26:40.907968 [error] [Thread-1 (]: 4 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer_demographics  [[31mERROR[0m in 0.42s]
[0m19:26:40.908950 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m19:26:40.909673 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m19:26:40.910550 [info ] [Thread-1 (]: 5 of 8 START sql view model intermediate.stg_tpcds__household_demographics ..... [RUN]
[0m19:26:40.911605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m19:26:40.912246 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m19:26:40.916724 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m19:26:40.917689 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 19:26:40.912644 => 19:26:40.917316
[0m19:26:40.918310 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m19:26:40.924975 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m19:26:40.926173 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m19:26:40.926829 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL, 
    HD_INCOME_BAND_SK, 
    HD_DEMO_SK, HD_DEP_COUNT, 
    HD_VEHICLE_COUNT
FROM 
    tpcds.staging.household_demographics
  );
[0m19:26:40.927502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:41.234961 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8e98-0004-d6ae0008a0de
[0m19:26:41.235792 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.HOUSEHOLD_DEMOGRAPHICS' does not exist or not authorized.
[0m19:26:41.236690 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 19:26:40.918713 => 19:26:41.236312
[0m19:26:41.237354 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m19:26:41.286754 [debug] [Thread-1 (]: Database Error in model stg_tpcds__household_demographics (models/staging/tpcds/stg_tpcds__household_demographics.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.HOUSEHOLD_DEMOGRAPHICS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__household_demographics.sql
[0m19:26:41.287714 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42550eaf50>]}
[0m19:26:41.288670 [error] [Thread-1 (]: 5 of 8 ERROR creating sql view model intermediate.stg_tpcds__household_demographics  [[31mERROR[0m in 0.38s]
[0m19:26:41.289704 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m19:26:41.290453 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m19:26:41.291363 [info ] [Thread-1 (]: 6 of 8 START sql view model intermediate.stg_tpcds__income_band ................ [RUN]
[0m19:26:41.292427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m19:26:41.293076 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m19:26:41.297738 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m19:26:41.298736 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 19:26:41.293489 => 19:26:41.298348
[0m19:26:41.299416 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m19:26:41.304370 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m19:26:41.305518 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m19:26:41.306175 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.intermediate.stg_tpcds__income_band
  
   as (
    SELECT 
    LOWER_BOUND, 
    INCOME_BAND_SK, 
    UPPER_BOUND
FROM
    tpcds.staging.income_band
  );
[0m19:26:41.306820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:41.624397 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8e9a-0004-d6ae0008815a
[0m19:26:41.625205 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.INCOME_BAND' does not exist or not authorized.
[0m19:26:41.626130 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 19:26:41.299838 => 19:26:41.625743
[0m19:26:41.626826 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m19:26:41.696131 [debug] [Thread-1 (]: Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.INCOME_BAND' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m19:26:41.697068 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425559f670>]}
[0m19:26:41.698009 [error] [Thread-1 (]: 6 of 8 ERROR creating sql view model intermediate.stg_tpcds__income_band ....... [[31mERROR[0m in 0.40s]
[0m19:26:41.699038 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m19:26:41.699784 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m19:26:41.700674 [info ] [Thread-1 (]: 7 of 8 START sql view model intermediate.stg_tpcds__inventory .................. [RUN]
[0m19:26:41.701775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m19:26:41.702427 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m19:26:41.707235 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m19:26:41.708254 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 19:26:41.702830 => 19:26:41.707885
[0m19:26:41.708897 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m19:26:41.713918 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m19:26:41.715093 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m19:26:41.715737 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.intermediate.stg_tpcds__inventory
  
   as (
    SELECT 
    DATE_SK, 
    ITEM_SK, 
    QUANTITY_ON_HAND, 
    WAREHOUSE_SK
FROM
    tpcds.staging.inventory
  );
[0m19:26:41.716357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:42.051718 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8eb8-0004-d6ae0008916e
[0m19:26:42.052519 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.INVENTORY' does not exist or not authorized.
[0m19:26:42.053443 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 19:26:41.709292 => 19:26:42.053061
[0m19:26:42.054126 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m19:26:42.102451 [debug] [Thread-1 (]: Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.INVENTORY' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m19:26:42.103399 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425508ed70>]}
[0m19:26:42.104363 [error] [Thread-1 (]: 7 of 8 ERROR creating sql view model intermediate.stg_tpcds__inventory ......... [[31mERROR[0m in 0.40s]
[0m19:26:42.105379 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m19:26:42.106132 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m19:26:42.107075 [info ] [Thread-1 (]: 8 of 8 START sql view model intermediate.stg_tpcds__web_sales .................. [RUN]
[0m19:26:42.108141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m19:26:42.108823 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m19:26:42.113605 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m19:26:42.114595 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 19:26:42.109240 => 19:26:42.114219
[0m19:26:42.115267 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m19:26:42.120286 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m19:26:42.122277 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m19:26:42.122974 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER, 
   WS_SHIP_MODE_SK, 
   WS_SOLD_TIME_SK, 
   WS_SHIP_ADDR_SK, 
   WS_NET_PAID_INC_TAX, 
   WS_PROMO_SK, 
   WS_NET_PAID_INC_SHIP, 
   WS_QUANTITY, 
   WS_EXT_SALES_PRICE, 
   WS_WEB_SITE_SK, 
   WS_SHIP_DATE_SK, 
   WS_BILL_CDEMO_SK, 
   WS_NET_PROFIT, 
   WS_NET_PAID, 
   WS_EXT_SHIP_COST, 
   WS_BILL_CUSTOMER_SK, 
   WS_COUPON_AMT, 
   WS_WHOLESALE_COST, 
   WS_SHIP_CUSTOMER_SK, 
   WS_BILL_HDEMO_SK, 
   WS_SOLD_DATE_SK, 
   WS_SHIP_CDEMO_SK, 
   WS_WAREHOUSE_SK, 
   WS_EXT_TAX, 
   WS_ITEM_SK, 
   WS_SHIP_HDEMO_SK, 
   WS_EXT_WHOLESALE_COST, 
   WS_NET_PAID_INC_SHIP_TAX, 
   WS_EXT_DISCOUNT_AMT, 
   WS_SALES_PRICE, 
   WS_WEB_PAGE_SK, 
   WS_EXT_LIST_PRICE, 
   WS_LIST_PRICE, 
   WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.staging.web_sales
  );
[0m19:26:42.123701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:26:42.503835 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102ce-0001-8ebc-0004-d6ae0008b0ca
[0m19:26:42.504636 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.STAGING.WEB_SALES' does not exist or not authorized.
[0m19:26:42.505544 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 19:26:42.115686 => 19:26:42.505163
[0m19:26:42.506216 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m19:26:42.556649 [debug] [Thread-1 (]: Database Error in model stg_tpcds__web_sales (models/staging/tpcds/stg_tpcds__web_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.WEB_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__web_sales.sql
[0m19:26:42.557581 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f36b3cd5-692f-4a70-a2b7-d422f2427fe9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4255081630>]}
[0m19:26:42.558543 [error] [Thread-1 (]: 8 of 8 ERROR creating sql view model intermediate.stg_tpcds__web_sales ......... [[31mERROR[0m in 0.45s]
[0m19:26:42.559720 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m19:26:42.562269 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:26:42.562832 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m19:26:42.563571 [info ] [MainThread]: 
[0m19:26:42.564298 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 4.30 seconds (4.30s).
[0m19:26:42.568135 [debug] [MainThread]: Command end result
[0m19:26:42.581381 [info ] [MainThread]: 
[0m19:26:42.582241 [info ] [MainThread]: [31mCompleted with 8 errors and 0 warnings:[0m
[0m19:26:42.582923 [info ] [MainThread]: 
[0m19:26:42.583657 [error] [MainThread]:   Database Error in model stg_tpcds__catalog_sales (models/staging/tpcds/stg_tpcds__catalog_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CATALOG_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m19:26:42.584360 [info ] [MainThread]: 
[0m19:26:42.585059 [error] [MainThread]:   Database Error in model stg_tpcds__customer (models/staging/tpcds/stg_tpcds__customer.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer.sql
[0m19:26:42.585753 [info ] [MainThread]: 
[0m19:26:42.586437 [error] [MainThread]:   Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER_ADDRESS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m19:26:42.587152 [info ] [MainThread]: 
[0m19:26:42.587841 [error] [MainThread]:   Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.CUSTOMER_DEMOGRAPHICS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m19:26:42.588632 [info ] [MainThread]: 
[0m19:26:42.589317 [error] [MainThread]:   Database Error in model stg_tpcds__household_demographics (models/staging/tpcds/stg_tpcds__household_demographics.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.HOUSEHOLD_DEMOGRAPHICS' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__household_demographics.sql
[0m19:26:42.590062 [info ] [MainThread]: 
[0m19:26:42.590742 [error] [MainThread]:   Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.INCOME_BAND' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m19:26:42.591457 [info ] [MainThread]: 
[0m19:26:42.592134 [error] [MainThread]:   Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.INVENTORY' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m19:26:42.592824 [info ] [MainThread]: 
[0m19:26:42.593566 [error] [MainThread]:   Database Error in model stg_tpcds__web_sales (models/staging/tpcds/stg_tpcds__web_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.STAGING.WEB_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__web_sales.sql
[0m19:26:42.594273 [info ] [MainThread]: 
[0m19:26:42.595071 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=8 SKIP=0 TOTAL=8
[0m19:26:42.596560 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.3642464, "process_user_time": 5.401531, "process_kernel_time": 0.208352, "process_mem_max_rss": "157928", "process_in_blocks": "704", "process_out_blocks": "2024", "command_success": false}
[0m19:26:42.597664 [debug] [MainThread]: Command `dbt run` failed at 19:26:42.597435 after 5.37 seconds
[0m19:26:42.598472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f425fddec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42555977c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42554555a0>]}
[0m19:26:42.599264 [debug] [MainThread]: Flushing usage events
[0m19:28:23.638059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055e10ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055c34cfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055c34cbb0>]}


============================== 19:28:23.641694 | 9c76048d-bc61-4251-a201-2740ded6979f ==============================
[0m19:28:23.641694 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:28:23.642584 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging.tpcds*', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:28:24.389220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055c30bd30>]}
[0m19:28:24.528628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0553b84f70>]}
[0m19:28:24.529758 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:28:24.540211 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:28:24.579392 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:28:24.580885 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/_tpcds__sources.yml
[0m19:28:24.940028 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m19:28:25.026823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0553852770>]}
[0m19:28:25.040443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055394ffa0>]}
[0m19:28:25.041162 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:28:25.041777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055394ffd0>]}
[0m19:28:25.044107 [info ] [MainThread]: 
[0m19:28:25.045209 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:28:25.048074 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:28:25.067308 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:28:25.068119 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:28:25.068791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:28:25.469699 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:28:25.472064 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:28:25.518501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m19:28:25.530647 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:28:25.531406 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:28:25.532054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:28:25.890495 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m19:28:25.892864 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:28:26.044739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0553d0d7e0>]}
[0m19:28:26.046197 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:28:26.046886 [info ] [MainThread]: 
[0m19:28:26.049928 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:28:26.050724 [info ] [Thread-1 (]: 1 of 8 START sql view model intermediate.stg_tpcds__catalog_sales .............. [RUN]
[0m19:28:26.051800 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m19:28:26.052524 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:28:26.064151 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:28:26.065609 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:28:26.053182 => 19:28:26.065213
[0m19:28:26.066359 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:28:26.104749 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:28:26.106843 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:28:26.107551 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate.stg_tpcds__catalog_sales
  
   as (
    SELECT 
    WAREHOUSE_SK, 
    SHIP_DATE_SK, 
    EXT_LIST_PRICE, 
    QUANTITY, 
    NET_PAID_INC_TAX, 
    SOLD_TIME_SK, 
    PROMO_SK, 
    LIST_PRICE, 
    EXT_SHIP_COST, 
    NET_PAID, 
    SOLD_DATE_SK, 
    EXT_DISCOUNT_AMT,
    SHIP_ADDR_SK, 
    EXT_TAX, 
    CATALOG_PAGE_SK, 
    NET_PROFIT, 
    ITEM_SK, 
    BILL_CDEMO_SK, 
    BILL_HDEMO_SK, 
    NET_PAID_INC_SHIP, 
    COUPON_AMT, 
    NET_PAID_INC_SHIP_TAX, 
    ORDER_NUMBER, 
    EXT_WHOLESALE_COST, 
    SHIP_MODE_SK, 
    EXT_SALES_PRICE, 
    SHIP_CUSTOMER_SK, 
    BILL_ADDR_SK, 
    SHIP_CDEMO_SK, 
    SHIP_HDEMO_SK, 
    WHOLESALE_COST, 
    SALES_PRICE, 
    CALL_CENTER_SK, 
    BILL_CUSTOMER_SK,
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m19:28:26.108229 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:26.549345 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8e9a-0004-d6ae00088166
[0m19:28:26.550121 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'WAREHOUSE_SK'
[0m19:28:26.551040 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:28:26.066850 => 19:28:26.550632
[0m19:28:26.551713 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:28:26.593191 [debug] [Thread-1 (]: Database Error in model stg_tpcds__catalog_sales (models/staging/tpcds/stg_tpcds__catalog_sales.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'WAREHOUSE_SK'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m19:28:26.594043 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055328aad0>]}
[0m19:28:26.594988 [error] [Thread-1 (]: 1 of 8 ERROR creating sql view model intermediate.stg_tpcds__catalog_sales ..... [[31mERROR[0m in 0.54s]
[0m19:28:26.596024 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:28:26.596740 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m19:28:26.597695 [info ] [Thread-1 (]: 2 of 8 START sql view model intermediate.stg_tpcds__customer ................... [RUN]
[0m19:28:26.598830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m19:28:26.599603 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m19:28:26.604414 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m19:28:26.605863 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 19:28:26.600097 => 19:28:26.605474
[0m19:28:26.606568 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m19:28:26.611570 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m19:28:26.613238 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m19:28:26.613898 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer
  
   as (
    select 
    SALUTATION, 
    PREFERRED_CUST_FLAG, 
    FIRST_SALES_DATE_SK, 
    CUSTOMER_SK, 
    LOGIN, 
    CURRENT_CDEMO_SK, 
    FIRST_NAME, 
    CURRENT_HDEMO_SK, 
    CURRENT_ADDR_SK, 
    LAST_NAME, 
    CUSTOMER_ID, 
    LAST_REVIEW_DATE_SK, 
    BIRTH_MONTH, 
    BIRTH_COUNTRY, 
    BIRTH_YEAR, 
    BIRTH_DAY, 
    EMAIL_ADDRESS, 
    FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m19:28:26.614519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:26.967524 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8e96-0004-d6ae0008c0d6
[0m19:28:26.968296 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'SALUTATION'
[0m19:28:26.969196 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 19:28:26.607111 => 19:28:26.968822
[0m19:28:26.969847 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m19:28:27.024099 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer (models/staging/tpcds/stg_tpcds__customer.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'SALUTATION'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer.sql
[0m19:28:27.024981 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f05510cb520>]}
[0m19:28:27.025914 [error] [Thread-1 (]: 2 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer .......... [[31mERROR[0m in 0.43s]
[0m19:28:27.026883 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m19:28:27.027633 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m19:28:27.028580 [info ] [Thread-1 (]: 3 of 8 START sql view model intermediate.stg_tpcds__customer_address ........... [RUN]
[0m19:28:27.029724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m19:28:27.030469 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m19:28:27.034959 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m19:28:27.036463 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 19:28:27.030970 => 19:28:27.036072
[0m19:28:27.037213 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m19:28:27.042090 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m19:28:27.043583 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m19:28:27.044230 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_address
  
   as (
    select
    STREET_NAME, 
    SUITE_NUMBER, 
    STATE, 
    LOCATION_TYPE, 
    ADDRESS_SK, 
    COUNTRY, 
    ADDRESS_ID,
    COUNTY, 
    STREET_NUMBER,
    ZIP, 
    CITY, 
    STREET_TYPE, 
    GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m19:28:27.044870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:27.308758 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8e96-0004-d6ae0008c0da
[0m19:28:27.309535 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'STREET_NAME'
[0m19:28:27.310449 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 19:28:27.037707 => 19:28:27.310068
[0m19:28:27.311150 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m19:28:27.356196 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'STREET_NAME'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m19:28:27.357136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f05529589a0>]}
[0m19:28:27.358208 [error] [Thread-1 (]: 3 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer_address .. [[31mERROR[0m in 0.33s]
[0m19:28:27.359584 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m19:28:27.360431 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m19:28:27.361305 [info ] [Thread-1 (]: 4 of 8 START sql view model intermediate.stg_tpcds__customer_demographics ...... [RUN]
[0m19:28:27.362651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m19:28:27.363887 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m19:28:27.368411 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:28:27.369417 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 19:28:27.364479 => 19:28:27.369035
[0m19:28:27.370064 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m19:28:27.374849 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:28:27.376210 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m19:28:27.376858 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_demographics
  
   as (
    select
    DEP_EMPLOYED_COUNT, 
    DEMO_SK, 
    DEP_COUNT, 
    CREDIT_RATING, 
    EDUCATION_STATUS, 
    PURCHASE_ESTIMATE, 
    MARITAL_STATUS, 
    DEP_COLLEGE_COUNT, 
    GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m19:28:27.377485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:27.738793 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8ebd-0004-d6ae0008718a
[0m19:28:27.739631 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'DEP_EMPLOYED_COUNT'
[0m19:28:27.740553 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 19:28:27.370488 => 19:28:27.740164
[0m19:28:27.741224 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m19:28:27.780534 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'DEP_EMPLOYED_COUNT'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m19:28:27.781398 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055298c8e0>]}
[0m19:28:27.782357 [error] [Thread-1 (]: 4 of 8 ERROR creating sql view model intermediate.stg_tpcds__customer_demographics  [[31mERROR[0m in 0.42s]
[0m19:28:27.783402 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m19:28:27.784151 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m19:28:27.785075 [info ] [Thread-1 (]: 5 of 8 START sql view model intermediate.stg_tpcds__household_demographics ..... [RUN]
[0m19:28:27.786148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m19:28:27.786801 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m19:28:27.792780 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m19:28:27.793817 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 19:28:27.787254 => 19:28:27.793431
[0m19:28:27.794479 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m19:28:27.799362 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m19:28:27.800638 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m19:28:27.801311 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL, 
    HD_INCOME_BAND_SK, 
    HD_DEMO_SK, HD_DEP_COUNT, 
    HD_VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m19:28:27.801957 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:28.616054 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:28:28.643942 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 19:28:27.794894 => 19:28:28.643553
[0m19:28:28.644732 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m19:28:28.689920 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0552979f90>]}
[0m19:28:28.691086 [info ] [Thread-1 (]: 5 of 8 OK created sql view model intermediate.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.90s]
[0m19:28:28.692124 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m19:28:28.692872 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m19:28:28.693741 [info ] [Thread-1 (]: 6 of 8 START sql view model intermediate.stg_tpcds__income_band ................ [RUN]
[0m19:28:28.694791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m19:28:28.695466 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m19:28:28.699942 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m19:28:28.700979 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 19:28:28.695884 => 19:28:28.700598
[0m19:28:28.701649 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m19:28:28.706545 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m19:28:28.707748 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m19:28:28.708407 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.intermediate.stg_tpcds__income_band
  
   as (
    SELECT 
    LOWER_BOUND, 
    INCOME_BAND_SK, 
    UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m19:28:28.709046 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:28.991860 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8ebd-0004-d6ae0008718e
[0m19:28:28.992658 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'LOWER_BOUND'
[0m19:28:28.993578 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 19:28:28.702051 => 19:28:28.993190
[0m19:28:28.994248 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m19:28:29.041389 [debug] [Thread-1 (]: Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'LOWER_BOUND'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m19:28:29.042303 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f05529a5870>]}
[0m19:28:29.043304 [error] [Thread-1 (]: 6 of 8 ERROR creating sql view model intermediate.stg_tpcds__income_band ....... [[31mERROR[0m in 0.35s]
[0m19:28:29.044329 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m19:28:29.045084 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m19:28:29.046071 [info ] [Thread-1 (]: 7 of 8 START sql view model intermediate.stg_tpcds__inventory .................. [RUN]
[0m19:28:29.047176 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m19:28:29.047837 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m19:28:29.052401 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m19:28:29.053462 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 19:28:29.048251 => 19:28:29.053065
[0m19:28:29.054145 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m19:28:29.060844 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m19:28:29.062062 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m19:28:29.062725 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.intermediate.stg_tpcds__inventory
  
   as (
    SELECT 
    DATE_SK, 
    ITEM_SK, 
    QUANTITY_ON_HAND, 
    WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m19:28:29.063392 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:29.403173 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b102d0-0001-8e98-0004-d6ae0008a0f2
[0m19:28:29.403960 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 4
invalid identifier 'DATE_SK'
[0m19:28:29.404853 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 19:28:29.054562 => 19:28:29.404471
[0m19:28:29.405516 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m19:28:29.454072 [debug] [Thread-1 (]: Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'DATE_SK'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m19:28:29.454951 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f05510faf80>]}
[0m19:28:29.455953 [error] [Thread-1 (]: 7 of 8 ERROR creating sql view model intermediate.stg_tpcds__inventory ......... [[31mERROR[0m in 0.41s]
[0m19:28:29.456932 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m19:28:29.457728 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m19:28:29.458615 [info ] [Thread-1 (]: 8 of 8 START sql view model intermediate.stg_tpcds__web_sales .................. [RUN]
[0m19:28:29.459664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m19:28:29.460283 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m19:28:29.464796 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m19:28:29.465804 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 19:28:29.460679 => 19:28:29.465435
[0m19:28:29.466463 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m19:28:29.471361 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m19:28:29.473450 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m19:28:29.474138 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER, 
   WS_SHIP_MODE_SK, 
   WS_SOLD_TIME_SK, 
   WS_SHIP_ADDR_SK, 
   WS_NET_PAID_INC_TAX, 
   WS_PROMO_SK, 
   WS_NET_PAID_INC_SHIP, 
   WS_QUANTITY, 
   WS_EXT_SALES_PRICE, 
   WS_WEB_SITE_SK, 
   WS_SHIP_DATE_SK, 
   WS_BILL_CDEMO_SK, 
   WS_NET_PROFIT, 
   WS_NET_PAID, 
   WS_EXT_SHIP_COST, 
   WS_BILL_CUSTOMER_SK, 
   WS_COUPON_AMT, 
   WS_WHOLESALE_COST, 
   WS_SHIP_CUSTOMER_SK, 
   WS_BILL_HDEMO_SK, 
   WS_SOLD_DATE_SK, 
   WS_SHIP_CDEMO_SK, 
   WS_WAREHOUSE_SK, 
   WS_EXT_TAX, 
   WS_ITEM_SK, 
   WS_SHIP_HDEMO_SK, 
   WS_EXT_WHOLESALE_COST, 
   WS_NET_PAID_INC_SHIP_TAX, 
   WS_EXT_DISCOUNT_AMT, 
   WS_SALES_PRICE, 
   WS_WEB_PAGE_SK, 
   WS_EXT_LIST_PRICE, 
   WS_LIST_PRICE, 
   WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m19:28:29.474814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:28:29.951526 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:28:29.955574 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 19:28:29.466857 => 19:28:29.955209
[0m19:28:29.956218 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m19:28:29.996579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c76048d-bc61-4251-a201-2740ded6979f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0552959420>]}
[0m19:28:29.997651 [info ] [Thread-1 (]: 8 of 8 OK created sql view model intermediate.stg_tpcds__web_sales ............. [[32mSUCCESS 1[0m in 0.54s]
[0m19:28:29.998637 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m19:28:30.001101 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:28:30.001688 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m19:28:30.002311 [info ] [MainThread]: 
[0m19:28:30.002948 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 4.96 seconds (4.96s).
[0m19:28:30.005917 [debug] [MainThread]: Command end result
[0m19:28:30.019297 [info ] [MainThread]: 
[0m19:28:30.020081 [info ] [MainThread]: [31mCompleted with 6 errors and 0 warnings:[0m
[0m19:28:30.020666 [info ] [MainThread]: 
[0m19:28:30.021267 [error] [MainThread]:   Database Error in model stg_tpcds__catalog_sales (models/staging/tpcds/stg_tpcds__catalog_sales.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'WAREHOUSE_SK'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m19:28:30.021860 [info ] [MainThread]: 
[0m19:28:30.022446 [error] [MainThread]:   Database Error in model stg_tpcds__customer (models/staging/tpcds/stg_tpcds__customer.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'SALUTATION'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer.sql
[0m19:28:30.023072 [info ] [MainThread]: 
[0m19:28:30.023670 [error] [MainThread]:   Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'STREET_NAME'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m19:28:30.024270 [info ] [MainThread]: 
[0m19:28:30.024843 [error] [MainThread]:   Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'DEP_EMPLOYED_COUNT'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m19:28:30.025429 [info ] [MainThread]: 
[0m19:28:30.026090 [error] [MainThread]:   Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'LOWER_BOUND'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m19:28:30.026705 [info ] [MainThread]: 
[0m19:28:30.027371 [error] [MainThread]:   Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  000904 (42000): SQL compilation error: error line 5 at position 4
  invalid identifier 'DATE_SK'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m19:28:30.027986 [info ] [MainThread]: 
[0m19:28:30.028625 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=6 SKIP=0 TOTAL=8
[0m19:28:30.029948 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.4607654, "process_user_time": 5.763378, "process_kernel_time": 0.247969, "process_mem_max_rss": "162780", "process_out_blocks": "2904", "command_success": false, "process_in_blocks": "0"}
[0m19:28:30.030837 [debug] [MainThread]: Command `dbt run` failed at 19:28:30.030611 after 6.46 seconds
[0m19:28:30.031520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055e10ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055394fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f055394ff10>]}
[0m19:28:30.032278 [debug] [MainThread]: Flushing usage events
[0m19:38:05.582175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916ec02aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916ce47370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916ce44190>]}


============================== 19:38:05.585603 | 13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c ==============================
[0m19:38:05.585603 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:38:05.586380 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select stg_tpcds__catalog_sales', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:38:06.332194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9164ac31c0>]}
[0m19:38:06.472449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916468cf70>]}
[0m19:38:06.473577 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:38:06.483848 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:38:06.521529 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:38:06.522409 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m19:38:06.724242 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m19:38:06.731559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91643f5390>]}
[0m19:38:06.746756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916446b880>]}
[0m19:38:06.747672 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:38:06.748379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916446b7f0>]}
[0m19:38:06.750199 [info ] [MainThread]: 
[0m19:38:06.751440 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:38:06.753200 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:38:06.773393 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:38:06.774230 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:38:06.774882 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:38:07.286486 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:38:07.288829 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:38:07.334139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m19:38:07.346226 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:38:07.346996 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:38:07.347678 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:38:07.734066 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m19:38:07.736586 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:38:07.788341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91643fa110>]}
[0m19:38:07.789684 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:38:07.790368 [info ] [MainThread]: 
[0m19:38:07.793252 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:38:07.794030 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__catalog_sales .............. [RUN]
[0m19:38:07.795091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m19:38:07.796078 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:38:07.808191 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:38:07.809772 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:38:07.796572 => 19:38:07.809390
[0m19:38:07.810527 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:38:07.850532 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:38:07.853585 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:38:07.854278 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate.stg_tpcds__catalog_sales
  
   as (
    SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m19:38:07.854981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:38:08.390356 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:38:08.417933 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:38:07.811046 => 19:38:08.417555
[0m19:38:08.418808 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:38:08.476589 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '13ad6b28-0cbd-4fd1-8a7a-e5c73ddc785c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91635e7460>]}
[0m19:38:08.477805 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate.stg_tpcds__catalog_sales ......... [[32mSUCCESS 1[0m in 0.68s]
[0m19:38:08.478890 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:38:08.481379 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:38:08.481903 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__catalog_sales' was properly closed.
[0m19:38:08.482450 [info ] [MainThread]: 
[0m19:38:08.483080 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.73 seconds (1.73s).
[0m19:38:08.484410 [debug] [MainThread]: Command end result
[0m19:38:08.496132 [info ] [MainThread]: 
[0m19:38:08.496798 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:38:08.497370 [info ] [MainThread]: 
[0m19:38:08.497964 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:38:08.499176 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9833472, "process_user_time": 4.523949, "process_kernel_time": 0.255583, "process_mem_max_rss": "159212", "process_out_blocks": "2728", "process_in_blocks": "0"}
[0m19:38:08.500022 [debug] [MainThread]: Command `dbt run` succeeded at 19:38:08.499807 after 2.98 seconds
[0m19:38:08.500633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f916ec02aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9164927940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91635e4dc0>]}
[0m19:38:08.501259 [debug] [MainThread]: Flushing usage events
[0m21:19:57.975625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49d212650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49b3f8670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49b3faec0>]}


============================== 21:19:57.979131 | 5092c2de-4e09-4537-b5c1-a7d689bddb18 ==============================
[0m21:19:57.979131 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:19:57.979999 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds__customer_address', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:19:58.728207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49304bb80>]}
[0m21:19:58.866879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49304b2e0>]}
[0m21:19:58.868031 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:19:58.878635 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:19:58.917091 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:19:58.918001 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_address.sql
[0m21:19:58.918681 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m21:19:59.127391 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:19:59.134794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4929712a0>]}
[0m21:19:59.150015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4929e37c0>]}
[0m21:19:59.150896 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:19:59.151620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4929e3730>]}
[0m21:19:59.153455 [info ] [MainThread]: 
[0m21:19:59.154652 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:59.156346 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:19:59.176010 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:19:59.176742 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:19:59.177371 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:59.779724 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:19:59.782037 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:19:59.866598 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:19:59.878548 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:19:59.879162 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:19:59.879708 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:20:00.352982 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m21:20:00.355503 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:20:00.563617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd492957760>]}
[0m21:20:00.564872 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:20:00.565473 [info ] [MainThread]: 
[0m21:20:00.568643 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:20:00.569478 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__customer_address ........... [RUN]
[0m21:20:00.570545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__customer_address)
[0m21:20:00.571561 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:20:00.583143 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:20:00.584718 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:20:00.572076 => 21:20:00.584333
[0m21:20:00.585452 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:20:00.626084 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:20:00.628201 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:20:00.628872 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSE AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:20:00.629512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:01.052477 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b10340-0001-8ebd-0004-d6ae000871da
[0m21:20:01.053481 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 4
invalid identifier 'CA_GMT_OFFSE'
[0m21:20:01.054587 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:20:00.585960 => 21:20:01.054198
[0m21:20:01.055455 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:20:01.105689 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  000904 (42000): SQL compilation error: error line 17 at position 4
  invalid identifier 'CA_GMT_OFFSE'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m21:20:01.106811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5092c2de-4e09-4537-b5c1-a7d689bddb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd491b3fb80>]}
[0m21:20:01.107894 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model intermediate.stg_tpcds__customer_address .. [[31mERROR[0m in 0.54s]
[0m21:20:01.109063 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:20:01.111477 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:01.112037 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__customer_address' was properly closed.
[0m21:20:01.112588 [info ] [MainThread]: 
[0m21:20:01.113180 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.96 seconds (1.96s).
[0m21:20:01.114342 [debug] [MainThread]: Command end result
[0m21:20:01.126173 [info ] [MainThread]: 
[0m21:20:01.126935 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:20:01.127632 [info ] [MainThread]: 
[0m21:20:01.128313 [error] [MainThread]:   Database Error in model stg_tpcds__customer_address (models/staging/tpcds/stg_tpcds__customer_address.sql)
  000904 (42000): SQL compilation error: error line 17 at position 4
  invalid identifier 'CA_GMT_OFFSE'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_address.sql
[0m21:20:01.128996 [info ] [MainThread]: 
[0m21:20:01.129709 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:20:01.131057 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.2220242, "process_user_time": 4.557263, "process_kernel_time": 0.24489, "process_mem_max_rss": "159964", "process_out_blocks": "2752", "command_success": false, "process_in_blocks": "0"}
[0m21:20:01.132008 [debug] [MainThread]: Command `dbt run` failed at 21:20:01.131786 after 3.22 seconds
[0m21:20:01.132736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49d212650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd49304b2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd491b3fb80>]}
[0m21:20:01.133491 [debug] [MainThread]: Flushing usage events
[0m21:20:54.768627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fff30eaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fffc28df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fffc29150>]}


============================== 21:20:54.772072 | 1a0566fc-1c25-4cdc-b413-52bb6d7caee5 ==============================
[0m21:20:54.772072 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:20:54.772855 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds__customer_address', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:20:55.513166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fffbe67a0>]}
[0m21:20:55.651242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4d20ee0>]}
[0m21:20:55.652378 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:20:55.662933 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:20:55.701778 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:20:55.702728 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_address.sql
[0m21:20:55.703480 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer.sql
[0m21:20:55.917820 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:20:55.925476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4a79330>]}
[0m21:20:55.940269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4af7850>]}
[0m21:20:55.941090 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:20:55.941736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4af77c0>]}
[0m21:20:55.943600 [info ] [MainThread]: 
[0m21:20:55.944784 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:20:55.946393 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:20:55.966303 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:20:55.967052 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:20:55.967602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:56.446693 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:20:56.449123 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:20:56.531542 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:20:56.543519 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:20:56.544158 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:20:56.544697 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:20:56.912467 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m21:20:56.914890 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:20:56.964180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4a6a0b0>]}
[0m21:20:56.965435 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:20:56.966076 [info ] [MainThread]: 
[0m21:20:56.968909 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:20:56.969723 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__customer_address ........... [RUN]
[0m21:20:56.970768 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__customer_address)
[0m21:20:56.971561 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:20:56.983302 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:20:56.984826 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:20:56.972324 => 21:20:56.984428
[0m21:20:56.985568 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:20:57.026092 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:20:57.028059 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:20:57.028749 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:20:57.029403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:57.465467 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:20:57.493591 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:20:56.986078 => 21:20:57.493191
[0m21:20:57.494321 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:20:57.574389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a0566fc-1c25-4cdc-b413-52bb6d7caee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff444fc10>]}
[0m21:20:57.575554 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate.stg_tpcds__customer_address ...... [[32mSUCCESS 1[0m in 0.60s]
[0m21:20:57.576597 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:20:57.578875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:57.579479 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__customer_address' was properly closed.
[0m21:20:57.580054 [info ] [MainThread]: 
[0m21:20:57.580656 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.64 seconds (1.64s).
[0m21:20:57.582014 [debug] [MainThread]: Command end result
[0m21:20:57.593334 [info ] [MainThread]: 
[0m21:20:57.594079 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:20:57.594653 [info ] [MainThread]: 
[0m21:20:57.595307 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:20:57.596542 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.8948863, "process_user_time": 4.554208, "process_kernel_time": 0.228301, "process_mem_max_rss": "159180", "process_out_blocks": "2736", "process_in_blocks": "0"}
[0m21:20:57.597406 [debug] [MainThread]: Command `dbt run` succeeded at 21:20:57.597180 after 2.90 seconds
[0m21:20:57.598015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fff30eaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff574d0c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9ff4d20ee0>]}
[0m21:20:57.598646 [debug] [MainThread]: Flushing usage events
[0m21:21:16.803241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f391ce0ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f391b0b8fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f391b0b8bb0>]}


============================== 21:21:16.806637 | e4562353-452e-43b8-9c6d-38680dd975e4 ==============================
[0m21:21:16.806637 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:21:16.807462 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds__customer_demographics', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:21:17.563213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f391b077d30>]}
[0m21:21:17.705210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3912904f70>]}
[0m21:21:17.706446 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:21:17.716946 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:21:17.755713 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:21:17.756473 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:21:17.757619 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:21:17.765525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3912715570>]}
[0m21:21:17.779777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39126e3760>]}
[0m21:21:17.780567 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:21:17.781276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39126e36a0>]}
[0m21:21:17.783102 [info ] [MainThread]: 
[0m21:21:17.784305 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:21:17.786297 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:21:17.805663 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:21:17.806487 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:21:17.807236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:21:18.272305 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:21:18.274719 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:21:19.619122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:21:19.630941 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:21:19.631597 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:21:19.632133 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:21:19.973353 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m21:21:19.975786 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:21:20.014893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3912746110>]}
[0m21:21:20.016356 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:21:20.017070 [info ] [MainThread]: 
[0m21:21:20.020034 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:21:20.020839 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__customer_demographics ...... [RUN]
[0m21:21:20.021920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__customer_demographics)
[0m21:21:20.022678 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:21:20.034837 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:20.036524 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:21:20.023573 => 21:21:20.036116
[0m21:21:20.037274 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:21:20.076458 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:20.078421 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:20.079133 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDE AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:21:20.079798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:21:20.465802 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b10341-0001-8eb8-0004-d6ae000891ca
[0m21:21:20.466585 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 13 at position 4
invalid identifier 'CD_GENDE'
[0m21:21:20.467533 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:21:20.037792 => 21:21:20.467141
[0m21:21:20.468207 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:21:20.514385 [debug] [Thread-1 (]: Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  000904 (42000): SQL compilation error: error line 13 at position 4
  invalid identifier 'CD_GENDE'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m21:21:20.515287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4562353-452e-43b8-9c6d-38680dd975e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3911d1f970>]}
[0m21:21:20.516252 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model intermediate.stg_tpcds__customer_demographics  [[31mERROR[0m in 0.49s]
[0m21:21:20.517283 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:21:20.519986 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:21:20.520588 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__customer_demographics' was properly closed.
[0m21:21:20.521147 [info ] [MainThread]: 
[0m21:21:20.522031 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.74 seconds (2.74s).
[0m21:21:20.523202 [debug] [MainThread]: Command end result
[0m21:21:20.535427 [info ] [MainThread]: 
[0m21:21:20.536175 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:21:20.536740 [info ] [MainThread]: 
[0m21:21:20.537304 [error] [MainThread]:   Database Error in model stg_tpcds__customer_demographics (models/staging/tpcds/stg_tpcds__customer_demographics.sql)
  000904 (42000): SQL compilation error: error line 13 at position 4
  invalid identifier 'CD_GENDE'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m21:21:20.537883 [info ] [MainThread]: 
[0m21:21:20.538475 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:21:20.539704 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.80469, "process_user_time": 4.296525, "process_kernel_time": 0.200686, "process_mem_max_rss": "157664", "process_out_blocks": "1856", "command_success": false, "process_in_blocks": "0"}
[0m21:21:20.540555 [debug] [MainThread]: Command `dbt run` failed at 21:21:20.540338 after 3.81 seconds
[0m21:21:20.541174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f391ce0ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39129d95a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3911d027a0>]}
[0m21:21:20.541790 [debug] [MainThread]: Flushing usage events
[0m21:21:37.721670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b5abdec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b58960fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b58960bb0>]}


============================== 21:21:37.725117 | eff804bc-94e4-4a90-8400-205530807e29 ==============================
[0m21:21:37.725117 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:21:37.725912 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select stg_tpcds__customer_demographics', 'send_anonymous_usage_stats': 'True'}
[0m21:21:38.472839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b5891fd30>]}
[0m21:21:38.615095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b5017cf70>]}
[0m21:21:38.616258 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:21:38.627110 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:21:38.666764 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:21:38.667871 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m21:21:38.878567 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:21:38.886647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b4fee5330>]}
[0m21:21:38.902477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b4ff5f7c0>]}
[0m21:21:38.903386 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:21:38.904073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b4ff5f790>]}
[0m21:21:38.905925 [info ] [MainThread]: 
[0m21:21:38.907178 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:21:38.909376 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:21:38.929322 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:21:38.930174 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:21:38.930814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:21:39.367543 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:21:39.369841 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:21:39.426944 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:21:39.438864 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:21:39.439522 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:21:39.440049 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:21:39.863225 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m21:21:39.865626 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:21:39.915559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b4feea230>]}
[0m21:21:39.916933 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:21:39.917628 [info ] [MainThread]: 
[0m21:21:39.920533 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:21:39.921337 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__customer_demographics ...... [RUN]
[0m21:21:39.922372 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__customer_demographics)
[0m21:21:39.923405 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:21:39.935664 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:39.937183 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:21:39.923907 => 21:21:39.936797
[0m21:21:39.937943 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:21:39.978133 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:39.980089 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:21:39.980762 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:21:39.981400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:21:40.453989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:21:40.482245 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:21:39.938431 => 21:21:40.481866
[0m21:21:40.483235 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:21:40.540343 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eff804bc-94e4-4a90-8400-205530807e29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b4f0b7df0>]}
[0m21:21:40.541618 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate.stg_tpcds__customer_demographics . [[32mSUCCESS 1[0m in 0.62s]
[0m21:21:40.542710 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:21:40.545071 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:21:40.545634 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__customer_demographics' was properly closed.
[0m21:21:40.546187 [info ] [MainThread]: 
[0m21:21:40.546782 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.64 seconds (1.64s).
[0m21:21:40.548193 [debug] [MainThread]: Command end result
[0m21:21:40.559488 [info ] [MainThread]: 
[0m21:21:40.560136 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:21:40.560695 [info ] [MainThread]: 
[0m21:21:40.561291 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:21:40.562457 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9087336, "process_user_time": 4.583088, "process_kernel_time": 0.236173, "process_mem_max_rss": "158948", "process_out_blocks": "2736", "process_in_blocks": "0"}
[0m21:21:40.563327 [debug] [MainThread]: Command `dbt run` succeeded at 21:21:40.563115 after 2.91 seconds
[0m21:21:40.563939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b5abdec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b505b3640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1b5017cf70>]}
[0m21:21:40.564549 [debug] [MainThread]: Flushing usage events
[0m21:22:37.872706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0b3df6680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0b1e5c160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0b1e5f5e0>]}


============================== 21:22:37.876106 | 6941aeaf-a291-4ffa-b8b8-5ac2de25a342 ==============================
[0m21:22:37.876106 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:22:37.876883 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select stg_tpcds__customer', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:22:38.623968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a9aa27a0>]}
[0m21:22:38.761658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a9aa3460>]}
[0m21:22:38.762781 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:22:38.773239 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:22:38.811744 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:22:38.812667 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__household_demographics.sql
[0m21:22:39.015639 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:22:39.022829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a93d5270>]}
[0m21:22:39.037651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a964b760>]}
[0m21:22:39.038480 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:22:39.039194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a964b6d0>]}
[0m21:22:39.041049 [info ] [MainThread]: 
[0m21:22:39.042237 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:22:39.044356 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:22:39.064012 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:22:39.064762 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:22:39.065422 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:22:39.768655 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:22:39.770923 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:22:39.867891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:22:39.879944 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:22:39.880690 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:22:39.881325 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:22:40.452938 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.0 seconds
[0m21:22:40.455621 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:22:40.536139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a93dbd90>]}
[0m21:22:40.537478 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:22:40.538156 [info ] [MainThread]: 
[0m21:22:40.541023 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:22:40.541797 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__customer ................... [RUN]
[0m21:22:40.542821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__customer)
[0m21:22:40.543570 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:22:40.555244 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:22:40.556734 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:22:40.544286 => 21:22:40.556358
[0m21:22:40.557445 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:22:40.597438 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m21:22:40.599759 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m21:22:40.600438 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m21:22:40.601084 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:41.386526 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:22:41.414141 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:22:40.557943 => 21:22:41.413777
[0m21:22:41.414850 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m21:22:41.509348 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6941aeaf-a291-4ffa-b8b8-5ac2de25a342', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a85a3ee0>]}
[0m21:22:41.510397 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate.stg_tpcds__customer .............. [[32mSUCCESS 1[0m in 0.97s]
[0m21:22:41.511427 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:22:41.513787 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:22:41.514325 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__customer' was properly closed.
[0m21:22:41.514905 [info ] [MainThread]: 
[0m21:22:41.516670 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.47 seconds (2.47s).
[0m21:22:41.517802 [debug] [MainThread]: Command end result
[0m21:22:41.528906 [info ] [MainThread]: 
[0m21:22:41.529605 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:22:41.530188 [info ] [MainThread]: 
[0m21:22:41.530802 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:22:41.532113 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7255642, "process_user_time": 4.47197, "process_kernel_time": 0.275744, "process_mem_max_rss": "158968", "process_out_blocks": "2744", "process_in_blocks": "0"}
[0m21:22:41.532979 [debug] [MainThread]: Command `dbt run` succeeded at 21:22:41.532757 after 3.73 seconds
[0m21:22:41.533594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0b3df6680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a9aa27a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0a8edf040>]}
[0m21:22:41.534221 [debug] [MainThread]: Flushing usage events
[0m21:24:54.248421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c31809690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2fab9420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2fab8b80>]}


============================== 21:24:54.251849 | dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af ==============================
[0m21:24:54.251849 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:24:54.252621 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_tpcds__household_demographics', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:24:54.999286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2fab8d00>]}
[0m21:24:55.138464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c274e6920>]}
[0m21:24:55.139630 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:24:55.150159 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:24:55.189602 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:24:55.190252 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:24:55.191344 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:24:55.199330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c27111540>]}
[0m21:24:55.212957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c270e0130>]}
[0m21:24:55.213721 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:24:55.214346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c270e3670>]}
[0m21:24:55.216303 [info ] [MainThread]: 
[0m21:24:55.217492 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:24:55.219194 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:24:55.239345 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:24:55.240179 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:24:55.240900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:55.640689 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:24:55.643201 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:24:55.716571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:24:55.728626 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:24:55.729356 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:24:55.730005 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:24:56.099397 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:24:56.101997 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:24:56.148406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c27142230>]}
[0m21:24:56.149584 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:24:56.150209 [info ] [MainThread]: 
[0m21:24:56.152986 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:24:56.153761 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate.stg_tpcds__household_demographics ..... [RUN]
[0m21:24:56.154785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__household_demographics)
[0m21:24:56.155702 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:24:56.167175 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:24:56.168181 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:24:56.156122 => 21:24:56.167812
[0m21:24:56.168807 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:24:56.207682 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m21:24:56.209153 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m21:24:56.209781 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_S, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m21:24:56.210407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:56.760626 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:24:56.791816 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:24:56.169203 => 21:24:56.791434
[0m21:24:56.792688 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m21:24:56.841666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca5a1bf-7225-40b2-b9a2-5bd96d1bc7af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c26717ca0>]}
[0m21:24:56.842873 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.69s]
[0m21:24:56.844002 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:24:56.846424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:24:56.846985 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__household_demographics' was properly closed.
[0m21:24:56.847591 [info ] [MainThread]: 
[0m21:24:56.848214 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.63 seconds (1.63s).
[0m21:24:56.849603 [debug] [MainThread]: Command end result
[0m21:24:56.861981 [info ] [MainThread]: 
[0m21:24:56.862664 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:24:56.863328 [info ] [MainThread]: 
[0m21:24:56.863949 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:24:56.865176 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6837673, "process_user_time": 4.225592, "process_kernel_time": 0.291245, "process_mem_max_rss": "156772", "process_out_blocks": "1856", "process_in_blocks": "0"}
[0m21:24:56.866052 [debug] [MainThread]: Command `dbt run` succeeded at 21:24:56.865829 after 2.68 seconds
[0m21:24:56.866658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c31809690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2759b220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c266fb640>]}
[0m21:24:56.867321 [debug] [MainThread]: Flushing usage events
[0m21:35:25.142574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1d030a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1ce545990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1ce544670>]}


============================== 21:35:25.146155 | 0178ceba-3cd8-4500-b718-19da419594f8 ==============================
[0m21:35:25.146155 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:35:25.146940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.tpcds*', 'send_anonymous_usage_stats': 'True'}
[0m21:35:25.899260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1ce545b10>]}
[0m21:35:26.038694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c5faf2e0>]}
[0m21:35:26.039896 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:35:26.050802 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:35:26.064724 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:35:26.065477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c5eacee0>]}
[0m21:35:27.667807 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:35:27.675487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c55840d0>]}
[0m21:35:27.690162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c5584070>]}
[0m21:35:27.690969 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:35:27.691607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c5f04ac0>]}
[0m21:35:27.694029 [info ] [MainThread]: 
[0m21:35:27.695215 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:35:27.697502 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:35:27.717207 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:35:27.718132 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:35:27.718845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:35:28.426855 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:35:28.429430 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:35:29.300697 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate_staging)
[0m21:35:29.301859 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate_staging"
"
[0m21:35:29.309027 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate_staging"
[0m21:35:29.309599 [debug] [ThreadPool]: On create_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate_staging"} */
create schema if not exists tpcds.intermediate_staging
[0m21:35:29.310126 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:29.727472 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:35:29.729050 [debug] [ThreadPool]: On create_tpcds_intermediate_staging: Close
[0m21:35:29.779439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate_staging, now list_tpcds_intermediate_staging)
[0m21:35:29.791411 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m21:35:29.792008 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m21:35:29.792538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:30.189310 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m21:35:30.191488 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m21:35:30.291732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c556bbe0>]}
[0m21:35:30.293072 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:35:30.293702 [info ] [MainThread]: 
[0m21:35:30.296744 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m21:35:30.297543 [info ] [Thread-1 (]: 1 of 8 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m21:35:30.298605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m21:35:30.299400 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m21:35:30.311427 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:35:30.312952 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 21:35:30.299911 => 21:35:30.312551
[0m21:35:30.313709 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m21:35:30.354577 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:35:30.357722 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m21:35:30.358453 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m21:35:30.359203 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:31.511986 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:35:31.539611 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 21:35:30.314234 => 21:35:31.539239
[0m21:35:31.540319 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m21:35:31.581761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c556f220>]}
[0m21:35:31.582816 [info ] [Thread-1 (]: 1 of 8 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 1.28s]
[0m21:35:31.583872 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m21:35:31.584591 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:35:31.585305 [info ] [Thread-1 (]: 2 of 8 START sql view model intermediate_staging.stg_tpcds__customer ........... [RUN]
[0m21:35:31.586593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m21:35:31.587347 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:35:31.592202 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:35:31.593668 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:35:31.587843 => 21:35:31.593287
[0m21:35:31.594421 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:35:31.599484 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m21:35:31.601539 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m21:35:31.602217 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m21:35:31.602860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:32.251844 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:35:32.255942 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:35:31.594916 => 21:35:32.255580
[0m21:35:32.256596 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m21:35:32.304988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c5585960>]}
[0m21:35:32.306057 [info ] [Thread-1 (]: 2 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer ...... [[32mSUCCESS 1[0m in 0.72s]
[0m21:35:32.307065 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:35:32.307792 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:35:32.308653 [info ] [Thread-1 (]: 3 of 8 START sql view model intermediate_staging.stg_tpcds__customer_address ... [RUN]
[0m21:35:32.309695 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m21:35:32.310317 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:35:32.316085 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:35:32.317117 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:35:32.310719 => 21:35:32.316747
[0m21:35:32.317774 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:35:32.322662 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:35:32.324257 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:35:32.324918 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:35:32.325556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:32.724269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:35:32.728450 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:35:32.318175 => 21:35:32.728096
[0m21:35:32.729207 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:35:32.787342 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c55e15a0>]}
[0m21:35:32.788546 [info ] [Thread-1 (]: 3 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_address  [[32mSUCCESS 1[0m in 0.48s]
[0m21:35:32.789640 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:35:32.790463 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:35:32.791446 [info ] [Thread-1 (]: 4 of 8 START sql view model intermediate_staging.stg_tpcds__customer_demographics  [RUN]
[0m21:35:32.792563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m21:35:32.793295 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:35:32.797919 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:35:32.799446 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:35:32.793783 => 21:35:32.799069
[0m21:35:32.800163 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:35:32.805195 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:35:32.806905 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:35:32.807589 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:35:32.808223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:33.248119 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:35:33.252246 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:35:32.800658 => 21:35:33.251886
[0m21:35:33.252921 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:35:33.720668 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c55e1ed0>]}
[0m21:35:33.721735 [info ] [Thread-1 (]: 4 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_demographics  [[32mSUCCESS 1[0m in 0.93s]
[0m21:35:33.722737 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:35:33.723495 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:35:33.724347 [info ] [Thread-1 (]: 5 of 8 START sql view model intermediate_staging.stg_tpcds__household_demographics  [RUN]
[0m21:35:33.725404 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m21:35:33.726038 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:35:33.730566 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:35:33.731612 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:35:33.726446 => 21:35:33.731237
[0m21:35:33.732260 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:35:33.738795 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m21:35:33.740174 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m21:35:33.740812 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_S, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m21:35:33.741439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:34.183362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:35:34.187594 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:35:33.732649 => 21:35:34.187214
[0m21:35:34.188260 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m21:35:34.240843 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c428ee30>]}
[0m21:35:34.241911 [info ] [Thread-1 (]: 5 of 8 OK created sql view model intermediate_staging.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.52s]
[0m21:35:34.242939 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:35:34.243726 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m21:35:34.244589 [info ] [Thread-1 (]: 6 of 8 START sql view model intermediate_staging.stg_tpcds__income_band ........ [RUN]
[0m21:35:34.245652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m21:35:34.246300 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m21:35:34.251069 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m21:35:34.252154 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 21:35:34.246720 => 21:35:34.251776
[0m21:35:34.252819 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m21:35:34.257951 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m21:35:34.259257 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m21:35:34.259925 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUN AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m21:35:34.260555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:35.027722 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1034f-0001-8e9a-0004-d6ae0008824e
[0m21:35:35.028616 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 4
invalid identifier 'IB_UPPER_BOUN'
[0m21:35:35.029609 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 21:35:34.253244 => 21:35:35.029223
[0m21:35:35.030357 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m21:35:35.074336 [debug] [Thread-1 (]: Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  000904 (42000): SQL compilation error: error line 7 at position 4
  invalid identifier 'IB_UPPER_BOUN'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m21:35:35.075363 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c425c640>]}
[0m21:35:35.076399 [error] [Thread-1 (]: 6 of 8 ERROR creating sql view model intermediate_staging.stg_tpcds__income_band  [[31mERROR[0m in 0.83s]
[0m21:35:35.077502 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m21:35:35.078335 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m21:35:35.079314 [info ] [Thread-1 (]: 7 of 8 START sql view model intermediate_staging.stg_tpcds__inventory .......... [RUN]
[0m21:35:35.080468 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m21:35:35.081206 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m21:35:35.085889 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m21:35:35.087375 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 21:35:35.081710 => 21:35:35.086971
[0m21:35:35.088113 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m21:35:35.093222 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m21:35:35.094589 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m21:35:35.095264 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_S AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m21:35:35.095882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:35.421628 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1034f-0001-8eb8-0004-d6ae00089276
[0m21:35:35.422437 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 8 at position 4
invalid identifier 'INV_WAREHOUSE_S'
[0m21:35:35.423427 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 21:35:35.088612 => 21:35:35.422959
[0m21:35:35.424101 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m21:35:35.492025 [debug] [Thread-1 (]: Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  000904 (42000): SQL compilation error: error line 8 at position 4
  invalid identifier 'INV_WAREHOUSE_S'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m21:35:35.492910 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c4195750>]}
[0m21:35:35.493837 [error] [Thread-1 (]: 7 of 8 ERROR creating sql view model intermediate_staging.stg_tpcds__inventory . [[31mERROR[0m in 0.41s]
[0m21:35:35.494808 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m21:35:35.495553 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m21:35:35.496491 [info ] [Thread-1 (]: 8 of 8 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m21:35:35.497604 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m21:35:35.498338 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m21:35:35.502993 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m21:35:35.504487 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 21:35:35.498836 => 21:35:35.504111
[0m21:35:35.505226 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m21:35:35.510368 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m21:35:35.513245 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m21:35:35.513958 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m21:35:35.514659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:35.974838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:35:35.978922 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 21:35:35.505732 => 21:35:35.978569
[0m21:35:35.979601 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m21:35:36.027574 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0178ceba-3cd8-4500-b718-19da419594f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c41950f0>]}
[0m21:35:36.028666 [info ] [Thread-1 (]: 8 of 8 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.53s]
[0m21:35:36.029650 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m21:35:36.032071 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:35:36.032656 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m21:35:36.033259 [info ] [MainThread]: 
[0m21:35:36.033893 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 8.34 seconds (8.34s).
[0m21:35:36.037141 [debug] [MainThread]: Command end result
[0m21:35:36.049064 [info ] [MainThread]: 
[0m21:35:36.049740 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m21:35:36.050316 [info ] [MainThread]: 
[0m21:35:36.050896 [error] [MainThread]:   Database Error in model stg_tpcds__income_band (models/staging/tpcds/stg_tpcds__income_band.sql)
  000904 (42000): SQL compilation error: error line 7 at position 4
  invalid identifier 'IB_UPPER_BOUN'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__income_band.sql
[0m21:35:36.051561 [info ] [MainThread]: 
[0m21:35:36.052136 [error] [MainThread]:   Database Error in model stg_tpcds__inventory (models/staging/tpcds/stg_tpcds__inventory.sql)
  000904 (42000): SQL compilation error: error line 8 at position 4
  invalid identifier 'INV_WAREHOUSE_S'
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__inventory.sql
[0m21:35:36.052739 [info ] [MainThread]: 
[0m21:35:36.053346 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=2 SKIP=0 TOTAL=8
[0m21:35:36.054588 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.980396, "process_user_time": 7.039155, "process_kernel_time": 0.27903, "process_mem_max_rss": "163540", "process_out_blocks": "2928", "command_success": false, "process_in_blocks": "0"}
[0m21:35:36.055497 [debug] [MainThread]: Command `dbt run` failed at 21:35:36.055265 after 10.98 seconds
[0m21:35:36.056130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1d030a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1ce545b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd1c55e12a0>]}
[0m21:35:36.056772 [debug] [MainThread]: Flushing usage events
[0m21:36:10.122322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899df12c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c11ad40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c11b130>]}


============================== 21:36:10.125751 | f311b945-5269-40e1-807d-e22addd44034 ==============================
[0m21:36:10.125751 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:36:10.126510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.tpcds*', 'send_anonymous_usage_stats': 'True'}
[0m21:36:10.875682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c0d7d30>]}
[0m21:36:11.016504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c0d77f0>]}
[0m21:36:11.017672 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:36:11.028389 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:36:11.067690 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:36:11.068649 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__income_band.sql
[0m21:36:11.069348 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__inventory.sql
[0m21:36:11.278202 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:36:11.285691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89936bd2a0>]}
[0m21:36:11.301005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899373b7c0>]}
[0m21:36:11.301861 [info ] [MainThread]: Found 8 models, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m21:36:11.302718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899373b730>]}
[0m21:36:11.305301 [info ] [MainThread]: 
[0m21:36:11.306549 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:36:11.308701 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:36:11.327968 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:36:11.328706 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:36:11.329341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:36:12.434953 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m21:36:12.437454 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:36:12.487622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_staging)
[0m21:36:12.499702 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m21:36:12.500399 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m21:36:12.501043 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:36:12.911907 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:36:12.914542 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m21:36:13.042803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899367b760>]}
[0m21:36:13.044065 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:36:13.044658 [info ] [MainThread]: 
[0m21:36:13.047591 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m21:36:13.048360 [info ] [Thread-1 (]: 1 of 8 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m21:36:13.049419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m21:36:13.050157 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m21:36:13.061901 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:36:13.063511 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 21:36:13.050646 => 21:36:13.063113
[0m21:36:13.064262 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m21:36:13.104687 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:36:13.107633 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m21:36:13.108332 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m21:36:13.109024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:13.638339 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:36:13.669942 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 21:36:13.064775 => 21:36:13.669546
[0m21:36:13.670674 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m21:36:13.710947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89937386a0>]}
[0m21:36:13.712051 [info ] [Thread-1 (]: 1 of 8 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.66s]
[0m21:36:13.713094 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m21:36:13.713840 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:36:13.714708 [info ] [Thread-1 (]: 2 of 8 START sql view model intermediate_staging.stg_tpcds__customer ........... [RUN]
[0m21:36:13.715788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m21:36:13.716433 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:36:13.720961 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:36:13.721993 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:36:13.716839 => 21:36:13.721616
[0m21:36:13.722654 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:36:13.727722 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m21:36:13.729671 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m21:36:13.730354 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m21:36:13.731051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:14.221518 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:14.226106 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:36:13.723098 => 21:36:14.225754
[0m21:36:14.226868 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m21:36:14.278306 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899282c6a0>]}
[0m21:36:14.279540 [info ] [Thread-1 (]: 2 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer ...... [[32mSUCCESS 1[0m in 0.56s]
[0m21:36:14.280627 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:36:14.281460 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:36:14.282267 [info ] [Thread-1 (]: 3 of 8 START sql view model intermediate_staging.stg_tpcds__customer_address ... [RUN]
[0m21:36:14.283459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m21:36:14.284199 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:36:14.289009 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:36:14.290473 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:36:14.284700 => 21:36:14.290103
[0m21:36:14.291247 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:36:14.297463 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:36:14.299181 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:36:14.299828 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:36:14.300458 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:14.744545 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:14.749087 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:36:14.291738 => 21:36:14.748730
[0m21:36:14.749842 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:36:14.795588 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89931cbfd0>]}
[0m21:36:14.796794 [info ] [Thread-1 (]: 3 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_address  [[32mSUCCESS 1[0m in 0.51s]
[0m21:36:14.797875 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:36:14.798707 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:36:14.799555 [info ] [Thread-1 (]: 4 of 8 START sql view model intermediate_staging.stg_tpcds__customer_demographics  [RUN]
[0m21:36:14.800688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m21:36:14.801422 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:36:14.806393 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:36:14.808005 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:36:14.801915 => 21:36:14.807610
[0m21:36:14.808751 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:36:14.813960 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:36:14.815839 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:36:14.816533 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:36:14.817181 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:15.254693 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:15.259338 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:36:14.809272 => 21:36:15.258937
[0m21:36:15.260028 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:36:15.301639 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89931bf280>]}
[0m21:36:15.302714 [info ] [Thread-1 (]: 4 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_demographics  [[32mSUCCESS 1[0m in 0.50s]
[0m21:36:15.303754 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:36:15.304505 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:36:15.305384 [info ] [Thread-1 (]: 5 of 8 START sql view model intermediate_staging.stg_tpcds__household_demographics  [RUN]
[0m21:36:15.306452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m21:36:15.307156 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:36:15.311681 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:36:15.312718 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:36:15.307576 => 21:36:15.312341
[0m21:36:15.313360 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:36:15.318405 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m21:36:15.319783 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m21:36:15.320458 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_S, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m21:36:15.321092 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:15.755657 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:15.760041 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:36:15.313764 => 21:36:15.759689
[0m21:36:15.760679 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m21:36:15.818482 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8990f21030>]}
[0m21:36:15.819578 [info ] [Thread-1 (]: 5 of 8 OK created sql view model intermediate_staging.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.51s]
[0m21:36:15.820555 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:36:15.821269 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m21:36:15.822094 [info ] [Thread-1 (]: 6 of 8 START sql view model intermediate_staging.stg_tpcds__income_band ........ [RUN]
[0m21:36:15.823148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m21:36:15.823786 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m21:36:15.828349 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m21:36:15.829358 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 21:36:15.824180 => 21:36:15.828985
[0m21:36:15.829981 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m21:36:15.834842 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m21:36:15.836085 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m21:36:15.836714 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m21:36:15.837343 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:16.282939 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:16.287131 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 21:36:15.830376 => 21:36:16.286757
[0m21:36:16.287882 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m21:36:16.337078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8990f21a20>]}
[0m21:36:16.338285 [info ] [Thread-1 (]: 6 of 8 OK created sql view model intermediate_staging.stg_tpcds__income_band ... [[32mSUCCESS 1[0m in 0.51s]
[0m21:36:16.339383 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m21:36:16.340224 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m21:36:16.341057 [info ] [Thread-1 (]: 7 of 8 START sql view model intermediate_staging.stg_tpcds__inventory .......... [RUN]
[0m21:36:16.342184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m21:36:16.342907 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m21:36:16.347659 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m21:36:16.349103 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 21:36:16.343442 => 21:36:16.348727
[0m21:36:16.349809 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m21:36:16.354805 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m21:36:16.356186 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m21:36:16.356824 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m21:36:16.357439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:16.747731 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:16.751720 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 21:36:16.350312 => 21:36:16.751355
[0m21:36:16.752354 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m21:36:16.809735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899367b070>]}
[0m21:36:16.810821 [info ] [Thread-1 (]: 7 of 8 OK created sql view model intermediate_staging.stg_tpcds__inventory ..... [[32mSUCCESS 1[0m in 0.47s]
[0m21:36:16.811845 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m21:36:16.812555 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m21:36:16.813382 [info ] [Thread-1 (]: 8 of 8 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m21:36:16.814421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m21:36:16.815070 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m21:36:16.821733 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m21:36:16.822742 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 21:36:16.815478 => 21:36:16.822374
[0m21:36:16.823374 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m21:36:16.828179 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m21:36:16.830848 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m21:36:16.831577 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m21:36:16.832252 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:17.311175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:36:17.315664 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 21:36:16.823767 => 21:36:17.315309
[0m21:36:17.316302 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m21:36:17.398389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f311b945-5269-40e1-807d-e22addd44034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899367b3d0>]}
[0m21:36:17.399653 [info ] [Thread-1 (]: 8 of 8 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.58s]
[0m21:36:17.400785 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m21:36:17.403296 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:36:17.403849 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m21:36:17.404466 [info ] [MainThread]: 
[0m21:36:17.405194 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 6.10 seconds (6.10s).
[0m21:36:17.408552 [debug] [MainThread]: Command end result
[0m21:36:17.421215 [info ] [MainThread]: 
[0m21:36:17.422069 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:36:17.422771 [info ] [MainThread]: 
[0m21:36:17.423552 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m21:36:17.424910 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.3700533, "process_user_time": 5.531467, "process_kernel_time": 0.298791, "process_mem_max_rss": "160228", "process_out_blocks": "2936", "process_in_blocks": "0"}
[0m21:36:17.425879 [debug] [MainThread]: Command `dbt run` succeeded at 21:36:17.425645 after 7.37 seconds
[0m21:36:17.426604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899df12c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c0d7d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899367b3d0>]}
[0m21:36:17.427623 [debug] [MainThread]: Flushing usage events
[0m23:43:57.124149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe597f5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe5785d420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe5785cb80>]}


============================== 23:43:57.127526 | c007a42c-125b-46f0-b2fa-381130a2814d ==============================
[0m23:43:57.127526 [info ] [MainThread]: Running with dbt=1.7.3
[0m23:43:57.128300 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select customer_snapshot', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:43:57.868684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c007a42c-125b-46f0-b2fa-381130a2814d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4f4a2ad0>]}
[0m23:43:58.006880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c007a42c-125b-46f0-b2fa-381130a2814d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4f073d30>]}
[0m23:43:58.008049 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m23:43:58.018642 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m23:43:58.056955 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:43:58.057780 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/customer_snapshot.sql
[0m23:43:58.238249 [error] [MainThread]: Encountered an error:
Compilation Error in model customer_snapshot (models/intermediate/customer_snapshot.sql)
  Encountered unknown tag 'snapshot'.
    line 1
      {%  snapshot customer_snapshot %}
[0m23:43:58.239609 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1817425, "process_user_time": 3.894221, "process_kernel_time": 0.187937, "process_mem_max_rss": "148944", "process_in_blocks": "8", "process_out_blocks": "8", "command_success": false}
[0m23:43:58.240456 [debug] [MainThread]: Command `dbt run` failed at 23:43:58.240246 after 1.18 seconds
[0m23:43:58.241049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe597f5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4eed08e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efe4eed0a30>]}
[0m23:43:58.241676 [debug] [MainThread]: Flushing usage events
[0m23:45:44.854581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad71409690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad6f6b9420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad6f6b8b80>]}


============================== 23:45:44.857970 | 19c25788-9ec5-4feb-9ce2-7730bdfe1ccc ==============================
[0m23:45:44.857970 [info ] [MainThread]: Running with dbt=1.7.3
[0m23:45:44.858772 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select customer_snapshot', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:45:45.610196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '19c25788-9ec5-4feb-9ce2-7730bdfe1ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad67322ad0>]}
[0m23:45:45.748574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '19c25788-9ec5-4feb-9ce2-7730bdfe1ccc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad66eebd30>]}
[0m23:45:45.749711 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m23:45:45.760437 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m23:45:45.799944 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:45:45.800838 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/customer_snapshot.sql
[0m23:45:45.983482 [error] [MainThread]: Encountered an error:
Compilation Error in model customer_snapshot (models/intermediate/customer_snapshot.sql)
  Encountered unknown tag 'snapshot'.
    line 1
      {%  snapshot customer_snapshot %}
[0m23:45:45.984833 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1966399, "process_user_time": 3.917242, "process_kernel_time": 0.224045, "process_mem_max_rss": "148948", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m23:45:45.985703 [debug] [MainThread]: Command `dbt run` failed at 23:45:45.985486 after 1.20 seconds
[0m23:45:45.986316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad71409690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad66d408e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad66d40a30>]}
[0m23:45:45.986965 [debug] [MainThread]: Flushing usage events
[0m23:49:18.778202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210b001690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210925d420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210925cb80>]}


============================== 23:49:18.781593 | 2a08090a-6ac5-4239-b1ce-76f3e8b34d72 ==============================
[0m23:49:18.781593 [info ] [MainThread]: Running with dbt=1.7.3
[0m23:49:18.782370 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --select customer_snapshot', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:49:19.530731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a08090a-6ac5-4239-b1ce-76f3e8b34d72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2100edead0>]}
[0m23:49:19.668652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a08090a-6ac5-4239-b1ce-76f3e8b34d72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2100aabd30>]}
[0m23:49:19.669787 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m23:49:19.680284 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m23:49:19.718858 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:49:19.719725 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/customer_snapshot.sql
[0m23:49:19.899304 [error] [MainThread]: Encountered an error:
Compilation Error in model customer_snapshot (models/intermediate/customer_snapshot.sql)
  Encountered unknown tag 'snapshot'.
    line 1
      {%  snapshot customer_snapshot %}
[0m23:49:19.900629 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 1.1889243, "process_user_time": 3.888732, "process_kernel_time": 0.195641, "process_mem_max_rss": "148860", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m23:49:19.901471 [debug] [MainThread]: Command `dbt snapshot` failed at 23:49:19.901260 after 1.19 seconds
[0m23:49:19.902079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210b001690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210090c8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210090ca30>]}
[0m23:49:19.902703 [debug] [MainThread]: Flushing usage events
[0m23:52:40.217020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17d7002680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17d525c160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17d525f5e0>]}


============================== 23:52:40.220441 | 5fa04f53-91a0-4eb0-b3e2-4210bf818071 ==============================
[0m23:52:40.220441 [info ] [MainThread]: Running with dbt=1.7.3
[0m23:52:40.221222 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt snapshot --select customer_snapshot', 'send_anonymous_usage_stats': 'True'}
[0m23:52:40.965373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fa04f53-91a0-4eb0-b3e2-4210bf818071', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ccede7a0>]}
[0m23:52:41.108130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fa04f53-91a0-4eb0-b3e2-4210bf818071', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ccedf460>]}
[0m23:52:41.109287 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m23:52:41.119968 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m23:52:41.158373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:52:41.159253 [debug] [MainThread]: Partial parsing: added file: capstone://snapshots/customer_snapshot.sql
[0m23:52:41.310937 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  expected token ',', got 'strategy'
    line 6
      strategy='timestamp'
[0m23:52:41.312292 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 1.1631064, "process_user_time": 3.918347, "process_kernel_time": 0.211502, "process_mem_max_rss": "148320", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m23:52:41.313146 [debug] [MainThread]: Command `dbt snapshot` failed at 23:52:41.312927 after 1.16 seconds
[0m23:52:41.313774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17d7002680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17cc8c3ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17cc965fc0>]}
[0m23:52:41.314401 [debug] [MainThread]: Flushing usage events
[0m00:12:07.793213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e93debf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e715cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e715d150>]}


============================== 00:12:07.796665 | 54df29eb-9dcc-49d7-88c7-2f3c05ebb6e5 ==============================
[0m00:12:07.796665 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:12:07.797440 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds_catalog_sales', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:12:08.559735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54df29eb-9dcc-49d7-88c7-2f3c05ebb6e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e711e7a0>]}
[0m00:12:08.701281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54df29eb-9dcc-49d7-88c7-2f3c05ebb6e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86de980ee0>]}
[0m00:12:08.702471 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:12:08.713434 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:12:08.727296 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:12:08.728056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '54df29eb-9dcc-49d7-88c7-2f3c05ebb6e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e715e710>]}
[0m00:12:10.340985 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two snapshots with the name "customer_snapshot".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for ref("customer_snapshot").
  
  To fix this, change the name of one of these resources:
  - snapshot.capstone.customer_snapshot (snapshots/customer_snapshot.sql)
  - snapshot.capstone.customer_snapshot (snapshots/daily_aggregated_sales.sql)
[0m00:12:10.342449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.6171503, "process_user_time": 5.369077, "process_kernel_time": 0.21938, "process_mem_max_rss": "151424", "process_out_blocks": "24", "command_success": false, "process_in_blocks": "0"}
[0m00:12:10.343352 [debug] [MainThread]: Command `dbt run` failed at 00:12:10.343121 after 2.62 seconds
[0m00:12:10.343964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86e93debf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86dea55240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86de1af310>]}
[0m00:12:10.344590 [debug] [MainThread]: Flushing usage events
[0m00:13:10.719215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6cfdd690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6ad5d420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6ad5cb80>]}


============================== 00:13:10.722583 | a4f3a7eb-adbf-4f07-9578-c46228a0f356 ==============================
[0m00:13:10.722583 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:13:10.723367 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds_catalog_sales', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:13:11.479809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4f3a7eb-adbf-4f07-9578-c46228a0f356', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f62777010>]}
[0m00:13:11.617701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4f3a7eb-adbf-4f07-9578-c46228a0f356', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f62585600>]}
[0m00:13:11.618850 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:13:11.629379 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:13:11.642941 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:13:11.643714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a4f3a7eb-adbf-4f07-9578-c46228a0f356', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6ad5d9c0>]}
[0m00:13:13.416221 [error] [MainThread]: Encountered an error:
Compilation Error
  Snapshot 'snapshot.capstone.daily_aggregated_sales' (snapshots/daily_aggregated_sales.sql) depends on a node named 'stg_tpcds_customer' which was not found
[0m00:13:13.417628 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.7647233, "process_user_time": 5.470433, "process_kernel_time": 0.199903, "process_mem_max_rss": "153360", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m00:13:13.418468 [debug] [MainThread]: Command `dbt run` failed at 00:13:13.418255 after 2.77 seconds
[0m00:13:13.419111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6cfdd690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f61eca1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f61ecac50>]}
[0m00:13:13.419747 [debug] [MainThread]: Flushing usage events
[0m00:14:22.178737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc5350ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc5174ed40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc5174f130>]}


============================== 00:14:22.182159 | d108be69-8b67-47e6-825b-ab10a7ef835a ==============================
[0m00:14:22.182159 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:14:22.182957 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select stg_tpcds_catalog_sales', 'send_anonymous_usage_stats': 'True'}
[0m00:14:22.935897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc5170bd30>]}
[0m00:14:23.073494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc48f84eb0>]}
[0m00:14:23.074652 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:14:23.085867 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:14:23.100109 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:14:23.100910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc4921b1c0>]}
[0m00:14:24.898456 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:14:24.906179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc487240d0>]}
[0m00:14:24.919784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc48727fa0>]}
[0m00:14:24.920518 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:14:24.921120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd108be69-8b67-47e6-825b-ab10a7ef835a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc48800ac0>]}
[0m00:14:24.922045 [warn ] [MainThread]: The selection criterion 'stg_tpcds_catalog_sales' does not match any nodes
[0m00:14:24.923406 [info ] [MainThread]: 
[0m00:14:24.923969 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m00:14:24.924735 [debug] [MainThread]: Command end result
[0m00:14:24.934919 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.8230126, "process_user_time": 5.535155, "process_kernel_time": 0.231735, "process_mem_max_rss": "157024", "process_out_blocks": "2744", "process_in_blocks": "0"}
[0m00:14:24.935833 [debug] [MainThread]: Command `dbt run` succeeded at 00:14:24.935617 after 2.82 seconds
[0m00:14:24.936437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc5350ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc49218b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc49111060>]}
[0m00:14:24.937046 [debug] [MainThread]: Flushing usage events
[0m00:14:51.255087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7660ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a748b5420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a748b4b80>]}


============================== 00:14:51.258456 | c8d5b392-2f4c-4fbf-aaf0-22efccf405ac ==============================
[0m00:14:51.258456 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:14:51.259265 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_tpcds__catalog_sales', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:14:52.014207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c2e7010>]}
[0m00:14:52.157246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c105600>]}
[0m00:14:52.158427 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:14:52.169338 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:14:52.209700 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:14:52.210382 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:14:52.211606 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:14:52.219868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6bf261d0>]}
[0m00:14:52.234087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c01c460>]}
[0m00:14:52.234860 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:14:52.235529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c01c370>]}
[0m00:14:52.237375 [info ] [MainThread]: 
[0m00:14:52.238534 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:14:52.240217 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:14:52.260123 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:14:52.261127 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:14:52.261930 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:14:52.705737 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m00:14:52.708132 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:14:53.325918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:14:53.339807 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:14:53.340547 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:14:53.341214 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:14:54.011621 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m00:14:54.014248 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:14:54.119255 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:14:54.125086 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:14:54.125854 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:14:54.126591 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:14:54.512374 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:14:54.515137 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:14:54.653425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6bf5e230>]}
[0m00:14:54.654893 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:14:54.655714 [info ] [MainThread]: 
[0m00:14:54.658665 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m00:14:54.659475 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m00:14:54.660512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m00:14:54.661337 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m00:14:54.674103 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:14:54.675993 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 00:14:54.661927 => 00:14:54.675597
[0m00:14:54.676811 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m00:14:54.716098 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:14:54.719315 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m00:14:54.720069 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m00:14:54.720753 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:14:55.443475 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:14:55.557813 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 00:14:54.677329 => 00:14:55.557413
[0m00:14:55.558701 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m00:14:55.629281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8d5b392-2f4c-4fbf-aaf0-22efccf405ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c0d1900>]}
[0m00:14:55.630538 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.97s]
[0m00:14:55.631701 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m00:14:55.634157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:14:55.634690 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__catalog_sales' was properly closed.
[0m00:14:55.635263 [info ] [MainThread]: 
[0m00:14:55.636055 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.40 seconds (3.40s).
[0m00:14:55.637133 [debug] [MainThread]: Command end result
[0m00:14:55.648473 [info ] [MainThread]: 
[0m00:14:55.649178 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:14:55.649740 [info ] [MainThread]: 
[0m00:14:55.650336 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:14:55.651593 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.463915, "process_user_time": 4.569796, "process_kernel_time": 0.24051, "process_mem_max_rss": "156960", "process_out_blocks": "1896", "process_in_blocks": "0"}
[0m00:14:55.652427 [debug] [MainThread]: Command `dbt run` succeeded at 00:14:55.652218 after 4.46 seconds
[0m00:14:55.653037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7660ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c39a200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a6c39a020>]}
[0m00:14:55.653649 [debug] [MainThread]: Flushing usage events
[0m00:17:15.674800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ae2fdebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ae0d60ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ae0d60340>]}


============================== 00:17:15.678220 | 2c09c30e-774f-4b4c-9376-235cf5450351 ==============================
[0m00:17:15.678220 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:17:15.678999 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select stg_tpcds__catalog_sales', 'send_anonymous_usage_stats': 'True'}
[0m00:17:16.435372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ae0d1e7a0>]}
[0m00:17:16.579168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad858cee0>]}
[0m00:17:16.580315 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:17:16.590895 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:17:16.631246 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:17:16.632247 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m00:17:16.840800 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:17:16.848545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad82f9cc0>]}
[0m00:17:16.864396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad84a05b0>]}
[0m00:17:16.865277 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:17:16.865980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad84a04f0>]}
[0m00:17:16.867893 [info ] [MainThread]: 
[0m00:17:16.869108 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:17:16.871304 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:17:16.892172 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:17:16.892995 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:17:16.893719 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:17.631151 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m00:17:17.633482 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:17:17.844570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:17:17.856739 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:17:17.857496 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:17:17.858143 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:18.459371 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m00:17:18.462298 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:17:18.625583 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:17:18.631516 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:17:18.632297 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:17:18.632935 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:19.335848 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m00:17:19.338533 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:17:19.392433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad82fe2c0>]}
[0m00:17:19.393868 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:17:19.394656 [info ] [MainThread]: 
[0m00:17:19.397661 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m00:17:19.398462 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m00:17:19.399549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m00:17:19.400633 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m00:17:19.414678 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:17:19.416672 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 00:17:19.401231 => 00:17:19.416281
[0m00:17:19.417498 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m00:17:19.456314 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:17:19.459793 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m00:17:19.460606 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m00:17:19.461402 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:17:20.148662 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:17:20.179978 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 00:17:19.418088 => 00:17:20.179587
[0m00:17:20.180934 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m00:17:20.257209 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c09c30e-774f-4b4c-9376-235cf5450351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad7e02e60>]}
[0m00:17:20.258591 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.86s]
[0m00:17:20.259856 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m00:17:20.262318 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:17:20.262866 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__catalog_sales' was properly closed.
[0m00:17:20.263448 [info ] [MainThread]: 
[0m00:17:20.264066 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.39 seconds (3.39s).
[0m00:17:20.265399 [debug] [MainThread]: Command end result
[0m00:17:20.278667 [info ] [MainThread]: 
[0m00:17:20.279495 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:17:20.280187 [info ] [MainThread]: 
[0m00:17:20.280899 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:17:20.282236 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6750154, "process_user_time": 4.728424, "process_kernel_time": 0.254954, "process_mem_max_rss": "159072", "process_out_blocks": "2784", "process_in_blocks": "0"}
[0m00:17:20.283259 [debug] [MainThread]: Command `dbt run` succeeded at 00:17:20.283005 after 4.68 seconds
[0m00:17:20.283977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ae2fdebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad8fb90c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ad84a03d0>]}
[0m00:17:20.284691 [debug] [MainThread]: Flushing usage events
[0m00:21:38.686717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02b320ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02b14b8fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02b14b8bb0>]}


============================== 00:21:38.690199 | 4033b48f-c891-4e51-8b3e-9bfb1606aa47 ==============================
[0m00:21:38.690199 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:21:38.691035 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select stg_tpcds__catalog_sales', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:21:39.450196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02b1477d30>]}
[0m00:21:39.589737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8ce8eb0>]}
[0m00:21:39.590901 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:21:39.601714 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:21:39.640863 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:21:39.641525 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:21:39.642699 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:21:39.650757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8b12200>]}
[0m00:21:39.664792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8c08460>]}
[0m00:21:39.665554 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:21:39.666159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8c08340>]}
[0m00:21:39.667990 [info ] [MainThread]: 
[0m00:21:39.669119 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:21:39.671054 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:21:39.691498 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:21:39.692552 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:21:39.693374 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:21:40.117585 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m00:21:40.120156 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:21:40.181582 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate_staging)
[0m00:21:40.182922 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate_staging"
"
[0m00:21:40.191408 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate_staging"
[0m00:21:40.192121 [debug] [ThreadPool]: On create_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate_staging"} */
create schema if not exists tpcds.intermediate_staging
[0m00:21:40.192800 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:21:40.693318 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:21:40.694945 [debug] [ThreadPool]: On create_tpcds_intermediate_staging: Close
[0m00:21:40.738982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m00:21:40.751304 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:21:40.751933 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:21:40.752492 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:21:41.057255 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b103f5-0001-8eb8-0004-d6ae00089456
[0m00:21:41.058217 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m00:21:41.059136 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m00:21:41.059882 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:21:41.060715 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:21:41.106880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:21:41.111159 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:21:41.111941 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:21:41.112674 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:21:41.718541 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m00:21:41.720955 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:21:41.764608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8b46260>]}
[0m00:21:41.765970 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:21:41.766621 [info ] [MainThread]: 
[0m00:21:41.769496 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m00:21:41.770325 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m00:21:41.771411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m00:21:41.772179 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m00:21:41.784570 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:21:41.786268 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 00:21:41.772692 => 00:21:41.785879
[0m00:21:41.787067 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m00:21:41.907044 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:21:41.909987 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m00:21:41.910706 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m00:21:41.911457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:21:42.417965 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:21:42.446285 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 00:21:41.787569 => 00:21:42.445878
[0m00:21:42.447095 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m00:21:42.492169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4033b48f-c891-4e51-8b3e-9bfb1606aa47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8eb8400>]}
[0m00:21:42.493312 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.72s]
[0m00:21:42.494354 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m00:21:42.496960 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:21:42.497552 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__catalog_sales' was properly closed.
[0m00:21:42.498127 [info ] [MainThread]: 
[0m00:21:42.498773 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.83 seconds (2.83s).
[0m00:21:42.499935 [debug] [MainThread]: Command end result
[0m00:21:42.511608 [info ] [MainThread]: 
[0m00:21:42.512284 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:21:42.512861 [info ] [MainThread]: 
[0m00:21:42.513482 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:21:42.514694 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.896732, "process_user_time": 4.684612, "process_kernel_time": 0.263061, "process_mem_max_rss": "157676", "process_in_blocks": "72", "process_out_blocks": "1896"}
[0m00:21:42.515591 [debug] [MainThread]: Command `dbt run` succeeded at 00:21:42.515364 after 3.90 seconds
[0m00:21:42.516223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02b320ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a3f4c2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02a8ce8eb0>]}
[0m00:21:42.516855 [debug] [MainThread]: Flushing usage events
[0m00:24:57.493452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb787411690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7855fe890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7855ff130>]}


============================== 00:24:57.496909 | 8f09e705-8683-4bc3-a71e-70915f3daa9c ==============================
[0m00:24:57.496909 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:24:57.497693 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --select +customer_snapshot', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:24:58.245000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cffb010>]}
[0m00:24:58.384059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77ce15600>]}
[0m00:24:58.385464 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:24:58.396563 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:24:58.436743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:24:58.437627 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:24:58.438993 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:24:58.447313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cc2a1d0>]}
[0m00:24:58.463237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cbf0460>]}
[0m00:24:58.464168 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:24:58.465001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cbf0370>]}
[0m00:24:58.467152 [info ] [MainThread]: 
[0m00:24:58.468467 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:24:58.470591 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:24:58.489912 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:24:58.490723 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:24:58.491475 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:59.158258 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m00:24:59.160707 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:24:59.249759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate)
[0m00:24:59.251081 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate"
"
[0m00:24:59.259175 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate"
[0m00:24:59.259857 [debug] [ThreadPool]: On create_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate"} */
create schema if not exists tpcds.intermediate
[0m00:24:59.260508 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:24:59.846920 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:24:59.848658 [debug] [ThreadPool]: On create_tpcds_intermediate: Close
[0m00:24:59.918425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate, now list_tpcds_intermediate)
[0m00:24:59.930888 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:24:59.931620 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:24:59.932262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:25:00.292110 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m00:25:00.294389 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:25:00.340825 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:25:00.344883 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:25:00.345799 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:25:00.346495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:25:00.681868 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:25:00.684303 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:25:00.732598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cc5a230>]}
[0m00:25:00.733958 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:25:00.734684 [info ] [MainThread]: 
[0m00:25:00.737554 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m00:25:00.738321 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m00:25:00.739406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now snapshot.capstone.customer_snapshot)
[0m00:25:00.740226 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m00:25:00.752788 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 00:25:00.740745 => 00:25:00.752378
[0m00:25:00.753581 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m00:25:00.911746 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m00:25:00.914542 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m00:25:00.915369 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id,
        _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
        _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
        nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.intermediate_staging.stg_tpcds__customer

    ) sbq



        );
[0m00:25:00.916127 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:25:01.257221 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b103f9-0001-8eb8-0004-d6ae0008947a
[0m00:25:01.258125 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.INTERMEDIATE_STAGING.STG_TPCDS__CUSTOMER' does not exist or not authorized.
[0m00:25:01.259179 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 00:25:00.754081 => 00:25:01.258758
[0m00:25:01.259944 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m00:25:01.329953 [debug] [Thread-1 (]: Database Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE_STAGING.STG_TPCDS__CUSTOMER' does not exist or not authorized.
  compiled Code at target/run/capstone/snapshots/customer_snapshot.sql
[0m00:25:01.331050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f09e705-8683-4bc3-a71e-70915f3daa9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cb81720>]}
[0m00:25:01.332309 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting intermediate.customer_snapshot ....................... [[31mERROR[0m in 0.59s]
[0m00:25:01.333445 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m00:25:01.335995 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:25:01.336521 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m00:25:01.337073 [info ] [MainThread]: 
[0m00:25:01.337938 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.87 seconds (2.87s).
[0m00:25:01.339053 [debug] [MainThread]: Command end result
[0m00:25:01.350951 [info ] [MainThread]: 
[0m00:25:01.351717 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:25:01.352275 [info ] [MainThread]: 
[0m00:25:01.352848 [error] [MainThread]:   Database Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE_STAGING.STG_TPCDS__CUSTOMER' does not exist or not authorized.
  compiled Code at target/run/capstone/snapshots/customer_snapshot.sql
[0m00:25:01.353437 [info ] [MainThread]: 
[0m00:25:01.354027 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:25:01.355279 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.9309282, "process_user_time": 4.663405, "process_kernel_time": 0.251791, "process_mem_max_rss": "157828", "process_out_blocks": "1880", "command_success": false, "process_in_blocks": "0"}
[0m00:25:01.356135 [debug] [MainThread]: Command `dbt snapshot` failed at 00:25:01.355920 after 3.93 seconds
[0m00:25:01.356757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb787411690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77c25cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb77cb83370>]}
[0m00:25:01.357381 [debug] [MainThread]: Flushing usage events
[0m00:25:51.617065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c593f6bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c57474ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c57474340>]}


============================== 00:25:51.620439 | 47e67796-2eda-4d90-9590-59e256398637 ==============================
[0m00:25:51.620439 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:25:51.621214 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging/tpcds', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:25:52.376215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47e67796-2eda-4d90-9590-59e256398637', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c5742e7a0>]}
[0m00:25:52.513496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47e67796-2eda-4d90-9590-59e256398637', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4eca0ee0>]}
[0m00:25:52.514619 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:25:52.525207 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:25:52.563942 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:25:52.564585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:25:52.565740 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:25:52.573653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47e67796-2eda-4d90-9590-59e256398637', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4eac6230>]}
[0m00:25:52.587482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47e67796-2eda-4d90-9590-59e256398637', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4ea8c4c0>]}
[0m00:25:52.588238 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:25:52.588862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47e67796-2eda-4d90-9590-59e256398637', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4ea8c3d0>]}
[0m00:25:52.590312 [warn ] [MainThread]: The selection criterion 'staging/tpcds' does not match any nodes
[0m00:25:52.591656 [info ] [MainThread]: 
[0m00:25:52.592217 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m00:25:52.592995 [debug] [MainThread]: Command end result
[0m00:25:52.603869 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.0535021, "process_user_time": 3.77326, "process_kernel_time": 0.215663, "process_mem_max_rss": "149904", "process_out_blocks": "1848", "process_in_blocks": "0"}
[0m00:25:52.604783 [debug] [MainThread]: Command `dbt run` succeeded at 00:25:52.604556 after 1.05 seconds
[0m00:25:52.605414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c593f6bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4eca0ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c4ea8c4c0>]}
[0m00:25:52.606030 [debug] [MainThread]: Flushing usage events
[0m00:26:05.516627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa04370a0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa041940a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa041942440>]}


============================== 00:26:05.520118 | 34b4c1ac-5154-43ea-bad8-403426cd4715 ==============================
[0m00:26:05.520118 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:26:05.520916 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging.tpcds*', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:26:06.299543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa041942b60>]}
[0m00:26:06.442854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0391760b0>]}
[0m00:26:06.444106 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:26:06.455216 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:26:06.495871 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:26:06.496562 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:26:06.497775 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:26:06.506076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038f8e290>]}
[0m00:26:06.520865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038f54520>]}
[0m00:26:06.521708 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:26:06.522351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038f54430>]}
[0m00:26:06.524884 [info ] [MainThread]: 
[0m00:26:06.526086 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:26:06.528180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:26:06.548006 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:26:06.548991 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:26:06.549747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:26:07.024249 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m00:26:07.026876 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:26:07.151428 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:26:07.165272 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:26:07.166225 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:26:07.166954 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:07.511803 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m00:26:07.514238 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:26:07.592700 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:26:07.596726 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:26:07.597489 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:26:07.598206 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:08.003819 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:26:08.006333 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:26:08.056379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038fb62f0>]}
[0m00:26:08.057677 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:26:08.058293 [info ] [MainThread]: 
[0m00:26:08.061310 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m00:26:08.062115 [info ] [Thread-1 (]: 1 of 8 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m00:26:08.063207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m00:26:08.064417 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m00:26:08.077274 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:26:08.079397 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 00:26:08.065215 => 00:26:08.078968
[0m00:26:08.080275 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m00:26:08.119266 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m00:26:08.122197 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m00:26:08.122914 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m00:26:08.123653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:09.342958 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:26:09.452918 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 00:26:08.080900 => 00:26:09.452517
[0m00:26:09.453811 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m00:26:09.506147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0385afb50>]}
[0m00:26:09.507437 [info ] [Thread-1 (]: 1 of 8 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 1.44s]
[0m00:26:09.508570 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m00:26:09.509406 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m00:26:09.510408 [info ] [Thread-1 (]: 2 of 8 START sql view model intermediate_staging.stg_tpcds__customer ........... [RUN]
[0m00:26:09.511668 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m00:26:09.512519 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m00:26:09.517363 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m00:26:09.519326 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 00:26:09.513097 => 00:26:09.518899
[0m00:26:09.520187 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m00:26:09.525396 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m00:26:09.527912 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m00:26:09.528711 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m00:26:09.529492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:10.195268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:26:10.199489 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 00:26:09.520779 => 00:26:10.199129
[0m00:26:10.200242 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m00:26:10.246523 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038fb62f0>]}
[0m00:26:10.247793 [info ] [Thread-1 (]: 2 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer ...... [[32mSUCCESS 1[0m in 0.74s]
[0m00:26:10.248876 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m00:26:10.249708 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m00:26:10.250657 [info ] [Thread-1 (]: 3 of 8 START sql view model intermediate_staging.stg_tpcds__customer_address ... [RUN]
[0m00:26:10.251906 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m00:26:10.252732 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m00:26:10.257605 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m00:26:10.259572 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 00:26:10.253324 => 00:26:10.259177
[0m00:26:10.260433 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m00:26:10.265737 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m00:26:10.267922 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m00:26:10.268691 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m00:26:10.269451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:11.662031 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:26:11.666697 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 00:26:10.261013 => 00:26:11.666318
[0m00:26:11.667700 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m00:26:11.757601 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038e87700>]}
[0m00:26:11.758954 [info ] [Thread-1 (]: 3 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_address  [[32mSUCCESS 1[0m in 1.51s]
[0m00:26:11.760176 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m00:26:11.761105 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m00:26:11.762033 [info ] [Thread-1 (]: 4 of 8 START sql view model intermediate_staging.stg_tpcds__customer_demographics  [RUN]
[0m00:26:11.763214 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m00:26:11.763965 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m00:26:11.769063 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m00:26:11.770825 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 00:26:11.764475 => 00:26:11.770443
[0m00:26:11.771606 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m00:26:11.778780 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m00:26:11.780568 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m00:26:11.781239 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m00:26:11.781875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:12.215346 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:26:12.219690 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 00:26:11.772105 => 00:26:12.219298
[0m00:26:12.220474 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m00:26:12.263278 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0385d8eb0>]}
[0m00:26:12.264575 [info ] [Thread-1 (]: 4 of 8 OK created sql view model intermediate_staging.stg_tpcds__customer_demographics  [[32mSUCCESS 1[0m in 0.50s]
[0m00:26:12.265721 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m00:26:12.266579 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m00:26:12.267468 [info ] [Thread-1 (]: 5 of 8 START sql view model intermediate_staging.stg_tpcds__household_demographics  [RUN]
[0m00:26:12.268641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m00:26:12.269400 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m00:26:12.274587 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m00:26:12.276177 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 00:26:12.269914 => 00:26:12.275773
[0m00:26:12.276937 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m00:26:12.282213 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m00:26:12.284085 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m00:26:12.284866 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_S, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m00:26:12.285620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:12.707523 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:26:12.711747 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 00:26:12.277446 => 00:26:12.711384
[0m00:26:12.712499 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m00:26:12.757143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038ee6b90>]}
[0m00:26:12.758383 [info ] [Thread-1 (]: 5 of 8 OK created sql view model intermediate_staging.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.49s]
[0m00:26:12.759509 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m00:26:12.760340 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m00:26:12.761301 [info ] [Thread-1 (]: 6 of 8 START sql view model intermediate_staging.stg_tpcds__income_band ........ [RUN]
[0m00:26:12.762459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m00:26:12.763235 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m00:26:12.768121 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m00:26:12.769601 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 00:26:12.763741 => 00:26:12.769217
[0m00:26:12.770330 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m00:26:12.775484 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m00:26:12.777143 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m00:26:12.777881 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m00:26:12.778624 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:13.583108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:26:13.587572 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 00:26:12.770826 => 00:26:13.587200
[0m00:26:13.588447 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m00:26:13.679095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa039146650>]}
[0m00:26:13.680484 [info ] [Thread-1 (]: 6 of 8 OK created sql view model intermediate_staging.stg_tpcds__income_band ... [[32mSUCCESS 1[0m in 0.92s]
[0m00:26:13.681701 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m00:26:13.682643 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m00:26:13.683615 [info ] [Thread-1 (]: 7 of 8 START sql view model intermediate_staging.stg_tpcds__inventory .......... [RUN]
[0m00:26:13.684884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m00:26:13.685732 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m00:26:13.690743 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m00:26:13.692302 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 00:26:13.686264 => 00:26:13.691907
[0m00:26:13.693083 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m00:26:13.698278 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m00:26:13.700032 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m00:26:13.700819 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m00:26:13.701578 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:14.098494 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:26:14.102963 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 00:26:13.693607 => 00:26:14.102596
[0m00:26:14.103750 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m00:26:14.147558 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038f8ffa0>]}
[0m00:26:14.148816 [info ] [Thread-1 (]: 7 of 8 OK created sql view model intermediate_staging.stg_tpcds__inventory ..... [[32mSUCCESS 1[0m in 0.46s]
[0m00:26:14.149922 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m00:26:14.150744 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m00:26:14.151743 [info ] [Thread-1 (]: 8 of 8 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m00:26:14.152887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m00:26:14.153643 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m00:26:14.158474 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m00:26:14.159969 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 00:26:14.154150 => 00:26:14.159591
[0m00:26:14.160702 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m00:26:14.165750 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m00:26:14.168921 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m00:26:14.169744 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m00:26:14.170542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:14.567448 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:26:14.571751 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 00:26:14.161202 => 00:26:14.571388
[0m00:26:14.572519 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m00:26:14.623529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34b4c1ac-5154-43ea-bad8-403426cd4715', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa038563cd0>]}
[0m00:26:14.624768 [info ] [Thread-1 (]: 8 of 8 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.47s]
[0m00:26:14.625893 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m00:26:14.628357 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:26:14.628946 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m00:26:14.629572 [info ] [MainThread]: 
[0m00:26:14.630200 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 8.10 seconds (8.10s).
[0m00:26:14.633360 [debug] [MainThread]: Command end result
[0m00:26:14.647545 [info ] [MainThread]: 
[0m00:26:14.648364 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:26:14.648970 [info ] [MainThread]: 
[0m00:26:14.649607 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m00:26:14.650884 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.203204, "process_user_time": 5.629572, "process_kernel_time": 0.243718, "process_mem_max_rss": "157648", "process_out_blocks": "2056", "process_in_blocks": "0"}
[0m00:26:14.651814 [debug] [MainThread]: Command `dbt run` succeeded at 00:26:14.651584 after 9.20 seconds
[0m00:26:14.652448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa04370a0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0385991b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa03859a1d0>]}
[0m00:26:14.653092 [debug] [MainThread]: Flushing usage events
[0m00:26:36.231784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c720ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c53f5420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c53f4b80>]}


============================== 00:26:36.235285 | 2e027c8f-229e-4a49-a9ad-8f7b4db919d5 ==============================
[0m00:26:36.235285 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:26:36.236129 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --select customer_snapshot', 'send_anonymous_usage_stats': 'True'}
[0m00:26:36.977179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bcdf7010>]}
[0m00:26:37.118832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bcc09600>]}
[0m00:26:37.120010 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:26:37.130901 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:26:37.170673 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:26:37.171383 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:26:37.172558 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:26:37.180812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bca2a1d0>]}
[0m00:26:37.194872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bc9ec460>]}
[0m00:26:37.195684 [info ] [MainThread]: Found 8 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:26:37.196317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bc9ec370>]}
[0m00:26:37.198143 [info ] [MainThread]: 
[0m00:26:37.199323 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:26:37.200957 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:26:37.221298 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:26:37.222260 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:26:37.223116 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:26:37.640218 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m00:26:37.642548 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:26:37.689822 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_staging)
[0m00:26:37.702764 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:26:37.703400 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:26:37.703926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:38.100707 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:26:38.103306 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:26:38.325856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m00:26:38.332250 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:26:38.333045 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:26:38.333776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:38.635786 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m00:26:38.638184 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:26:38.699154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bca5a230>]}
[0m00:26:38.700600 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:26:38.701332 [info ] [MainThread]: 
[0m00:26:38.704236 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m00:26:38.705042 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m00:26:38.706107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now snapshot.capstone.customer_snapshot)
[0m00:26:38.706959 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m00:26:38.720023 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 00:26:38.707615 => 00:26:38.719605
[0m00:26:38.720892 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m00:26:38.805152 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m00:26:38.808319 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m00:26:38.809203 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id,
        _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
        _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
        nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.intermediate_staging.stg_tpcds__customer

    ) sbq



        );
[0m00:26:38.810094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:42.216961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m00:26:42.250323 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 00:26:38.721511 => 00:26:42.249931
[0m00:26:42.251259 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m00:26:42.296778 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e027c8f-229e-4a49-a9ad-8f7b4db919d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43b7f6fe50>]}
[0m00:26:42.298252 [info ] [Thread-1 (]: 1 of 1 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 1[0m in 3.59s]
[0m00:26:42.299440 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m00:26:42.301945 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:26:42.302514 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m00:26:42.303128 [info ] [MainThread]: 
[0m00:26:42.303762 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.10 seconds (5.10s).
[0m00:26:42.304889 [debug] [MainThread]: Command end result
[0m00:26:42.316700 [info ] [MainThread]: 
[0m00:26:42.317473 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:26:42.318066 [info ] [MainThread]: 
[0m00:26:42.318678 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:26:42.319944 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.1546717, "process_user_time": 4.560221, "process_kernel_time": 0.231171, "process_mem_max_rss": "156896", "process_out_blocks": "1880", "process_in_blocks": "0"}
[0m00:26:42.320829 [debug] [MainThread]: Command `dbt snapshot` succeeded at 00:26:42.320599 after 6.16 seconds
[0m00:26:42.321447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c720ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bcea99c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43bca507f0>]}
[0m00:26:42.322091 [debug] [MainThread]: Flushing usage events
[0m00:41:13.933128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbdac415690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbdacd51420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbdacd50b80>]}


============================== 00:41:13.936497 | d7309063-e69b-4492-bf62-bd6a1a993112 ==============================
[0m00:41:13.936497 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:41:13.937266 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select analytics.customer_dim', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:41:14.676796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda2027010>]}
[0m00:41:14.814431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1e45600>]}
[0m00:41:14.815560 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:41:14.825858 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:41:14.864306 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m00:41:14.865130 [debug] [MainThread]: Partial parsing: added file: capstone://models/analytics/customer_dim.sql
[0m00:41:15.070511 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:41:15.078090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1bbe2c0>]}
[0m00:41:15.093921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1c2b550>]}
[0m00:41:15.094764 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:41:15.095472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1f75810>]}
[0m00:41:15.097359 [info ] [MainThread]: 
[0m00:41:15.098542 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:41:15.100298 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:41:15.120778 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:41:15.121725 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:41:15.122479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:41:15.924795 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m00:41:15.927421 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:41:16.034923 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:41:16.047274 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:41:16.048155 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:41:16.048908 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:41:16.398003 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:41:16.400595 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:41:16.448115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:41:16.452299 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:41:16.453045 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:41:16.453775 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:41:16.776638 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:41:16.779289 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:41:16.854965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1bae650>]}
[0m00:41:16.856371 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:41:16.857077 [info ] [MainThread]: 
[0m00:41:16.860010 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m00:41:16.860801 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.customer_dim ................... [RUN]
[0m00:41:16.861866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.customer_dim)
[0m00:41:16.862605 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m00:41:16.877920 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m00:41:16.879709 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 00:41:16.863491 => 00:41:16.879312
[0m00:41:16.880458 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m00:41:16.956901 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m00:41:16.961369 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:41:16.962238 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.DEP_COUNT AS DEP_COUNT,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate_staging.stg_tpcds__customer AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m00:41:16.963142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:41:17.908950 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b10409-0001-8ebd-0004-d6ae000875aa
[0m00:41:17.909848 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 46 at position 4
invalid identifier 'RHD.INCOME_BAND_SK'
[0m00:41:17.910837 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 00:41:16.880964 => 00:41:17.910459
[0m00:41:17.911614 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m00:41:17.994996 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  000904 (42000): SQL compilation error: error line 46 at position 4
  invalid identifier 'RHD.INCOME_BAND_SK'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:41:17.996056 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7309063-e69b-4492-bf62-bd6a1a993112', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda16cb8e0>]}
[0m00:41:17.997096 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model intermediate.customer_dim .......... [[31mERROR[0m in 1.13s]
[0m00:41:17.998196 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m00:41:18.000725 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:41:18.001315 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m00:41:18.001883 [info ] [MainThread]: 
[0m00:41:18.002511 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.90 seconds (2.90s).
[0m00:41:18.003677 [debug] [MainThread]: Command end result
[0m00:41:18.017500 [info ] [MainThread]: 
[0m00:41:18.018323 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:41:18.019049 [info ] [MainThread]: 
[0m00:41:18.019756 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  000904 (42000): SQL compilation error: error line 46 at position 4
  invalid identifier 'RHD.INCOME_BAND_SK'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:41:18.020465 [info ] [MainThread]: 
[0m00:41:18.021195 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:41:18.022540 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.156128, "process_user_time": 4.721822, "process_kernel_time": 0.204495, "process_mem_max_rss": "160080", "process_out_blocks": "2840", "command_success": false, "process_in_blocks": "0"}
[0m00:41:18.023540 [debug] [MainThread]: Command `dbt run` failed at 00:41:18.023306 after 4.16 seconds
[0m00:41:18.024295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbdac415690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda1e45600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbda2026920>]}
[0m00:41:18.025051 [debug] [MainThread]: Flushing usage events
[0m00:43:31.117508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e0851a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e08d58670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e08d5aec0>]}


============================== 00:43:31.120955 | 8b4cd5a7-6adc-4c5d-a748-da6d29b27c62 ==============================
[0m00:43:31.120955 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:43:31.121743 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_tpcds__household_demographics', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:43:31.858901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfe19fb80>]}
[0m00:43:31.994867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfe19f2e0>]}
[0m00:43:31.996017 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:43:32.006440 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:43:32.045182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:43:32.046111 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__household_demographics.sql
[0m00:43:32.251474 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:43:32.258981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfdcde2f0>]}
[0m00:43:32.275154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e08d5b1c0>]}
[0m00:43:32.276013 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:43:32.276738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e08d599c0>]}
[0m00:43:32.278652 [info ] [MainThread]: 
[0m00:43:32.279896 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:43:32.281972 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:43:32.301733 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:43:32.302583 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:43:32.303390 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:43:32.915456 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m00:43:32.917979 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:43:32.966067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:43:32.978112 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:43:32.978861 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:43:32.979556 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:43:33.872525 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:43:33.875252 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:43:33.936413 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:43:33.940630 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:43:33.941407 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:43:33.942131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:43:34.329055 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:43:34.331794 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:43:34.380094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfdcce650>]}
[0m00:43:34.381494 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:43:34.382204 [info ] [MainThread]: 
[0m00:43:34.384987 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m00:43:34.385778 [info ] [Thread-1 (]: 1 of 1 START sql view model intermediate_staging.stg_tpcds__household_demographics  [RUN]
[0m00:43:34.386826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.stg_tpcds__household_demographics)
[0m00:43:34.387626 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m00:43:34.400803 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m00:43:34.402295 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 00:43:34.388613 => 00:43:34.401903
[0m00:43:34.403086 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m00:43:34.441299 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m00:43:34.443335 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m00:43:34.444089 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m00:43:34.444821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:43:35.065251 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:43:35.096978 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 00:43:34.403595 => 00:43:35.096568
[0m00:43:35.097848 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m00:43:35.147689 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b4cd5a7-6adc-4c5d-a748-da6d29b27c62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfd7f3c70>]}
[0m00:43:35.148906 [info ] [Thread-1 (]: 1 of 1 OK created sql view model intermediate_staging.stg_tpcds__household_demographics  [[32mSUCCESS 1[0m in 0.76s]
[0m00:43:35.150044 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m00:43:35.152438 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:43:35.152999 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__household_demographics' was properly closed.
[0m00:43:35.153566 [info ] [MainThread]: 
[0m00:43:35.154188 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.87 seconds (2.87s).
[0m00:43:35.155342 [debug] [MainThread]: Command end result
[0m00:43:35.166966 [info ] [MainThread]: 
[0m00:43:35.167731 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:43:35.168318 [info ] [MainThread]: 
[0m00:43:35.168942 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:43:35.170170 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1192255, "process_user_time": 4.623114, "process_kernel_time": 0.255937, "process_mem_max_rss": "159560", "process_out_blocks": "2832", "process_in_blocks": "0"}
[0m00:43:35.171063 [debug] [MainThread]: Command `dbt run` succeeded at 00:43:35.170804 after 4.12 seconds
[0m00:43:35.171702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e0851a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4dfd7f1b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4e08d587f0>]}
[0m00:43:35.172330 [debug] [MainThread]: Flushing usage events
[0m00:43:40.717174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f98a12bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f96c18df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f96c19150>]}


============================== 00:43:40.720583 | 0de656a7-081a-4a4d-ba1d-9f2c2b701fba ==============================
[0m00:43:40.720583 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:43:40.721341 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select analytics.customer_dim', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:43:41.455950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f96bd67a0>]}
[0m00:43:41.596127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e444ee0>]}
[0m00:43:41.597278 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:43:41.607935 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:43:41.647573 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:43:41.648239 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:43:41.649475 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:43:41.657669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e26a950>]}
[0m00:43:41.672177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e877010>]}
[0m00:43:41.672989 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:43:41.673629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e8777f0>]}
[0m00:43:41.675498 [info ] [MainThread]: 
[0m00:43:41.676646 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:43:41.678267 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:43:41.700112 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:43:41.701017 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:43:41.701841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:43:41.999957 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m00:43:42.002320 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:43:42.076645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m00:43:42.089645 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:43:42.090375 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:43:42.091030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:43:42.364609 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:43:42.367070 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:43:44.470809 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m00:43:44.475181 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:43:44.475852 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:43:44.476479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:43:45.339829 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m00:43:45.342293 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:43:45.391689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e2a68c0>]}
[0m00:43:45.393198 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:43:45.393998 [info ] [MainThread]: 
[0m00:43:45.396965 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m00:43:45.397735 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.customer_dim ................... [RUN]
[0m00:43:45.398750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.customer_dim)
[0m00:43:45.399507 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m00:43:45.412948 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m00:43:45.414522 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 00:43:45.400382 => 00:43:45.414157
[0m00:43:45.415264 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m00:43:45.491806 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m00:43:45.496092 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:43:45.496938 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.DEP_COUNT AS DEP_COUNT,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate_staging.stg_tpcds__customer AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m00:43:45.497755 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:43:46.156037 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1040b-0001-8e9a-0004-d6ae00088546
[0m00:43:46.157014 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 49 at position 4
invalid identifier 'IC.DBT_VALID_FROM'
[0m00:43:46.158170 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 00:43:45.415754 => 00:43:46.157784
[0m00:43:46.158955 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m00:43:46.201785 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  000904 (42000): SQL compilation error: error line 49 at position 4
  invalid identifier 'IC.DBT_VALID_FROM'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:43:46.202787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0de656a7-081a-4a4d-ba1d-9f2c2b701fba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e174a30>]}
[0m00:43:46.203856 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model intermediate.customer_dim .......... [[31mERROR[0m in 0.80s]
[0m00:43:46.204952 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m00:43:46.207516 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:43:46.208082 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m00:43:46.208653 [info ] [MainThread]: 
[0m00:43:46.209407 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 4.53 seconds (4.53s).
[0m00:43:46.210465 [debug] [MainThread]: Command end result
[0m00:43:46.222252 [info ] [MainThread]: 
[0m00:43:46.222964 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:43:46.223600 [info ] [MainThread]: 
[0m00:43:46.224166 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  000904 (42000): SQL compilation error: error line 49 at position 4
  invalid identifier 'IC.DBT_VALID_FROM'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:43:46.224760 [info ] [MainThread]: 
[0m00:43:46.225354 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:43:46.226557 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.576329, "process_user_time": 4.476433, "process_kernel_time": 0.231298, "process_mem_max_rss": "157940", "process_out_blocks": "1928", "command_success": false, "process_in_blocks": "0"}
[0m00:43:46.227431 [debug] [MainThread]: Command `dbt run` failed at 00:43:46.227214 after 5.58 seconds
[0m00:43:46.228044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f98a12bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e444ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3f8e877010>]}
[0m00:43:46.228676 [debug] [MainThread]: Flushing usage events
[0m00:44:56.179391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd695b0ebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd69647cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd69647d150>]}


============================== 00:44:56.182951 | f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42 ==============================
[0m00:44:56.182951 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:44:56.183856 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select analytics.customer_dim', 'send_anonymous_usage_stats': 'True'}
[0m00:44:56.927130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd69643a7a0>]}
[0m00:44:57.065610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b584ee0>]}
[0m00:44:57.066743 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:44:57.077268 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:44:57.117962 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:44:57.118909 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m00:44:57.322989 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:44:57.330433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b2f6320>]}
[0m00:44:57.345719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b681f90>]}
[0m00:44:57.346518 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:44:57.347250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b3a0b50>]}
[0m00:44:57.349148 [info ] [MainThread]: 
[0m00:44:57.350329 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:44:57.352399 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:44:57.371438 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:44:57.372277 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:44:57.372996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:44:57.878376 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m00:44:57.880963 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:44:57.932671 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_staging)
[0m00:44:57.944669 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:44:57.945458 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:44:57.946180 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:44:58.247929 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:44:58.250762 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:44:58.312702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m00:44:58.319070 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:44:58.319847 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:44:58.320495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:44:59.141018 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:44:59.143583 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:44:59.471863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b2e26b0>]}
[0m00:44:59.473161 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:44:59.473803 [info ] [MainThread]: 
[0m00:44:59.476759 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m00:44:59.477623 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.customer_dim ................... [RUN]
[0m00:44:59.478712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.customer_dim)
[0m00:44:59.479387 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m00:44:59.495072 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m00:44:59.496219 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 00:44:59.480092 => 00:44:59.495801
[0m00:44:59.496931 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m00:44:59.572041 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m00:44:59.575953 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:44:59.576716 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.DEP_COUNT AS DEP_COUNT,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m00:44:59.577485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:45:00.108775 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1040c-0001-8e9a-0004-d6ae0008854a
[0m00:45:00.109560 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'DEP_COUNT'
[0m00:45:00.110459 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 00:44:59.497373 => 00:45:00.110077
[0m00:45:00.111150 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m00:45:00.162228 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'DEP_COUNT'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:45:00.163200 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7c92a49-9a5b-4bd5-bdc3-b1857f4e1b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68a4c84c0>]}
[0m00:45:00.164155 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model intermediate.customer_dim .......... [[31mERROR[0m in 0.68s]
[0m00:45:00.165178 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m00:45:00.167738 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:45:00.168320 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m00:45:00.168889 [info ] [MainThread]: 
[0m00:45:00.169591 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.82 seconds (2.82s).
[0m00:45:00.170708 [debug] [MainThread]: Command end result
[0m00:45:00.184323 [info ] [MainThread]: 
[0m00:45:00.185065 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:45:00.185635 [info ] [MainThread]: 
[0m00:45:00.186215 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'DEP_COUNT'
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m00:45:00.186795 [info ] [MainThread]: 
[0m00:45:00.187432 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:45:00.188663 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0760875, "process_user_time": 4.673052, "process_kernel_time": 0.244887, "process_mem_max_rss": "159868", "process_out_blocks": "2840", "command_success": false, "process_in_blocks": "0"}
[0m00:45:00.189515 [debug] [MainThread]: Command `dbt run` failed at 00:45:00.189297 after 4.08 seconds
[0m00:45:00.190159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd695b0ebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b584ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd68b681f90>]}
[0m00:45:00.190787 [debug] [MainThread]: Flushing usage events
[0m00:45:55.211120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc309dde0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc307b70a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc307b72440>]}


============================== 00:45:55.214589 | 35c68744-0429-47ee-af37-40d145a48763 ==============================
[0m00:45:55.214589 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:45:55.215424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select analytics.customer_dim', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:45:55.958525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc307b72b60>]}
[0m00:45:56.095053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff3920b0>]}
[0m00:45:56.096169 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:45:56.106521 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:45:56.145466 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:45:56.146371 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m00:45:56.348049 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m00:45:56.355429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff0fe380>]}
[0m00:45:56.371424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff59ad10>]}
[0m00:45:56.372295 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:45:56.373078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff59b9a0>]}
[0m00:45:56.375048 [info ] [MainThread]: 
[0m00:45:56.376320 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:45:56.378538 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:45:56.398534 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:45:56.399296 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:45:56.399955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:45:56.961375 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m00:45:56.963987 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:45:57.037256 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_staging)
[0m00:45:57.050334 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:45:57.051149 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:45:57.051866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:45:57.404532 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:45:57.407384 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:45:57.452656 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m00:45:57.459087 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:45:57.459849 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:45:57.460558 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:45:57.804690 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:45:57.807253 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:45:57.907360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff0f2710>]}
[0m00:45:57.908613 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:45:57.909298 [info ] [MainThread]: 
[0m00:45:57.912179 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m00:45:57.912971 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.customer_dim ................... [RUN]
[0m00:45:57.913994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.customer_dim)
[0m00:45:57.915097 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m00:45:57.930061 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m00:45:57.931619 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 00:45:57.915690 => 00:45:57.931240
[0m00:45:57.932381 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m00:45:58.008943 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m00:45:58.013262 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:45:58.014132 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m00:45:58.015007 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:46:02.266891 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m00:46:02.279530 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.customer_dim__dbt_tmp
[0m00:46:02.288507 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:46:02.289170 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.intermediate.customer_dim__dbt_tmp cascade
[0m00:46:02.338648 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:46:02.365808 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 00:45:57.932878 => 00:46:02.365426
[0m00:46:02.366528 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m00:46:02.457800 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35c68744-0429-47ee-af37-40d145a48763', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff11fac0>]}
[0m00:46:02.458904 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate.customer_dim .............. [[32mSUCCESS 1[0m in 4.54s]
[0m00:46:02.459958 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m00:46:02.462527 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:46:02.463088 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m00:46:02.463633 [info ] [MainThread]: 
[0m00:46:02.464227 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 6.09 seconds (6.09s).
[0m00:46:02.465250 [debug] [MainThread]: Command end result
[0m00:46:02.477897 [info ] [MainThread]: 
[0m00:46:02.478548 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:46:02.479181 [info ] [MainThread]: 
[0m00:46:02.479780 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:46:02.480958 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.337605, "process_user_time": 4.770163, "process_kernel_time": 0.215368, "process_mem_max_rss": "159372", "process_out_blocks": "2840", "process_in_blocks": "0"}
[0m00:46:02.481799 [debug] [MainThread]: Command `dbt run` succeeded at 00:46:02.481586 after 7.34 seconds
[0m00:46:02.482387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc309dde0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc307b71a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2ff5985b0>]}
[0m00:46:02.483003 [debug] [MainThread]: Flushing usage events
[0m00:50:31.103696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4753402aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47516449d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47516473d0>]}


============================== 00:50:31.107240 | 90b0195c-6fd5-4e78-9f63-23ef357c4b9b ==============================
[0m00:50:31.107240 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:50:31.108015 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select analytics.customer_dim', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:50:31.856332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90b0195c-6fd5-4e78-9f63-23ef357c4b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47492c31c0>]}
[0m00:50:31.994569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '90b0195c-6fd5-4e78-9f63-23ef357c4b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47515fffa0>]}
[0m00:50:31.995719 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:50:32.006617 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:50:32.020759 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:50:32.021451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '90b0195c-6fd5-4e78-9f63-23ef357c4b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4748f929e0>]}
[0m00:50:33.416034 [error] [MainThread]: Encountered an error:
Compilation Error in model customer_dim (models/analytics/customer_dim.sql)
  expected token ',', got 'target_schema'
    line 5
      target_schema = 'analytics'
[0m00:50:33.417376 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.3809714, "process_user_time": 5.119061, "process_kernel_time": 0.171944, "process_mem_max_rss": "149352", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m00:50:33.418251 [debug] [MainThread]: Command `dbt run` failed at 00:50:33.418026 after 2.38 seconds
[0m00:50:33.418865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4753402aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47487460b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f47487461a0>]}
[0m00:50:33.419556 [debug] [MainThread]: Flushing usage events
[0m00:50:39.879746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefaf16c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefb854fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefb854bb0>]}


============================== 00:50:39.883337 | db6bb1e2-9677-4f1e-a34c-2590c9380f47 ==============================
[0m00:50:39.883337 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:50:39.884238 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select analytics.customer_dim', 'send_anonymous_usage_stats': 'True'}
[0m00:50:40.635287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefb813d30>]}
[0m00:50:40.773727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faef0948eb0>]}
[0m00:50:40.774850 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:50:40.785189 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:50:40.799100 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:50:40.799796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faef0bcdf60>]}
[0m00:50:42.568813 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.example
- models.capstone.intermediate
[0m00:50:42.576662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faeebfec0d0>]}
[0m00:50:42.590737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faeebfeffa0>]}
[0m00:50:42.591537 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m00:50:42.592170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faef0ae65f0>]}
[0m00:50:42.594032 [info ] [MainThread]: 
[0m00:50:42.595200 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:50:42.597192 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:50:42.616929 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:50:42.617951 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:50:42.618785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:50:43.024657 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m00:50:43.027092 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:50:43.067612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate_intermediate)
[0m00:50:43.068776 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate_intermediate"
"
[0m00:50:43.075911 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate_intermediate"
[0m00:50:43.076493 [debug] [ThreadPool]: On create_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate_intermediate"} */
create schema if not exists tpcds.intermediate_intermediate
[0m00:50:43.077040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:50:43.499016 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:50:43.500609 [debug] [ThreadPool]: On create_tpcds_intermediate_intermediate: Close
[0m00:50:43.543414 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate_intermediate, now list_tpcds_intermediate_staging)
[0m00:50:43.555230 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m00:50:43.555892 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m00:50:43.556519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:50:43.887053 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m00:50:43.889740 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m00:50:43.931077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m00:50:43.937661 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:50:43.938228 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:50:43.938742 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:50:44.240546 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:50:44.242873 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:50:44.283351 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_intermediate)
[0m00:50:44.287911 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m00:50:44.288676 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m00:50:44.289399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:50:44.596325 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m00:50:44.598723 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m00:50:44.644196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faeebe39de0>]}
[0m00:50:44.645486 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:50:44.646098 [info ] [MainThread]: 
[0m00:50:44.648887 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m00:50:44.649699 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate_intermediate.customer_dim ...... [RUN]
[0m00:50:44.650796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now model.capstone.customer_dim)
[0m00:50:44.651655 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m00:50:44.666938 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m00:50:44.668831 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 00:50:44.652542 => 00:50:44.668438
[0m00:50:44.669669 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m00:50:44.745490 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m00:50:44.750236 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:50:44.751228 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate_intermediate.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m00:50:44.752182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:50:47.908520 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m00:50:47.921480 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate_intermediate.customer_dim__dbt_tmp
[0m00:50:47.930327 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m00:50:47.931112 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.intermediate_intermediate.customer_dim__dbt_tmp cascade
[0m00:50:47.984683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:50:48.012764 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 00:50:44.670261 => 00:50:48.012369
[0m00:50:48.013651 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m00:50:48.106125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db6bb1e2-9677-4f1e-a34c-2590c9380f47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faeeb491090>]}
[0m00:50:48.107399 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate_intermediate.customer_dim . [[32mSUCCESS 1[0m in 3.46s]
[0m00:50:48.108533 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m00:50:48.110875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:50:48.111456 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m00:50:48.112021 [info ] [MainThread]: 
[0m00:50:48.112736 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 5.52 seconds (5.52s).
[0m00:50:48.113932 [debug] [MainThread]: Command end result
[0m00:50:48.126893 [info ] [MainThread]: 
[0m00:50:48.127662 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:50:48.128233 [info ] [MainThread]: 
[0m00:50:48.128841 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:50:48.130036 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.318387, "process_user_time": 6.470305, "process_kernel_time": 0.224104, "process_mem_max_rss": "164564", "process_out_blocks": "2832", "process_in_blocks": "0"}
[0m00:50:48.130866 [debug] [MainThread]: Command `dbt run` succeeded at 00:50:48.130652 after 8.32 seconds
[0m00:50:48.131493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefaf16c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faef0a839d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faefb813d30>]}
[0m00:50:48.132107 [debug] [MainThread]: Flushing usage events
[0m05:06:26.434298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f288a402c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2888638d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28886389d0>]}


============================== 05:06:26.437778 | 05418264-ef84-46b5-990e-443fe78da01f ==============================
[0m05:06:26.437778 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:06:26.438566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select analytics.customer_dim', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:06:27.185713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28885fbd30>]}
[0m05:06:27.328526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28802a3a60>]}
[0m05:06:27.329679 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:06:27.340682 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:06:27.355603 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m05:06:27.356373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f288005d000>]}
[0m05:06:29.168986 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.capstone.intermediate
- models.capstone.example
[0m05:06:29.176753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287f6180d0>]}
[0m05:06:29.190617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287f61bfa0>]}
[0m05:06:29.191390 [info ] [MainThread]: Found 9 models, 2 snapshots, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m05:06:29.192001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287fe34e80>]}
[0m05:06:29.193810 [info ] [MainThread]: 
[0m05:06:29.194931 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:06:29.196667 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m05:06:29.216257 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:06:29.217444 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:06:29.218250 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:06:29.666211 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m05:06:29.668761 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:06:29.720424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate_analytics)
[0m05:06:29.721667 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate_analytics"
"
[0m05:06:29.728863 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate_analytics"
[0m05:06:29.729539 [debug] [ThreadPool]: On create_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate_analytics"} */
create schema if not exists tpcds.intermediate_analytics
[0m05:06:29.730256 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:30.242747 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:06:30.244495 [debug] [ThreadPool]: On create_tpcds_intermediate_analytics: Close
[0m05:06:30.324785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate_analytics, now list_tpcds_intermediate_analytics)
[0m05:06:30.337317 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m05:06:30.338036 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m05:06:30.338689 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:31.145251 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m05:06:31.147529 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m05:06:31.196632 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now list_tpcds_intermediate_staging)
[0m05:06:31.200772 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m05:06:31.201473 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m05:06:31.202128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:31.660717 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m05:06:31.663421 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m05:06:31.726097 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m05:06:31.732543 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m05:06:31.733317 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m05:06:31.734037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:32.022927 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m05:06:32.025571 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m05:06:32.122103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287f61b940>]}
[0m05:06:32.123515 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:06:32.124211 [info ] [MainThread]: 
[0m05:06:32.127118 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m05:06:32.127908 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate_analytics.customer_dim ......... [RUN]
[0m05:06:32.128953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.customer_dim)
[0m05:06:32.129776 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m05:06:32.144996 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m05:06:32.146623 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 05:06:32.130634 => 05:06:32.146243
[0m05:06:32.147379 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m05:06:32.222515 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m05:06:32.226790 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m05:06:32.227679 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.intermediate_analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.intermediate_staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
        );
[0m05:06:32.228532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:36.649833 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m05:06:36.662551 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate_analytics.customer_dim__dbt_tmp
[0m05:06:36.671400 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m05:06:36.672069 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.intermediate_analytics.customer_dim__dbt_tmp cascade
[0m05:06:36.772688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:06:36.800144 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 05:06:32.147887 => 05:06:36.799724
[0m05:06:36.800856 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m05:06:36.850782 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05418264-ef84-46b5-990e-443fe78da01f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287eaaa470>]}
[0m05:06:36.851913 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate_analytics.customer_dim .... [[32mSUCCESS 1[0m in 4.72s]
[0m05:06:36.852910 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m05:06:36.855223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:06:36.855801 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m05:06:36.856359 [info ] [MainThread]: 
[0m05:06:36.856952 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 7.66 seconds (7.66s).
[0m05:06:36.858112 [debug] [MainThread]: Command end result
[0m05:06:36.872118 [info ] [MainThread]: 
[0m05:06:36.872901 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:06:36.873589 [info ] [MainThread]: 
[0m05:06:36.874305 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m05:06:36.875628 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.508151, "process_user_time": 6.590309, "process_kernel_time": 0.240181, "process_mem_max_rss": "164324", "process_out_blocks": "2832", "process_in_blocks": "0"}
[0m05:06:36.876582 [debug] [MainThread]: Command `dbt run` succeeded at 05:06:36.876361 after 10.51 seconds
[0m05:06:36.877312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f288a402c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2880002fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f287f44b430>]}
[0m05:06:36.878047 [debug] [MainThread]: Flushing usage events
[0m05:30:27.840791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24dfe02bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24de05cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24de05c340>]}


============================== 05:30:27.844430 | 4ee46cb6-bbfb-4ae6-8623-c69cebee3544 ==============================
[0m05:30:27.844430 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:30:27.845335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +intermediate*', 'send_anonymous_usage_stats': 'True'}
[0m05:30:28.591757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ee46cb6-bbfb-4ae6-8623-c69cebee3544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24e084a7a0>]}
[0m05:30:28.732667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ee46cb6-bbfb-4ae6-8623-c69cebee3544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24d5cd3010>]}
[0m05:30:28.733855 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:30:28.744751 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:30:28.786564 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m05:30:28.787508 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m05:30:28.788059 [debug] [MainThread]: Partial parsing: deleted file: capstone://snapshots/daily_aggregated_sales.sql
[0m05:30:28.967194 [error] [MainThread]: Encountered an error:
Compilation Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  expected token ',', got 'target_schema'
    line 4
      target_schema='intermediate',
[0m05:30:28.968838 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1967697, "process_user_time": 3.907217, "process_kernel_time": 0.215828, "process_mem_max_rss": "148840", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m05:30:28.969863 [debug] [MainThread]: Command `dbt run` failed at 05:30:28.969638 after 1.20 seconds
[0m05:30:28.970651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24dfe02bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24d57114b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24d57115a0>]}
[0m05:30:28.971492 [debug] [MainThread]: Flushing usage events
[0m05:30:41.301840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b8526bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b66e0ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b66e0340>]}


============================== 05:30:41.305723 | 9dc901e6-dc96-493b-bdc2-43805fddd0bf ==============================
[0m05:30:41.305723 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:30:41.306705 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +intermediate*', 'send_anonymous_usage_stats': 'True'}
[0m05:30:42.051544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b669e7a0>]}
[0m05:30:42.188624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ae357010>]}
[0m05:30:42.189880 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:30:42.200390 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:30:42.240712 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m05:30:42.241742 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m05:30:42.242378 [debug] [MainThread]: Partial parsing: deleted file: capstone://snapshots/daily_aggregated_sales.sql
[0m05:30:42.449731 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m05:30:42.457086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17adc890f0>]}
[0m05:30:42.472798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17add6c430>]}
[0m05:30:42.473643 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m05:30:42.474337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17add6e890>]}
[0m05:30:42.476722 [info ] [MainThread]: 
[0m05:30:42.477961 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:30:42.479881 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m05:30:42.499388 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:30:42.500148 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:30:42.500779 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:30:43.659099 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m05:30:43.661739 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:30:43.861392 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:30:43.862334 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:30:43.862966 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:44.432608 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m05:30:44.435265 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:30:44.512269 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate_intermediate)
[0m05:30:44.513650 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate_intermediate"
"
[0m05:30:44.520832 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate_intermediate"
[0m05:30:44.521663 [debug] [ThreadPool]: On create_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate_intermediate"} */
create schema if not exists tpcds.intermediate_intermediate
[0m05:30:44.522410 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:45.206920 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:30:45.208778 [debug] [ThreadPool]: On create_tpcds_intermediate_intermediate: Close
[0m05:30:45.361506 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate_intermediate, now list_tpcds_intermediate)
[0m05:30:45.373650 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m05:30:45.374465 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m05:30:45.375206 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:45.911150 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m05:30:45.913673 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m05:30:46.042839 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_intermediate)
[0m05:30:46.047721 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m05:30:46.048429 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m05:30:46.049064 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:46.317227 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m05:30:46.319480 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m05:30:46.813886 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now list_tpcds_intermediate_staging)
[0m05:30:46.817887 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m05:30:46.818697 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m05:30:46.819451 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:47.531328 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m05:30:47.534001 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m05:30:47.582461 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate_analytics)
[0m05:30:47.588965 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m05:30:47.589767 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m05:30:47.590507 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:30:48.292875 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:30:48.295435 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m05:30:48.485534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17add6cfa0>]}
[0m05:30:48.486943 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:30:48.487695 [info ] [MainThread]: 
[0m05:30:48.490830 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m05:30:48.491686 [info ] [Thread-1 (]: 1 of 3 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m05:30:48.492752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m05:30:48.493510 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m05:30:48.506235 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:30:48.508170 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 05:30:48.494408 => 05:30:48.507773
[0m05:30:48.508917 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m05:30:48.548551 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:30:48.551972 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m05:30:48.552790 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m05:30:48.553607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:30:50.812905 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m05:30:50.844221 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 05:30:48.509437 => 05:30:50.843831
[0m05:30:50.844974 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m05:30:51.049091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ad262350>]}
[0m05:30:51.050211 [info ] [Thread-1 (]: 1 of 3 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 2.56s]
[0m05:30:51.051268 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m05:30:51.052012 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m05:30:51.052811 [info ] [Thread-1 (]: 2 of 3 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m05:30:51.054094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__web_sales)
[0m05:30:51.054855 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m05:30:51.059675 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m05:30:51.061136 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 05:30:51.055410 => 05:30:51.060754
[0m05:30:51.061882 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m05:30:51.068550 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m05:30:51.071820 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m05:30:51.072648 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m05:30:51.073464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:30:51.677017 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:30:51.681746 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 05:30:51.062382 => 05:30:51.681378
[0m05:30:51.682528 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m05:30:51.730139 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17add2bb20>]}
[0m05:30:51.731492 [info ] [Thread-1 (]: 2 of 3 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.68s]
[0m05:30:51.732663 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m05:30:51.734179 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m05:30:51.735205 [info ] [Thread-1 (]: 3 of 3 START sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [RUN]
[0m05:30:51.736448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now model.capstone.int_daily_aggregated_sales)
[0m05:30:51.737254 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m05:30:51.743895 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m05:30:51.746125 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 05:30:51.737861 => 05:30:51.745740
[0m05:30:51.746938 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m05:30:51.812267 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int_daily_aggregated_sales"
[0m05:30:51.817873 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m05:30:51.818888 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate_intermediate.int_daily_aggregated_sales
         as
        (

WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            WS_ORDER_NUMBER AS order_number,
            WS_ITEM_SK AS item_sk,
            WS_WAREHOUSE_SK AS warehouse_sk,
            WS_SOLD_DATE_SK as sold_date_sk,
            WS_QUANTITY as quantity,
            WS_NET_PROFIT as net_profit,
            WS_SALES_PRICE as sales_price,
            ws_sales_price * ws_quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__web_sales
        WHERE 
            WS_SOLD_DATE_SK >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            AND quantity IS NOT NULL
        UNION
        SELECT DISTINCT
            CS_ORDER_NUMBER AS order_number,
            CS_ITEM_SK AS item_sk,
            CS_WAREHOUSE_SK AS warehouse_sk,
            CS_SOLD_DATE_SK as sold_date_sk,
            CS_QUANTITY as quantity,
            CS_NET_PROFIT as net_profit,
            CS_SALES_PRICE as sales_price,
            cs_sales_price * cs_quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__catalog_sales
        WHERE 
            cs_sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            AND quantity IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0),
    -- add the bow sk to the daily table
    daily_agg_bow as
        (
            SELECT 
                item_sk, 
                warehouse_sk, 
                sold_date_sk, 
                dt.cal_dt as sold_cal_date,
                daily_quantity, 
                daily_net_profit, 
                daily_sales_amt,
                dt.wk_num as wk_num, 
                dt.yr_num as yr_num,
                bow.bow_sk AS sold_date_bow_sk,
                bow.cal_date as sold_date_bow_cal_date
            FROM daily_agg
            INNER JOIN tpcds.raw.date_dim AS dt ON daily_agg.sold_date_sk = dt.d_date_sk 
            INNER JOIN bow ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num 
        )
    SELECT 
        warehouse_sk, 
        item_sk, 
        sold_date_sk, 
        wk_num, 
        yr_num,
        sold_date_bow_sk, 
        daily_quantity, 
        daily_net_profit, 
        daily_sales_amt,
        sold_cal_date,
        sold_date_bow_cal_date
FROM daily_agg_bow
;
[0m05:30:51.819924 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:30:52.130339 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1052a-0001-8eb8-0004-d6ae0008973e
[0m05:30:52.131378 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 95 at position 0 unexpected ';'.
[0m05:30:52.132464 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 05:30:51.747558 => 05:30:52.132086
[0m05:30:52.133295 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: Close
[0m05:30:52.174396 [debug] [Thread-1 (]: Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  001003 (42000): SQL compilation error:
  syntax error line 95 at position 0 unexpected ';'.
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:30:52.175482 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9dc901e6-dc96-493b-bdc2-43805fddd0bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ac133c40>]}
[0m05:30:52.176602 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [[31mERROR[0m in 0.44s]
[0m05:30:52.177781 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m05:30:52.180232 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:30:52.180784 [debug] [MainThread]: Connection 'model.capstone.int_daily_aggregated_sales' was properly closed.
[0m05:30:52.181364 [info ] [MainThread]: 
[0m05:30:52.181956 [info ] [MainThread]: Finished running 2 view models, 1 incremental model in 0 hours 0 minutes and 9.70 seconds (9.70s).
[0m05:30:52.183497 [debug] [MainThread]: Command end result
[0m05:30:52.195286 [info ] [MainThread]: 
[0m05:30:52.195931 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m05:30:52.196487 [info ] [MainThread]: 
[0m05:30:52.197043 [error] [MainThread]:   Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  001003 (42000): SQL compilation error:
  syntax error line 95 at position 0 unexpected ';'.
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:30:52.197618 [info ] [MainThread]: 
[0m05:30:52.198198 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m05:30:52.199427 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.965166, "process_user_time": 5.538469, "process_kernel_time": 0.266673, "process_mem_max_rss": "161504", "process_out_blocks": "2920", "command_success": false, "process_in_blocks": "0"}
[0m05:30:52.200274 [debug] [MainThread]: Command `dbt run` failed at 05:30:52.200058 after 10.97 seconds
[0m05:30:52.200881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b8526bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17ae357010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f17b669e8c0>]}
[0m05:30:52.201480 [debug] [MainThread]: Flushing usage events
[0m05:31:08.911881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938cf09690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938b14e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938b14f130>]}


============================== 05:31:08.915423 | b6efd07f-1edb-4384-95b4-85ba37e92a96 ==============================
[0m05:31:08.915423 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:31:08.916328 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select +intermediate*', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:31:09.667040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382db6ad0>]}
[0m05:31:09.805301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382b66920>]}
[0m05:31:09.806442 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:31:09.816802 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:31:09.855957 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:31:09.856934 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m05:31:10.073264 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m05:31:10.081134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382709090>]}
[0m05:31:10.096786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382644070>]}
[0m05:31:10.097580 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m05:31:10.098202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382646890>]}
[0m05:31:10.100504 [info ] [MainThread]: 
[0m05:31:10.101633 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:31:10.103509 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m05:31:10.123724 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:31:10.124772 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:31:10.125577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:31:11.031773 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m05:31:11.034416 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:31:11.091066 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:31:11.091914 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:31:11.092574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:31:11.529600 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m05:31:11.532153 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:31:11.591084 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_intermediate)
[0m05:31:11.603262 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m05:31:11.604050 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m05:31:11.604693 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:31:11.897244 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m05:31:11.899589 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m05:31:11.962119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now list_tpcds_intermediate)
[0m05:31:11.966018 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m05:31:11.966691 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m05:31:11.967355 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:31:12.263544 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m05:31:12.266079 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m05:31:12.309704 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_staging)
[0m05:31:12.314436 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m05:31:12.315132 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m05:31:12.315774 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:31:12.635403 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m05:31:12.638117 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m05:31:12.691751 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate_analytics)
[0m05:31:12.698389 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m05:31:12.699126 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m05:31:12.699780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:31:13.075572 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:31:13.078205 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m05:31:13.125970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382644ee0>]}
[0m05:31:13.127246 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:31:13.127854 [info ] [MainThread]: 
[0m05:31:13.130641 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m05:31:13.131458 [info ] [Thread-1 (]: 1 of 3 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m05:31:13.132515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m05:31:13.133350 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m05:31:13.146853 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:31:13.148620 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 05:31:13.133860 => 05:31:13.148235
[0m05:31:13.149465 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m05:31:13.188166 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:31:13.191688 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m05:31:13.192499 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m05:31:13.193306 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:31:13.625076 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:31:13.656768 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 05:31:13.150051 => 05:31:13.656368
[0m05:31:13.657649 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m05:31:13.710113 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93827a8430>]}
[0m05:31:13.711361 [info ] [Thread-1 (]: 1 of 3 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.58s]
[0m05:31:13.712463 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m05:31:13.713292 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m05:31:13.714327 [info ] [Thread-1 (]: 2 of 3 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m05:31:13.715495 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__web_sales)
[0m05:31:13.716225 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m05:31:13.720918 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m05:31:13.721960 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 05:31:13.716745 => 05:31:13.721576
[0m05:31:13.722611 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m05:31:13.727607 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m05:31:13.730348 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m05:31:13.731082 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m05:31:13.731785 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:31:14.141133 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:31:14.145685 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 05:31:13.723029 => 05:31:14.145313
[0m05:31:14.146382 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m05:31:14.737442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9380348b20>]}
[0m05:31:14.738790 [info ] [Thread-1 (]: 2 of 3 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 1.02s]
[0m05:31:14.740049 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m05:31:14.741647 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m05:31:14.742399 [info ] [Thread-1 (]: 3 of 3 START sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [RUN]
[0m05:31:14.743481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now model.capstone.int_daily_aggregated_sales)
[0m05:31:14.744108 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m05:31:14.750132 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m05:31:14.751183 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 05:31:14.744515 => 05:31:14.750770
[0m05:31:14.751807 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m05:31:14.817154 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int_daily_aggregated_sales"
[0m05:31:14.821590 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m05:31:14.822420 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate_intermediate.int_daily_aggregated_sales
         as
        (

WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            WS_ORDER_NUMBER AS order_number,
            WS_ITEM_SK AS item_sk,
            WS_WAREHOUSE_SK AS warehouse_sk,
            WS_SOLD_DATE_SK as sold_date_sk,
            WS_QUANTITY as quantity,
            WS_NET_PROFIT as net_profit,
            WS_SALES_PRICE as sales_price,
            ws_sales_price * ws_quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__web_sales
        WHERE 
            WS_SOLD_DATE_SK >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            AND quantity IS NOT NULL
        UNION
        SELECT DISTINCT
            CS_ORDER_NUMBER AS order_number,
            CS_ITEM_SK AS item_sk,
            CS_WAREHOUSE_SK AS warehouse_sk,
            CS_SOLD_DATE_SK as sold_date_sk,
            CS_QUANTITY as quantity,
            CS_NET_PROFIT as net_profit,
            CS_SALES_PRICE as sales_price,
            cs_sales_price * cs_quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__catalog_sales
        WHERE 
            cs_sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            AND quantity IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0),
    -- add the bow sk to the daily table
    daily_agg_bow as
        (
            SELECT 
                item_sk, 
                warehouse_sk, 
                sold_date_sk, 
                dt.cal_dt as sold_cal_date,
                daily_quantity, 
                daily_net_profit, 
                daily_sales_amt,
                dt.wk_num as wk_num, 
                dt.yr_num as yr_num,
                bow.bow_sk AS sold_date_bow_sk,
                bow.cal_date as sold_date_bow_cal_date
            FROM daily_agg
            INNER JOIN tpcds.raw.date_dim AS dt ON daily_agg.sold_date_sk = dt.d_date_sk 
            INNER JOIN bow ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num 
        )
    SELECT 
        warehouse_sk, 
        item_sk, 
        sold_date_sk, 
        wk_num, 
        yr_num,
        sold_date_bow_sk, 
        daily_quantity, 
        daily_net_profit, 
        daily_sales_amt,
        sold_cal_date,
        sold_date_bow_cal_date
FROM daily_agg_bow
        );
[0m05:31:14.823255 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:31:15.804336 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1052b-0001-8e9a-0004-d6ae000887c2
[0m05:31:15.805362 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.INTERMEDIATE_INTERMEDIATE.INT_DAILY_AGGREGATED_SALES' does not exist or not authorized.
[0m05:31:15.806469 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 05:31:14.752215 => 05:31:15.806077
[0m05:31:15.807359 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: Close
[0m05:31:15.856002 [debug] [Thread-1 (]: Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE_INTERMEDIATE.INT_DAILY_AGGREGATED_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:31:15.856916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6efd07f-1edb-4384-95b4-85ba37e92a96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938034b0d0>]}
[0m05:31:15.857873 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [[31mERROR[0m in 1.11s]
[0m05:31:15.858925 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m05:31:15.861321 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:31:15.861898 [debug] [MainThread]: Connection 'model.capstone.int_daily_aggregated_sales' was properly closed.
[0m05:31:15.862495 [info ] [MainThread]: 
[0m05:31:15.863131 [info ] [MainThread]: Finished running 2 view models, 1 incremental model in 0 hours 0 minutes and 5.76 seconds (5.76s).
[0m05:31:15.864948 [debug] [MainThread]: Command end result
[0m05:31:15.877870 [info ] [MainThread]: 
[0m05:31:15.878593 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m05:31:15.879183 [info ] [MainThread]: 
[0m05:31:15.879760 [error] [MainThread]:   Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE_INTERMEDIATE.INT_DAILY_AGGREGATED_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:31:15.880370 [info ] [MainThread]: 
[0m05:31:15.880967 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m05:31:15.882199 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.0388536, "process_user_time": 5.476297, "process_kernel_time": 0.252392, "process_mem_max_rss": "161632", "process_out_blocks": "2928", "command_success": false, "process_in_blocks": "0"}
[0m05:31:15.883140 [debug] [MainThread]: Command `dbt run` failed at 05:31:15.882848 after 7.04 seconds
[0m05:31:15.883785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938cf09690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382702980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9382b8fd90>]}
[0m05:31:15.884446 [debug] [MainThread]: Flushing usage events
[0m05:41:43.523483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6673160b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff667c550c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff667c56440>]}


============================== 05:41:43.526934 | a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d ==============================
[0m05:41:43.526934 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:41:43.527842 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +intermediate*', 'send_anonymous_usage_stats': 'True'}
[0m05:41:44.276679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff667c56b60>]}
[0m05:41:44.413557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65cf970a0>]}
[0m05:41:44.414708 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:41:44.425151 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:41:44.464943 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:41:44.465931 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m05:41:44.678174 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m05:41:44.685600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65cae16f0>]}
[0m05:41:44.700194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65ca013c0>]}
[0m05:41:44.700898 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m05:41:44.701503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65ca013f0>]}
[0m05:41:44.703753 [info ] [MainThread]: 
[0m05:41:44.704821 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:41:44.706615 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m05:41:44.725428 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:41:44.726308 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:41:44.727136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:41:45.295567 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m05:41:45.297976 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:41:45.342135 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:41:45.342952 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:41:45.343514 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:45.819579 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m05:41:45.821950 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:41:45.890449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_analytics)
[0m05:41:45.903136 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m05:41:45.903812 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m05:41:45.904357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:46.280786 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:41:46.283174 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m05:41:46.339399 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now list_tpcds_intermediate_intermediate)
[0m05:41:46.343821 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m05:41:46.344422 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m05:41:46.344972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:46.627114 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m05:41:46.629296 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m05:41:46.669213 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now list_tpcds_intermediate_staging)
[0m05:41:46.673284 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m05:41:46.673956 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m05:41:46.674615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:47.035398 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m05:41:47.038110 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m05:41:47.079540 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate)
[0m05:41:47.086001 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m05:41:47.086792 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m05:41:47.087495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:47.428081 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m05:41:47.430589 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m05:41:47.483058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65ca01060>]}
[0m05:41:47.484517 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:41:47.485304 [info ] [MainThread]: 
[0m05:41:47.488234 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m05:41:47.489023 [info ] [Thread-1 (]: 1 of 3 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m05:41:47.490061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m05:41:47.490879 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m05:41:47.504626 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:41:47.506621 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 05:41:47.491691 => 05:41:47.506238
[0m05:41:47.507496 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m05:41:47.545922 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:41:47.549409 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m05:41:47.550231 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m05:41:47.551064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:41:48.100477 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:41:48.132214 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 05:41:47.508076 => 05:41:48.131823
[0m05:41:48.133171 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m05:41:48.178589 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65cae01c0>]}
[0m05:41:48.179709 [info ] [Thread-1 (]: 1 of 3 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.69s]
[0m05:41:48.180761 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m05:41:48.181540 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m05:41:48.182498 [info ] [Thread-1 (]: 2 of 3 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m05:41:48.183698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__web_sales)
[0m05:41:48.184494 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m05:41:48.189466 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m05:41:48.190945 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 05:41:48.185009 => 05:41:48.190554
[0m05:41:48.191781 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m05:41:48.196977 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m05:41:48.200205 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m05:41:48.201054 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS WS_ORDER_NUMBER,
   WS_SHIP_MODE_SK AS WS_SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS WS_SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS WS_SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS WS_NET_PAID_INC_TAX,
   WS_PROMO_SK AS WS_PROMO_SK,
   WS_NET_PAID_INC_SHIP AS WS_NET_PAID_INC_SHIP,
   WS_QUANTITY AS WS_QUANTITY,
   WS_EXT_SALES_PRICE AS WS_EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WS_WEB_SITE_SK,
   WS_SHIP_DATE_SK AS WS_SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS WS_BILL_CDEMO_SK,
   WS_NET_PROFIT AS WS_NET_PROFIT,
   WS_NET_PAID AS WS_NET_PAID,
   WS_EXT_SHIP_COST AS WS_EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS WS_BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS WS_COUPON_AMT,
   WS_WHOLESALE_COST AS WS_WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS WS_SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS WS_BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS WS_SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS WS_SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WS_WAREHOUSE_SK,
   WS_EXT_TAX AS WS_EXT_TAX,
   WS_ITEM_SK AS WS_ITEM_SK,
   WS_SHIP_HDEMO_SK AS WS_SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS WS_EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS WS_NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS WS_EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS WS_SALES_PRICE,
   WS_WEB_PAGE_SK AS WS_WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS WS_EXT_LIST_PRICE,
   WS_LIST_PRICE AS WS_LIST_PRICE,
   WS_BILL_ADDR_SK AS WS_BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m05:41:48.201884 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:41:48.725926 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:41:48.730596 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 05:41:48.192297 => 05:41:48.730227
[0m05:41:48.731407 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m05:41:48.786971 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65c833940>]}
[0m05:41:48.788271 [info ] [Thread-1 (]: 2 of 3 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.60s]
[0m05:41:48.789387 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m05:41:48.790876 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m05:41:48.791801 [info ] [Thread-1 (]: 3 of 3 START sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [RUN]
[0m05:41:48.792977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now model.capstone.int_daily_aggregated_sales)
[0m05:41:48.793709 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m05:41:48.802182 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m05:41:48.803697 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 05:41:48.794228 => 05:41:48.803312
[0m05:41:48.804430 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m05:41:48.869931 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int_daily_aggregated_sales"
[0m05:41:48.874546 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m05:41:48.875532 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate_intermediate.int_daily_aggregated_sales
         as
        (

WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__web_sales
        WHERE 
            -- SOLD_DATE_SK >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__catalog_sales
        WHERE 
            -- sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0),
    -- add the bow sk to the daily table
    daily_agg_bow as
        (
            SELECT 
                item_sk, 
                warehouse_sk, 
                sold_date_sk, 
                dt.cal_dt as sold_cal_date,
                daily_quantity, 
                daily_net_profit, 
                daily_sales_amt,
                dt.wk_num as wk_num, 
                dt.yr_num as yr_num,
                bow.bow_sk AS sold_date_bow_sk,
                bow.cal_date as sold_date_bow_cal_date
            FROM daily_agg
            INNER JOIN tpcds.raw.date_dim AS dt ON daily_agg.sold_date_sk = dt.d_date_sk 
            INNER JOIN bow ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num 
        )
    SELECT 
        warehouse_sk, 
        item_sk, 
        sold_date_sk, 
        wk_num, 
        yr_num,
        sold_date_bow_sk, 
        daily_quantity, 
        daily_net_profit, 
        daily_sales_amt,
        sold_cal_date,
        sold_date_bow_cal_date
FROM daily_agg_bow


        );
[0m05:41:48.876464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:41:49.264915 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b10535-0001-8eb8-0004-d6ae0008975a
[0m05:41:49.265714 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 13 at position 12
invalid identifier 'ORDER_NUMBER'
[0m05:41:49.266612 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 05:41:48.804933 => 05:41:49.266235
[0m05:41:49.267314 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: Close
[0m05:41:49.333956 [debug] [Thread-1 (]: Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  000904 (42000): SQL compilation error: error line 13 at position 12
  invalid identifier 'ORDER_NUMBER'
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:41:49.334885 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a00a8f03-5c2a-435f-9efe-3f72dcaf4c2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65c831a80>]}
[0m05:41:49.335873 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [[31mERROR[0m in 0.54s]
[0m05:41:49.336900 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m05:41:49.339337 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:41:49.339897 [debug] [MainThread]: Connection 'model.capstone.int_daily_aggregated_sales' was properly closed.
[0m05:41:49.340493 [info ] [MainThread]: 
[0m05:41:49.341096 [info ] [MainThread]: Finished running 2 view models, 1 incremental model in 0 hours 0 minutes and 4.64 seconds (4.64s).
[0m05:41:49.342623 [debug] [MainThread]: Command end result
[0m05:41:49.355300 [info ] [MainThread]: 
[0m05:41:49.355996 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m05:41:49.356574 [info ] [MainThread]: 
[0m05:41:49.357148 [error] [MainThread]:   Database Error in model int_daily_aggregated_sales (models/intermediate/int_daily_aggregated_sales.sql)
  000904 (42000): SQL compilation error: error line 13 at position 12
  invalid identifier 'ORDER_NUMBER'
  compiled Code at target/run/capstone/models/intermediate/int_daily_aggregated_sales.sql
[0m05:41:49.357742 [info ] [MainThread]: 
[0m05:41:49.358348 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m05:41:49.359589 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.9021764, "process_user_time": 5.409022, "process_kernel_time": 0.244571, "process_mem_max_rss": "161240", "process_out_blocks": "2936", "command_success": false, "process_in_blocks": "0"}
[0m05:41:49.360446 [debug] [MainThread]: Command `dbt run` failed at 05:41:49.360229 after 5.90 seconds
[0m05:41:49.361055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6673160b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65ca750f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff65ca00e80>]}
[0m05:41:49.361679 [debug] [MainThread]: Flushing usage events
[0m05:52:08.794747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09c5622aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09c37e09d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09c37e33d0>]}


============================== 05:52:08.798157 | 2ad602ff-3f26-41d4-98ad-db3ca1a55edb ==============================
[0m05:52:08.798157 [info ] [MainThread]: Running with dbt=1.7.3
[0m05:52:08.798940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select +intermediate*', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:52:09.550733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09c37e2b30>]}
[0m05:52:09.690279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bb008f70>]}
[0m05:52:09.691502 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m05:52:09.702482 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m05:52:09.743744 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:52:09.744785 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__web_sales.sql
[0m05:52:09.955580 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m05:52:09.963220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bad92410>]}
[0m05:52:09.979054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bae00b80>]}
[0m05:52:09.979932 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m05:52:09.980649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bb112050>]}
[0m05:52:09.983057 [info ] [MainThread]: 
[0m05:52:09.984287 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:52:09.986665 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m05:52:10.006874 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:52:10.007866 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:52:10.008585 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:52:10.511554 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m05:52:10.513998 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:52:10.576831 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m05:52:10.577555 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m05:52:10.578112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:52:10.994506 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m05:52:10.997009 [debug] [ThreadPool]: On list_tpcds: Close
[0m05:52:11.044672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate_staging)
[0m05:52:11.057225 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m05:52:11.058046 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m05:52:11.058713 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:52:11.478468 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m05:52:11.481264 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m05:52:11.561912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now list_tpcds_intermediate_intermediate)
[0m05:52:11.568303 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m05:52:11.569095 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m05:52:11.569816 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:52:12.007339 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m05:52:12.009705 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m05:52:12.062424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now list_tpcds_intermediate_analytics)
[0m05:52:12.066548 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m05:52:12.067357 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m05:52:12.068102 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:52:12.381221 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:52:12.383772 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m05:52:12.422675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now list_tpcds_intermediate)
[0m05:52:12.427285 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m05:52:12.428059 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m05:52:12.428787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:52:12.812892 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m05:52:12.815543 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m05:52:12.871453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bae00b50>]}
[0m05:52:12.872831 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:52:12.873527 [info ] [MainThread]: 
[0m05:52:12.876641 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m05:52:12.877457 [info ] [Thread-1 (]: 1 of 3 START sql view model intermediate_staging.stg_tpcds__catalog_sales ...... [RUN]
[0m05:52:12.878593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m05:52:12.879569 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m05:52:12.892614 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:52:12.894542 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 05:52:12.880178 => 05:52:12.894154
[0m05:52:12.895430 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m05:52:12.936501 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m05:52:12.940055 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m05:52:12.940919 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m05:52:12.942167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:52:13.348339 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:52:13.379687 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 05:52:12.896017 => 05:52:13.379310
[0m05:52:13.380652 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m05:52:13.438230 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09b9f710f0>]}
[0m05:52:13.439568 [info ] [Thread-1 (]: 1 of 3 OK created sql view model intermediate_staging.stg_tpcds__catalog_sales . [[32mSUCCESS 1[0m in 0.56s]
[0m05:52:13.440747 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m05:52:13.441665 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m05:52:13.442585 [info ] [Thread-1 (]: 2 of 3 START sql view model intermediate_staging.stg_tpcds__web_sales .......... [RUN]
[0m05:52:13.443828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__web_sales)
[0m05:52:13.444644 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m05:52:13.449474 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m05:52:13.451365 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 05:52:13.445214 => 05:52:13.450950
[0m05:52:13.452205 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m05:52:13.457369 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m05:52:13.460554 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m05:52:13.461352 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.intermediate_staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m05:52:13.462156 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:52:13.866884 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:52:13.871492 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 05:52:13.452777 => 05:52:13.871134
[0m05:52:13.872256 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m05:52:13.912223 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09b9f711b0>]}
[0m05:52:13.913430 [info ] [Thread-1 (]: 2 of 3 OK created sql view model intermediate_staging.stg_tpcds__web_sales ..... [[32mSUCCESS 1[0m in 0.47s]
[0m05:52:13.914494 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m05:52:13.915927 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m05:52:13.916763 [info ] [Thread-1 (]: 3 of 3 START sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [RUN]
[0m05:52:13.917890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now model.capstone.int_daily_aggregated_sales)
[0m05:52:13.918607 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m05:52:13.931071 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m05:52:13.932555 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 05:52:13.919135 => 05:52:13.932172
[0m05:52:13.933317 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m05:52:13.998505 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int_daily_aggregated_sales"
[0m05:52:14.003170 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m05:52:14.004136 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate_intermediate.int_daily_aggregated_sales
         as
        (

WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__web_sales
        WHERE 
            -- SOLD_DATE_SK >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__catalog_sales
        WHERE 
            -- sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0),
    -- add the bow sk to the daily table
    daily_agg_bow as
        (
            SELECT 
                item_sk, 
                warehouse_sk, 
                sold_date_sk, 
                dt.cal_dt as sold_cal_date,
                daily_quantity, 
                daily_net_profit, 
                daily_sales_amt,
                dt.wk_num as wk_num, 
                dt.yr_num as yr_num,
                bow.bow_sk AS sold_date_bow_sk,
                bow.cal_date as sold_date_bow_cal_date
            FROM daily_agg
            INNER JOIN tpcds.raw.date_dim AS dt ON daily_agg.sold_date_sk = dt.d_date_sk 
            INNER JOIN bow ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num 
        )
    SELECT 
        warehouse_sk, 
        item_sk, 
        sold_date_sk, 
        wk_num, 
        yr_num,
        sold_date_bow_sk, 
        daily_quantity, 
        daily_net_profit, 
        daily_sales_amt,
        sold_cal_date,
        sold_date_bow_cal_date
FROM daily_agg_bow


        );
[0m05:52:14.005073 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:52:18.584017 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m05:52:18.596944 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp
[0m05:52:18.606414 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m05:52:18.607496 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
drop view if exists tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp cascade
[0m05:52:18.643496 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:52:18.647907 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 05:52:13.933822 => 05:52:18.647546
[0m05:52:18.648766 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: Close
[0m05:52:18.694990 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad602ff-3f26-41d4-98ad-db3ca1a55edb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09ba8b5a50>]}
[0m05:52:18.696408 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [[32mSUCCESS 1[0m in 4.78s]
[0m05:52:18.697625 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m05:52:18.700093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:52:18.700637 [debug] [MainThread]: Connection 'model.capstone.int_daily_aggregated_sales' was properly closed.
[0m05:52:18.701201 [info ] [MainThread]: 
[0m05:52:18.701822 [info ] [MainThread]: Finished running 2 view models, 1 incremental model in 0 hours 0 minutes and 8.72 seconds (8.72s).
[0m05:52:18.703361 [debug] [MainThread]: Command end result
[0m05:52:18.716161 [info ] [MainThread]: 
[0m05:52:18.716817 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:52:18.717391 [info ] [MainThread]: 
[0m05:52:18.717985 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m05:52:18.719234 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.9910555, "process_user_time": 5.546337, "process_kernel_time": 0.21589, "process_mem_max_rss": "160608", "process_out_blocks": "2928", "process_in_blocks": "0"}
[0m05:52:18.720078 [debug] [MainThread]: Command `dbt run` succeeded at 05:52:18.719859 after 9.99 seconds
[0m05:52:18.720680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09c5622aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bae009d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09bb111960>]}
[0m05:52:18.721298 [debug] [MainThread]: Flushing usage events
[0m06:01:14.693246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38cff2c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af72950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af72e00>]}


============================== 06:01:14.696640 | 8a4f1396-3fdb-4727-bc43-64c7c545be44 ==============================
[0m06:01:14.696640 [info ] [MainThread]: Running with dbt=1.7.3
[0m06:01:14.697427 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:01:14.831865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a4f1396-3fdb-4727-bc43-64c7c545be44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af72110>]}
[0m06:01:14.833211 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-bk28jn3l'
[0m06:01:14.833973 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m06:01:14.955776 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m06:01:14.956608 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m06:01:15.053528 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m06:01:15.059571 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json
[0m06:01:15.158665 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json 200
[0m06:01:15.163368 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m06:01:15.259629 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m06:01:15.276372 [info ] [MainThread]: Updating lock file in file path: /home/ubuntu/capstone_dbt_project/capstone/package-lock.yml
[0m06:01:15.280531 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-p4rwqfe7'
[0m06:01:15.291889 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m06:01:15.498991 [info ] [MainThread]: Installed from version 1.1.1
[0m06:01:15.499946 [info ] [MainThread]: Up to date!
[0m06:01:15.500684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '8a4f1396-3fdb-4727-bc43-64c7c545be44', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38afa7d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38ae69420>]}
[0m06:01:15.501324 [info ] [MainThread]: Installing calogica/dbt_expectations
[0m06:01:15.941207 [info ] [MainThread]: Installed from version 0.10.1
[0m06:01:15.947679 [info ] [MainThread]: Up to date!
[0m06:01:15.948455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '8a4f1396-3fdb-4727-bc43-64c7c545be44', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af709a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af73970>]}
[0m06:01:15.949248 [info ] [MainThread]: Installing calogica/dbt_date
[0m06:01:16.104402 [info ] [MainThread]: Installed from version 0.10.0
[0m06:01:16.105316 [info ] [MainThread]: Up to date!
[0m06:01:16.106069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '8a4f1396-3fdb-4727-bc43-64c7c545be44', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38afcd6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38af72e00>]}
[0m06:01:16.108503 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.4824326, "process_user_time": 3.72032, "process_kernel_time": 0.144097, "process_mem_max_rss": "103632", "process_out_blocks": "23048", "process_in_blocks": "0"}
[0m06:01:16.109356 [debug] [MainThread]: Command `dbt deps` succeeded at 06:01:16.109137 after 1.48 seconds
[0m06:01:16.119367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38cff2c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38afcc1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd38ae6ba90>]}
[0m06:01:16.123118 [debug] [MainThread]: Flushing usage events
[0m18:22:10.717270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe7a1f6500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe782615d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe78263f70>]}


============================== 18:22:10.721807 | 0982725c-8cc1-428a-ba30-88427df1f6d6 ==============================
[0m18:22:10.721807 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:22:10.722616 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select int_daily_aggregated_sales', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:22:12.402438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6fea27a0>]}
[0m18:22:12.544481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6fea3460>]}
[0m18:22:12.546199 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:22:12.581421 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:22:12.600283 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m18:22:12.601093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6fba6530>]}
[0m18:22:15.815670 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m18:22:15.824468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6f8b99c0>]}
[0m18:22:15.846132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6faa2c50>]}
[0m18:22:15.846973 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 804 macros, 0 groups, 0 semantic models
[0m18:22:15.847627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6faa2ad0>]}
[0m18:22:15.849486 [info ] [MainThread]: 
[0m18:22:15.850661 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:22:15.852398 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:22:15.873507 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:22:15.874198 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:22:15.874755 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:22:16.352790 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:22:16.355311 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:22:16.402162 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m18:22:16.415542 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:22:16.416210 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:22:16.416797 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:22:16.788779 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:22:16.791285 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:22:16.838088 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_intermediate_analytics)
[0m18:22:16.843863 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_analytics"
[0m18:22:16.844455 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_analytics"} */
show terse objects in tpcds.intermediate_analytics limit 10000
[0m18:22:16.844993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:22:17.171941 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:22:17.174330 [debug] [ThreadPool]: On list_tpcds_intermediate_analytics: Close
[0m18:22:17.218037 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_analytics, now list_tpcds_intermediate_intermediate)
[0m18:22:17.224881 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_intermediate"
[0m18:22:17.225478 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_intermediate"} */
show terse objects in tpcds.intermediate_intermediate limit 10000
[0m18:22:17.226017 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:22:17.503491 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:22:17.505836 [debug] [ThreadPool]: On list_tpcds_intermediate_intermediate: Close
[0m18:22:17.548113 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_intermediate, now list_tpcds_intermediate_staging)
[0m18:22:17.553498 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate_staging"
[0m18:22:17.554081 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate_staging"} */
show terse objects in tpcds.intermediate_staging limit 10000
[0m18:22:17.554615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:22:17.880531 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m18:22:17.883216 [debug] [ThreadPool]: On list_tpcds_intermediate_staging: Close
[0m18:22:17.931891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6f9afe80>]}
[0m18:22:17.933245 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:22:17.933903 [info ] [MainThread]: 
[0m18:22:17.938538 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m18:22:17.939427 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [RUN]
[0m18:22:17.940688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate_staging, now model.capstone.int_daily_aggregated_sales)
[0m18:22:17.941389 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m18:22:17.959219 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m18:22:17.960388 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 18:22:17.941810 => 18:22:17.959970
[0m18:22:17.961052 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m18:22:18.030813 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.031932 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp
  
   as (
    

WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__web_sales
        WHERE 
            -- SOLD_DATE_SK >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.intermediate_staging.stg_tpcds__catalog_sales
        WHERE 
            -- sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)
            -- AND 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0),
    -- add the bow sk to the daily table
    daily_agg_bow as
        (
            SELECT 
                item_sk, 
                warehouse_sk, 
                sold_date_sk, 
                dt.cal_dt as sold_cal_date,
                daily_quantity, 
                daily_net_profit, 
                daily_sales_amt,
                dt.wk_num as wk_num, 
                dt.yr_num as yr_num,
                bow.bow_sk AS sold_date_bow_sk,
                bow.cal_date as sold_date_bow_cal_date
            FROM daily_agg
            INNER JOIN tpcds.raw.date_dim AS dt ON daily_agg.sold_date_sk = dt.d_date_sk 
            INNER JOIN bow ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num 
        )
    SELECT 
        warehouse_sk, 
        item_sk, 
        sold_date_sk, 
        wk_num, 
        yr_num,
        sold_date_bow_sk, 
        daily_quantity, 
        daily_net_profit, 
        daily_sales_amt,
        sold_cal_date,
        sold_date_bow_cal_date
FROM daily_agg_bow

 

WHERE 
 sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate_intermediate.int_daily_aggregated_sales), 0)


  );
[0m18:22:18.032793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:22:18.676492 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:22:18.689946 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.690662 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
describe table tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp
[0m18:22:18.761966 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m18:22:18.769344 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.770038 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
describe table tpcds.intermediate_intermediate.int_daily_aggregated_sales
[0m18:22:18.814106 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m18:22:18.829495 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.830283 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE_INTERMEDIATE"."INT_DAILY_AGGREGATED_SALES"
[0m18:22:18.893573 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m18:22:18.938471 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.941207 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:18.941900 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m18:22:19.058061 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:22:19.058928 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:19.059712 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
merge into tpcds.intermediate_intermediate.int_daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_SK", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "SOLD_CAL_DATE", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_SK", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "SOLD_CAL_DATE", "SOLD_DATE_BOW_CAL_DATE")

;
[0m18:22:24.516326 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 5.0 seconds
[0m18:22:24.517286 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:24.517935 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
COMMIT
[0m18:22:25.429981 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:22:25.443806 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp
[0m18:22:25.452832 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int_daily_aggregated_sales"
[0m18:22:25.453516 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int_daily_aggregated_sales"} */
drop view if exists tpcds.intermediate_intermediate.int_daily_aggregated_sales__dbt_tmp cascade
[0m18:22:25.660498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:22:25.689119 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 18:22:17.961479 => 18:22:25.688675
[0m18:22:25.689951 [debug] [Thread-1 (]: On model.capstone.int_daily_aggregated_sales: Close
[0m18:22:25.754191 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0982725c-8cc1-428a-ba30-88427df1f6d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6efe6f20>]}
[0m18:22:25.755429 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate_intermediate.int_daily_aggregated_sales  [[32mSUCCESS 2310[0m in 7.81s]
[0m18:22:25.756535 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m18:22:25.758988 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:22:25.759601 [debug] [MainThread]: Connection 'model.capstone.int_daily_aggregated_sales' was properly closed.
[0m18:22:25.760184 [info ] [MainThread]: 
[0m18:22:25.760841 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 9.91 seconds (9.91s).
[0m18:22:25.761940 [debug] [MainThread]: Command end result
[0m18:22:25.784007 [info ] [MainThread]: 
[0m18:22:25.784878 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:22:25.785547 [info ] [MainThread]: 
[0m18:22:25.786205 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m18:22:25.787579 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.139235, "process_user_time": 8.051372, "process_kernel_time": 0.327891, "process_mem_max_rss": "168396", "process_in_blocks": "74984", "process_out_blocks": "5392"}
[0m18:22:25.788500 [debug] [MainThread]: Command `dbt run` succeeded at 18:22:25.788264 after 15.14 seconds
[0m18:22:25.789162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe7a1f6500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6ef34370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe6faa2c20>]}
[0m18:22:25.789836 [debug] [MainThread]: Flushing usage events
[0m20:14:43.162574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc43c1de680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc439fc36a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc439fc3640>]}


============================== 20:14:43.166105 | d09662e8-1422-4f36-b695-f01eae4a427f ==============================
[0m20:14:43.166105 [info ] [MainThread]: Running with dbt=1.7.3
[0m20:14:43.166929 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select +customer_dim', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:14:43.931611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc431bb3850>]}
[0m20:14:44.073067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc431bb3790>]}
[0m20:14:44.074289 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m20:14:44.105559 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m20:14:44.185139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m20:14:44.186114 [debug] [MainThread]: Partial parsing: added file: capstone://macros/generate_schema_name.sql
[0m20:14:44.186862 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m20:14:44.191044 [info ] [MainThread]: Unable to do partial parsing because change detected to override macro. Starting full parse.
[0m20:14:47.096098 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m20:14:47.104769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc43131ad40>]}
[0m20:14:47.126258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4314bd840>]}
[0m20:14:47.127071 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m20:14:47.127722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4314bd7e0>]}
[0m20:14:47.130045 [info ] [MainThread]: 
[0m20:14:47.131269 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:14:47.133762 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m20:14:47.154708 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:14:47.155600 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:14:47.156282 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:47.724213 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m20:14:47.726582 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:14:47.774450 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:14:47.775353 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:14:47.775931 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:48.121863 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m20:14:48.124244 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:14:48.165481 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_analytics)
[0m20:14:48.166743 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "analytics"
"
[0m20:14:48.174874 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_analytics"
[0m20:14:48.175517 [debug] [ThreadPool]: On create_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_analytics"} */
create schema if not exists tpcds.analytics
[0m20:14:48.176081 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:48.473988 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:48.475680 [debug] [ThreadPool]: On create_tpcds_analytics: Close
[0m20:14:48.549649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_analytics, now create_tpcds_staging)
[0m20:14:48.551014 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "staging"
"
[0m20:14:48.555414 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_staging"
[0m20:14:48.555986 [debug] [ThreadPool]: On create_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_staging"} */
create schema if not exists tpcds.staging
[0m20:14:48.556525 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:48.913014 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:48.914683 [debug] [ThreadPool]: On create_tpcds_staging: Close
[0m20:14:48.970146 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_staging, now list_tpcds_intermediate)
[0m20:14:48.983222 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m20:14:48.983950 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m20:14:48.984496 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:49.308452 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b1089e-0001-8e9a-0004-d6ae00088976
[0m20:14:49.309194 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m20:14:49.309922 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m20:14:49.310491 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m20:14:49.311212 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m20:14:49.352425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m20:14:49.357321 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m20:14:49.357932 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m20:14:49.358502 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:49.710585 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m20:14:49.712891 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m20:14:49.773147 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m20:14:49.777996 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m20:14:49.778611 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m20:14:49.779189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:50.064979 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m20:14:50.067255 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m20:14:50.119079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc431913a60>]}
[0m20:14:50.120572 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:14:50.121234 [info ] [MainThread]: 
[0m20:14:50.124333 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m20:14:50.125159 [info ] [Thread-1 (]: 1 of 6 START sql view model staging.stg_tpcds__customer ........................ [RUN]
[0m20:14:50.126249 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__customer)
[0m20:14:50.126903 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m20:14:50.139825 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m20:14:50.141015 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 20:14:50.127355 => 20:14:50.140596
[0m20:14:50.141690 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m20:14:50.183677 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m20:14:50.185889 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m20:14:50.186612 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m20:14:50.187340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:50.723175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:14:50.750780 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 20:14:50.142125 => 20:14:50.750385
[0m20:14:50.751577 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m20:14:50.793085 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4317512a0>]}
[0m20:14:50.794253 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging.stg_tpcds__customer ................... [[32mSUCCESS 1[0m in 0.67s]
[0m20:14:50.795349 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m20:14:50.796123 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m20:14:50.797144 [info ] [Thread-1 (]: 2 of 6 START sql view model staging.stg_tpcds__customer_address ................ [RUN]
[0m20:14:50.798311 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m20:14:50.799029 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m20:14:50.804886 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m20:14:50.805970 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 20:14:50.799490 => 20:14:50.805577
[0m20:14:50.806610 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m20:14:50.812222 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m20:14:50.813845 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m20:14:50.814523 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m20:14:50.815206 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:51.234865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:51.239050 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 20:14:50.807028 => 20:14:51.238661
[0m20:14:51.239811 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m20:14:51.281041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4300abb80>]}
[0m20:14:51.282202 [info ] [Thread-1 (]: 2 of 6 OK created sql view model staging.stg_tpcds__customer_address ........... [[32mSUCCESS 1[0m in 0.48s]
[0m20:14:51.283274 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m20:14:51.284042 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m20:14:51.284951 [info ] [Thread-1 (]: 3 of 6 START sql view model staging.stg_tpcds__customer_demographics ........... [RUN]
[0m20:14:51.286055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m20:14:51.286712 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m20:14:51.294315 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:14:51.295496 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 20:14:51.287150 => 20:14:51.295069
[0m20:14:51.296143 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m20:14:51.301822 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:14:51.303457 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m20:14:51.304138 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m20:14:51.304812 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:51.749239 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:51.753276 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 20:14:51.296548 => 20:14:51.752896
[0m20:14:51.753972 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m20:14:51.811000 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc430168af0>]}
[0m20:14:51.812231 [info ] [Thread-1 (]: 3 of 6 OK created sql view model staging.stg_tpcds__customer_demographics ...... [[32mSUCCESS 1[0m in 0.53s]
[0m20:14:51.813314 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m20:14:51.814104 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m20:14:51.815023 [info ] [Thread-1 (]: 4 of 6 START sql view model staging.stg_tpcds__household_demographics .......... [RUN]
[0m20:14:51.816197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m20:14:51.816878 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m20:14:51.822784 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m20:14:51.823920 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 20:14:51.817303 => 20:14:51.823508
[0m20:14:51.824584 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m20:14:51.830282 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m20:14:51.831710 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m20:14:51.832407 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m20:14:51.833068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:52.266236 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:52.270297 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 20:14:51.825008 => 20:14:52.269901
[0m20:14:52.271002 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m20:14:52.309382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4300f2fb0>]}
[0m20:14:52.310536 [info ] [Thread-1 (]: 4 of 6 OK created sql view model staging.stg_tpcds__household_demographics ..... [[32mSUCCESS 1[0m in 0.49s]
[0m20:14:52.311649 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m20:14:52.312437 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m20:14:52.313375 [info ] [Thread-1 (]: 5 of 6 START sql view model staging.stg_tpcds__income_band ..................... [RUN]
[0m20:14:52.314494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m20:14:52.315197 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m20:14:52.321176 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m20:14:52.322290 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 20:14:52.315635 => 20:14:52.321879
[0m20:14:52.322955 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m20:14:52.328684 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m20:14:52.329987 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m20:14:52.330681 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m20:14:52.331361 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:52.777057 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:14:52.781281 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 20:14:52.323414 => 20:14:52.780871
[0m20:14:52.782008 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m20:14:52.823673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4301046a0>]}
[0m20:14:52.824873 [info ] [Thread-1 (]: 5 of 6 OK created sql view model staging.stg_tpcds__income_band ................ [[32mSUCCESS 1[0m in 0.51s]
[0m20:14:52.825927 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m20:14:52.827437 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m20:14:52.828277 [info ] [Thread-1 (]: 6 of 6 START sql incremental model analytics.customer_dim ...................... [RUN]
[0m20:14:52.829451 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.customer_dim)
[0m20:14:52.830122 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m20:14:52.838065 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m20:14:52.839286 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 20:14:52.830547 => 20:14:52.838833
[0m20:14:52.839957 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m20:14:52.908535 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m20:14:52.912521 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:14:52.913332 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m20:14:52.914139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:53.178218 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1089e-0001-8eb8-0004-d6ae000898fa
[0m20:14:53.179033 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'TPCDS.INTERMEDIATE' does not exist or not authorized.
[0m20:14:53.180003 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 20:14:52.840381 => 20:14:53.179606
[0m20:14:53.180695 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m20:14:53.223135 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  002003 (02000): SQL compilation error:
  Schema 'TPCDS.INTERMEDIATE' does not exist or not authorized.
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m20:14:53.224060 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd09662e8-1422-4f36-b695-f01eae4a427f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc431912440>]}
[0m20:14:53.225064 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model analytics.customer_dim ............. [[31mERROR[0m in 0.39s]
[0m20:14:53.226127 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m20:14:53.228738 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:53.229333 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m20:14:53.229950 [info ] [MainThread]: 
[0m20:14:53.230919 [info ] [MainThread]: Finished running 5 view models, 1 incremental model in 0 hours 0 minutes and 6.10 seconds (6.10s).
[0m20:14:53.233248 [debug] [MainThread]: Command end result
[0m20:14:53.253915 [info ] [MainThread]: 
[0m20:14:53.254762 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:14:53.255397 [info ] [MainThread]: 
[0m20:14:53.256008 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  002003 (02000): SQL compilation error:
  Schema 'TPCDS.INTERMEDIATE' does not exist or not authorized.
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m20:14:53.256629 [info ] [MainThread]: 
[0m20:14:53.257263 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m20:14:53.258587 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.165139, "process_user_time": 9.028211, "process_kernel_time": 0.264631, "process_mem_max_rss": "171108", "process_in_blocks": "1976", "process_out_blocks": "6320", "command_success": false}
[0m20:14:53.259511 [debug] [MainThread]: Command `dbt run` failed at 20:14:53.259280 after 10.17 seconds
[0m20:14:53.260183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc43c1de680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4313ea710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4317512a0>]}
[0m20:14:53.260838 [debug] [MainThread]: Flushing usage events
[0m20:19:44.421480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79cfc05690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79cde52950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79cde531c0>]}


============================== 20:19:44.425076 | e78017fe-773e-4c2b-b91e-ac471eda3f34 ==============================
[0m20:19:44.425076 [info ] [MainThread]: Running with dbt=1.7.3
[0m20:19:44.425886 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --select +customer_dim', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:19:45.200467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5ad31c0>]}
[0m20:19:45.341063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5b06560>]}
[0m20:19:45.342269 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m20:19:45.374126 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m20:19:45.451249 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:19:45.451983 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:19:45.453338 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m20:19:45.462616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5436920>]}
[0m20:19:45.485044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c53f7c40>]}
[0m20:19:45.485808 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m20:19:45.488146 [info ] [MainThread]: 
[0m20:19:45.489274 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:19:45.491414 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m20:19:45.513318 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:19:45.514064 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:19:45.514733 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:19:46.064671 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.0 seconds
[0m20:19:46.067059 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:19:46.115081 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:19:46.115950 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:19:46.116491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:46.441381 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:19:46.443802 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:19:46.488287 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:19:46.489075 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:19:46.489634 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:46.896815 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:19:46.899187 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:19:46.945848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now create_tpcds_intermediate)
[0m20:19:46.946990 [debug] [ThreadPool]: Creating schema "database: "tpcds"
schema: "intermediate"
"
[0m20:19:46.954681 [debug] [ThreadPool]: Using snowflake connection "create_tpcds_intermediate"
[0m20:19:46.955302 [debug] [ThreadPool]: On create_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "create_tpcds_intermediate"} */
create schema if not exists tpcds.intermediate
[0m20:19:46.955863 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:47.985163 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:19:47.986827 [debug] [ThreadPool]: On create_tpcds_intermediate: Close
[0m20:19:48.033750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_tpcds_intermediate, now list_tpcds_staging)
[0m20:19:48.046892 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m20:19:48.047750 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m20:19:48.048299 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:48.348393 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:19:48.350925 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m20:19:48.393576 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m20:19:48.400042 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m20:19:48.400649 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m20:19:48.401212 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:48.665065 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m20:19:48.667401 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m20:19:48.703069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m20:19:48.707555 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m20:19:48.708172 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m20:19:48.708738 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:19:48.989026 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m20:19:48.991331 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m20:19:49.041002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c51ff9d0>]}
[0m20:19:49.042456 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:19:49.043091 [info ] [MainThread]: 
[0m20:19:49.046107 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m20:19:49.046916 [info ] [Thread-1 (]: 1 of 7 START sql view model staging.stg_tpcds__customer ........................ [RUN]
[0m20:19:49.048519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__customer)
[0m20:19:49.049554 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m20:19:49.062310 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m20:19:49.063414 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 20:19:49.049997 => 20:19:49.062989
[0m20:19:49.064093 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m20:19:49.105579 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m20:19:49.107787 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m20:19:49.108476 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m20:19:49.109163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:49.580221 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:19:49.611553 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 20:19:49.064502 => 20:19:49.611154
[0m20:19:49.612336 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m20:19:49.659091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c531efb0>]}
[0m20:19:49.660295 [info ] [Thread-1 (]: 1 of 7 OK created sql view model staging.stg_tpcds__customer ................... [[32mSUCCESS 1[0m in 0.61s]
[0m20:19:49.661351 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m20:19:49.662123 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m20:19:49.663198 [info ] [Thread-1 (]: 2 of 7 START sql view model staging.stg_tpcds__customer_address ................ [RUN]
[0m20:19:49.664393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m20:19:49.665051 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m20:19:49.670601 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m20:19:49.671725 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 20:19:49.665469 => 20:19:49.671336
[0m20:19:49.672367 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m20:19:49.678710 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m20:19:49.680331 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m20:19:49.681012 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m20:19:49.681665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:50.161892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:19:50.166144 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 20:19:49.672779 => 20:19:50.165767
[0m20:19:50.166830 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m20:19:50.210481 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5237d90>]}
[0m20:19:50.211542 [info ] [Thread-1 (]: 2 of 7 OK created sql view model staging.stg_tpcds__customer_address ........... [[32mSUCCESS 1[0m in 0.55s]
[0m20:19:50.212573 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m20:19:50.213331 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m20:19:50.214211 [info ] [Thread-1 (]: 3 of 7 START sql view model staging.stg_tpcds__customer_demographics ........... [RUN]
[0m20:19:50.215309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m20:19:50.215973 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m20:19:50.221429 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:19:50.222505 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 20:19:50.216385 => 20:19:50.222119
[0m20:19:50.223178 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m20:19:50.228576 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:19:50.230153 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m20:19:50.230829 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m20:19:50.231519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:50.688651 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:19:50.692834 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 20:19:50.223595 => 20:19:50.692467
[0m20:19:50.693512 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m20:19:50.949407 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5359030>]}
[0m20:19:50.950598 [info ] [Thread-1 (]: 3 of 7 OK created sql view model staging.stg_tpcds__customer_demographics ...... [[32mSUCCESS 1[0m in 0.73s]
[0m20:19:50.951696 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m20:19:50.952481 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m20:19:50.953418 [info ] [Thread-1 (]: 4 of 7 START sql view model staging.stg_tpcds__household_demographics .......... [RUN]
[0m20:19:50.954563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m20:19:50.955271 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m20:19:50.960695 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m20:19:50.961784 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 20:19:50.955704 => 20:19:50.961387
[0m20:19:50.962442 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m20:19:50.969413 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m20:19:50.970790 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m20:19:50.971511 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m20:19:50.972166 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:51.361685 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:19:51.366105 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 20:19:50.962867 => 20:19:51.365697
[0m20:19:51.366854 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m20:19:51.414337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c40b7460>]}
[0m20:19:51.415556 [info ] [Thread-1 (]: 4 of 7 OK created sql view model staging.stg_tpcds__household_demographics ..... [[32mSUCCESS 1[0m in 0.46s]
[0m20:19:51.416597 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m20:19:51.417367 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m20:19:51.418249 [info ] [Thread-1 (]: 5 of 7 START sql view model staging.stg_tpcds__income_band ..................... [RUN]
[0m20:19:51.419327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m20:19:51.419985 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m20:19:51.425313 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m20:19:51.426377 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 20:19:51.420399 => 20:19:51.425992
[0m20:19:51.427013 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m20:19:51.432362 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m20:19:51.433606 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m20:19:51.434277 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m20:19:51.434912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:51.825589 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:19:51.829906 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 20:19:51.427472 => 20:19:51.829526
[0m20:19:51.830609 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m20:19:51.885743 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5383b20>]}
[0m20:19:51.886878 [info ] [Thread-1 (]: 5 of 7 OK created sql view model staging.stg_tpcds__income_band ................ [[32mSUCCESS 1[0m in 0.47s]
[0m20:19:51.887927 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m20:19:51.888690 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m20:19:51.889589 [info ] [Thread-1 (]: 6 of 7 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m20:19:51.890698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now snapshot.capstone.customer_snapshot)
[0m20:19:51.891379 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m20:19:51.899067 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 20:19:51.891807 => 20:19:51.898649
[0m20:19:51.899784 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m20:19:51.969862 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m20:19:51.972223 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:19:51.972916 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id,
        _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
        _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
        nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

    ) sbq



        );
[0m20:19:51.973617 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:19:55.168703 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m20:19:55.177967 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 20:19:51.900206 => 20:19:55.177589
[0m20:19:55.178660 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m20:19:55.222796 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5382d70>]}
[0m20:19:55.224139 [info ] [Thread-1 (]: 6 of 7 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 1[0m in 3.33s]
[0m20:19:55.225219 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m20:19:55.226680 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m20:19:55.227521 [info ] [Thread-1 (]: 7 of 7 START sql incremental model analytics.customer_dim ...................... [RUN]
[0m20:19:55.228609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.customer_dim)
[0m20:19:55.229270 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m20:19:55.237177 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m20:19:55.238280 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 20:19:55.229683 => 20:19:55.237881
[0m20:19:55.238975 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m20:19:55.291136 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m20:19:55.295057 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:19:55.295872 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m20:19:55.296644 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:01.096927 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 6.0 seconds
[0m20:20:01.110259 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m20:20:01.118884 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:20:01.119629 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m20:20:01.159340 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:20:01.163346 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 20:19:55.239439 => 20:20:01.162923
[0m20:20:01.164123 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m20:20:01.207218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e78017fe-773e-4c2b-b91e-ac471eda3f34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5382f80>]}
[0m20:20:01.208433 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model analytics.customer_dim ................. [[32mSUCCESS 1[0m in 5.98s]
[0m20:20:01.209493 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m20:20:01.212137 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:01.212775 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m20:20:01.213813 [info ] [MainThread]: 
[0m20:20:01.214522 [info ] [MainThread]: Finished running 5 view models, 1 snapshot, 1 incremental model in 0 hours 0 minutes and 15.72 seconds (15.72s).
[0m20:20:01.217226 [debug] [MainThread]: Command end result
[0m20:20:01.239307 [info ] [MainThread]: 
[0m20:20:01.240142 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:20:01.240776 [info ] [MainThread]: 
[0m20:20:01.241423 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:20:01.242848 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 16.889809, "process_user_time": 6.25835, "process_kernel_time": 0.281015, "process_mem_max_rss": "163140", "process_out_blocks": "3720", "process_in_blocks": "0"}
[0m20:20:01.243840 [debug] [MainThread]: Command `dbt build` succeeded at 20:20:01.243598 after 16.89 seconds
[0m20:20:01.244524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79cfc05690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c5b06560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79c40d77c0>]}
[0m20:20:01.245235 [debug] [MainThread]: Flushing usage events
[0m21:31:33.548575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f148a5f6bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f148865dde0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f148865d6c0>]}


============================== 21:31:33.552215 | 671f7df8-8db8-47b3-8706-fb751c3c8efa ==============================
[0m21:31:33.552215 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:31:33.553038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --select customer_snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:31:34.340909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1480052530>]}
[0m21:31:34.480908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f14802a3280>]}
[0m21:31:34.482121 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:31:34.513465 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:31:34.589707 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:31:34.590434 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:31:34.591789 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:31:34.601145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147fc028f0>]}
[0m21:31:34.624619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147fbbd2a0>]}
[0m21:31:34.625511 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m21:31:34.626156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147fbbd1e0>]}
[0m21:31:34.628154 [info ] [MainThread]: 
[0m21:31:34.629384 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:31:34.631468 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:31:34.652673 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:31:34.653550 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:31:34.654205 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:35.154252 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:31:35.156694 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:31:35.208772 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:31:35.221700 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:31:35.222427 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:31:35.222971 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:35.584271 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:31:35.586733 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:31:35.641469 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m21:31:35.647970 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m21:31:35.648598 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m21:31:35.649157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:36.000885 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m21:31:36.003496 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m21:31:36.077219 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m21:31:36.083687 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m21:31:36.084376 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m21:31:36.085037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:36.434752 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:31:36.437181 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m21:31:36.477142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147fc19570>]}
[0m21:31:36.478479 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:31:36.479103 [info ] [MainThread]: 
[0m21:31:36.482014 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m21:31:36.482820 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m21:31:36.483948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now snapshot.capstone.customer_snapshot)
[0m21:31:36.484585 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m21:31:36.498130 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 21:31:36.485274 => 21:31:36.497679
[0m21:31:36.498847 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m21:31:36.571811 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:36.572650 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:31:36.573274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:36.851372 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:31:36.891484 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:36.892463 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m21:31:38.817602 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m21:31:38.823953 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:38.824610 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:31:38.888846 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:31:38.896360 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:38.897034 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:31:38.943083 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:31:38.950581 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:38.951304 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:31:39.027229 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:31:39.034766 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:39.035468 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:31:39.093699 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:31:39.107561 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:39.108360 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:31:39.144612 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:31:39.157822 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m21:31:39.159941 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:39.160584 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m21:31:39.242093 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:31:39.242961 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:39.243727 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m21:31:39.654676 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m21:31:39.655640 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:31:39.656274 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m21:31:39.793470 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:31:39.823912 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 21:31:36.499300 => 21:31:39.823515
[0m21:31:39.824699 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m21:31:39.873576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '671f7df8-8db8-47b3-8706-fb751c3c8efa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147f9c7bb0>]}
[0m21:31:39.874938 [info ] [Thread-1 (]: 1 of 1 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 0[0m in 3.39s]
[0m21:31:39.876020 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m21:31:39.878455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:39.879044 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m21:31:39.879654 [info ] [MainThread]: 
[0m21:31:39.880276 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.25 seconds (5.25s).
[0m21:31:39.881370 [debug] [MainThread]: Command end result
[0m21:31:39.900985 [info ] [MainThread]: 
[0m21:31:39.901856 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:31:39.902442 [info ] [MainThread]: 
[0m21:31:39.903060 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:31:39.904398 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.425615, "process_user_time": 4.993101, "process_kernel_time": 0.280271, "process_mem_max_rss": "162248", "process_out_blocks": "3568", "process_in_blocks": "0"}
[0m21:31:39.905278 [debug] [MainThread]: Command `dbt snapshot` succeeded at 21:31:39.905054 after 6.43 seconds
[0m21:31:39.905918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f148a5f6bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147f9bb940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f147f9ba7a0>]}
[0m21:31:39.906562 [debug] [MainThread]: Flushing usage events
[0m21:39:54.371479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f099f116650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f099d2d0fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f099d2d0430>]}


============================== 21:39:54.375056 | 54cd051a-d5e0-4b2f-95bc-939799e236b2 ==============================
[0m21:39:54.375056 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:39:54.375893 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt docs generate', 'send_anonymous_usage_stats': 'True'}
[0m21:39:55.155689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994f4f1c0>]}
[0m21:39:55.296554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994cfe560>]}
[0m21:39:55.297751 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:39:55.328910 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:39:55.405167 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:39:55.405887 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:39:55.407233 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m21:39:55.416639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994896920>]}
[0m21:39:55.419987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994855270>]}
[0m21:39:55.420696 [info ] [MainThread]: Found 10 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m21:39:55.421314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f09948552d0>]}
[0m21:39:55.423957 [info ] [MainThread]: 
[0m21:39:55.425079 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:39:55.427603 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_analytics'
[0m21:39:55.450071 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m21:39:55.450837 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m21:39:55.451518 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:39:56.037652 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:39:56.040211 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m21:39:56.086964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m21:39:56.169191 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:39:56.169955 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:39:56.170538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:39:56.555798 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:39:56.558261 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:39:56.597118 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m21:39:56.602181 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m21:39:56.602770 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m21:39:56.603330 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:39:56.901023 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m21:39:56.903600 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m21:39:56.945249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54cd051a-d5e0-4b2f-95bc-939799e236b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994857d60>]}
[0m21:39:56.946495 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:39:56.947157 [info ] [MainThread]: 
[0m21:39:56.950112 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m21:39:56.951156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m21:39:56.951800 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m21:39:56.964886 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:39:56.965948 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 21:39:56.952219 => 21:39:56.965558
[0m21:39:56.966608 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m21:39:56.967420 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 21:39:56.967017 => 21:39:56.967037
[0m21:39:56.968915 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m21:39:56.969630 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:39:56.970739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m21:39:56.971404 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:39:56.977267 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:39:56.978239 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:39:56.971805 => 21:39:56.977866
[0m21:39:56.978890 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:39:56.979694 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:39:56.979333 => 21:39:56.979344
[0m21:39:56.981030 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:39:56.981746 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:39:56.982966 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m21:39:56.983641 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:39:56.988156 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:39:56.989136 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:39:56.984045 => 21:39:56.988765
[0m21:39:56.989796 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:39:56.990561 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:39:56.990196 => 21:39:56.990209
[0m21:39:56.991946 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:39:56.992666 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:39:56.993843 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m21:39:56.994485 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:39:56.999271 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:39:57.000259 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:39:56.994891 => 21:39:56.999883
[0m21:39:57.000910 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:39:57.001693 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:39:57.001324 => 21:39:57.001337
[0m21:39:57.003045 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:39:57.003804 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:39:57.005000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__household_demographics)
[0m21:39:57.005650 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:39:57.010340 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:39:57.011343 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:39:57.006050 => 21:39:57.010939
[0m21:39:57.011997 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:39:57.012770 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:39:57.012403 => 21:39:57.012415
[0m21:39:57.014123 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:39:57.014831 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m21:39:57.016069 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m21:39:57.016707 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m21:39:57.021186 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m21:39:57.022141 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 21:39:57.017104 => 21:39:57.021775
[0m21:39:57.022780 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m21:39:57.023573 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 21:39:57.023211 => 21:39:57.023223
[0m21:39:57.026685 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m21:39:57.027413 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m21:39:57.028522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m21:39:57.029156 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m21:39:57.033427 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m21:39:57.034393 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 21:39:57.029548 => 21:39:57.034025
[0m21:39:57.035041 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m21:39:57.035845 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 21:39:57.035481 => 21:39:57.035493
[0m21:39:57.037182 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m21:39:57.037883 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m21:39:57.038981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m21:39:57.039657 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m21:39:57.044310 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m21:39:57.045266 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 21:39:57.040059 => 21:39:57.044894
[0m21:39:57.045909 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m21:39:57.046667 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 21:39:57.046304 => 21:39:57.046315
[0m21:39:57.048036 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m21:39:57.048752 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m21:39:57.049855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m21:39:57.050633 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m21:39:57.056059 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 21:39:57.051043 => 21:39:57.055670
[0m21:39:57.056697 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m21:39:57.057452 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 21:39:57.057098 => 21:39:57.057111
[0m21:39:57.058781 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m21:39:57.059520 [debug] [Thread-1 (]: Began running node model.capstone.int_daily_aggregated_sales
[0m21:39:57.060640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int_daily_aggregated_sales)
[0m21:39:57.061402 [debug] [Thread-1 (]: Began compiling node model.capstone.int_daily_aggregated_sales
[0m21:39:57.072571 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int_daily_aggregated_sales"
[0m21:39:57.073578 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (compile): 21:39:57.061813 => 21:39:57.073205
[0m21:39:57.074248 [debug] [Thread-1 (]: Began executing node model.capstone.int_daily_aggregated_sales
[0m21:39:57.075007 [debug] [Thread-1 (]: Timing info for model.capstone.int_daily_aggregated_sales (execute): 21:39:57.074651 => 21:39:57.074663
[0m21:39:57.076385 [debug] [Thread-1 (]: Finished running node model.capstone.int_daily_aggregated_sales
[0m21:39:57.077104 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m21:39:57.078164 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int_daily_aggregated_sales, now model.capstone.customer_dim)
[0m21:39:57.078801 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m21:39:57.086980 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m21:39:57.087983 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 21:39:57.079227 => 21:39:57.087615
[0m21:39:57.088640 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m21:39:57.089395 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 21:39:57.089039 => 21:39:57.089051
[0m21:39:57.090731 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m21:39:57.092136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:39:57.092680 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m21:39:57.095636 [debug] [MainThread]: Command end result
[0m21:39:57.129356 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m21:39:57.129957 [info ] [MainThread]: Building catalog
[0m21:39:57.134537 [debug] [ThreadPool]: Acquiring new snowflake connection 'tpcds.information_schema'
[0m21:39:57.157973 [debug] [ThreadPool]: Using snowflake connection "tpcds.information_schema"
[0m21:39:57.159152 [debug] [ThreadPool]: On tpcds.information_schema: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "tpcds.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        coalesce(table_type, 'DYNAMIC TABLE') as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from tpcds.INFORMATION_SCHEMA.tables
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('income_band')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__inventory')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('customer_snapshot')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('int_daily_aggregated_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__income_band')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('customer_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_demographics')
                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from tpcds.INFORMATION_SCHEMA.columns
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('income_band')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__inventory')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('customer_snapshot')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('int_daily_aggregated_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__income_band')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('customer_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_demographics')
                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m21:39:57.160256 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:00.837271 [debug] [ThreadPool]: SQL status: SUCCESS 278 in 4.0 seconds
[0m21:40:01.297907 [debug] [ThreadPool]: On tpcds.information_schema: Close
[0m21:40:01.423825 [info ] [MainThread]: Catalog written to /home/ubuntu/capstone_dbt_project/capstone/target/catalog.json
[0m21:40:01.425806 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 7.123932, "process_user_time": 5.21179, "process_kernel_time": 0.237429, "process_mem_max_rss": "163924", "process_in_blocks": "2944", "process_out_blocks": "7592"}
[0m21:40:01.426881 [debug] [MainThread]: Command `dbt docs generate` succeeded at 21:40:01.426635 after 7.13 seconds
[0m21:40:01.427514 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m21:40:01.428040 [debug] [MainThread]: Connection 'tpcds.information_schema' was properly closed.
[0m21:40:01.428637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f099f116650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994cfe560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0994855270>]}
[0m21:40:01.429308 [debug] [MainThread]: Flushing usage events
[0m21:41:47.446903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d219deaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d1f757df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d1f754400>]}


============================== 21:41:47.450410 | cf2b8c84-95f4-466f-9b52-597e7b8d2fa3 ==============================
[0m21:41:47.450410 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:41:47.451219 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8000', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:41:48.204175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf2b8c84-95f4-466f-9b52-597e7b8d2fa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d1f71a3e0>]}
[0m21:41:48.344489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf2b8c84-95f4-466f-9b52-597e7b8d2fa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d173b2860>]}
[0m17:43:17.850488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66b500a680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66b331b6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66b331b640>]}


============================== 17:43:17.857605 | 46823941-01dc-4a01-8417-866034e939fb ==============================
[0m17:43:17.857605 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:43:17.858406 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select staging.tpcds*', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:43:19.569743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aaf23850>]}
[0m17:43:19.710407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aaf23790>]}
[0m17:43:19.712269 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:43:19.745833 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:43:20.037059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 1 files changed.
[0m17:43:20.038007 [debug] [MainThread]: Partial parsing: added file: capstone://models/analytics/weekly_sales_inventory.sql
[0m17:43:20.038617 [debug] [MainThread]: Partial parsing: added file: capstone://models/staging/tpcds/stg_tpcds__date_dim.sql
[0m17:43:20.039297 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m17:43:20.359447 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m17:43:20.368205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa258be0>]}
[0m17:43:20.392673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa82d360>]}
[0m17:43:20.393608 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:43:20.394321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa82fd90>]}
[0m17:43:20.396934 [info ] [MainThread]: 
[0m17:43:20.398209 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:43:20.400540 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m17:43:20.420377 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:43:20.421109 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:43:20.421766 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:43:20.948226 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m17:43:20.950573 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:43:21.005631 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m17:43:21.018469 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:43:21.019172 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:43:21.019696 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:43:21.484454 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m17:43:21.487001 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:43:21.534785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m17:43:21.541014 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:43:21.541678 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:43:21.542205 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:43:21.951611 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:21.953943 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:43:22.003487 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m17:43:22.009987 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:43:22.010579 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:43:22.011116 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:43:22.402768 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:22.405134 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:43:22.451637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa0d0370>]}
[0m17:43:22.452923 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:43:22.453551 [info ] [MainThread]: 
[0m17:43:22.457306 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m17:43:22.458113 [info ] [Thread-1 (]: 1 of 9 START sql view model staging.stg_tpcds__catalog_sales ................... [RUN]
[0m17:43:22.459463 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m17:43:22.460084 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m17:43:22.473005 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:43:22.474148 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 17:43:22.460484 => 17:43:22.473768
[0m17:43:22.474807 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m17:43:22.514123 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:43:22.516988 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m17:43:22.517729 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m17:43:22.518435 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:23.067832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:43:23.095076 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 17:43:22.475201 => 17:43:23.094699
[0m17:43:23.095819 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m17:43:23.157243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa15c910>]}
[0m17:43:23.158371 [info ] [Thread-1 (]: 1 of 9 OK created sql view model staging.stg_tpcds__catalog_sales .............. [[32mSUCCESS 1[0m in 0.70s]
[0m17:43:23.159360 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m17:43:23.160082 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m17:43:23.161104 [info ] [Thread-1 (]: 2 of 9 START sql view model staging.stg_tpcds__customer ........................ [RUN]
[0m17:43:23.162209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m17:43:23.162839 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m17:43:23.167944 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m17:43:23.168953 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 17:43:23.163231 => 17:43:23.168583
[0m17:43:23.169639 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m17:43:23.174910 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m17:43:23.176834 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m17:43:23.177493 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m17:43:23.178181 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:23.875616 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:43:23.883174 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 17:43:23.170037 => 17:43:23.882797
[0m17:43:23.883859 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m17:43:23.935469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa15ee00>]}
[0m17:43:23.936560 [info ] [Thread-1 (]: 2 of 9 OK created sql view model staging.stg_tpcds__customer ................... [[32mSUCCESS 1[0m in 0.77s]
[0m17:43:23.937563 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m17:43:23.938298 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m17:43:23.939234 [info ] [Thread-1 (]: 3 of 9 START sql view model staging.stg_tpcds__customer_address ................ [RUN]
[0m17:43:23.940303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m17:43:23.940930 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m17:43:23.946267 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m17:43:23.947278 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 17:43:23.941324 => 17:43:23.946911
[0m17:43:23.947917 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m17:43:23.954949 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m17:43:23.956529 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m17:43:23.957182 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m17:43:23.957846 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:24.451452 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:24.455575 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 17:43:23.948295 => 17:43:24.455204
[0m17:43:24.456243 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m17:43:26.189932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa18a260>]}
[0m17:43:26.191018 [info ] [Thread-1 (]: 3 of 9 OK created sql view model staging.stg_tpcds__customer_address ........... [[32mSUCCESS 1[0m in 2.25s]
[0m17:43:26.192020 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m17:43:26.192749 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m17:43:26.193637 [info ] [Thread-1 (]: 4 of 9 START sql view model staging.stg_tpcds__customer_demographics ........... [RUN]
[0m17:43:26.194676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m17:43:26.195313 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m17:43:26.200963 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:43:26.202021 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 17:43:26.195707 => 17:43:26.201646
[0m17:43:26.202675 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m17:43:26.208034 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:43:26.209641 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m17:43:26.210313 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m17:43:26.210960 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:26.718454 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:43:26.722397 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 17:43:26.203089 => 17:43:26.722043
[0m17:43:26.723052 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m17:43:26.768696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa13ecb0>]}
[0m17:43:26.769860 [info ] [Thread-1 (]: 4 of 9 OK created sql view model staging.stg_tpcds__customer_demographics ...... [[32mSUCCESS 1[0m in 0.57s]
[0m17:43:26.770900 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m17:43:26.771645 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m17:43:26.772556 [info ] [Thread-1 (]: 5 of 9 START sql view model staging.stg_tpcds__date_dim ........................ [RUN]
[0m17:43:26.773861 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m17:43:26.774503 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m17:43:26.781920 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m17:43:26.782966 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 17:43:26.774917 => 17:43:26.782573
[0m17:43:26.783592 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m17:43:26.788982 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m17:43:26.790296 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m17:43:26.790949 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT, 
FROM tpcds.raw.date_dim
  );
[0m17:43:26.791584 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:27.278896 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b118e7-0001-9035-0004-d6ae0009a076
[0m17:43:27.279684 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 16 at position 0 unexpected 'FROM'.
[0m17:43:27.280604 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 17:43:26.783989 => 17:43:27.280222
[0m17:43:27.281267 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m17:43:27.322137 [debug] [Thread-1 (]: Database Error in model stg_tpcds__date_dim (models/staging/tpcds/stg_tpcds__date_dim.sql)
  001003 (42000): SQL compilation error:
  syntax error line 16 at position 0 unexpected 'FROM'.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__date_dim.sql
[0m17:43:27.323063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa004220>]}
[0m17:43:27.324020 [error] [Thread-1 (]: 5 of 9 ERROR creating sql view model staging.stg_tpcds__date_dim ............... [[31mERROR[0m in 0.55s]
[0m17:43:27.325040 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m17:43:27.325814 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m17:43:27.326793 [info ] [Thread-1 (]: 6 of 9 START sql view model staging.stg_tpcds__household_demographics .......... [RUN]
[0m17:43:27.327877 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m17:43:27.328533 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m17:43:27.333989 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m17:43:27.335025 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 17:43:27.328942 => 17:43:27.334646
[0m17:43:27.335687 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m17:43:27.341135 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m17:43:27.342527 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m17:43:27.343204 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m17:43:27.343843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:27.736336 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:27.740341 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 17:43:27.336099 => 17:43:27.739989
[0m17:43:27.740989 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m17:43:27.785131 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66a85e4df0>]}
[0m17:43:27.786260 [info ] [Thread-1 (]: 6 of 9 OK created sql view model staging.stg_tpcds__household_demographics ..... [[32mSUCCESS 1[0m in 0.46s]
[0m17:43:27.787261 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m17:43:27.787987 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m17:43:27.788835 [info ] [Thread-1 (]: 7 of 9 START sql view model staging.stg_tpcds__income_band ..................... [RUN]
[0m17:43:27.789894 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m17:43:27.790528 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m17:43:27.795690 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m17:43:27.796699 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 17:43:27.790920 => 17:43:27.796329
[0m17:43:27.797353 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m17:43:27.802618 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m17:43:27.803817 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m17:43:27.804474 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m17:43:27.805081 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:28.424014 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:43:28.428191 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 17:43:27.797788 => 17:43:28.427819
[0m17:43:28.428869 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m17:43:28.473125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66a85e7ac0>]}
[0m17:43:28.474287 [info ] [Thread-1 (]: 7 of 9 OK created sql view model staging.stg_tpcds__income_band ................ [[32mSUCCESS 1[0m in 0.68s]
[0m17:43:28.475318 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m17:43:28.476074 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m17:43:28.476954 [info ] [Thread-1 (]: 8 of 9 START sql view model staging.stg_tpcds__inventory ....................... [RUN]
[0m17:43:28.478046 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m17:43:28.478693 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m17:43:28.484446 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m17:43:28.485562 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 17:43:28.479101 => 17:43:28.485148
[0m17:43:28.486238 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m17:43:28.493907 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m17:43:28.495348 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m17:43:28.496034 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m17:43:28.496680 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:28.957436 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:28.961258 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 17:43:28.486640 => 17:43:28.960892
[0m17:43:28.962110 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m17:43:29.000110 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa27b130>]}
[0m17:43:29.001204 [info ] [Thread-1 (]: 8 of 9 OK created sql view model staging.stg_tpcds__inventory .................. [[32mSUCCESS 1[0m in 0.52s]
[0m17:43:29.002271 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m17:43:29.003023 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m17:43:29.004008 [info ] [Thread-1 (]: 9 of 9 START sql view model staging.stg_tpcds__web_sales ....................... [RUN]
[0m17:43:29.005171 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m17:43:29.005858 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m17:43:29.012029 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m17:43:29.013098 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 17:43:29.006277 => 17:43:29.012705
[0m17:43:29.013798 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m17:43:29.019280 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m17:43:29.021935 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m17:43:29.022652 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m17:43:29.023342 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:43:29.519319 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:43:29.523163 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 17:43:29.014215 => 17:43:29.522802
[0m17:43:29.523829 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m17:43:30.480384 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46823941-01dc-4a01-8417-866034e939fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa15d8a0>]}
[0m17:43:30.481483 [info ] [Thread-1 (]: 9 of 9 OK created sql view model staging.stg_tpcds__web_sales .................. [[32mSUCCESS 1[0m in 1.48s]
[0m17:43:30.482532 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m17:43:30.485011 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:43:30.485597 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__web_sales' was properly closed.
[0m17:43:30.486269 [info ] [MainThread]: 
[0m17:43:30.486984 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 10.09 seconds (10.09s).
[0m17:43:30.490170 [debug] [MainThread]: Command end result
[0m17:43:30.510702 [info ] [MainThread]: 
[0m17:43:30.511434 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:43:30.511984 [info ] [MainThread]: 
[0m17:43:30.512548 [error] [MainThread]:   Database Error in model stg_tpcds__date_dim (models/staging/tpcds/stg_tpcds__date_dim.sql)
  001003 (42000): SQL compilation error:
  syntax error line 16 at position 0 unexpected 'FROM'.
  compiled Code at target/run/capstone/models/staging/tpcds/stg_tpcds__date_dim.sql
[0m17:43:30.513156 [info ] [MainThread]: 
[0m17:43:30.513828 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m17:43:30.518144 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 12.739596, "process_user_time": 6.209141, "process_kernel_time": 0.358358, "process_mem_max_rss": "166392", "process_in_blocks": "76984", "process_out_blocks": "5648", "command_success": false}
[0m17:43:30.519132 [debug] [MainThread]: Command `dbt run` failed at 17:43:30.518911 after 12.74 seconds
[0m17:43:30.519752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66b500a680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aaf23850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66aa82cd60>]}
[0m17:43:30.520387 [debug] [MainThread]: Flushing usage events
[0m17:53:49.318294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc372e16bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc373757df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc373755780>]}


============================== 17:53:49.321752 | 60bfb141-459e-404a-bc43-77e294ffd276 ==============================
[0m17:53:49.321752 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:53:49.322548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select stg_tpcds__date_dim', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:53:50.072655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc373713d30>]}
[0m17:53:50.212805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc368c76860>]}
[0m17:53:50.213953 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:53:50.244951 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:53:50.321927 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:53:50.322915 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__date_dim.sql
[0m17:53:50.610581 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.capstone.example
[0m17:53:50.619009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685b2710>]}
[0m17:53:50.640182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685a4580>]}
[0m17:53:50.640956 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:53:50.641585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685a4610>]}
[0m17:53:50.643425 [info ] [MainThread]: 
[0m17:53:50.644549 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:53:50.646474 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m17:53:50.666244 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:53:50.666956 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:53:50.667583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:53:51.061889 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:53:51.064163 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:53:51.113897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m17:53:51.126459 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:53:51.127104 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:53:51.127615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:53:51.602909 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:53:51.605256 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:53:51.656186 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m17:53:51.661192 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:53:51.661797 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:53:51.662323 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:53:52.007088 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m17:53:52.009656 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:53:52.057873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m17:53:52.064942 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:53:52.065577 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:53:52.066099 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:53:52.438691 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:53:52.441003 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:53:52.498586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685a33a0>]}
[0m17:53:52.499863 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:53:52.500471 [info ] [MainThread]: 
[0m17:53:52.503368 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m17:53:52.504159 [info ] [Thread-1 (]: 1 of 1 START sql view model staging.stg_tpcds__date_dim ........................ [RUN]
[0m17:53:52.505234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__date_dim)
[0m17:53:52.505891 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m17:53:52.519931 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m17:53:52.521063 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 17:53:52.506528 => 17:53:52.520677
[0m17:53:52.521716 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m17:53:52.561394 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m17:53:52.562958 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m17:53:52.563590 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m17:53:52.564209 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:53:52.968695 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:53:52.996099 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 17:53:52.522120 => 17:53:52.995718
[0m17:53:52.996835 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m17:53:53.049962 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60bfb141-459e-404a-bc43-77e294ffd276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc367e8bb80>]}
[0m17:53:53.051055 [info ] [Thread-1 (]: 1 of 1 OK created sql view model staging.stg_tpcds__date_dim ................... [[32mSUCCESS 1[0m in 0.54s]
[0m17:53:53.052044 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m17:53:53.054545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:53:53.055110 [debug] [MainThread]: Connection 'model.capstone.stg_tpcds__date_dim' was properly closed.
[0m17:53:53.055673 [info ] [MainThread]: 
[0m17:53:53.056277 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.41 seconds (2.41s).
[0m17:53:53.057389 [debug] [MainThread]: Command end result
[0m17:53:53.076824 [info ] [MainThread]: 
[0m17:53:53.077567 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:53:53.078159 [info ] [MainThread]: 
[0m17:53:53.078757 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:53:53.079968 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8296168, "process_user_time": 4.904931, "process_kernel_time": 0.224129, "process_mem_max_rss": "163420", "process_out_blocks": "5440", "process_in_blocks": "0"}
[0m17:53:53.080831 [debug] [MainThread]: Command `dbt run` succeeded at 17:53:53.080599 after 3.83 seconds
[0m17:53:53.081450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc372e16bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685d2770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3685a4520>]}
[0m17:53:53.082116 [debug] [MainThread]: Flushing usage events
[0m18:04:10.520363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ec0df5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ebee6ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ebee6d150>]}


============================== 18:04:10.523993 | e80452c1-1328-4881-abfc-af223c55f945 ==============================
[0m18:04:10.523993 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:04:10.524791 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select analytics*', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:04:11.313495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb6ad2ad0>]}
[0m18:04:11.454237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb6886920>]}
[0m18:04:11.455413 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:04:11.486837 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:04:11.510859 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m18:04:11.511641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb66719f0>]}
[0m18:04:14.517544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb5e5e9e0>]}
[0m18:04:14.540396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb66da6e0>]}
[0m18:04:14.541235 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:04:14.541901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb66da7d0>]}
[0m18:04:14.544117 [info ] [MainThread]: 
[0m18:04:14.545297 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:04:14.547129 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:04:14.567088 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:04:14.567844 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:04:14.568468 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:18.016085 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 3.0 seconds
[0m18:04:18.018515 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:04:18.069302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m18:04:18.082345 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:04:18.082988 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:04:18.083539 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:18.500640 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:04:18.502954 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:04:18.556477 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m18:04:18.562796 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:04:18.563373 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:04:18.563886 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:19.244337 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:04:19.246648 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:04:22.133792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m18:04:22.138885 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:04:22.139452 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:04:22.139964 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:22.523348 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:04:22.525879 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:04:22.581440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb5bc30a0>]}
[0m18:04:22.582726 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:04:22.583342 [info ] [MainThread]: 
[0m18:04:22.586229 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m18:04:22.587028 [info ] [Thread-1 (]: 1 of 2 START sql incremental model analytics.customer_dim ...................... [RUN]
[0m18:04:22.588081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.customer_dim)
[0m18:04:22.588715 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m18:04:22.602745 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m18:04:22.603803 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 18:04:22.589094 => 18:04:22.603428
[0m18:04:22.604411 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m18:04:22.674325 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:22.675222 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m18:04:22.675959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:24.103406 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:04:24.116327 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:24.116982 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m18:04:24.240504 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m18:04:24.249835 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:24.250529 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m18:04:24.368583 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m18:04:24.385395 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:24.386329 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m18:04:24.454468 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m18:04:24.501823 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m18:04:24.505930 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:24.506568 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m18:04:24.623067 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:04:24.623856 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:24.624686 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m18:04:31.597280 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 7.0 seconds
[0m18:04:31.598194 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:31.598804 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m18:04:31.856694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:04:31.870181 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m18:04:31.879246 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:04:31.879909 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m18:04:32.047009 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:04:32.074474 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 18:04:22.604813 => 18:04:32.074076
[0m18:04:32.075193 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m18:04:32.123541 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb5e5eb30>]}
[0m18:04:32.124582 [info ] [Thread-1 (]: 1 of 2 OK created sql incremental model analytics.customer_dim ................. [[32mSUCCESS 100000[0m in 9.54s]
[0m18:04:32.125643 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m18:04:32.126380 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:04:32.127227 [info ] [Thread-1 (]: 2 of 2 START sql incremental model analytics.weekly_sales_inventory ............ [RUN]
[0m18:04:32.128276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now model.capstone.weekly_sales_inventory)
[0m18:04:32.128908 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:04:32.135637 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:04:32.136615 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:04:32.129309 => 18:04:32.136244
[0m18:04:32.137240 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:04:32.161639 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:04:32.166239 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:04:32.167063 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (


create or replace transient table tpcds.analytics.WEEKLY_SALES_INVENTORY_STG AS
(
WITH 
-- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.INTERMEDIATE.DAILY_AGGREGATED_SALES

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
-- inventory weekly table
-- step 1.
-- each warehouse and item's last day of recording to inventory table is different
-- find the last day of each week (eow) to derive inventory at eow
    eow_inventory_day AS
    (
        SELECT 
            INV_WAREHOUSE_SK,
            INV_ITEM_SK,
            YR_num,
            WK_num,
            MAX(INV_DATE_SK) AS eow_sk
        FROM tpcds.raw.inventory
        INNER JOIN tpcds.raw.date_dim
            ON inv_date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
-- inventory weekly table
-- step 1.            
-- aggregrate inventory data to weekly level, INV_QUANTITY_ON_HAND     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.INV_WAREHOUSE_SK AS INV_WAREHOUSE_SK,
            inv.INV_ITEM_SK AS INV_ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.inv_date_sk = eow.eow_sk 
                    THEN inv.INV_QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.raw.inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(INV_WAREHOUSE_SK,INV_ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

-- inventory weekly table
-- step 3. final weekly table, and join with weekly sales table
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        LEFT JOIN agg_wkly_inventory_stg AS inv
            ON inv.INV_WAREHOUSE_SK = sales.warehouse_sk
                AND inv.inv_item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )
SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
);
[0m18:04:32.167867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:32.583112 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b118fc-0001-8eb8-0004-d6ae00094232
[0m18:04:32.583884 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 6 at position 0 unexpected 'create'.
syntax error line 19 at position 32 unexpected 'AS'.
[0m18:04:32.584803 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:04:32.137668 => 18:04:32.584409
[0m18:04:32.585464 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:04:32.635639 [debug] [Thread-1 (]: Database Error in model weekly_sales_inventory (models/analytics/weekly_sales_inventory.sql)
  001003 (42000): SQL compilation error:
  syntax error line 6 at position 0 unexpected 'create'.
  syntax error line 19 at position 32 unexpected 'AS'.
  compiled Code at target/run/capstone/models/analytics/weekly_sales_inventory.sql
[0m18:04:32.636551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80452c1-1328-4881-abfc-af223c55f945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb51e61a0>]}
[0m18:04:32.637528 [error] [Thread-1 (]: 2 of 2 ERROR creating sql incremental model analytics.weekly_sales_inventory ... [[31mERROR[0m in 0.51s]
[0m18:04:32.638545 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:04:32.640916 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:32.641444 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:04:32.642061 [info ] [MainThread]: 
[0m18:04:32.642655 [info ] [MainThread]: Finished running 2 incremental models in 0 hours 0 minutes and 18.10 seconds (18.10s).
[0m18:04:32.644208 [debug] [MainThread]: Command end result
[0m18:04:32.664567 [info ] [MainThread]: 
[0m18:04:32.665308 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:04:32.665907 [info ] [MainThread]: 
[0m18:04:32.666486 [error] [MainThread]:   Database Error in model weekly_sales_inventory (models/analytics/weekly_sales_inventory.sql)
  001003 (42000): SQL compilation error:
  syntax error line 6 at position 0 unexpected 'create'.
  syntax error line 19 at position 32 unexpected 'AS'.
  compiled Code at target/run/capstone/models/analytics/weekly_sales_inventory.sql
[0m18:04:32.667060 [info ] [MainThread]: 
[0m18:04:32.667665 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m18:04:32.668935 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 22.216188, "process_user_time": 7.980075, "process_kernel_time": 0.239651, "process_mem_max_rss": "169020", "process_out_blocks": "5504", "command_success": false, "process_in_blocks": "0"}
[0m18:04:32.669820 [debug] [MainThread]: Command `dbt run` failed at 18:04:32.669600 after 22.22 seconds
[0m18:04:32.670455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ec0df5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb66d87c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7eb6886920>]}
[0m18:04:32.671072 [debug] [MainThread]: Flushing usage events
[0m18:19:16.856430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540b002650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540925cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540925e1d0>]}


============================== 18:19:16.859830 | 0e1e8277-7879-4aad-b98d-fc48eb321489 ==============================
[0m18:19:16.859830 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:19:16.860600 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select int__daily_aggregated_sales', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:19:17.631564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540925e230>]}
[0m18:19:17.770874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5400edf2e0>]}
[0m18:19:17.772021 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:19:17.802556 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:19:17.879529 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m18:19:17.880441 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m18:19:17.880989 [debug] [MainThread]: Partial parsing: deleted file: capstone://models/intermediate/int_daily_aggregated_sales.sql
[0m18:19:18.191740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540076ce20>]}
[0m18:19:18.213456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540080c4f0>]}
[0m18:19:18.214298 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:19:18.214911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540080c580>]}
[0m18:19:18.216772 [info ] [MainThread]: 
[0m18:19:18.217955 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:19:18.219625 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:19:18.240766 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:19:18.241913 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:19:18.242579 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:19:18.728701 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:19:18.731034 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:19:18.831305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m18:19:18.844992 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:19:18.845641 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:19:18.846160 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:19:19.502117 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m18:19:19.504688 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:19:19.549133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m18:19:19.556413 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:19:19.556994 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:19:19.557537 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:19:20.100750 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:19:20.103008 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:19:20.146430 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m18:19:20.151487 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:19:20.152045 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:19:20.152566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:19:20.444461 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:19:20.446846 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:19:20.489309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f54005e7730>]}
[0m18:19:20.490614 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:19:20.491223 [info ] [MainThread]: 
[0m18:19:20.494098 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m18:19:20.494913 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.int__daily_aggregated_sales .... [RUN]
[0m18:19:20.495977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.int__daily_aggregated_sales)
[0m18:19:20.496607 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m18:19:20.511266 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m18:19:20.512277 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 18:19:20.496994 => 18:19:20.511901
[0m18:19:20.512905 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m18:19:20.588197 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m18:19:20.591705 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:19:20.592481 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m18:19:20.593250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:19:25.719329 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m18:19:25.733535 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m18:19:25.742341 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:19:25.743115 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m18:19:25.779488 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:19:25.807180 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 18:19:20.513298 => 18:19:25.806772
[0m18:19:25.807947 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m18:19:25.860396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e1e8277-7879-4aad-b98d-fc48eb321489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5400503c70>]}
[0m18:19:25.861653 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 5.36s]
[0m18:19:25.863222 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m18:19:25.865645 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:19:25.866198 [debug] [MainThread]: Connection 'model.capstone.int__daily_aggregated_sales' was properly closed.
[0m18:19:25.866756 [info ] [MainThread]: 
[0m18:19:25.867589 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 7.65 seconds (7.65s).
[0m18:19:25.868681 [debug] [MainThread]: Command end result
[0m18:19:25.887314 [info ] [MainThread]: 
[0m18:19:25.888124 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:19:25.888698 [info ] [MainThread]: 
[0m18:19:25.889296 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m18:19:25.890516 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.10247, "process_user_time": 5.044416, "process_kernel_time": 0.224127, "process_mem_max_rss": "164152", "process_out_blocks": "5432", "process_in_blocks": "0"}
[0m18:19:25.891366 [debug] [MainThread]: Command `dbt run` succeeded at 18:19:25.891152 after 9.10 seconds
[0m18:19:25.891963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f540b002650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5400d46c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5400edf2e0>]}
[0m18:19:25.892599 [debug] [MainThread]: Flushing usage events
[0m18:20:37.667937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25d7e0ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25d875bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25d8758400>]}


============================== 18:20:37.671388 | 26c28309-cf3b-48a6-9387-47e0c917e1a3 ==============================
[0m18:20:37.671388 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:20:37.672165 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select iweekly_sales_inventory', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:20:38.445830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26c28309-cf3b-48a6-9387-47e0c917e1a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25d8717d30>]}
[0m18:20:38.586385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '26c28309-cf3b-48a6-9387-47e0c917e1a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cdaae860>]}
[0m18:20:38.587537 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:20:38.618926 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:20:38.698039 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:20:38.699050 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/weekly_sales_inventory.sql
[0m18:20:39.016202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '26c28309-cf3b-48a6-9387-47e0c917e1a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cd3acca0>]}
[0m18:20:39.037161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '26c28309-cf3b-48a6-9387-47e0c917e1a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cd5c8580>]}
[0m18:20:39.037993 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:20:39.038595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26c28309-cf3b-48a6-9387-47e0c917e1a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cd5c8610>]}
[0m18:20:39.039540 [warn ] [MainThread]: The selection criterion 'iweekly_sales_inventory' does not match any nodes
[0m18:20:39.040931 [info ] [MainThread]: 
[0m18:20:39.041494 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m18:20:39.042318 [debug] [MainThread]: Command end result
[0m18:20:39.059798 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4605724, "process_user_time": 4.202529, "process_kernel_time": 0.215613, "process_mem_max_rss": "156580", "process_out_blocks": "5376", "process_in_blocks": "0"}
[0m18:20:39.060758 [debug] [MainThread]: Command `dbt run` succeeded at 18:20:39.060536 after 1.46 seconds
[0m18:20:39.061359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25d7e0ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cdaae860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25cd5c8580>]}
[0m18:20:39.062015 [debug] [MainThread]: Flushing usage events
[0m18:23:56.638056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefd450ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefd274fdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefd274d780>]}


============================== 18:23:56.641575 | 423335fb-714f-4c44-835b-7bc9acfa81bb ==============================
[0m18:23:56.641575 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:23:56.642375 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select weekly_sales_inventory', 'send_anonymous_usage_stats': 'True'}
[0m18:23:57.389798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefd270bd30>]}
[0m18:23:57.528995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefca3b6860>]}
[0m18:23:57.530157 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:23:57.560602 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:23:57.637319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:23:57.638059 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:23:57.647944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9d280d0>]}
[0m18:23:57.669806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9ce44c0>]}
[0m18:23:57.670590 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:23:57.671206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9ce4520>]}
[0m18:23:57.673079 [info ] [MainThread]: 
[0m18:23:57.674232 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:23:57.675878 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:23:57.696842 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:23:57.697588 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:23:57.698230 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:23:58.182895 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:23:58.185268 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:23:58.250316 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m18:23:58.262951 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:23:58.263638 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:23:58.264164 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:58.629108 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:23:58.631436 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:23:58.683622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m18:23:58.689988 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:23:58.690599 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:23:58.691154 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:58.974036 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:23:58.976582 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:23:59.021183 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m18:23:59.028590 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:23:59.029188 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:23:59.029755 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:59.489917 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:23:59.492221 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:23:59.541145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9ce3520>]}
[0m18:23:59.542413 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:23:59.543020 [info ] [MainThread]: 
[0m18:23:59.545773 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:23:59.546556 [info ] [Thread-1 (]: 1 of 1 START sql incremental model analytics.weekly_sales_inventory ............ [RUN]
[0m18:23:59.547594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.weekly_sales_inventory)
[0m18:23:59.548235 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:23:59.566915 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:23:59.568010 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:23:59.548873 => 18:23:59.567620
[0m18:23:59.568661 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:23:59.645926 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:23:59.650316 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:23:59.651146 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
-- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.INTERMEDIATE.DAILY_AGGREGATED_SALES

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
-- inventory weekly table
-- step 1.
-- each warehouse and item's last day of recording to inventory table is different
-- find the last day of each week (eow) to derive inventory at eow
    eow_inventory_day AS
    (
        SELECT 
            INV_WAREHOUSE_SK,
            INV_ITEM_SK,
            YR_num,
            WK_num,
            MAX(INV_DATE_SK) AS eow_sk
        FROM tpcds.raw.inventory
        INNER JOIN tpcds.raw.date_dim
            ON inv_date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
-- inventory weekly table
-- step 1.            
-- aggregrate inventory data to weekly level, INV_QUANTITY_ON_HAND     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.INV_WAREHOUSE_SK AS INV_WAREHOUSE_SK,
            inv.INV_ITEM_SK AS INV_ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.inv_date_sk = eow.eow_sk 
                    THEN inv.INV_QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.raw.inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(INV_WAREHOUSE_SK,INV_ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

-- inventory weekly table
-- step 3. final weekly table, and join with weekly sales table
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        LEFT JOIN agg_wkly_inventory_stg AS inv
            ON inv.INV_WAREHOUSE_SK = sales.warehouse_sk
                AND inv.inv_item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )
    
SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:23:59.651943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:24:00.008726 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1190f-0001-8eb8-0004-d6ae0009427e
[0m18:24:00.009633 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES' does not exist or not authorized.
[0m18:24:00.010589 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:23:59.569092 => 18:24:00.010181
[0m18:24:00.011390 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:24:00.079245 [debug] [Thread-1 (]: Database Error in model weekly_sales_inventory (models/analytics/weekly_sales_inventory.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/analytics/weekly_sales_inventory.sql
[0m18:24:00.080194 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '423335fb-714f-4c44-835b-7bc9acfa81bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9bfa770>]}
[0m18:24:00.081162 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model analytics.weekly_sales_inventory ... [[31mERROR[0m in 0.53s]
[0m18:24:00.082283 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:24:00.084889 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:24:00.085568 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:24:00.086152 [info ] [MainThread]: 
[0m18:24:00.087051 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.41 seconds (2.41s).
[0m18:24:00.088246 [debug] [MainThread]: Command end result
[0m18:24:00.108335 [info ] [MainThread]: 
[0m18:24:00.109159 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:24:00.109765 [info ] [MainThread]: 
[0m18:24:00.110349 [error] [MainThread]:   Database Error in model weekly_sales_inventory (models/analytics/weekly_sales_inventory.sql)
  002003 (42S02): SQL compilation error:
  Object 'TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES' does not exist or not authorized.
  compiled Code at target/run/capstone/models/analytics/weekly_sales_inventory.sql
[0m18:24:00.110944 [info ] [MainThread]: 
[0m18:24:00.111552 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m18:24:00.112821 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.543434, "process_user_time": 4.676318, "process_kernel_time": 0.28751, "process_mem_max_rss": "162360", "process_out_blocks": "3624", "command_success": false, "process_in_blocks": "0"}
[0m18:24:00.113734 [debug] [MainThread]: Command `dbt run` failed at 18:24:00.113478 after 3.54 seconds
[0m18:24:00.114377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefd450ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefca3b6860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fefc9ce4310>]}
[0m18:24:00.115028 [debug] [MainThread]: Flushing usage events
[0m18:25:36.293717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce7d816650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce7b9d0d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce7b9d21d0>]}


============================== 18:25:36.297134 | 3724de8a-7687-4bb0-b84e-8bf05db1da20 ==============================
[0m18:25:36.297134 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:25:36.297958 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select weekly_sales_inventory', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:25:37.054642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce7b9d2230>]}
[0m18:25:37.196544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce736472e0>]}
[0m18:25:37.197710 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:25:37.227608 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:25:37.302573 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:25:37.303547 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/weekly_sales_inventory.sql
[0m18:25:37.618674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce72ec4ca0>]}
[0m18:25:37.640485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce72f605b0>]}
[0m18:25:37.641299 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:25:37.641936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce72f605e0>]}
[0m18:25:37.643780 [info ] [MainThread]: 
[0m18:25:37.644907 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:25:37.646621 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:25:37.666777 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:25:37.667594 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:25:37.668223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:25:38.108384 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:25:38.110744 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:25:38.159733 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m18:25:38.173751 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:25:38.174422 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:25:38.174968 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:25:38.687075 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:25:38.689408 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:25:39.080434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m18:25:39.085426 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:25:39.086053 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:25:39.086581 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:25:39.467833 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:25:39.470415 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:25:39.518420 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m18:25:39.525862 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:25:39.526436 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:25:39.526956 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:25:39.870423 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:25:39.872787 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:25:39.913860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce72d2b790>]}
[0m18:25:39.915131 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:25:39.915742 [info ] [MainThread]: 
[0m18:25:39.918623 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:25:39.919446 [info ] [Thread-1 (]: 1 of 1 START sql incremental model analytics.weekly_sales_inventory ............ [RUN]
[0m18:25:39.920484 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.weekly_sales_inventory)
[0m18:25:39.921117 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:25:39.935339 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:25:39.936456 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:25:39.921541 => 18:25:39.936077
[0m18:25:39.937108 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:25:40.012254 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:25:40.016621 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:25:40.017445 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
-- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
-- inventory weekly table
-- step 1.
-- each warehouse and item's last day of recording to inventory table is different
-- find the last day of each week (eow) to derive inventory at eow
    eow_inventory_day AS
    (
        SELECT 
            INV_WAREHOUSE_SK,
            INV_ITEM_SK,
            YR_num,
            WK_num,
            MAX(INV_DATE_SK) AS eow_sk
        FROM tpcds.raw.inventory
        INNER JOIN tpcds.raw.date_dim
            ON inv_date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
-- inventory weekly table
-- step 1.            
-- aggregrate inventory data to weekly level, INV_QUANTITY_ON_HAND     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.INV_WAREHOUSE_SK AS INV_WAREHOUSE_SK,
            inv.INV_ITEM_SK AS INV_ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.inv_date_sk = eow.eow_sk 
                    THEN inv.INV_QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.raw.inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(INV_WAREHOUSE_SK,INV_ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

-- inventory weekly table
-- step 3. final weekly table, and join with weekly sales table
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        LEFT JOIN agg_wkly_inventory_stg AS inv
            ON inv.INV_WAREHOUSE_SK = sales.warehouse_sk
                AND inv.inv_item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:25:40.018279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:25:43.752104 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m18:25:43.766532 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m18:25:43.775169 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:25:43.775857 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m18:25:43.838448 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:25:43.865944 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:25:39.937528 => 18:25:43.865532
[0m18:25:43.866686 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:25:43.919688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3724de8a-7687-4bb0-b84e-8bf05db1da20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce72c47e80>]}
[0m18:25:43.920811 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model analytics.weekly_sales_inventory ....... [[32mSUCCESS 1[0m in 4.00s]
[0m18:25:43.921845 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:25:43.924177 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:25:43.924732 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:25:43.925286 [info ] [MainThread]: 
[0m18:25:43.926164 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 6.28 seconds (6.28s).
[0m18:25:43.927278 [debug] [MainThread]: Command end result
[0m18:25:43.945793 [info ] [MainThread]: 
[0m18:25:43.946534 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:25:43.947106 [info ] [MainThread]: 
[0m18:25:43.947703 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m18:25:43.948884 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.7237716, "process_user_time": 4.991008, "process_kernel_time": 0.25198, "process_mem_max_rss": "164164", "process_out_blocks": "5440", "process_in_blocks": "0"}
[0m18:25:43.949749 [debug] [MainThread]: Command `dbt run` succeeded at 18:25:43.949531 after 7.72 seconds
[0m18:25:43.950360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce7d816650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce734a8fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce736472e0>]}
[0m18:25:43.950981 [debug] [MainThread]: Flushing usage events
[0m16:17:49.245444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f692f002650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f692d23dde0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f692d23c280>]}


============================== 16:17:49.279948 | 84a74838-4928-4985-85f1-1f1ce2a71cc7 ==============================
[0m16:17:49.279948 [info ] [MainThread]: Running with dbt=1.7.3
[0m16:17:49.280725 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:17:52.295390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6924cfa530>]}
[0m16:17:52.437869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6924ec3280>]}
[0m16:17:52.439779 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m16:17:52.474381 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m16:17:52.757927 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:17:52.758997 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m16:17:53.074223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69245ccf10>]}
[0m16:17:53.099889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69247ec5b0>]}
[0m16:17:53.100685 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m16:17:53.103399 [info ] [MainThread]: 
[0m16:17:53.104546 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:17:53.106838 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m16:17:53.127234 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m16:17:53.127928 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m16:17:53.128453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:17:53.915952 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m16:17:53.918425 [debug] [ThreadPool]: On list_tpcds: Close
[0m16:17:53.966754 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m16:17:53.967569 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m16:17:53.968097 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:17:54.462301 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m16:17:54.464605 [debug] [ThreadPool]: On list_tpcds: Close
[0m16:17:54.524200 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m16:17:54.525063 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m16:17:54.525612 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:17:54.880627 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m16:17:54.882918 [debug] [ThreadPool]: On list_tpcds: Close
[0m16:17:54.939596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m16:17:54.953279 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m16:17:54.953928 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m16:17:54.954433 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:17:55.386969 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m16:17:55.389514 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m16:17:55.431943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m16:17:55.439401 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m16:17:55.440011 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m16:17:55.440523 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:17:55.763590 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m16:17:55.765925 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m16:17:55.814955 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m16:17:55.820279 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m16:17:55.820870 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m16:17:55.821404 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:17:56.171124 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m16:17:56.173388 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m16:17:56.222004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69247eb580>]}
[0m16:17:56.223259 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:17:56.223844 [info ] [MainThread]: 
[0m16:17:56.227464 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m16:17:56.228229 [info ] [Thread-1 (]: 1 of 13 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m16:17:56.229255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m16:17:56.229862 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m16:17:56.242880 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m16:17:56.243926 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 16:17:56.230253 => 16:17:56.243554
[0m16:17:56.244563 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m16:17:56.283431 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m16:17:56.286315 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m16:17:56.287056 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m16:17:56.287726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:17:56.819106 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:17:56.850155 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 16:17:56.244953 => 16:17:56.849765
[0m16:17:56.850918 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m16:17:56.924126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69239d16c0>]}
[0m16:17:56.925243 [info ] [Thread-1 (]: 1 of 13 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.70s]
[0m16:17:56.926287 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m16:17:56.927053 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m16:17:56.927926 [info ] [Thread-1 (]: 2 of 13 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m16:17:56.928957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m16:17:56.929597 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m16:17:56.936806 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m16:17:56.937945 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 16:17:56.930002 => 16:17:56.937538
[0m16:17:56.938651 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m16:17:56.944483 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m16:17:56.946516 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m16:17:56.947250 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m16:17:56.947943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:17:57.507365 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:17:57.511437 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 16:17:56.939073 => 16:17:57.511061
[0m16:17:57.512117 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m16:17:57.572663 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69239d32e0>]}
[0m16:17:57.573757 [info ] [Thread-1 (]: 2 of 13 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.64s]
[0m16:17:57.574795 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m16:17:57.575537 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m16:17:57.576424 [info ] [Thread-1 (]: 3 of 13 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m16:17:57.577637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m16:17:57.578421 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m16:17:57.584346 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m16:17:57.585452 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 16:17:57.578863 => 16:17:57.585056
[0m16:17:57.586141 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m16:17:57.591711 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m16:17:57.593339 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m16:17:57.594003 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m16:17:57.594672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:17:58.065214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:17:58.069243 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 16:17:57.586561 => 16:17:58.068879
[0m16:17:58.069912 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m16:17:58.138678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923a31f90>]}
[0m16:17:58.139754 [info ] [Thread-1 (]: 3 of 13 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.56s]
[0m16:17:58.140711 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m16:17:58.141414 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m16:17:58.142273 [info ] [Thread-1 (]: 4 of 13 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m16:17:58.143318 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m16:17:58.143945 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m16:17:58.149567 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m16:17:58.150633 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 16:17:58.144324 => 16:17:58.150227
[0m16:17:58.151279 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m16:17:58.156769 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m16:17:58.158348 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m16:17:58.159024 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m16:17:58.159646 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:17:58.716703 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:17:58.720694 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 16:17:58.151666 => 16:17:58.720344
[0m16:17:58.721359 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m16:17:58.760264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923a32a10>]}
[0m16:17:58.761295 [info ] [Thread-1 (]: 4 of 13 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.62s]
[0m16:17:58.762273 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m16:17:58.762999 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m16:17:58.763824 [info ] [Thread-1 (]: 5 of 13 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m16:17:58.764825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m16:17:58.765437 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m16:17:58.770979 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m16:17:58.771978 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 16:17:58.765826 => 16:17:58.771616
[0m16:17:58.772609 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m16:17:58.779792 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m16:17:58.781170 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m16:17:58.781817 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m16:17:58.782456 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:17:59.926485 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:17:59.930490 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 16:17:58.773001 => 16:17:59.930116
[0m16:17:59.931181 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m16:17:59.972571 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6922058f10>]}
[0m16:17:59.973633 [info ] [Thread-1 (]: 5 of 13 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 1.21s]
[0m16:17:59.974627 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m16:17:59.975334 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m16:17:59.976158 [info ] [Thread-1 (]: 6 of 13 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m16:17:59.977151 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m16:17:59.977763 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m16:17:59.983043 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m16:17:59.984039 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 16:17:59.978144 => 16:17:59.983669
[0m16:17:59.984666 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m16:17:59.989997 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m16:17:59.991366 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m16:17:59.991999 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m16:17:59.992610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:02.455237 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:18:02.459324 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 16:17:59.985048 => 16:18:02.458956
[0m16:18:02.459989 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m16:18:02.524092 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6922059780>]}
[0m16:18:02.525171 [info ] [Thread-1 (]: 6 of 13 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 2.55s]
[0m16:18:02.526156 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m16:18:02.526901 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m16:18:02.527751 [info ] [Thread-1 (]: 7 of 13 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m16:18:02.528790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m16:18:02.529417 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m16:18:02.534708 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m16:18:02.535738 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 16:18:02.529807 => 16:18:02.535364
[0m16:18:02.536374 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m16:18:02.543358 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m16:18:02.544601 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m16:18:02.545231 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m16:18:02.545843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:02.956217 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:02.960339 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 16:18:02.536756 => 16:18:02.959973
[0m16:18:02.961030 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m16:18:03.006876 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f692203ffa0>]}
[0m16:18:03.007972 [info ] [Thread-1 (]: 7 of 13 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.48s]
[0m16:18:03.008959 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m16:18:03.009720 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m16:18:03.010567 [info ] [Thread-1 (]: 8 of 13 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m16:18:03.011643 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m16:18:03.012257 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m16:18:03.017509 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m16:18:03.018531 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 16:18:03.012652 => 16:18:03.018157
[0m16:18:03.019194 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m16:18:03.024715 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m16:18:03.026096 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m16:18:03.026758 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m16:18:03.027364 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:03.764758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:18:03.768738 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 16:18:03.019590 => 16:18:03.768387
[0m16:18:03.769389 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m16:18:03.845957 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923b2c370>]}
[0m16:18:03.847100 [info ] [Thread-1 (]: 8 of 13 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.83s]
[0m16:18:03.848105 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m16:18:03.848854 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m16:18:03.849739 [info ] [Thread-1 (]: 9 of 13 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m16:18:03.850835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m16:18:03.851475 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m16:18:03.858584 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m16:18:03.859729 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 16:18:03.851877 => 16:18:03.859342
[0m16:18:03.860385 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m16:18:03.866222 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m16:18:03.869026 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m16:18:03.869731 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m16:18:03.870445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:04.366853 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:04.370953 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 16:18:03.860789 => 16:18:04.370560
[0m16:18:04.371618 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m16:18:04.438949 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923a076d0>]}
[0m16:18:04.440046 [info ] [Thread-1 (]: 9 of 13 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.59s]
[0m16:18:04.441062 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m16:18:04.441801 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m16:18:04.442829 [info ] [Thread-1 (]: 10 of 13 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m16:18:04.443883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m16:18:04.444507 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m16:18:04.450716 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 16:18:04.444909 => 16:18:04.450288
[0m16:18:04.451346 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m16:18:04.515738 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:04.516548 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m16:18:04.517186 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:04.916844 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m16:18:04.955304 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:04.956224 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m16:18:06.661292 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:18:06.666645 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:06.667342 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m16:18:06.731537 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m16:18:06.740351 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:06.741057 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m16:18:06.791181 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m16:18:06.798781 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:06.799530 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m16:18:06.868367 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m16:18:06.875773 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:06.876448 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m16:18:06.957971 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m16:18:06.970549 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:06.971334 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m16:18:07.018797 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m16:18:07.031515 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m16:18:07.033565 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:07.034180 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m16:18:07.145308 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:07.146120 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:07.146838 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m16:18:07.771957 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:18:07.772844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m16:18:07.773475 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m16:18:07.975332 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:07.982155 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 16:18:04.451743 => 16:18:07.981763
[0m16:18:07.982880 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m16:18:08.031621 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6922087580>]}
[0m16:18:08.032889 [info ] [Thread-1 (]: 10 of 13 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.59s]
[0m16:18:08.033918 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m16:18:08.034701 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m16:18:08.035738 [info ] [Thread-1 (]: 11 of 13 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m16:18:08.036817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m16:18:08.037449 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m16:18:08.049697 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m16:18:08.050818 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 16:18:08.037857 => 16:18:08.050409
[0m16:18:08.051471 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m16:18:08.098396 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:08.099394 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m16:18:08.100204 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:08.745090 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:18:08.750425 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:08.751110 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m16:18:08.853196 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m16:18:08.859968 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:08.860675 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m16:18:08.926642 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m16:18:08.941344 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:08.942136 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m16:18:09.003410 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m16:18:09.044279 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m16:18:09.046884 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:09.047503 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m16:18:09.151279 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:09.152087 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:09.152794 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m16:18:13.685234 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 5.0 seconds
[0m16:18:13.686100 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:13.686734 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m16:18:13.997434 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:14.010747 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m16:18:14.019446 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m16:18:14.020140 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m16:18:14.121706 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:14.125460 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 16:18:08.051870 => 16:18:14.125077
[0m16:18:14.126145 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m16:18:14.180108 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923b243d0>]}
[0m16:18:14.181187 [info ] [Thread-1 (]: 11 of 13 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2310[0m in 6.14s]
[0m16:18:14.182171 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m16:18:14.182912 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m16:18:14.184064 [info ] [Thread-1 (]: 12 of 13 START sql incremental model analytics.customer_dim .................... [RUN]
[0m16:18:14.185156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m16:18:14.185792 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m16:18:14.193324 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m16:18:14.194392 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 16:18:14.186204 => 16:18:14.193991
[0m16:18:14.195090 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m16:18:14.206206 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:14.207112 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m16:18:14.207896 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:14.938777 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:18:14.944084 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:14.944815 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m16:18:15.007399 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m16:18:15.015941 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:15.016667 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m16:18:15.082192 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m16:18:15.090893 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:15.091653 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m16:18:15.154969 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m16:18:15.165349 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m16:18:15.169430 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:15.170071 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m16:18:15.288479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:15.289290 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:15.290124 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m16:18:19.475937 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m16:18:19.476770 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:19.477374 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m16:18:19.723652 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:19.729558 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m16:18:19.731016 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m16:18:19.731622 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m16:18:19.819812 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:19.823613 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 16:18:14.195506 => 16:18:19.823238
[0m16:18:19.824287 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m16:18:19.870000 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6923b2cee0>]}
[0m16:18:19.871084 [info ] [Thread-1 (]: 12 of 13 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 5.69s]
[0m16:18:19.872047 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m16:18:19.872761 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m16:18:19.873609 [info ] [Thread-1 (]: 13 of 13 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m16:18:19.874650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now model.capstone.weekly_sales_inventory)
[0m16:18:19.875280 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m16:18:19.882697 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m16:18:19.883697 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 16:18:19.875668 => 16:18:19.883332
[0m16:18:19.884326 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m16:18:19.893650 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:19.894468 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
-- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
-- inventory weekly table
-- step 1.
-- each warehouse and item's last day of recording to inventory table is different
-- find the last day of each week (eow) to derive inventory at eow
    eow_inventory_day AS
    (
        SELECT 
            INV_WAREHOUSE_SK,
            INV_ITEM_SK,
            YR_num,
            WK_num,
            MAX(INV_DATE_SK) AS eow_sk
        FROM tpcds.raw.inventory
        INNER JOIN tpcds.raw.date_dim
            ON inv_date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
-- inventory weekly table
-- step 1.            
-- aggregrate inventory data to weekly level, INV_QUANTITY_ON_HAND     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.INV_WAREHOUSE_SK AS INV_WAREHOUSE_SK,
            inv.INV_ITEM_SK AS INV_ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.inv_date_sk = eow.eow_sk 
                    THEN inv.INV_QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.raw.inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(INV_WAREHOUSE_SK,INV_ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

-- inventory weekly table
-- step 3. final weekly table, and join with weekly sales table
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        LEFT JOIN agg_wkly_inventory_stg AS inv
            ON inv.INV_WAREHOUSE_SK = sales.warehouse_sk
                AND inv.inv_item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m16:18:19.895295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:20.829156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:18:20.835754 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:20.836383 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m16:18:20.900462 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m16:18:20.907092 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:20.907753 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m16:18:20.971101 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m16:18:20.977710 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:20.978334 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m16:18:21.081931 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m16:18:21.087484 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m16:18:21.089945 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:21.090549 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m16:18:21.186167 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:21.186991 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:21.187703 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m16:18:25.161148 [debug] [Thread-1 (]: SQL status: SUCCESS 8572 in 4.0 seconds
[0m16:18:25.162059 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:25.162705 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m16:18:25.510108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:25.516598 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m16:18:25.518223 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m16:18:25.518886 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m16:18:25.592439 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:18:25.596254 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 16:18:19.884719 => 16:18:25.595883
[0m16:18:25.596927 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m16:18:25.952722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a74838-4928-4985-85f1-1f1ce2a71cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69220cd630>]}
[0m16:18:25.953847 [info ] [Thread-1 (]: 13 of 13 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 8572[0m in 6.08s]
[0m16:18:25.954877 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m16:18:25.957209 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:18:25.957760 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m16:18:25.958369 [info ] [MainThread]: 
[0m16:18:25.958967 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models in 0 hours 0 minutes and 32.85 seconds (32.85s).
[0m16:18:25.963347 [debug] [MainThread]: Command end result
[0m16:18:25.985362 [info ] [MainThread]: 
[0m16:18:25.986169 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:18:25.986799 [info ] [MainThread]: 
[0m16:18:25.987405 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m16:18:25.989710 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 36.81471, "process_user_time": 7.99382, "process_kernel_time": 0.419023, "process_mem_max_rss": "170256", "process_in_blocks": "122656", "process_out_blocks": "6648"}
[0m16:18:25.990578 [debug] [MainThread]: Command `dbt build` succeeded at 16:18:25.990354 after 36.82 seconds
[0m16:18:25.991556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f692f002650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69247ec6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69247ec5e0>]}
[0m16:18:25.992208 [debug] [MainThread]: Flushing usage events
[0m21:13:26.355236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2caf7f6c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2cad85bf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2cad85ab60>]}


============================== 21:13:26.358716 | c55e1aa4-c35a-4044-b700-23d8fa7499d6 ==============================
[0m21:13:26.358716 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:13:26.359486 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:13:27.132785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c55e1aa4-c35a-4044-b700-23d8fa7499d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ca54a2ad0>]}
[0m21:13:27.272890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c55e1aa4-c35a-4044-b700-23d8fa7499d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ca5252920>]}
[0m21:13:27.274039 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:13:27.304288 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:13:27.333342 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_warehouse_not_null.yml is invalid because a list element for 'models' is not a dictionary
[0m21:13:27.334721 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0468675, "process_user_time": 3.803638, "process_kernel_time": 0.212229, "process_mem_max_rss": "149604", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m21:13:27.335566 [debug] [MainThread]: Command `dbt test` failed at 21:13:27.335342 after 1.05 seconds
[0m21:13:27.336171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2caf7f6c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ca4db6bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ca4db6d40>]}
[0m21:13:27.336797 [debug] [MainThread]: Flushing usage events
[0m21:14:20.581275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8550b16bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854ecc7df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854ecc4400>]}


============================== 21:14:20.584680 | df07d739-2ac2-40e7-a6e3-1721fe52cf7f ==============================
[0m21:14:20.584680 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:14:20.585438 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m21:14:21.349510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df07d739-2ac2-40e7-a6e3-1721fe52cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854ec93d30>]}
[0m21:14:21.492374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df07d739-2ac2-40e7-a6e3-1721fe52cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854694e860>]}
[0m21:14:21.493531 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:14:21.525078 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:14:21.554885 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading capstone: intermediate/test_warehouse_not_null.yml - Runtime Error
    Syntax error near line 8
    ------------------------------
    5  | 
    6  | tests:
    7  |   name: sk_not_null
    8  |     columns:
    9  |       warehouse_sk
    10 |       item_sk
    11 |       sold_date_sk
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 8, column 12
[0m21:14:21.556324 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0418984, "process_user_time": 3.786539, "process_kernel_time": 0.22393, "process_mem_max_rss": "149596", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m21:14:21.557188 [debug] [MainThread]: Command `dbt test` failed at 21:14:21.556960 after 1.04 seconds
[0m21:14:21.557810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8550b16bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854624ee60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f854624ebc0>]}
[0m21:14:21.558450 [debug] [MainThread]: Flushing usage events
[0m21:16:23.439588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016020abf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f015e4b3df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f015e4b1660>]}


============================== 21:16:23.443126 | 529b6bc0-3d17-4124-811d-995a3ad3fc73 ==============================
[0m21:16:23.443126 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:16:23.443920 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:16:24.202205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '529b6bc0-3d17-4124-811d-995a3ad3fc73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f015e477d30>]}
[0m21:16:24.340852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '529b6bc0-3d17-4124-811d-995a3ad3fc73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0156132860>]}
[0m21:16:24.341952 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:16:24.371974 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:16:24.400854 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading capstone: intermediate/test_daily_table_sk_not_null.yml - Runtime Error
    Syntax error near line 8
    ------------------------------
    5  | 
    6  | tests:
    7  |   name: sk_not_null
    8  |     columns:
    9  |       - warehouse_sk
    10 |       - item_sk
    11 |       - sold_date_sk
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 8, column 12
[0m21:16:24.402234 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0322347, "process_user_time": 3.747047, "process_kernel_time": 0.248013, "process_mem_max_rss": "149588", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:16:24.403077 [debug] [MainThread]: Command `dbt test` failed at 21:16:24.402865 after 1.03 seconds
[0m21:16:24.403666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016020abf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0155a4ae60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0155a4ab90>]}
[0m21:16:24.404279 [debug] [MainThread]: Flushing usage events
[0m21:18:28.986794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f89201690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f87434d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f874361d0>]}


============================== 21:18:28.990328 | d8849142-e810-4a93-b32a-4e931dfb87b1 ==============================
[0m21:18:28.990328 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:18:28.991122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:18:29.750341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8849142-e810-4a93-b32a-4e931dfb87b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f87436230>]}
[0m21:18:29.893255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8849142-e810-4a93-b32a-4e931dfb87b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f7f09b2e0>]}
[0m21:18:29.894416 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:18:29.925922 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:18:29.955521 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_daily_table_sk_not_null.yml is invalid because a list element for 'models' is not a dictionary
[0m21:18:29.956914 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0384378, "process_user_time": 3.770309, "process_kernel_time": 0.227922, "process_mem_max_rss": "149604", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:18:29.957778 [debug] [MainThread]: Command `dbt test` failed at 21:18:29.957548 after 1.04 seconds
[0m21:18:29.958403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f89201690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f7e99ab90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f7e99ad10>]}
[0m21:18:29.959057 [debug] [MainThread]: Flushing usage events
[0m21:20:51.119276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aad7f5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aab768f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aab76a1d0>]}


============================== 21:20:51.122906 | 84ff828c-9867-4f6e-bba1-e3138569defe ==============================
[0m21:20:51.122906 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:20:51.123705 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:20:51.908087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84ff828c-9867-4f6e-bba1-e3138569defe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aab76a230>]}
[0m21:20:52.052252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84ff828c-9867-4f6e-bba1-e3138569defe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aa33f72e0>]}
[0m21:20:52.053427 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:20:52.085253 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:20:52.115140 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_daily_table_sk_not_null.yml is invalid because the value of 'models' is not a list
[0m21:20:52.116527 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0664583, "process_user_time": 3.803579, "process_kernel_time": 0.276027, "process_mem_max_rss": "149488", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:20:52.117364 [debug] [MainThread]: Command `dbt test` failed at 21:20:52.117151 after 1.07 seconds
[0m21:20:52.117962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aad7f5690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aa2d0eb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6aa2d0ed10>]}
[0m21:20:52.118583 [debug] [MainThread]: Flushing usage events
[0m21:21:20.860338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fbe222c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fbc3d7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fbc3d43d0>]}


============================== 21:21:20.863883 | e2c44c34-984c-4a66-a36b-9f2290eb1e42 ==============================
[0m21:21:20.863883 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:21:20.864653 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m21:21:21.639605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2c44c34-984c-4a66-a36b-9f2290eb1e42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fb404aad0>]}
[0m21:21:21.779093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2c44c34-984c-4a66-a36b-9f2290eb1e42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fb3dfa920>]}
[0m21:21:21.780250 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:21:21.811418 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:21:21.840480 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_daily_table_sk_not_null.yml is invalid because a list element for 'models' is not a dictionary
[0m21:21:21.841792 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0542204, "process_user_time": 3.825401, "process_kernel_time": 0.240443, "process_mem_max_rss": "149636", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m21:21:21.842628 [debug] [MainThread]: Command `dbt test` failed at 21:21:21.842396 after 1.06 seconds
[0m21:21:21.843222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fbe222c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fb394abf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7fb394ad40>]}
[0m21:21:21.843845 [debug] [MainThread]: Flushing usage events
[0m21:24:09.379050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3aae12c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a9017f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a9016b60>]}


============================== 21:24:09.382481 | f8090a32-89de-49a0-8122-2e70a9c9864f ==============================
[0m21:24:09.382481 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:24:09.383263 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:24:10.146303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f8090a32-89de-49a0-8122-2e70a9c9864f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a0c7aad0>]}
[0m21:24:10.284752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f8090a32-89de-49a0-8122-2e70a9c9864f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a0a2a920>]}
[0m21:24:10.285880 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:24:10.316288 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:24:10.345830 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_daily_table_sk_not_null.yml is invalid because a list element for 'models' is not a dictionary
[0m21:24:10.347197 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0370511, "process_user_time": 3.768307, "process_kernel_time": 0.219789, "process_mem_max_rss": "149728", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m21:24:10.348025 [debug] [MainThread]: Command `dbt test` failed at 21:24:10.347808 after 1.04 seconds
[0m21:24:10.348620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3aae12c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a058ebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3a058ed40>]}
[0m21:24:10.349230 [debug] [MainThread]: Flushing usage events
[0m21:25:17.846235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fc700aaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fc52b5f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fc52b4a30>]}


============================== 21:25:17.849859 | b4b5a114-89da-4010-870b-161dad6e31ac ==============================
[0m21:25:17.849859 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:25:17.850692 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:25:18.643216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b4b5a114-89da-4010-870b-161dad6e31ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fbcd62530>]}
[0m21:25:18.786583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b4b5a114-89da-4010-870b-161dad6e31ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fbcd2f280>]}
[0m21:25:18.787804 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:25:18.820637 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:25:18.850770 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at models/intermediate/test_daily_table_sk_not_null.yml is invalid because a list element for 'models' is not a dictionary
[0m21:25:18.852180 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0736095, "process_user_time": 3.840418, "process_kernel_time": 0.200138, "process_mem_max_rss": "149652", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:25:18.853051 [debug] [MainThread]: Command `dbt test` failed at 21:25:18.852823 after 1.07 seconds
[0m21:25:18.853677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fc700aaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fbc82ec20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fbc82eda0>]}
[0m21:25:18.854319 [debug] [MainThread]: Flushing usage events
[0m21:30:12.692116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f247c909690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f247ab42f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f247ab41660>]}


============================== 21:30:12.695637 | 9fd5a2a4-6fca-4127-bc4d-6ae236066a6e ==============================
[0m21:30:12.695637 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:30:12.696421 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:30:13.495147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9fd5a2a4-6fca-4127-bc4d-6ae236066a6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f247ab41600>]}
[0m21:30:13.636107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9fd5a2a4-6fca-4127-bc4d-6ae236066a6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24727ab2e0>]}
[0m21:30:13.637283 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:30:13.669607 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:30:13.699880 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading capstone: intermediate/test_daily_table_sk_not_null.yml - Runtime Error
    Syntax error near line 5
    ------------------------------
    2  | 
    3  | models: 
    4  |   - name: int__daily_aggregated_sales
    5  |   tests:
    6  |     - name: sk_columns_are_not_null
    7  |       columns:
    8  |         - warehouse_sk
    
    Raw Error:
    ------------------------------
    while parsing a block collection
      in "<unicode string>", line 4, column 3
    did not find expected '-' indicator
      in "<unicode string>", line 5, column 3
[0m21:30:13.701320 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0795547, "process_user_time": 3.884032, "process_kernel_time": 0.244071, "process_mem_max_rss": "149628", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:30:13.702182 [debug] [MainThread]: Command `dbt test` failed at 21:30:13.701966 after 1.08 seconds
[0m21:30:13.702826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f247c909690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24720bed10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f24720bec50>]}
[0m21:30:13.703466 [debug] [MainThread]: Flushing usage events
[0m21:30:49.961979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1ea02c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1cc57f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1cc55150>]}


============================== 21:30:49.965496 | 248842bc-2a47-4157-a4de-7d5380d6e9e0 ==============================
[0m21:30:49.965496 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:30:49.966295 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:30:50.740383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '248842bc-2a47-4157-a4de-7d5380d6e9e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a148d6ad0>]}
[0m21:30:50.880009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '248842bc-2a47-4157-a4de-7d5380d6e9e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1468a920>]}
[0m21:30:50.881150 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:30:50.912503 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:30:50.991655 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m21:30:50.992652 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/test_daily_table_sk_not_null.yml
[0m21:30:51.080332 [error] [MainThread]: Encountered an error:
Parsing Error
  Invalid test config given in models/intermediate/test_daily_table_sk_not_null.yml:
  	test definition dictionary must have exactly one key, got [('name', 'sk_columns_are_not_null'), ('columns', ['warehouse_sk', 'item_sk', 'sold_date_sk']), ('expectations', [{'expectation': 'not_null', 'level': 'error', 'message': 'one of more column is null.'}])] instead (3 keys)
  	@: UnparsedModelUpdate(original_file_path='mode...ne)
[0m21:30:51.081806 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.189337, "process_user_time": 3.926001, "process_kernel_time": 0.259438, "process_mem_max_rss": "150616", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m21:30:51.082710 [debug] [MainThread]: Command `dbt test` failed at 21:30:51.082454 after 1.19 seconds
[0m21:30:51.083326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a1ea02c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a140b6800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a140b5c00>]}
[0m21:30:51.083958 [debug] [MainThread]: Flushing usage events
[0m00:02:29.718147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc36c9deaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc36a75e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc36a75f1c0>]}


============================== 00:02:29.721532 | c89f14d8-10d6-4842-906c-9b6dd35ce960 ==============================
[0m00:02:29.721532 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:02:29.722297 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --select intermediate.*', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:02:30.495367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3623c71c0>]}
[0m00:02:30.636005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc362176560>]}
[0m00:02:30.637176 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:02:30.668104 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:02:30.744661 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m00:02:30.745633 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/_int__test.yml
[0m00:02:30.746324 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m00:02:31.308077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3618dd720>]}
[0m00:02:31.329765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc361ce07c0>]}
[0m00:02:31.330616 [info ] [MainThread]: Found 12 models, 1 snapshot, 2 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m00:02:31.331235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc361ce06a0>]}
[0m00:02:31.333421 [info ] [MainThread]: 
[0m00:02:31.334569 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:02:31.336940 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_intermediate'
[0m00:02:31.358656 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:02:31.359369 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:02:31.359895 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:02:32.526899 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m00:02:32.529326 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:02:32.630305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m00:02:32.636050 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m00:02:32.636695 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m00:02:32.637238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:02:33.406331 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m00:02:33.408748 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m00:02:33.593579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m00:02:33.598895 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m00:02:33.599502 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m00:02:33.600030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:02:34.255942 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m00:02:34.258550 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m00:02:34.379010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c89f14d8-10d6-4842-906c-9b6dd35ce960', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3629b90f0>]}
[0m00:02:34.380298 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:02:34.380885 [info ] [MainThread]: 
[0m00:02:34.383730 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m00:02:34.384398 [info ] [Thread-1 (]: 1 of 2 START test not_null_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m00:02:34.385761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m00:02:34.386863 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m00:02:34.408068 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m00:02:34.409290 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 00:02:34.387369 => 00:02:34.408906
[0m00:02:34.409930 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m00:02:34.439277 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m00:02:34.440805 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m00:02:34.441453 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m00:02:34.442068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:02:36.388141 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m00:02:36.398234 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 00:02:34.410325 => 00:02:36.397724
[0m00:02:36.399084 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m00:02:36.505573 [error] [Thread-1 (]: 1 of 2 FAIL 515 not_null_int__daily_aggregated_sales_warehouse_sk .............. [[31mFAIL 515[0m in 2.12s]
[0m00:02:36.506783 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m00:02:36.507533 [debug] [Thread-1 (]: Began running node test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194
[0m00:02:36.508351 [info ] [Thread-1 (]: 2 of 2 START test unqiue_int__daily_aggregated_sales_warehouse_sk .............. [RUN]
[0m00:02:36.509464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194)
[0m00:02:36.510101 [debug] [Thread-1 (]: Began compiling node test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194
[0m00:02:36.519609 [debug] [Thread-1 (]: Timing info for test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194 (compile): 00:02:36.510507 => 00:02:36.519155
[0m00:02:36.526900 [debug] [Thread-1 (]: Compilation Error in test unqiue_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)
  'test_unqiue' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m00:02:36.527746 [error] [Thread-1 (]: 2 of 2 ERROR unqiue_int__daily_aggregated_sales_warehouse_sk ................... [[31mERROR[0m in 0.02s]
[0m00:02:36.528614 [debug] [Thread-1 (]: Finished running node test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194
[0m00:02:36.531010 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:02:36.531598 [debug] [MainThread]: Connection 'test.capstone.unqiue_int__daily_aggregated_sales_warehouse_sk.c4017e5194' was properly closed.
[0m00:02:36.532171 [info ] [MainThread]: 
[0m00:02:36.532778 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 5.20 seconds (5.20s).
[0m00:02:36.534014 [debug] [MainThread]: Command end result
[0m00:02:36.553358 [info ] [MainThread]: 
[0m00:02:36.554120 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m00:02:36.554712 [info ] [MainThread]: 
[0m00:02:36.555319 [error] [MainThread]: [31mFailure in test not_null_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m00:02:36.555894 [error] [MainThread]:   Got 515 results, configured to fail if != 0
[0m00:02:36.556470 [info ] [MainThread]: 
[0m00:02:36.557038 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/not_null_int__daily_aggregated_sales_warehouse_sk.sql
[0m00:02:36.557613 [info ] [MainThread]: 
[0m00:02:36.558181 [error] [MainThread]:   Compilation Error in test unqiue_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)
  'test_unqiue' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m00:02:36.558803 [info ] [MainThread]: 
[0m00:02:36.559422 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m00:02:36.560719 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 6.909928, "process_user_time": 5.092412, "process_kernel_time": 0.24781, "process_mem_max_rss": "166848", "process_in_blocks": "280", "process_out_blocks": "5472", "command_success": false}
[0m00:02:36.562687 [debug] [MainThread]: Command `dbt test` failed at 00:02:36.562435 after 6.91 seconds
[0m00:02:36.563341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc36c9deaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc361ab6200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc361ce07c0>]}
[0m00:02:36.563994 [debug] [MainThread]: Flushing usage events
[0m00:04:49.377161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6b822bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f699dea40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f699dffa0>]}


============================== 00:04:49.380565 | 098465c7-c28d-46a1-ab66-61d30ac4f15b ==============================
[0m00:04:49.380565 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:04:49.381324 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt deps', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:04:49.513360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '098465c7-c28d-46a1-ab66-61d30ac4f15b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f699dcdf0>]}
[0m00:04:49.531846 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-carb7psv'
[0m00:04:49.532552 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m00:04:49.636967 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m00:04:49.637813 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m00:04:49.732101 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m00:04:49.737828 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json
[0m00:04:49.839077 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json 200
[0m00:04:49.843579 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m00:04:49.952743 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m00:04:49.956857 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m00:04:50.147475 [info ] [MainThread]: Installed from version 1.1.1
[0m00:04:50.148162 [info ] [MainThread]: Up to date!
[0m00:04:50.148790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '098465c7-c28d-46a1-ab66-61d30ac4f15b', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f69a341f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f699dca30>]}
[0m00:04:50.149421 [info ] [MainThread]: Installing calogica/dbt_expectations
[0m00:04:50.455859 [info ] [MainThread]: Installed from version 0.10.1
[0m00:04:50.456897 [info ] [MainThread]: Up to date!
[0m00:04:50.457663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '098465c7-c28d-46a1-ab66-61d30ac4f15b', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698fbc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698f9bd0>]}
[0m00:04:50.458296 [info ] [MainThread]: Installing calogica/dbt_date
[0m00:04:50.605761 [info ] [MainThread]: Installed from version 0.10.0
[0m00:04:50.606468 [info ] [MainThread]: Up to date!
[0m00:04:50.607132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '098465c7-c28d-46a1-ab66-61d30ac4f15b', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698f8d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698faaa0>]}
[0m00:04:50.609313 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.3001047, "process_user_time": 3.705885, "process_kernel_time": 0.140334, "process_mem_max_rss": "103656", "process_out_blocks": "23040", "process_in_blocks": "0"}
[0m00:04:50.610145 [debug] [MainThread]: Command `dbt deps` succeeded at 00:04:50.609924 after 1.30 seconds
[0m00:04:50.610727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f6b822bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698d7250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f698d4e50>]}
[0m00:04:50.611328 [debug] [MainThread]: Flushing usage events
[0m00:10:30.050747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4b89f2aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4b696e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4b696f1c0>]}


============================== 00:10:30.054463 | 45196364-7898-4075-a077-aa01f21de746 ==============================
[0m00:10:30.054463 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:10:30.055327 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --select intermediate.*', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:10:30.843617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4ae5e71c0>]}
[0m00:10:30.985274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4ae396560>]}
[0m00:10:30.986426 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:10:31.018763 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:10:31.098442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:10:31.099675 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/_int__test.yml
[0m00:10:31.679313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4adb1e170>]}
[0m00:10:31.702935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4adf09180>]}
[0m00:10:31.703800 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m00:10:31.704432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4adf09030>]}
[0m00:10:31.706571 [info ] [MainThread]: 
[0m00:10:31.707766 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:10:31.710177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_analytics'
[0m00:10:31.732463 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m00:10:31.733175 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m00:10:31.733698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:10:34.009001 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 2.0 seconds
[0m00:10:34.011421 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m00:10:34.066466 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m00:10:34.072004 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m00:10:34.072633 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m00:10:34.073172 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:10:34.449317 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m00:10:34.451943 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m00:10:34.515357 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m00:10:34.523818 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:10:34.524451 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:10:34.524993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:10:34.967015 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:10:34.969383 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:10:35.012996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45196364-7898-4075-a077-aa01f21de746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4adf08610>]}
[0m00:10:35.014284 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:10:35.014896 [info ] [MainThread]: 
[0m00:10:35.017841 [debug] [Thread-1 (]: Began running node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:10:35.018584 [info ] [Thread-1 (]: 1 of 1 START test dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk  [RUN]
[0m00:10:35.019713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5)
[0m00:10:35.020374 [debug] [Thread-1 (]: Began compiling node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:10:35.035918 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:10:35.037050 [debug] [Thread-1 (]: Timing info for test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5 (compile): 00:10:35.020793 => 00:10:35.036656
[0m00:10:35.037710 [debug] [Thread-1 (]: Began executing node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:10:35.070266 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:10:35.072015 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:10:35.072700 [debug] [Thread-1 (]: On test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      




    with grouped_expression as (
    select
        
        
    
  warehouse_sk is not null as expression


    from tpcds.intermediate.int__daily_aggregated_sales
    

),
validation_errors as (

    select
        *
    from
        grouped_expression
    where
        not(expression = true)

)

select *
from validation_errors




      
    ) dbt_internal_test
[0m00:10:35.073372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:10:35.859110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:10:35.870233 [debug] [Thread-1 (]: Timing info for test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5 (execute): 00:10:35.038131 => 00:10:35.869716
[0m00:10:35.871073 [debug] [Thread-1 (]: On test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5: Close
[0m00:10:37.179713 [error] [Thread-1 (]: 1 of 1 FAIL 515 dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk  [[31mFAIL 515[0m in 2.16s]
[0m00:10:37.180879 [debug] [Thread-1 (]: Finished running node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:10:37.183254 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:10:37.183839 [debug] [MainThread]: Connection 'test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5' was properly closed.
[0m00:10:37.184395 [info ] [MainThread]: 
[0m00:10:37.185016 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 5.48 seconds (5.48s).
[0m00:10:37.186089 [debug] [MainThread]: Command end result
[0m00:10:37.206263 [info ] [MainThread]: 
[0m00:10:37.207030 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:10:37.207598 [info ] [MainThread]: 
[0m00:10:37.208182 [error] [MainThread]: [31mFailure in test dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m00:10:37.208748 [error] [MainThread]:   Got 515 results, configured to fail if != 0
[0m00:10:37.209294 [info ] [MainThread]: 
[0m00:10:37.209853 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/dbt_expectations_expect_column_52120907eba4f0c04b92ed91fa7a6879.sql
[0m00:10:37.210413 [info ] [MainThread]: 
[0m00:10:37.211048 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:10:37.212316 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 7.2294083, "process_user_time": 5.135768, "process_kernel_time": 0.27137, "process_mem_max_rss": "166996", "process_out_blocks": "5448", "command_success": false, "process_in_blocks": "0"}
[0m00:10:37.213205 [debug] [MainThread]: Command `dbt test` failed at 00:10:37.212979 after 7.23 seconds
[0m00:10:37.213849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4b89f2aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4adcddab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4ad9ca650>]}
[0m00:10:37.214486 [debug] [MainThread]: Flushing usage events
[0m00:16:59.658289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aa1a01690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a9fc3ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a9fc3d150>]}


============================== 00:16:59.661740 | 92e03dbf-b35b-436f-833a-c875de6a493a ==============================
[0m00:16:59.661740 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:16:59.662518 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select int__daily_aggregated_sales', 'send_anonymous_usage_stats': 'True'}
[0m00:17:00.425411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a978a2ad0>]}
[0m00:17:00.565905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a97652920>]}
[0m00:17:00.567083 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:17:00.597831 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:17:00.675347 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:17:00.676423 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m00:17:01.266393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a96dfe4d0>]}
[0m00:17:01.288824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a971d8e50>]}
[0m00:17:01.289645 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m00:17:01.290262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a971d8d00>]}
[0m00:17:01.292189 [info ] [MainThread]: 
[0m00:17:01.293314 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:17:01.295196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:17:01.318333 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:17:01.319059 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:17:01.319569 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:01.725887 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m00:17:01.728275 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:17:01.787830 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m00:17:01.800987 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m00:17:01.801687 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m00:17:01.802230 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:02.182225 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m00:17:02.184849 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m00:17:02.278187 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m00:17:02.285644 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m00:17:02.286424 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m00:17:02.286985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:02.625024 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:17:02.627389 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m00:17:02.675951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m00:17:02.681325 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:17:02.681916 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:17:02.682447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:03.072752 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:17:03.075195 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:17:03.174429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a971d8550>]}
[0m00:17:03.175738 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:17:03.176333 [info ] [MainThread]: 
[0m00:17:03.179121 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m00:17:03.179901 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.int__daily_aggregated_sales .... [RUN]
[0m00:17:03.180972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.int__daily_aggregated_sales)
[0m00:17:03.181597 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m00:17:03.201616 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m00:17:03.202871 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 00:17:03.181985 => 00:17:03.202428
[0m00:17:03.203524 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m00:17:03.274583 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:03.275598 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sold_date_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _surrograte_key,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m00:17:03.276409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:17:04.111760 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:17:04.124844 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.125616 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m00:17:04.195372 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m00:17:04.202178 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.202933 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m00:17:04.278063 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m00:17:04.292434 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.293217 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m00:17:04.357690 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m00:17:04.401173 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.403747 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.404369 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m00:17:04.475708 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:17:04.476539 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:04.477244 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m00:17:09.229896 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 5.0 seconds
[0m00:17:09.230810 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:09.231422 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m00:17:11.733552 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m00:17:11.747191 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m00:17:11.756020 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:17:11.756713 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m00:17:11.841146 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:17:11.868507 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 00:17:03.203928 => 00:17:11.868127
[0m00:17:11.869222 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m00:17:11.911755 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e03dbf-b35b-436f-833a-c875de6a493a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a96b4ffd0>]}
[0m00:17:11.912863 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2310[0m in 8.73s]
[0m00:17:11.913859 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m00:17:11.916199 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:17:11.916727 [debug] [MainThread]: Connection 'model.capstone.int__daily_aggregated_sales' was properly closed.
[0m00:17:11.917272 [info ] [MainThread]: 
[0m00:17:11.917887 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 10.62 seconds (10.62s).
[0m00:17:11.918971 [debug] [MainThread]: Command end result
[0m00:17:11.938543 [info ] [MainThread]: 
[0m00:17:11.939309 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:17:11.939885 [info ] [MainThread]: 
[0m00:17:11.940487 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:17:11.941717 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.350338, "process_user_time": 5.4381, "process_kernel_time": 0.251495, "process_mem_max_rss": "168568", "process_out_blocks": "5472", "process_in_blocks": "0"}
[0m00:17:11.942574 [debug] [MainThread]: Command `dbt run` succeeded at 00:17:11.942348 after 12.35 seconds
[0m00:17:11.943240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aa1a01690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a96fb5d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a96bf72b0>]}
[0m00:17:11.943875 [debug] [MainThread]: Flushing usage events
[0m00:17:21.667969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8924a09690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8922cb6f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8922cb5660>]}


============================== 00:17:21.671578 | 9a6e272d-9b85-4bf2-9d91-c29889eaa203 ==============================
[0m00:17:21.671578 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:17:21.672389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:17:22.441027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8922cb5600>]}
[0m00:17:22.582811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a93b2e0>]}
[0m00:17:22.583953 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:17:22.614751 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:17:22.693090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:17:22.693803 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:17:22.703993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a2b40d0>]}
[0m00:17:22.727482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a270e20>]}
[0m00:17:22.728309 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m00:17:22.728915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a270cd0>]}
[0m00:17:22.731268 [info ] [MainThread]: 
[0m00:17:22.732400 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:17:22.734793 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_analytics'
[0m00:17:22.756701 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m00:17:22.757423 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m00:17:22.757971 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:23.256278 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:17:23.258703 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m00:17:23.330008 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m00:17:23.335364 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:17:23.335967 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:17:23.336497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:23.774012 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:17:23.776340 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:17:24.460289 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m00:17:24.466748 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m00:17:24.467355 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m00:17:24.467875 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:24.880150 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m00:17:24.882740 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m00:17:24.950959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a6e272d-9b85-4bf2-9d91-c29889eaa203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a270d30>]}
[0m00:17:24.952246 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:17:24.952831 [info ] [MainThread]: 
[0m00:17:24.955681 [debug] [Thread-1 (]: Began running node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:17:24.956385 [info ] [Thread-1 (]: 1 of 1 START test dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk  [RUN]
[0m00:17:24.957455 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5)
[0m00:17:24.958090 [debug] [Thread-1 (]: Began compiling node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:17:24.988280 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:17:24.989478 [debug] [Thread-1 (]: Timing info for test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5 (compile): 00:17:24.958513 => 00:17:24.989073
[0m00:17:24.990157 [debug] [Thread-1 (]: Began executing node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:17:25.021784 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:17:25.023623 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"
[0m00:17:25.024316 [debug] [Thread-1 (]: On test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      




    with grouped_expression as (
    select
        
        
    
  warehouse_sk is not null as expression


    from tpcds.intermediate.int__daily_aggregated_sales
    

),
validation_errors as (

    select
        *
    from
        grouped_expression
    where
        not(expression = true)

)

select *
from validation_errors




      
    ) dbt_internal_test
[0m00:17:25.024986 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:17:25.407902 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:17:25.417858 [debug] [Thread-1 (]: Timing info for test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5 (execute): 00:17:24.990561 => 00:17:25.417321
[0m00:17:25.418678 [debug] [Thread-1 (]: On test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5: Close
[0m00:17:25.492737 [error] [Thread-1 (]: 1 of 1 FAIL 515 dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk  [[31mFAIL 515[0m in 0.54s]
[0m00:17:25.494049 [debug] [Thread-1 (]: Finished running node test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5
[0m00:17:25.496455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:17:25.497043 [debug] [MainThread]: Connection 'test.capstone.dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk.003cfdbcc5' was properly closed.
[0m00:17:25.497609 [info ] [MainThread]: 
[0m00:17:25.498232 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.77 seconds (2.77s).
[0m00:17:25.499382 [debug] [MainThread]: Command end result
[0m00:17:25.519496 [info ] [MainThread]: 
[0m00:17:25.520256 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:17:25.520833 [info ] [MainThread]: 
[0m00:17:25.521420 [error] [MainThread]: [31mFailure in test dbt_expectations_expect_column_values_to_not_be_null_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m00:17:25.521989 [error] [MainThread]:   Got 515 results, configured to fail if != 0
[0m00:17:25.522541 [info ] [MainThread]: 
[0m00:17:25.523132 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/dbt_expectations_expect_column_52120907eba4f0c04b92ed91fa7a6879.sql
[0m00:17:25.523712 [info ] [MainThread]: 
[0m00:17:25.524309 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:17:25.525573 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 3.9257877, "process_user_time": 4.649417, "process_kernel_time": 0.216336, "process_mem_max_rss": "161256", "process_out_blocks": "3616", "command_success": false, "process_in_blocks": "0"}
[0m00:17:25.526550 [debug] [MainThread]: Command `dbt test` failed at 00:17:25.526220 after 3.93 seconds
[0m00:17:25.527247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8924a09690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a93b2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f891a79cfd0>]}
[0m00:17:25.527896 [debug] [MainThread]: Flushing usage events
[0m00:17:54.802845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c9df8d690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c9bc73f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c9bc71150>]}


============================== 00:17:54.806384 | 006cc061-8f11-4ace-b155-cbb492c3c6b2 ==============================
[0m00:17:54.806384 [info ] [MainThread]: Running with dbt=1.7.3
[0m00:17:54.807201 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select int__daily_aggregated_sales', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:17:55.579294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c938d2ad0>]}
[0m00:17:55.718522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c93682920>]}
[0m00:17:55.719777 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m00:17:55.751971 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m00:17:55.829080 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:17:55.830175 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m00:17:56.400965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c92e2e4d0>]}
[0m00:17:56.423028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c93208e50>]}
[0m00:17:56.423828 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m00:17:56.424579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c93208d00>]}
[0m00:17:56.426612 [info ] [MainThread]: 
[0m00:17:56.427790 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:17:56.429700 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m00:17:56.449457 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m00:17:56.450696 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m00:17:56.451254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:59.337847 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 3.0 seconds
[0m00:17:59.340405 [debug] [ThreadPool]: On list_tpcds: Close
[0m00:17:59.400728 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m00:17:59.413301 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m00:17:59.413935 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m00:17:59.414504 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:17:59.772082 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m00:17:59.774683 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m00:18:01.936729 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m00:18:01.944190 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m00:18:01.944828 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m00:18:01.945351 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:18:02.365763 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:18:02.368164 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m00:18:02.420541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m00:18:02.425802 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m00:18:02.426408 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m00:18:02.426957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:18:02.832084 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m00:18:02.834465 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m00:18:02.876892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c932085b0>]}
[0m00:18:02.878161 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:18:02.878779 [info ] [MainThread]: 
[0m00:18:02.881524 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m00:18:02.882377 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.int__daily_aggregated_sales .... [RUN]
[0m00:18:02.883505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.int__daily_aggregated_sales)
[0m00:18:02.884153 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m00:18:02.904627 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m00:18:02.905848 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 00:18:02.884582 => 00:18:02.905446
[0m00:18:02.906530 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m00:18:02.977837 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:02.978887 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sold_date_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _surrograte_key,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
WHERE warehouse_sk IS NOT NULL
  );
[0m00:18:02.979749 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:18:03.640616 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m00:18:03.653440 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:03.654174 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m00:18:03.723637 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m00:18:03.730558 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:03.731319 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m00:18:03.788782 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m00:18:03.803198 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:03.804014 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m00:18:03.863432 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m00:18:03.907112 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m00:18:03.909711 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:03.910345 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m00:18:04.005541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:18:04.006370 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:04.007134 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m00:18:06.257736 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 2.0 seconds
[0m00:18:06.258759 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:06.259388 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m00:18:06.544541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:18:06.557726 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m00:18:06.566380 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m00:18:06.567072 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m00:18:06.686828 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m00:18:06.714578 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 00:18:02.906980 => 00:18:06.714192
[0m00:18:06.715392 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m00:18:06.772050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '006cc061-8f11-4ace-b155-cbb492c3c6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c92b7ff10>]}
[0m00:18:06.773192 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2310[0m in 3.89s]
[0m00:18:06.774229 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m00:18:06.776559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:18:06.777120 [debug] [MainThread]: Connection 'model.capstone.int__daily_aggregated_sales' was properly closed.
[0m00:18:06.777671 [info ] [MainThread]: 
[0m00:18:06.778270 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 10.35 seconds (10.35s).
[0m00:18:06.779340 [debug] [MainThread]: Command end result
[0m00:18:06.798769 [info ] [MainThread]: 
[0m00:18:06.799479 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:18:06.800059 [info ] [MainThread]: 
[0m00:18:06.800645 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:18:06.801825 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.068334, "process_user_time": 5.412294, "process_kernel_time": 0.217114, "process_mem_max_rss": "168452", "process_out_blocks": "5480", "process_in_blocks": "0"}
[0m00:18:06.802683 [debug] [MainThread]: Command `dbt run` succeeded at 00:18:06.802445 after 12.07 seconds
[0m00:18:06.803278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c9df8d690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c92fe5d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c92c272b0>]}
[0m00:18:06.803883 [debug] [MainThread]: Flushing usage events
[0m01:46:14.761211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26145debf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2612362860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2612362f20>]}


============================== 01:46:14.764669 | 8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1 ==============================
[0m01:46:14.764669 [info ] [MainThread]: Running with dbt=1.7.3
[0m01:46:14.765441 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m01:46:15.537987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2609d80e50>]}
[0m01:46:15.679093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2609d614b0>]}
[0m01:46:15.680219 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m01:46:15.711122 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m01:46:15.788951 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m01:46:15.790099 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/_int__test.yml
[0m01:46:15.790806 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m01:46:16.149220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2609727f40>]}
[0m01:46:16.171330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26098e4fa0>]}
[0m01:46:16.172140 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m01:46:16.174868 [info ] [MainThread]: 
[0m01:46:16.176026 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:46:16.178414 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m01:46:16.198509 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:46:16.199356 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:46:16.199983 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:46:16.613638 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:46:16.616163 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:46:16.697878 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:46:16.698556 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:46:16.699116 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:16.996149 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:46:16.998368 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:46:17.051037 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:46:17.051838 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:46:17.052370 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:17.674306 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:46:17.676688 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:46:17.720354 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m01:46:17.733149 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m01:46:17.733829 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m01:46:17.734356 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:18.437324 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m01:46:18.439669 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m01:46:18.477310 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m01:46:18.482486 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m01:46:18.483121 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m01:46:18.483637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:18.797455 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m01:46:18.799817 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m01:46:18.845365 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m01:46:18.850608 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m01:46:18.851215 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m01:46:18.851741 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:19.203466 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m01:46:19.206056 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m01:46:19.253716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26098e42e0>]}
[0m01:46:19.254980 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:46:19.255571 [info ] [MainThread]: 
[0m01:46:19.258527 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m01:46:19.259326 [info ] [Thread-1 (]: 1 of 13 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m01:46:19.260367 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m01:46:19.260978 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m01:46:19.273836 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:46:19.274925 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 01:46:19.261404 => 01:46:19.274521
[0m01:46:19.275542 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m01:46:19.314109 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:46:19.316981 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m01:46:19.317687 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m01:46:19.318369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:19.859901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:46:19.890290 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 01:46:19.275938 => 01:46:19.889909
[0m01:46:19.891027 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m01:46:19.963724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b99d20>]}
[0m01:46:19.964839 [info ] [Thread-1 (]: 1 of 13 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.70s]
[0m01:46:19.965845 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m01:46:19.966578 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m01:46:19.967555 [info ] [Thread-1 (]: 2 of 13 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m01:46:19.968589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m01:46:19.969224 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m01:46:19.976051 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m01:46:19.977085 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 01:46:19.969633 => 01:46:19.976706
[0m01:46:19.977711 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m01:46:19.983098 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m01:46:19.985000 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m01:46:19.985677 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m01:46:19.986326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:20.441694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:20.445721 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 01:46:19.978102 => 01:46:20.445364
[0m01:46:20.446380 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m01:46:20.487733 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f260952e7a0>]}
[0m01:46:20.488790 [info ] [Thread-1 (]: 2 of 13 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.52s]
[0m01:46:20.489785 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m01:46:20.490495 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m01:46:20.491396 [info ] [Thread-1 (]: 3 of 13 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m01:46:20.492671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m01:46:20.493298 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m01:46:20.498500 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m01:46:20.499521 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 01:46:20.493691 => 01:46:20.499158
[0m01:46:20.500128 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m01:46:20.505325 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m01:46:20.506862 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m01:46:20.507507 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m01:46:20.508126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:20.995100 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:20.999214 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 01:46:20.500517 => 01:46:20.998846
[0m01:46:20.999893 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m01:46:21.050493 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b9abc0>]}
[0m01:46:21.051631 [info ] [Thread-1 (]: 3 of 13 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.56s]
[0m01:46:21.052628 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m01:46:21.053355 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m01:46:21.054221 [info ] [Thread-1 (]: 4 of 13 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m01:46:21.055290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m01:46:21.055935 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m01:46:21.061248 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:46:21.062306 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 01:46:21.056341 => 01:46:21.061920
[0m01:46:21.062959 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m01:46:21.068541 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:46:21.070137 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m01:46:21.070832 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m01:46:21.071475 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:21.545276 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:21.549343 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 01:46:21.063366 => 01:46:21.548970
[0m01:46:21.550004 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m01:46:21.603945 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b9abc0>]}
[0m01:46:21.605137 [info ] [Thread-1 (]: 4 of 13 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.55s]
[0m01:46:21.606500 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m01:46:21.607347 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m01:46:21.608242 [info ] [Thread-1 (]: 5 of 13 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m01:46:21.609521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m01:46:21.610351 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m01:46:21.617700 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m01:46:21.619247 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 01:46:21.610894 => 01:46:21.618868
[0m01:46:21.619959 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m01:46:21.627299 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m01:46:21.629013 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m01:46:21.629743 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m01:46:21.630446 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:22.112453 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:22.116427 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 01:46:21.620437 => 01:46:22.116067
[0m01:46:22.117065 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m01:46:22.165677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f260950f4c0>]}
[0m01:46:22.166786 [info ] [Thread-1 (]: 5 of 13 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.56s]
[0m01:46:22.167784 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m01:46:22.168501 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m01:46:22.169368 [info ] [Thread-1 (]: 6 of 13 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m01:46:22.170382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m01:46:22.171043 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m01:46:22.176486 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m01:46:22.177582 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 01:46:22.171434 => 01:46:22.177195
[0m01:46:22.178214 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m01:46:22.183715 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m01:46:22.185057 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m01:46:22.185716 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m01:46:22.186344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:22.599157 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:22.603227 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 01:46:22.178668 => 01:46:22.602867
[0m01:46:22.603892 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m01:46:22.657983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608bb40d0>]}
[0m01:46:22.659144 [info ] [Thread-1 (]: 6 of 13 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.49s]
[0m01:46:22.660150 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m01:46:22.660883 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m01:46:22.661741 [info ] [Thread-1 (]: 7 of 13 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m01:46:22.662848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m01:46:22.663483 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m01:46:22.670724 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m01:46:22.671780 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 01:46:22.663884 => 01:46:22.671400
[0m01:46:22.672409 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m01:46:22.677804 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m01:46:22.679069 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m01:46:22.679713 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m01:46:22.680353 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:23.094366 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:23.098529 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 01:46:22.672805 => 01:46:23.098156
[0m01:46:23.099241 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m01:46:23.371852 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2609d12440>]}
[0m01:46:23.372921 [info ] [Thread-1 (]: 7 of 13 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.71s]
[0m01:46:23.373881 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m01:46:23.374627 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m01:46:23.375461 [info ] [Thread-1 (]: 8 of 13 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m01:46:23.376470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m01:46:23.377081 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m01:46:23.382304 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m01:46:23.383345 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 01:46:23.377467 => 01:46:23.382975
[0m01:46:23.383946 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m01:46:23.389231 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m01:46:23.390453 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m01:46:23.391104 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m01:46:23.391704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:23.847015 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:23.850975 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 01:46:23.384327 => 01:46:23.850612
[0m01:46:23.851607 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m01:46:23.910663 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b58910>]}
[0m01:46:23.911734 [info ] [Thread-1 (]: 8 of 13 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.53s]
[0m01:46:23.912694 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m01:46:23.913414 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m01:46:23.914248 [info ] [Thread-1 (]: 9 of 13 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m01:46:23.915284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m01:46:23.915911 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m01:46:23.921261 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m01:46:23.922275 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 01:46:23.916313 => 01:46:23.921903
[0m01:46:23.922932 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m01:46:23.928217 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m01:46:23.930816 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m01:46:23.931511 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m01:46:23.932185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:24.365096 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:24.369153 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 01:46:23.923323 => 01:46:24.368781
[0m01:46:24.369816 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m01:46:24.417405 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b59630>]}
[0m01:46:24.418484 [info ] [Thread-1 (]: 9 of 13 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.50s]
[0m01:46:24.419532 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m01:46:24.420259 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m01:46:24.421219 [info ] [Thread-1 (]: 10 of 13 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m01:46:24.422373 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m01:46:24.423029 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m01:46:24.429176 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 01:46:24.423421 => 01:46:24.428782
[0m01:46:24.429798 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m01:46:24.493197 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:24.493974 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:46:24.494607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:24.749506 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:46:24.789990 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:24.791131 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m01:46:26.867269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:46:26.872471 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:26.873129 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:46:27.001688 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:46:27.010447 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.011136 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:46:27.053491 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:46:27.060707 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.061345 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:46:27.119688 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:46:27.127119 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.127794 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:46:27.197875 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:46:27.209879 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.210612 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:46:27.247767 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:46:27.260690 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m01:46:27.262749 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.263395 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m01:46:27.335599 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:27.336381 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.337077 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:46:27.882971 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:46:27.883829 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:46:27.884435 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m01:46:27.997019 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:28.003761 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 01:46:24.430190 => 01:46:28.003352
[0m01:46:28.004448 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m01:46:28.061509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b99cf0>]}
[0m01:46:28.062810 [info ] [Thread-1 (]: 10 of 13 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.64s]
[0m01:46:28.063812 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m01:46:28.064552 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m01:46:28.065413 [info ] [Thread-1 (]: 11 of 13 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m01:46:28.066628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m01:46:28.067274 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m01:46:28.081675 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m01:46:28.082795 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 01:46:28.067668 => 01:46:28.082364
[0m01:46:28.083414 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m01:46:28.130172 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:28.131212 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sold_date_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _surrograte_key,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
WHERE daily_agg.warehouse_sk IS NOT NULL
  );
[0m01:46:28.132055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:28.862215 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:46:28.867517 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:28.868194 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:46:28.924410 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:46:28.932589 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:28.933312 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m01:46:28.990641 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:46:29.099086 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:29.099872 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m01:46:29.167860 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:46:29.208198 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m01:46:29.210783 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:29.211408 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m01:46:29.299799 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:29.300597 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:29.301290 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m01:46:35.588452 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 6.0 seconds
[0m01:46:35.589315 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:35.589932 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m01:46:37.486062 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:46:37.499019 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:46:37.507536 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:46:37.508224 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m01:46:37.582509 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:37.586436 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 01:46:28.083811 => 01:46:37.586051
[0m01:46:37.587151 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m01:46:37.639291 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f260825eb90>]}
[0m01:46:37.640384 [info ] [Thread-1 (]: 11 of 13 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2310[0m in 9.57s]
[0m01:46:37.641377 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m01:46:37.642107 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m01:46:37.643090 [info ] [Thread-1 (]: 12 of 13 START sql incremental model analytics.customer_dim .................... [RUN]
[0m01:46:37.644259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m01:46:37.644887 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m01:46:37.652198 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m01:46:37.653215 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 01:46:37.645289 => 01:46:37.652847
[0m01:46:37.653858 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m01:46:37.664053 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:37.664819 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m01:46:37.665538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:38.374675 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:46:38.380091 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:38.380943 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m01:46:38.551060 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:46:38.559636 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:38.560352 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m01:46:38.608208 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:46:38.618009 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:38.618687 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m01:46:38.657253 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:46:38.666143 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m01:46:38.670192 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:38.670847 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m01:46:38.767245 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:38.768083 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:38.768917 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m01:46:43.162400 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m01:46:43.163282 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:43.163880 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m01:46:43.380326 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:43.386286 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m01:46:43.387878 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:46:43.388508 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m01:46:43.452297 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:43.456067 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 01:46:37.654251 => 01:46:43.455696
[0m01:46:43.456711 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m01:46:43.506655 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f260832d6f0>]}
[0m01:46:43.507723 [info ] [Thread-1 (]: 12 of 13 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 5.86s]
[0m01:46:43.508703 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m01:46:43.509420 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m01:46:43.510243 [info ] [Thread-1 (]: 13 of 13 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m01:46:43.511276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now model.capstone.weekly_sales_inventory)
[0m01:46:43.511887 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m01:46:43.519263 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m01:46:43.520322 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 01:46:43.512283 => 01:46:43.519909
[0m01:46:43.520950 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m01:46:43.530008 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:43.530850 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
-- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
-- inventory weekly table
-- step 1.
-- each warehouse and item's last day of recording to inventory table is different
-- find the last day of each week (eow) to derive inventory at eow
    eow_inventory_day AS
    (
        SELECT 
            INV_WAREHOUSE_SK,
            INV_ITEM_SK,
            YR_num,
            WK_num,
            MAX(INV_DATE_SK) AS eow_sk
        FROM tpcds.raw.inventory
        INNER JOIN tpcds.raw.date_dim
            ON inv_date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
-- inventory weekly table
-- step 1.            
-- aggregrate inventory data to weekly level, INV_QUANTITY_ON_HAND     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.INV_WAREHOUSE_SK AS INV_WAREHOUSE_SK,
            inv.INV_ITEM_SK AS INV_ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.inv_date_sk = eow.eow_sk 
                    THEN inv.INV_QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.raw.inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(INV_WAREHOUSE_SK,INV_ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

-- inventory weekly table
-- step 3. final weekly table, and join with weekly sales table
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        LEFT JOIN agg_wkly_inventory_stg AS inv
            ON inv.INV_WAREHOUSE_SK = sales.warehouse_sk
                AND inv.inv_item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m01:46:43.531659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:44.070959 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:46:44.076107 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:44.076776 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:46:44.129127 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:46:44.135673 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:44.136326 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m01:46:44.223902 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:46:44.230558 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:44.231314 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m01:46:44.317121 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:46:44.322932 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m01:46:44.325465 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:44.326104 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m01:46:44.404516 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:44.405306 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:44.406012 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m01:46:48.926883 [debug] [Thread-1 (]: SQL status: SUCCESS 8572 in 5.0 seconds
[0m01:46:48.927742 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:48.928356 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m01:46:49.196588 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:49.202320 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:46:49.205967 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:46:49.206615 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m01:46:49.269274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:46:49.273041 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 01:46:43.521334 => 01:46:49.272668
[0m01:46:49.273691 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m01:46:49.319277 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5af2fd-3682-4bd0-ac4a-ac81e9660bd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f260974a680>]}
[0m01:46:49.320387 [info ] [Thread-1 (]: 13 of 13 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 8572[0m in 5.81s]
[0m01:46:49.321405 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m01:46:49.323755 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:46:49.324301 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m01:46:49.324908 [info ] [MainThread]: 
[0m01:46:49.325487 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models in 0 hours 0 minutes and 33.15 seconds (33.15s).
[0m01:46:49.329400 [debug] [MainThread]: Command end result
[0m01:46:49.347815 [info ] [MainThread]: 
[0m01:46:49.348533 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:46:49.349107 [info ] [MainThread]: 
[0m01:46:49.349690 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m01:46:49.350932 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 34.658516, "process_user_time": 7.690438, "process_kernel_time": 0.289355, "process_mem_max_rss": "166632", "process_out_blocks": "5840", "process_in_blocks": "0"}
[0m01:46:49.351762 [debug] [MainThread]: Command `dbt build` succeeded at 01:46:49.351548 after 34.66 seconds
[0m01:46:49.352357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f26145debf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2608b707c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2609d614b0>]}
[0m01:46:49.352961 [debug] [MainThread]: Flushing usage events
[0m02:37:54.907659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41cb7f6c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c9853f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c9851150>]}


============================== 02:37:54.911050 | fdceaf80-6494-4a2e-9a4a-992995978f25 ==============================
[0m02:37:54.911050 [info ] [MainThread]: Running with dbt=1.7.3
[0m02:37:54.911796 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:37:55.686148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdceaf80-6494-4a2e-9a4a-992995978f25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c14a2ad0>]}
[0m02:37:55.826571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdceaf80-6494-4a2e-9a4a-992995978f25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c1252920>]}
[0m02:37:55.827746 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m02:37:55.859302 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m02:37:55.935917 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:37:55.936580 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:37:55.946429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdceaf80-6494-4a2e-9a4a-992995978f25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c0e0c0d0>]}
[0m02:37:55.969068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdceaf80-6494-4a2e-9a4a-992995978f25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c0dcc790>]}
[0m02:37:55.969866 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m02:37:55.970475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdceaf80-6494-4a2e-9a4a-992995978f25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c0dcc730>]}
[0m02:37:55.972647 [info ] [MainThread]: 
[0m02:37:55.973204 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m02:37:55.973975 [debug] [MainThread]: Command end result
[0m02:37:55.992244 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 1.1515763, "process_user_time": 3.878875, "process_kernel_time": 0.179961, "process_mem_max_rss": "154436", "process_out_blocks": "3568", "process_in_blocks": "0"}
[0m02:37:55.993204 [debug] [MainThread]: Command `dbt test` succeeded at 02:37:55.992989 after 1.15 seconds
[0m02:37:55.993809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41cb7f6c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c1252920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41c0dcc790>]}
[0m02:37:55.994422 [debug] [MainThread]: Flushing usage events
[0m02:38:14.436165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2560b0a500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f255ed48ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f255ed49d50>]}


============================== 02:38:14.439612 | dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf ==============================
[0m02:38:14.439612 [info ] [MainThread]: Running with dbt=1.7.3
[0m02:38:14.440374 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m02:38:15.199762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25569a3790>]}
[0m02:38:15.338195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25567513c0>]}
[0m02:38:15.339340 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m02:38:15.369443 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m02:38:15.446373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:38:15.447458 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/_int__test.yml
[0m02:38:15.796041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25561019f0>]}
[0m02:38:15.818770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25562d0760>]}
[0m02:38:15.819620 [info ] [MainThread]: Found 12 models, 1 snapshot, 2 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m02:38:15.820258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25562d0790>]}
[0m02:38:15.822840 [info ] [MainThread]: 
[0m02:38:15.824030 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:38:15.826412 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_analytics'
[0m02:38:15.848836 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m02:38:15.849533 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m02:38:15.850078 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:16.424349 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m02:38:16.426803 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m02:38:16.608287 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m02:38:16.613937 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m02:38:16.614555 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m02:38:16.615113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:38:17.282555 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m02:38:17.285130 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m02:38:20.359122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m02:38:20.367485 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m02:38:20.368067 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m02:38:20.368576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:38:20.708220 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m02:38:20.710798 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m02:38:20.776902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd2ee906-0b6a-4a2b-b2c4-2b7ef11272bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25562c7730>]}
[0m02:38:20.778207 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:38:20.778842 [info ] [MainThread]: 
[0m02:38:20.781629 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m02:38:20.782316 [info ] [Thread-1 (]: 1 of 2 START test not_null_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m02:38:20.783389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m02:38:20.784021 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m02:38:20.809405 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m02:38:20.810624 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 02:38:20.784432 => 02:38:20.810203
[0m02:38:20.811300 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m02:38:20.841474 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m02:38:20.843031 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m02:38:20.843680 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m02:38:20.844320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:38:21.853058 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:38:21.862379 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 02:38:20.811706 => 02:38:21.861960
[0m02:38:21.863072 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m02:38:21.926426 [error] [Thread-1 (]: 1 of 2 FAIL 515 not_null_int__daily_aggregated_sales_warehouse_sk .............. [[31mFAIL 515[0m in 1.14s]
[0m02:38:21.927614 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m02:38:21.928352 [debug] [Thread-1 (]: Began running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m02:38:21.929142 [info ] [Thread-1 (]: 2 of 2 START test unique_int__daily_aggregated_sales_warehouse_sk .............. [RUN]
[0m02:38:21.930229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2)
[0m02:38:21.930875 [debug] [Thread-1 (]: Began compiling node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m02:38:21.941187 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m02:38:21.942160 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (compile): 02:38:21.931274 => 02:38:21.941793
[0m02:38:21.942835 [debug] [Thread-1 (]: Began executing node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m02:38:21.947438 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m02:38:21.948779 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m02:38:21.949432 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    warehouse_sk as unique_field,
    count(*) as n_records

from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is not null
group by warehouse_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m02:38:21.950062 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:38:22.672542 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:38:22.675679 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (execute): 02:38:21.943227 => 02:38:22.675287
[0m02:38:22.676334 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: Close
[0m02:38:22.732832 [error] [Thread-1 (]: 2 of 2 FAIL 5 unique_int__daily_aggregated_sales_warehouse_sk .................. [[31mFAIL 5[0m in 0.80s]
[0m02:38:22.733966 [debug] [Thread-1 (]: Finished running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m02:38:22.736359 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:38:22.736924 [debug] [MainThread]: Connection 'test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2' was properly closed.
[0m02:38:22.737483 [info ] [MainThread]: 
[0m02:38:22.738072 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 6.91 seconds (6.91s).
[0m02:38:22.739379 [debug] [MainThread]: Command end result
[0m02:38:22.759584 [info ] [MainThread]: 
[0m02:38:22.760337 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m02:38:22.760900 [info ] [MainThread]: 
[0m02:38:22.761504 [error] [MainThread]: [31mFailure in test not_null_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m02:38:22.762077 [error] [MainThread]:   Got 515 results, configured to fail if != 0
[0m02:38:22.762660 [info ] [MainThread]: 
[0m02:38:22.763228 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/not_null_int__daily_aggregated_sales_warehouse_sk.sql
[0m02:38:22.763808 [info ] [MainThread]: 
[0m02:38:22.764386 [error] [MainThread]: [31mFailure in test unique_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m02:38:22.764939 [error] [MainThread]:   Got 5 results, configured to fail if != 0
[0m02:38:22.765508 [info ] [MainThread]: 
[0m02:38:22.766061 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/unique_int__daily_aggregated_sales_warehouse_sk.sql
[0m02:38:22.766670 [info ] [MainThread]: 
[0m02:38:22.767286 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m02:38:22.768542 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 8.400183, "process_user_time": 4.963083, "process_kernel_time": 0.268387, "process_mem_max_rss": "164308", "process_out_blocks": "5464", "command_success": false, "process_in_blocks": "0"}
[0m02:38:22.769393 [debug] [MainThread]: Command `dbt test` failed at 02:38:22.769175 after 8.40 seconds
[0m02:38:22.770034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2560b0a500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25567513c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f25562d0610>]}
[0m02:38:22.770702 [debug] [MainThread]: Flushing usage events
[0m03:04:04.714581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1176a0ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1174cb8190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1174cbb3d0>]}


============================== 03:04:04.718074 | 77abc0ff-2761-4211-9750-9d98bc0e15df ==============================
[0m03:04:04.718074 [info ] [MainThread]: Running with dbt=1.7.3
[0m03:04:04.718868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m03:04:05.495041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c6f1360>]}
[0m03:04:05.634554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c923280>]}
[0m03:04:05.635739 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m03:04:05.667027 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m03:04:05.747658 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:04:05.748747 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m03:04:06.311103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116be54be0>]}
[0m03:04:06.333939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c2511e0>]}
[0m03:04:06.334806 [info ] [MainThread]: Found 12 models, 1 snapshot, 2 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m03:04:06.337749 [info ] [MainThread]: 
[0m03:04:06.339004 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:04:06.341415 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m03:04:06.361899 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:04:06.362639 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:04:06.363188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:04:07.398715 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m03:04:07.401076 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:04:07.528154 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:04:07.529083 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:04:07.529640 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:04:08.037750 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m03:04:08.040098 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:04:08.102193 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:04:08.102923 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:04:08.103452 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:04:08.626910 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m03:04:08.629221 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:04:08.807086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m03:04:08.819750 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m03:04:08.820401 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m03:04:08.820922 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:04:10.641276 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 2.0 seconds
[0m03:04:10.643681 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m03:04:10.717134 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m03:04:10.722376 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m03:04:10.723008 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m03:04:10.723540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:04:11.439933 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m03:04:11.442559 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m03:04:11.515529 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m03:04:11.524343 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m03:04:11.524963 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m03:04:11.525494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:04:14.999650 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 3.0 seconds
[0m03:04:15.002019 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m03:04:15.059796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c250070>]}
[0m03:04:15.061068 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:04:15.061678 [info ] [MainThread]: 
[0m03:04:15.064741 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m03:04:15.065562 [info ] [Thread-1 (]: 1 of 15 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m03:04:15.066654 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m03:04:15.067308 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m03:04:15.080423 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:04:15.081731 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 03:04:15.067806 => 03:04:15.081327
[0m03:04:15.082362 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m03:04:15.122006 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:04:15.124915 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m03:04:15.125625 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m03:04:15.126321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:15.815412 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:15.848411 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 03:04:15.082796 => 03:04:15.848020
[0m03:04:15.849147 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m03:04:15.899915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116be25150>]}
[0m03:04:15.901018 [info ] [Thread-1 (]: 1 of 15 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.83s]
[0m03:04:15.902028 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m03:04:15.902782 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m03:04:15.903750 [info ] [Thread-1 (]: 2 of 15 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m03:04:15.904819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m03:04:15.905441 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m03:04:15.910924 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m03:04:15.912007 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 03:04:15.905843 => 03:04:15.911630
[0m03:04:15.912641 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m03:04:15.918394 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m03:04:15.920454 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m03:04:15.921122 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m03:04:15.921785 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:16.741162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:16.745178 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 03:04:15.913041 => 03:04:16.744816
[0m03:04:16.745837 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m03:04:16.972302 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116bc0eb30>]}
[0m03:04:16.973401 [info ] [Thread-1 (]: 2 of 15 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 1.07s]
[0m03:04:16.974391 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m03:04:16.975157 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m03:04:16.976037 [info ] [Thread-1 (]: 3 of 15 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m03:04:16.977368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m03:04:16.978003 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m03:04:16.983493 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m03:04:16.984554 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 03:04:16.978401 => 03:04:16.984169
[0m03:04:16.985179 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m03:04:16.992552 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m03:04:16.994238 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m03:04:16.994918 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m03:04:16.995582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:17.933747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:17.937784 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 03:04:16.985585 => 03:04:17.937415
[0m03:04:17.938444 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m03:04:18.035136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1169b12350>]}
[0m03:04:18.036255 [info ] [Thread-1 (]: 3 of 15 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 1.06s]
[0m03:04:18.037274 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m03:04:18.038019 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m03:04:18.038920 [info ] [Thread-1 (]: 4 of 15 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m03:04:18.040004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m03:04:18.040650 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m03:04:18.046339 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:04:18.047458 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 03:04:18.041067 => 03:04:18.047065
[0m03:04:18.048111 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m03:04:18.053706 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:04:18.055345 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m03:04:18.056022 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m03:04:18.056701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:18.778114 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:18.782257 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 03:04:18.048528 => 03:04:18.781867
[0m03:04:18.783032 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m03:04:18.897596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1169b118a0>]}
[0m03:04:18.898770 [info ] [Thread-1 (]: 4 of 15 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.86s]
[0m03:04:18.899830 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m03:04:18.900590 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m03:04:18.901596 [info ] [Thread-1 (]: 5 of 15 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m03:04:18.902829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m03:04:18.903487 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m03:04:18.908917 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m03:04:18.910010 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 03:04:18.903902 => 03:04:18.909619
[0m03:04:18.910681 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m03:04:18.918099 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m03:04:18.919589 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m03:04:18.920254 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m03:04:18.920898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:19.505381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:19.509468 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 03:04:18.911107 => 03:04:19.509099
[0m03:04:19.510141 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m03:04:19.559456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c24b9d0>]}
[0m03:04:19.560546 [info ] [Thread-1 (]: 5 of 15 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.66s]
[0m03:04:19.561543 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m03:04:19.562283 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m03:04:19.563172 [info ] [Thread-1 (]: 6 of 15 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m03:04:19.564232 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m03:04:19.564868 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m03:04:19.570690 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m03:04:19.571791 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 03:04:19.565272 => 03:04:19.571409
[0m03:04:19.572417 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m03:04:19.577983 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m03:04:19.579372 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m03:04:19.580023 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m03:04:19.580662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:20.198246 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:20.202305 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 03:04:19.572811 => 03:04:20.201938
[0m03:04:20.202990 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m03:04:20.293309 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c24b8e0>]}
[0m03:04:20.294412 [info ] [Thread-1 (]: 6 of 15 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.73s]
[0m03:04:20.295453 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m03:04:20.296190 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m03:04:20.297077 [info ] [Thread-1 (]: 7 of 15 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m03:04:20.298192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m03:04:20.298851 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m03:04:20.305880 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m03:04:20.307008 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 03:04:20.299260 => 03:04:20.306582
[0m03:04:20.307946 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m03:04:20.313418 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m03:04:20.314697 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m03:04:20.315335 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m03:04:20.315970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:21.012494 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:21.016765 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 03:04:20.308350 => 03:04:21.016386
[0m03:04:21.017468 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m03:04:21.084834 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116bd48610>]}
[0m03:04:21.086055 [info ] [Thread-1 (]: 7 of 15 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.79s]
[0m03:04:21.087461 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m03:04:21.088228 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m03:04:21.089127 [info ] [Thread-1 (]: 8 of 15 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m03:04:21.090194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m03:04:21.090996 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m03:04:21.096496 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m03:04:21.097731 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 03:04:21.091407 => 03:04:21.097346
[0m03:04:21.098388 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m03:04:21.104132 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m03:04:21.105690 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m03:04:21.106341 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m03:04:21.106994 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:21.744997 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:21.749139 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 03:04:21.098814 => 03:04:21.748771
[0m03:04:21.749826 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m03:04:21.860677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1169b66fb0>]}
[0m03:04:21.861780 [info ] [Thread-1 (]: 8 of 15 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.77s]
[0m03:04:21.862815 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m03:04:21.863560 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m03:04:21.864430 [info ] [Thread-1 (]: 9 of 15 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m03:04:21.865489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m03:04:21.866130 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m03:04:21.871813 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m03:04:21.872899 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 03:04:21.866531 => 03:04:21.872496
[0m03:04:21.873578 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m03:04:21.879382 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m03:04:21.882118 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m03:04:21.882891 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m03:04:21.883632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:22.697113 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:22.701304 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 03:04:21.874004 => 03:04:22.700919
[0m03:04:22.702028 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m03:04:22.760325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1169b645b0>]}
[0m03:04:22.761456 [info ] [Thread-1 (]: 9 of 15 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.90s]
[0m03:04:22.762497 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m03:04:22.763281 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m03:04:22.764204 [info ] [Thread-1 (]: 10 of 15 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m03:04:22.765446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m03:04:22.766102 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m03:04:22.772817 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 03:04:22.766528 => 03:04:22.772389
[0m03:04:22.773495 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m03:04:22.837687 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:22.838525 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:04:22.839212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:23.250305 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:04:23.290371 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:23.291433 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:04:25.352155 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:04:25.357516 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:25.358267 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:04:25.435706 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:04:25.553340 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:25.554152 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:04:31.534476 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 6.0 seconds
[0m03:04:31.541687 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:31.542397 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:04:31.669810 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:04:31.677009 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:31.677706 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:04:31.838468 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:04:31.850285 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:31.851024 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:04:31.931016 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:04:31.944426 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m03:04:31.949058 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:31.949767 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m03:04:32.136285 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:04:32.137092 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:32.137797 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:04:32.869878 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m03:04:32.870806 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:04:32.871449 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m03:04:33.156843 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:04:33.163629 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 03:04:22.773909 => 03:04:33.163250
[0m03:04:33.164308 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m03:04:33.231195 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116bd67b50>]}
[0m03:04:33.232498 [info ] [Thread-1 (]: 10 of 15 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 10.47s]
[0m03:04:33.233532 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m03:04:33.234300 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m03:04:33.235385 [info ] [Thread-1 (]: 11 of 15 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m03:04:33.236489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m03:04:33.237128 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m03:04:33.250230 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m03:04:33.251438 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 03:04:33.237533 => 03:04:33.251034
[0m03:04:33.252117 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m03:04:33.297199 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m03:04:33.301537 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:04:33.302380 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sold_date_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as _surrograte_key,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m03:04:33.303233 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:41.328671 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 8.0 seconds
[0m03:04:41.343030 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m03:04:41.351631 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:04:41.352325 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m03:04:41.543093 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:04:41.547208 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 03:04:33.252528 => 03:04:41.546824
[0m03:04:41.547903 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m03:04:41.602032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1169b1fb20>]}
[0m03:04:41.603193 [info ] [Thread-1 (]: 11 of 15 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 8.37s]
[0m03:04:41.604228 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m03:04:41.604989 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m03:04:41.605885 [info ] [Thread-1 (]: 12 of 15 START sql incremental model analytics.customer_dim .................... [RUN]
[0m03:04:41.607281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m03:04:41.607936 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m03:04:41.615609 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m03:04:41.616693 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 03:04:41.608355 => 03:04:41.616301
[0m03:04:41.617322 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m03:04:41.623651 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m03:04:41.627403 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:04:41.628180 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m03:04:41.628951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:45.271994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m03:04:45.277903 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m03:04:45.279465 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:04:45.280089 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m03:04:45.319133 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:04:45.323509 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 03:04:41.617746 => 03:04:45.323129
[0m03:04:45.324216 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m03:04:45.607669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77abc0ff-2761-4211-9750-9d98bc0e15df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116bfd7670>]}
[0m03:04:45.608808 [info ] [Thread-1 (]: 12 of 15 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 4.00s]
[0m03:04:45.609857 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m03:04:45.610665 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:04:45.611532 [info ] [Thread-1 (]: 13 of 15 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m03:04:45.612696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m03:04:45.613356 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:04:45.634135 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:04:45.635398 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 03:04:45.613779 => 03:04:45.634996
[0m03:04:45.636062 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:04:45.660813 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:04:45.662348 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:04:45.663060 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m03:04:45.663720 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:46.256003 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:46.260064 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 03:04:45.636486 => 03:04:46.259634
[0m03:04:46.260805 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m03:04:46.348893 [info ] [Thread-1 (]: 13 of 15 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.74s]
[0m03:04:46.350072 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:04:46.350860 [debug] [Thread-1 (]: Began running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:04:46.351670 [info ] [Thread-1 (]: 14 of 15 START test unique_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m03:04:46.352734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2)
[0m03:04:46.353388 [debug] [Thread-1 (]: Began compiling node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:04:46.364261 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:04:46.365419 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (compile): 03:04:46.353802 => 03:04:46.365000
[0m03:04:46.366090 [debug] [Thread-1 (]: Began executing node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:04:46.373134 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:04:46.374695 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:04:46.375392 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    warehouse_sk as unique_field,
    count(*) as n_records

from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is not null
group by warehouse_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m03:04:46.376069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:47.086500 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:04:47.089638 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (execute): 03:04:46.366520 => 03:04:47.089240
[0m03:04:47.090321 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: Close
[0m03:04:47.139720 [error] [Thread-1 (]: 14 of 15 FAIL 5 unique_int__daily_aggregated_sales_warehouse_sk ................ [[31mFAIL 5[0m in 0.79s]
[0m03:04:47.140872 [debug] [Thread-1 (]: Finished running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:04:47.142336 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m03:04:47.143129 [info ] [Thread-1 (]: 15 of 15 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m03:04:47.143907 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m03:04:47.146228 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:04:47.146788 [debug] [MainThread]: Connection 'test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2' was properly closed.
[0m03:04:47.147442 [info ] [MainThread]: 
[0m03:04:47.148047 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 2 tests in 0 hours 0 minutes and 40.81 seconds (40.81s).
[0m03:04:47.152099 [debug] [MainThread]: Command end result
[0m03:04:47.170827 [info ] [MainThread]: 
[0m03:04:47.171567 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m03:04:47.172145 [info ] [MainThread]: 
[0m03:04:47.172740 [error] [MainThread]: [31mFailure in test unique_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m03:04:47.173322 [error] [MainThread]:   Got 5 results, configured to fail if != 0
[0m03:04:47.173886 [info ] [MainThread]: 
[0m03:04:47.174456 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/unique_int__daily_aggregated_sales_warehouse_sk.sql
[0m03:04:47.175081 [info ] [MainThread]: 
[0m03:04:47.175702 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m03:04:47.176998 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 42.530605, "process_user_time": 7.95982, "process_kernel_time": 0.244547, "process_mem_max_rss": "167864", "process_out_blocks": "5832", "command_success": false, "process_in_blocks": "0"}
[0m03:04:47.177849 [debug] [MainThread]: Command `dbt build` failed at 03:04:47.177629 after 42.53 seconds
[0m03:04:47.178473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1176a0ac80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c187df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f116c185000>]}
[0m03:04:47.179132 [debug] [MainThread]: Flushing usage events
[0m03:39:43.955424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb8250aaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb80738c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb8073b250>]}


============================== 03:39:43.958967 | 4df02ee8-a17d-4433-bc45-64376a5a38b1 ==============================
[0m03:39:43.958967 [info ] [MainThread]: Running with dbt=1.7.3
[0m03:39:43.959813 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt build --full-refresh', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:39:44.730563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb8073a740>]}
[0m03:39:44.872564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb78150c70>]}
[0m03:39:44.873713 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m03:39:44.904605 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m03:39:44.981089 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:39:44.982165 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m03:39:45.531903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb778d0c40>]}
[0m03:39:45.553376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb77cd1270>]}
[0m03:39:45.554191 [info ] [MainThread]: Found 12 models, 1 snapshot, 2 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m03:39:45.556964 [info ] [MainThread]: 
[0m03:39:45.558073 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:39:45.560419 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m03:39:45.580245 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:39:45.581076 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:39:45.581792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:39:45.975742 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:39:45.978054 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:39:46.037129 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:39:46.037917 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:39:46.038441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:46.473209 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:39:46.475547 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:39:46.536276 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:39:46.536981 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:39:46.537519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:46.910790 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:39:46.913086 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:39:46.966084 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m03:39:46.979111 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m03:39:46.979758 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m03:39:46.980294 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:47.335100 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m03:39:47.337441 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m03:39:47.386007 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m03:39:47.391216 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m03:39:47.391779 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m03:39:47.392293 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:47.697103 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m03:39:47.699480 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m03:39:47.764168 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m03:39:47.770677 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m03:39:47.771341 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m03:39:47.771972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:48.099727 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m03:39:48.102296 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m03:39:48.147463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb77cd0370>]}
[0m03:39:48.148873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:39:48.149563 [info ] [MainThread]: 
[0m03:39:48.152561 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m03:39:48.153337 [info ] [Thread-1 (]: 1 of 15 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m03:39:48.154376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m03:39:48.155123 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m03:39:48.168291 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:39:48.169862 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 03:39:48.155830 => 03:39:48.169467
[0m03:39:48.170633 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m03:39:48.209756 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:39:48.213096 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m03:39:48.213896 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m03:39:48.214716 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:48.736341 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:39:48.769662 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 03:39:48.171130 => 03:39:48.769254
[0m03:39:48.770577 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m03:39:48.810850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777cb190>]}
[0m03:39:48.811886 [info ] [Thread-1 (]: 1 of 15 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.66s]
[0m03:39:48.812862 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m03:39:48.813573 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m03:39:48.814406 [info ] [Thread-1 (]: 2 of 15 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m03:39:48.815445 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m03:39:48.816064 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m03:39:48.821200 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m03:39:48.822208 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 03:39:48.816453 => 03:39:48.821833
[0m03:39:48.822880 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m03:39:48.828162 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m03:39:48.830085 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m03:39:48.830771 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m03:39:48.831414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:49.257411 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:49.261498 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 03:39:48.823270 => 03:39:49.261135
[0m03:39:49.262150 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m03:39:49.306672 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777ca6b0>]}
[0m03:39:49.307747 [info ] [Thread-1 (]: 2 of 15 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.49s]
[0m03:39:49.308722 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m03:39:49.309426 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m03:39:49.310409 [info ] [Thread-1 (]: 3 of 15 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m03:39:49.311514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m03:39:49.312130 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m03:39:49.317518 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m03:39:49.318519 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 03:39:49.312538 => 03:39:49.318141
[0m03:39:49.319196 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m03:39:49.326272 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m03:39:49.327887 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m03:39:49.328554 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m03:39:49.329199 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:49.750934 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:49.754884 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 03:39:49.319581 => 03:39:49.754500
[0m03:39:49.755528 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m03:39:49.797499 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777e2560>]}
[0m03:39:49.798557 [info ] [Thread-1 (]: 3 of 15 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.49s]
[0m03:39:49.799563 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m03:39:49.800271 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m03:39:49.801099 [info ] [Thread-1 (]: 4 of 15 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m03:39:49.802111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m03:39:49.802750 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m03:39:49.808128 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:39:49.809151 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 03:39:49.803148 => 03:39:49.808777
[0m03:39:49.809780 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m03:39:49.815151 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:39:49.816687 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m03:39:49.817337 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m03:39:49.817970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:50.220220 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:50.224255 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 03:39:49.810173 => 03:39:50.223899
[0m03:39:50.224904 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m03:39:50.271300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb75596260>]}
[0m03:39:50.272388 [info ] [Thread-1 (]: 4 of 15 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.47s]
[0m03:39:50.273384 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m03:39:50.274096 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m03:39:50.274952 [info ] [Thread-1 (]: 5 of 15 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m03:39:50.275996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m03:39:50.276611 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m03:39:50.281941 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m03:39:50.283042 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 03:39:50.277007 => 03:39:50.282667
[0m03:39:50.283684 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m03:39:50.291293 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m03:39:50.292716 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m03:39:50.293369 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m03:39:50.294010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:50.684826 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:50.688864 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 03:39:50.284085 => 03:39:50.688495
[0m03:39:50.689499 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m03:39:50.734505 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb77896050>]}
[0m03:39:50.735622 [info ] [Thread-1 (]: 5 of 15 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.46s]
[0m03:39:50.736600 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m03:39:50.737319 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m03:39:50.738179 [info ] [Thread-1 (]: 6 of 15 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m03:39:50.739231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m03:39:50.739859 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m03:39:50.745436 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m03:39:50.746568 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 03:39:50.740253 => 03:39:50.746173
[0m03:39:50.747278 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m03:39:50.752817 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m03:39:50.754194 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m03:39:50.754886 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m03:39:50.755527 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:51.322910 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:39:51.327169 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 03:39:50.747693 => 03:39:51.326786
[0m03:39:51.327946 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m03:39:51.365730 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777c9ba0>]}
[0m03:39:51.366971 [info ] [Thread-1 (]: 6 of 15 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.63s]
[0m03:39:51.368041 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m03:39:51.368872 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m03:39:51.369810 [info ] [Thread-1 (]: 7 of 15 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m03:39:51.371002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m03:39:51.371728 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m03:39:51.378573 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m03:39:51.380062 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 03:39:51.372215 => 03:39:51.379655
[0m03:39:51.380819 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m03:39:51.386351 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m03:39:51.388072 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m03:39:51.388827 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m03:39:51.389550 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:51.806515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:51.810806 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 03:39:51.381333 => 03:39:51.810415
[0m03:39:51.811583 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m03:39:51.858930 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb7769a500>]}
[0m03:39:51.860147 [info ] [Thread-1 (]: 7 of 15 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.49s]
[0m03:39:51.861249 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m03:39:51.862087 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m03:39:51.863106 [info ] [Thread-1 (]: 8 of 15 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m03:39:51.864258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m03:39:51.864997 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m03:39:51.870372 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m03:39:51.871857 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 03:39:51.865500 => 03:39:51.871463
[0m03:39:51.872598 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m03:39:51.878341 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m03:39:51.880043 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m03:39:51.880783 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m03:39:51.881512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:52.268726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:52.272872 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 03:39:51.873101 => 03:39:52.272503
[0m03:39:52.273651 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m03:39:52.321715 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777c98d0>]}
[0m03:39:52.322953 [info ] [Thread-1 (]: 8 of 15 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.46s]
[0m03:39:52.324021 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m03:39:52.324828 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m03:39:52.325641 [info ] [Thread-1 (]: 9 of 15 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m03:39:52.326784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m03:39:52.327497 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m03:39:52.333122 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m03:39:52.334618 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 03:39:52.327989 => 03:39:52.334198
[0m03:39:52.335382 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m03:39:52.341063 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m03:39:52.344166 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m03:39:52.344995 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m03:39:52.345811 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:52.747951 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:52.752015 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 03:39:52.335884 => 03:39:52.751646
[0m03:39:52.752755 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m03:39:52.790915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb777c9f00>]}
[0m03:39:52.792018 [info ] [Thread-1 (]: 9 of 15 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.46s]
[0m03:39:52.793020 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m03:39:52.793777 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m03:39:52.794694 [info ] [Thread-1 (]: 10 of 15 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m03:39:52.795943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m03:39:52.796577 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m03:39:52.802998 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 03:39:52.796981 => 03:39:52.802565
[0m03:39:52.803644 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m03:39:52.867098 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:52.867918 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:39:52.868561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:53.149169 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:39:53.188368 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:53.189290 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:39:54.537967 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:39:54.543653 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:54.544475 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:39:54.744677 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:39:54.849671 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:54.850459 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:39:54.894360 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:39:54.901414 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:54.902068 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:39:54.945210 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:39:54.952309 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:54.952969 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:39:55.008751 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:39:55.020905 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:55.021633 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:39:55.085568 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:39:55.098260 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m03:39:55.102438 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:55.103238 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m03:39:55.193099 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:55.193915 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:55.194644 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:39:55.482969 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m03:39:55.483844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:39:55.484465 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m03:39:55.672727 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:55.679365 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 03:39:52.804049 => 03:39:55.679001
[0m03:39:55.680015 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m03:39:55.733077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb75602ad0>]}
[0m03:39:55.734336 [info ] [Thread-1 (]: 10 of 15 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.94s]
[0m03:39:55.735344 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m03:39:55.736079 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m03:39:55.736963 [info ] [Thread-1 (]: 11 of 15 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m03:39:55.738149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m03:39:55.738956 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m03:39:55.751318 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m03:39:55.752408 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 03:39:55.739361 => 03:39:55.752031
[0m03:39:55.753019 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m03:39:55.795873 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m03:39:55.800025 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:39:55.800845 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.raw.date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m03:39:55.801663 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:59.711340 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m03:39:59.725986 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m03:39:59.734548 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:39:59.735253 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m03:39:59.779587 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:39:59.783819 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 03:39:55.753419 => 03:39:59.783425
[0m03:39:59.784509 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m03:39:59.831592 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb77c05120>]}
[0m03:39:59.832710 [info ] [Thread-1 (]: 11 of 15 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 4.09s]
[0m03:39:59.833728 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m03:39:59.834498 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m03:39:59.835657 [info ] [Thread-1 (]: 12 of 15 START sql incremental model analytics.customer_dim .................... [RUN]
[0m03:39:59.836976 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m03:39:59.837726 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m03:39:59.845673 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m03:39:59.847184 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 03:39:59.838242 => 03:39:59.846784
[0m03:39:59.847943 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m03:39:59.854191 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m03:39:59.858210 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:39:59.859074 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, but not enable below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m03:39:59.859929 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:40:05.243179 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m03:40:05.249296 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m03:40:05.250912 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:40:05.251576 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m03:40:05.286540 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:40:05.291000 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 03:39:59.848457 => 03:40:05.290629
[0m03:40:05.291676 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m03:40:05.350380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4df02ee8-a17d-4433-bc45-64376a5a38b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb75568820>]}
[0m03:40:05.351496 [info ] [Thread-1 (]: 12 of 15 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 5.51s]
[0m03:40:05.352499 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m03:40:05.353244 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:40:05.354018 [info ] [Thread-1 (]: 13 of 15 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m03:40:05.355095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m03:40:05.355725 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:40:05.375391 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:40:05.376509 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 03:40:05.356132 => 03:40:05.376134
[0m03:40:05.377149 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:40:05.400748 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:40:05.402257 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m03:40:05.402923 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m03:40:05.403563 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:40:05.759411 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:40:05.763297 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 03:40:05.377554 => 03:40:05.762905
[0m03:40:05.763965 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m03:40:05.811334 [info ] [Thread-1 (]: 13 of 15 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.46s]
[0m03:40:05.812610 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:40:05.813345 [debug] [Thread-1 (]: Began running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:40:05.814119 [info ] [Thread-1 (]: 14 of 15 START test unique_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m03:40:05.815166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2)
[0m03:40:05.815795 [debug] [Thread-1 (]: Began compiling node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:40:05.825962 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:40:05.828112 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (compile): 03:40:05.816188 => 03:40:05.827715
[0m03:40:05.828966 [debug] [Thread-1 (]: Began executing node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:40:05.834064 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:40:05.836514 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"
[0m03:40:05.837358 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    warehouse_sk as unique_field,
    count(*) as n_records

from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is not null
group by warehouse_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m03:40:05.838191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:40:06.211321 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:40:06.214495 [debug] [Thread-1 (]: Timing info for test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2 (execute): 03:40:05.829559 => 03:40:06.214094
[0m03:40:06.215182 [debug] [Thread-1 (]: On test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2: Close
[0m03:40:06.264335 [error] [Thread-1 (]: 14 of 15 FAIL 5 unique_int__daily_aggregated_sales_warehouse_sk ................ [[31mFAIL 5[0m in 0.45s]
[0m03:40:06.265546 [debug] [Thread-1 (]: Finished running node test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2
[0m03:40:06.267022 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m03:40:06.267852 [info ] [Thread-1 (]: 15 of 15 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m03:40:06.268691 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m03:40:06.271078 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:40:06.271641 [debug] [MainThread]: Connection 'test.capstone.unique_int__daily_aggregated_sales_warehouse_sk.bbbebbfbd2' was properly closed.
[0m03:40:06.272475 [info ] [MainThread]: 
[0m03:40:06.273102 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 2 tests in 0 hours 0 minutes and 20.71 seconds (20.71s).
[0m03:40:06.277167 [debug] [MainThread]: Command end result
[0m03:40:06.296614 [info ] [MainThread]: 
[0m03:40:06.297362 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m03:40:06.297934 [info ] [MainThread]: 
[0m03:40:06.298542 [error] [MainThread]: [31mFailure in test unique_int__daily_aggregated_sales_warehouse_sk (models/intermediate/_int__test.yml)[0m
[0m03:40:06.299141 [error] [MainThread]:   Got 5 results, configured to fail if != 0
[0m03:40:06.299697 [info ] [MainThread]: 
[0m03:40:06.300251 [info ] [MainThread]:   compiled Code at target/compiled/capstone/models/intermediate/_int__test.yml/unique_int__daily_aggregated_sales_warehouse_sk.sql
[0m03:40:06.300850 [info ] [MainThread]: 
[0m03:40:06.301448 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m03:40:06.302769 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 22.41549, "process_user_time": 7.808093, "process_kernel_time": 0.30512, "process_mem_max_rss": "168144", "process_out_blocks": "5824", "command_success": false, "process_in_blocks": "0"}
[0m03:40:06.303648 [debug] [MainThread]: Command `dbt build` failed at 03:40:06.303422 after 22.42 seconds
[0m03:40:06.304284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb8250aaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb77ab5b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb78150c70>]}
[0m03:40:06.304928 [debug] [MainThread]: Flushing usage events
[0m06:08:19.257800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2817dec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa27f576950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa27f5771c0>]}


============================== 06:08:19.265092 | 673f68b0-e951-4630-a929-5b36838c0314 ==============================
[0m06:08:19.265092 [info ] [MainThread]: Running with dbt=1.7.3
[0m06:08:19.265872 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt build --full-refresh', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:08:21.354092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2771cb1c0>]}
[0m06:08:21.493875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276f7a560>]}
[0m06:08:21.495703 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m06:08:21.532026 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m06:08:21.816897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m06:08:21.818230 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/_int__test.yml
[0m06:08:21.818964 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/weekly_sales_inventory.sql
[0m06:08:21.819666 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m06:08:21.820282 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m06:08:22.445804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2762f0ca0>]}
[0m06:08:22.468461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276ae50f0>]}
[0m06:08:22.469193 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m06:08:22.472059 [info ] [MainThread]: 
[0m06:08:22.473213 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:08:22.475622 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m06:08:22.495237 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:08:22.495890 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:08:22.496445 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:08:23.374228 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m06:08:23.376894 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:08:23.964581 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:08:23.965310 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:08:23.965832 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:08:24.349002 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:08:24.351469 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:08:24.401261 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:08:24.401977 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:08:24.402535 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:08:24.745542 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:08:24.748017 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:08:24.815832 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_analytics'
[0m06:08:24.828818 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m06:08:24.829433 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m06:08:24.829948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:08:25.165944 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m06:08:25.168591 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m06:08:25.205737 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m06:08:25.213011 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m06:08:25.213589 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m06:08:25.214170 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:08:25.538383 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m06:08:25.541188 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m06:08:25.609713 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m06:08:25.617437 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m06:08:25.618077 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m06:08:25.618597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:08:25.959782 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m06:08:25.962361 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m06:08:26.057212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276ae50c0>]}
[0m06:08:26.058578 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:08:26.059193 [info ] [MainThread]: 
[0m06:08:26.063306 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m06:08:26.064112 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m06:08:26.065199 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m06:08:26.065814 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m06:08:26.079580 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m06:08:26.080804 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 06:08:26.066226 => 06:08:26.080427
[0m06:08:26.081455 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m06:08:26.123997 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m06:08:26.127031 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m06:08:26.127737 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m06:08:26.128424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:26.898508 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:08:26.929599 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 06:08:26.081853 => 06:08:26.929206
[0m06:08:26.930403 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m06:08:26.973312 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2757ffbe0>]}
[0m06:08:26.974502 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.91s]
[0m06:08:26.975502 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m06:08:26.976228 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m06:08:26.977083 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m06:08:26.978147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m06:08:26.978768 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m06:08:26.984363 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m06:08:26.985379 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 06:08:26.979172 => 06:08:26.985016
[0m06:08:26.986047 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m06:08:26.991436 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m06:08:26.993357 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m06:08:26.994050 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m06:08:26.994708 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:27.483771 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:27.487971 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 06:08:26.986445 => 06:08:27.487619
[0m06:08:27.488624 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m06:08:27.538095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa27571e560>]}
[0m06:08:27.539230 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.56s]
[0m06:08:27.540234 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m06:08:27.540974 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m06:08:27.541952 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m06:08:27.543224 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m06:08:27.543859 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m06:08:27.549540 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m06:08:27.550627 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 06:08:27.544274 => 06:08:27.550247
[0m06:08:27.551288 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m06:08:27.556884 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m06:08:27.558508 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m06:08:27.559178 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m06:08:27.559811 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:28.355898 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:08:28.360201 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 06:08:27.551688 => 06:08:28.359838
[0m06:08:28.360855 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m06:08:28.414084 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa27571e560>]}
[0m06:08:28.415224 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.87s]
[0m06:08:28.416220 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m06:08:28.416963 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m06:08:28.417901 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m06:08:28.419103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m06:08:28.419777 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m06:08:28.425493 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m06:08:28.426601 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 06:08:28.420184 => 06:08:28.426209
[0m06:08:28.427248 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m06:08:28.434518 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m06:08:28.436109 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m06:08:28.436755 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m06:08:28.437383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:28.962565 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:08:28.966821 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 06:08:28.427640 => 06:08:28.966447
[0m06:08:28.967483 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m06:08:29.008867 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2756a3f70>]}
[0m06:08:29.010047 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.59s]
[0m06:08:29.011025 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m06:08:29.011755 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m06:08:29.012619 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m06:08:29.013663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m06:08:29.014305 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m06:08:29.020281 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m06:08:29.021340 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 06:08:29.014703 => 06:08:29.020967
[0m06:08:29.021973 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m06:08:29.027495 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m06:08:29.028873 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m06:08:29.029514 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m06:08:29.030172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:29.483512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:29.487733 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 06:08:29.022406 => 06:08:29.487370
[0m06:08:29.488385 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m06:08:29.550472 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa27566ee60>]}
[0m06:08:29.551582 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.54s]
[0m06:08:29.552558 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m06:08:29.553299 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m06:08:29.554184 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m06:08:29.555249 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m06:08:29.555870 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m06:08:29.561740 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m06:08:29.562795 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 06:08:29.556265 => 06:08:29.562430
[0m06:08:29.563429 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m06:08:29.570359 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m06:08:29.571675 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m06:08:29.572308 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m06:08:29.572926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:29.975427 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:29.979677 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 06:08:29.563825 => 06:08:29.979310
[0m06:08:29.980322 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m06:08:30.019415 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2756f9300>]}
[0m06:08:30.020625 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.46s]
[0m06:08:30.021651 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m06:08:30.022438 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m06:08:30.023306 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m06:08:30.024570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m06:08:30.025205 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m06:08:30.031786 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m06:08:30.032994 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 06:08:30.025625 => 06:08:30.032606
[0m06:08:30.033631 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m06:08:30.040112 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m06:08:30.041536 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m06:08:30.042223 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m06:08:30.042864 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:30.456766 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:30.460990 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 06:08:30.034036 => 06:08:30.460632
[0m06:08:30.461656 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m06:08:30.544837 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2745673a0>]}
[0m06:08:30.546003 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.52s]
[0m06:08:30.547022 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m06:08:30.547755 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m06:08:30.548629 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m06:08:30.549708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m06:08:30.550357 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m06:08:30.686447 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m06:08:30.687673 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 06:08:30.550751 => 06:08:30.687288
[0m06:08:30.688291 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m06:08:30.693765 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m06:08:30.695046 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m06:08:30.695686 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m06:08:30.696297 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:31.252696 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:08:31.256982 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 06:08:30.688692 => 06:08:31.256618
[0m06:08:31.257646 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m06:08:31.308422 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276f9a4d0>]}
[0m06:08:31.309582 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.76s]
[0m06:08:31.310598 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m06:08:31.311335 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m06:08:31.312163 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m06:08:31.313199 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m06:08:31.313816 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m06:08:31.319540 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m06:08:31.320576 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 06:08:31.314243 => 06:08:31.320200
[0m06:08:31.321188 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m06:08:31.326522 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m06:08:31.329091 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m06:08:31.329788 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m06:08:31.330495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:31.788693 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:31.792966 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 06:08:31.321577 => 06:08:31.792601
[0m06:08:31.793628 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m06:08:31.842604 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2768eee00>]}
[0m06:08:31.843752 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.53s]
[0m06:08:31.844747 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m06:08:31.845473 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m06:08:31.846377 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m06:08:31.847738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m06:08:31.848396 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m06:08:31.855204 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 06:08:31.848790 => 06:08:31.854791
[0m06:08:31.855844 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m06:08:31.916714 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:31.917543 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:08:31.918188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:32.343777 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:08:32.383327 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:32.384310 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:08:34.443060 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m06:08:34.448663 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:34.449333 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:08:34.644461 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:08:34.652219 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:34.652883 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:08:34.703990 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:08:34.711648 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:34.712306 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:08:34.827967 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:08:34.838165 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:34.838902 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:08:34.954921 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:08:34.967677 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:34.968461 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:08:35.066378 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:08:35.079530 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m06:08:35.081679 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:35.082353 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m06:08:35.231862 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:35.232736 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:35.233425 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:08:35.613604 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m06:08:35.614553 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:08:35.615175 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m06:08:35.772569 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:35.780190 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 06:08:31.856243 => 06:08:35.779798
[0m06:08:35.780874 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m06:08:37.373398 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2758503d0>]}
[0m06:08:37.374819 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 5.53s]
[0m06:08:37.375839 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m06:08:37.376607 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m06:08:37.377481 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m06:08:37.378807 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m06:08:37.379432 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m06:08:37.392545 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m06:08:37.393656 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 06:08:37.379825 => 06:08:37.393275
[0m06:08:37.394340 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m06:08:37.439202 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m06:08:37.443490 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:08:37.444288 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m06:08:37.445074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:41.373965 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m06:08:41.387715 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m06:08:41.396346 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:08:41.397033 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m06:08:41.456886 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:41.461167 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 06:08:37.394739 => 06:08:41.460800
[0m06:08:41.461834 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m06:08:41.502237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2745c7d90>]}
[0m06:08:41.503295 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 4.12s]
[0m06:08:41.504286 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m06:08:41.505032 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m06:08:41.505934 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m06:08:41.507310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m06:08:41.507930 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m06:08:41.516915 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m06:08:41.517965 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 06:08:41.508348 => 06:08:41.517597
[0m06:08:41.518618 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m06:08:41.524587 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m06:08:41.528131 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:08:41.528873 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m06:08:41.529594 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:45.225884 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m06:08:45.232436 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m06:08:45.234112 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:08:45.234750 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m06:08:45.345504 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:45.350346 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 06:08:41.519020 => 06:08:45.349943
[0m06:08:45.351030 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m06:08:45.410763 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276b21000>]}
[0m06:08:45.411956 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 3.90s]
[0m06:08:45.412941 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m06:08:45.413685 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:08:45.414509 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m06:08:45.415548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m06:08:45.416173 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:08:45.434553 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:08:45.435760 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 06:08:45.416581 => 06:08:45.435380
[0m06:08:45.436392 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:08:45.460057 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:08:45.461541 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:08:45.462223 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m06:08:45.462848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:45.837446 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:45.841694 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 06:08:45.436810 => 06:08:45.841289
[0m06:08:45.842407 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m06:08:45.885101 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.47s]
[0m06:08:45.886301 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:08:45.887741 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m06:08:45.888544 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m06:08:45.889603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m06:08:45.890253 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m06:08:45.900938 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m06:08:45.902090 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 06:08:45.890655 => 06:08:45.901670
[0m06:08:45.902718 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m06:08:45.909059 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m06:08:45.913499 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:08:45.914337 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m06:08:45.915123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:08:47.811445 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m06:08:47.817876 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m06:08:47.819687 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:08:47.820344 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m06:08:47.854860 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:08:47.859122 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 06:08:45.903125 => 06:08:47.858746
[0m06:08:47.859804 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m06:08:47.903486 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '673f68b0-e951-4630-a929-5b36838c0314', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa276b20c40>]}
[0m06:08:47.904639 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.01s]
[0m06:08:47.905639 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m06:08:47.908238 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:08:47.908783 [debug] [MainThread]: Connection 'list_tpcds' was properly closed.
[0m06:08:47.909282 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m06:08:47.909930 [info ] [MainThread]: 
[0m06:08:47.910572 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 25.44 seconds (25.44s).
[0m06:08:47.914584 [debug] [MainThread]: Command end result
[0m06:08:47.941412 [info ] [MainThread]: 
[0m06:08:47.942251 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:08:47.942841 [info ] [MainThread]: 
[0m06:08:47.943431 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m06:08:47.949605 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 28.780796, "process_user_time": 8.46229, "process_kernel_time": 0.41121, "process_mem_max_rss": "169544", "process_in_blocks": "122920", "process_out_blocks": "6656"}
[0m06:08:47.950654 [debug] [MainThread]: Command `dbt build` succeeded at 06:08:47.950428 after 28.78 seconds
[0m06:08:47.951268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2817dec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2777bd0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa275705fc0>]}
[0m06:08:47.951915 [debug] [MainThread]: Flushing usage events
[0m06:24:23.801027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0ca7109690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0ca532a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0ca532b1c0>]}


============================== 06:24:23.804649 | 92e818f1-e760-47de-aad9-c3b82537de26 ==============================
[0m06:24:23.804649 [info ] [MainThread]: Running with dbt=1.7.3
[0m06:24:23.805431 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt build', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:24:24.611237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9cf7f1c0>]}
[0m06:24:24.755906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9cfb2560>]}
[0m06:24:24.757170 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m06:24:24.787831 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m06:24:24.865779 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:24:24.866592 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:24:24.877077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c8f80d0>]}
[0m06:24:24.901753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c8acf40>]}
[0m06:24:24.902674 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m06:24:24.905579 [info ] [MainThread]: 
[0m06:24:24.906788 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:24:24.909493 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m06:24:24.931088 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:24:24.932002 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:24:24.932615 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:24:25.493723 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m06:24:25.496302 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:24:25.566776 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:24:25.567520 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:24:25.568047 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:24:25.965809 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:24:25.968371 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:24:26.014125 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m06:24:26.015021 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m06:24:26.015562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:24:26.315246 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:24:26.317794 [debug] [ThreadPool]: On list_tpcds: Close
[0m06:24:26.376519 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m06:24:26.389706 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m06:24:26.390409 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m06:24:26.390946 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:24:26.705136 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m06:24:26.708005 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m06:24:26.753016 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m06:24:26.760773 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m06:24:26.761373 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m06:24:26.761909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:24:27.233270 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m06:24:27.235829 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m06:24:27.847923 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m06:24:27.853537 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m06:24:27.854175 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m06:24:27.854703 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:24:28.190330 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m06:24:28.192880 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m06:24:28.234784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c8acee0>]}
[0m06:24:28.236113 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:24:28.236716 [info ] [MainThread]: 
[0m06:24:28.239889 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m06:24:28.240687 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m06:24:28.241722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m06:24:28.242379 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m06:24:28.255833 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m06:24:28.257058 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 06:24:28.242874 => 06:24:28.256672
[0m06:24:28.257711 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m06:24:28.298847 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m06:24:28.301881 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m06:24:28.302618 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m06:24:28.303322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:28.737887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:28.768897 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 06:24:28.258135 => 06:24:28.768488
[0m06:24:28.769682 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m06:24:28.810690 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c837be0>]}
[0m06:24:28.811914 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.57s]
[0m06:24:28.812931 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m06:24:28.813670 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m06:24:28.814557 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m06:24:28.815589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m06:24:28.816215 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m06:24:28.822197 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m06:24:28.823268 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 06:24:28.816619 => 06:24:28.822893
[0m06:24:28.823909 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m06:24:28.829425 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m06:24:28.831471 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m06:24:28.832129 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m06:24:28.832782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:29.299594 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:29.303925 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 06:24:28.824303 => 06:24:29.303557
[0m06:24:29.304608 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m06:24:29.427551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c802cb0>]}
[0m06:24:29.428747 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.61s]
[0m06:24:29.429749 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m06:24:29.430545 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m06:24:29.431296 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m06:24:29.433099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m06:24:29.433948 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m06:24:29.441878 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m06:24:29.443197 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 06:24:29.434513 => 06:24:29.442796
[0m06:24:29.443853 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m06:24:29.450193 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m06:24:29.451988 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m06:24:29.452677 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m06:24:29.453336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:29.846892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:29.851362 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 06:24:29.444279 => 06:24:29.850980
[0m06:24:29.852063 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m06:24:29.899723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a561b70>]}
[0m06:24:29.900934 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.47s]
[0m06:24:29.901952 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m06:24:29.902756 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m06:24:29.903641 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m06:24:29.904735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m06:24:29.905377 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m06:24:29.911175 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m06:24:29.912263 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 06:24:29.905777 => 06:24:29.911884
[0m06:24:29.912876 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m06:24:29.918572 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m06:24:29.920252 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m06:24:29.920902 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m06:24:29.921550 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:30.338550 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:30.342798 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 06:24:29.913271 => 06:24:30.342429
[0m06:24:30.343461 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m06:24:30.390835 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a5c47c0>]}
[0m06:24:30.392004 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.49s]
[0m06:24:30.392992 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m06:24:30.393728 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m06:24:30.394601 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m06:24:30.395612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m06:24:30.396232 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m06:24:30.401840 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m06:24:30.402933 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 06:24:30.396619 => 06:24:30.402561
[0m06:24:30.403540 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m06:24:30.408974 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m06:24:30.410342 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m06:24:30.410988 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m06:24:30.411607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:30.887600 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:30.891883 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 06:24:30.403938 => 06:24:30.891514
[0m06:24:30.892543 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m06:24:30.936595 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c7c7d90>]}
[0m06:24:30.937796 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.54s]
[0m06:24:30.938835 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m06:24:30.939561 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m06:24:30.940464 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m06:24:30.941540 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m06:24:30.942197 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m06:24:30.947829 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m06:24:30.948890 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 06:24:30.942606 => 06:24:30.948512
[0m06:24:30.949520 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m06:24:30.956903 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m06:24:30.958290 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m06:24:30.958932 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m06:24:30.959546 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:31.379089 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:31.383583 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 06:24:30.949906 => 06:24:31.383192
[0m06:24:31.384269 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m06:24:31.433181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a60be50>]}
[0m06:24:31.434461 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.49s]
[0m06:24:31.435516 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m06:24:31.436278 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m06:24:31.437179 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m06:24:31.438395 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m06:24:31.439081 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m06:24:31.444957 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m06:24:31.446049 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 06:24:31.439487 => 06:24:31.445638
[0m06:24:31.446686 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m06:24:31.452543 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m06:24:31.453835 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m06:24:31.454515 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m06:24:31.455139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:35.910424 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m06:24:35.914672 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 06:24:31.447085 => 06:24:35.914313
[0m06:24:35.915319 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m06:24:35.961975 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c7a4b20>]}
[0m06:24:35.963194 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 4.52s]
[0m06:24:35.964195 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m06:24:35.964944 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m06:24:35.965812 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m06:24:35.966899 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m06:24:35.967527 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m06:24:35.973111 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m06:24:35.974183 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 06:24:35.967934 => 06:24:35.973773
[0m06:24:35.974805 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m06:24:35.981969 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m06:24:35.983297 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m06:24:35.983935 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m06:24:35.984546 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:36.465797 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:36.470146 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 06:24:35.975190 => 06:24:36.469753
[0m06:24:36.470807 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m06:24:36.521797 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c800e20>]}
[0m06:24:36.523088 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.56s]
[0m06:24:36.524102 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m06:24:36.524868 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m06:24:36.525717 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m06:24:36.526851 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m06:24:36.527479 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m06:24:36.533785 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m06:24:36.534950 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 06:24:36.527877 => 06:24:36.534567
[0m06:24:36.535570 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m06:24:36.541249 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m06:24:36.544115 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m06:24:36.544816 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m06:24:36.545494 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:37.050702 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:24:37.054985 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 06:24:36.535963 => 06:24:37.054600
[0m06:24:37.055649 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m06:24:37.107308 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a5e30d0>]}
[0m06:24:37.108482 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.58s]
[0m06:24:37.109488 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m06:24:37.110266 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m06:24:37.111126 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m06:24:37.112447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m06:24:37.113083 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m06:24:37.121318 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 06:24:37.113492 => 06:24:37.120908
[0m06:24:37.121968 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m06:24:37.182607 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:37.183439 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:24:37.184050 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:37.554136 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:24:37.594720 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:37.595682 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:24:39.388716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m06:24:39.394327 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.395021 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:24:39.444309 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:24:39.452102 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.452740 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:24:39.519574 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:24:39.527536 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.528238 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:24:39.597863 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:24:39.605830 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.606510 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m06:24:39.646729 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m06:24:39.660657 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.661397 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m06:24:39.713971 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m06:24:39.727003 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m06:24:39.728977 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.729595 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m06:24:39.797833 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:39.798687 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:39.799364 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:24:40.557608 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m06:24:40.558586 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m06:24:40.559206 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m06:24:40.696673 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:40.704046 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 06:24:37.122384 => 06:24:40.703678
[0m06:24:40.704689 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m06:24:40.756379 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9c8a7a60>]}
[0m06:24:40.757813 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.64s]
[0m06:24:40.758904 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m06:24:40.759669 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m06:24:40.760744 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m06:24:40.761992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m06:24:40.762679 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m06:24:40.795161 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m06:24:40.796462 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 06:24:40.763078 => 06:24:40.796068
[0m06:24:40.797110 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m06:24:40.845508 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:40.846533 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m06:24:40.847371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:41.363410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:24:41.369136 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.369834 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m06:24:41.444978 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:41.452168 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.452842 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m06:24:41.501263 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:41.515010 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.515794 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m06:24:41.618005 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:41.660152 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.662967 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.663614 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m06:24:41.726819 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:41.727705 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:41.728413 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m06:24:47.698365 [debug] [Thread-1 (]: SQL status: SUCCESS 2310 in 6.0 seconds
[0m06:24:47.699336 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:47.699957 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m06:24:47.943427 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:47.959499 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m06:24:47.968177 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m06:24:47.968877 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m06:24:48.057112 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:48.061128 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 06:24:40.797502 => 06:24:48.060760
[0m06:24:48.061792 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m06:24:48.105889 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a60be50>]}
[0m06:24:48.107138 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2310[0m in 7.34s]
[0m06:24:48.108154 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m06:24:48.108897 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m06:24:48.109790 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m06:24:48.111065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m06:24:48.111741 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m06:24:48.119599 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m06:24:48.120661 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 06:24:48.112136 => 06:24:48.120284
[0m06:24:48.121268 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m06:24:48.129943 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:48.130737 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m06:24:48.131467 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:48.860668 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:24:48.868077 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:48.868809 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m06:24:48.928828 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m06:24:48.937882 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:48.938591 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m06:24:49.052412 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m06:24:49.061302 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:49.061961 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m06:24:49.122167 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m06:24:49.131398 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m06:24:49.135495 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:49.136123 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m06:24:49.212268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:49.213129 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:49.213956 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m06:24:53.788150 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 5.0 seconds
[0m06:24:53.789133 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:53.789790 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m06:24:54.105610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:54.112193 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m06:24:54.113792 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m06:24:54.114438 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m06:24:54.176725 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:54.181015 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 06:24:48.121659 => 06:24:54.180619
[0m06:24:54.181754 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m06:24:54.242102 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a479360>]}
[0m06:24:54.243316 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 6.13s]
[0m06:24:54.244318 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m06:24:54.245074 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:24:54.245881 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m06:24:54.247045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m06:24:54.247692 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:24:54.268486 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:24:54.269807 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 06:24:54.248106 => 06:24:54.269409
[0m06:24:54.270487 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:24:54.295886 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:24:54.297490 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m06:24:54.298179 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m06:24:54.298813 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:54.764749 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:54.769071 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 06:24:54.270904 => 06:24:54.768645
[0m06:24:54.769777 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m06:24:54.865008 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.62s]
[0m06:24:54.866274 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m06:24:54.867713 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m06:24:54.868705 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m06:24:54.869849 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m06:24:54.870512 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m06:24:54.879539 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m06:24:54.880784 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 06:24:54.870921 => 06:24:54.880391
[0m06:24:54.881418 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m06:24:54.893622 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:54.894702 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m06:24:54.895545 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:24:55.455868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:24:55.461541 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:55.462215 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m06:24:55.512914 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:55.519963 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:55.520609 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m06:24:55.570065 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:55.577279 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:55.577937 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m06:24:55.693817 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:24:55.699957 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m06:24:55.702468 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:55.703080 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m06:24:55.819715 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:55.820576 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:55.821281 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m06:24:57.725976 [debug] [Thread-1 (]: SQL status: SUCCESS 35 in 2.0 seconds
[0m06:24:57.726958 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:57.727573 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m06:24:57.970537 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:57.979151 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m06:24:57.980752 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m06:24:57.981399 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m06:24:58.053067 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:24:58.057062 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 06:24:54.881810 => 06:24:58.056702
[0m06:24:58.057713 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m06:24:58.113216 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92e818f1-e760-47de-aad9-c3b82537de26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a253430>]}
[0m06:24:58.114471 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 35[0m in 3.24s]
[0m06:24:58.115468 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m06:24:58.118012 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:24:58.118668 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m06:24:58.119584 [info ] [MainThread]: 
[0m06:24:58.120217 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 33.21 seconds (33.21s).
[0m06:24:58.124325 [debug] [MainThread]: Command end result
[0m06:24:58.145563 [info ] [MainThread]: 
[0m06:24:58.146386 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:24:58.146988 [info ] [MainThread]: 
[0m06:24:58.147589 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m06:24:58.148912 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 34.41656, "process_user_time": 7.832614, "process_kernel_time": 0.244189, "process_mem_max_rss": "167144", "process_out_blocks": "4072", "process_in_blocks": "0"}
[0m06:24:58.149768 [debug] [MainThread]: Command `dbt build` succeeded at 06:24:58.149551 after 34.42 seconds
[0m06:24:58.150434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0ca7109690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9a60be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9cfb2560>]}
[0m06:24:58.151071 [debug] [MainThread]: Flushing usage events


============================== 19:44:55.424557 | 8b122a5d-559b-461a-82c0-a475220588d4 ==============================
[0m19:44:55.424557 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:44:55.428193 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m19:44:56.338810 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:44:56.371321 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:44:56.396960 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m19:44:59.596073 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m19:44:59.599188 [info ] [MainThread]: 
[0m19:44:59.600534 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:44:59.603008 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:44:59.623195 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:44:59.623892 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:44:59.624537 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:45:00.266638 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:45:00.269162 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:00.352466 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:45:00.353494 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:45:00.354087 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:00.835830 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:45:00.838286 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:00.932091 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:45:00.932943 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:45:00.933473 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:01.558253 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:45:01.560733 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:01.615901 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m19:45:01.629853 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m19:45:01.630679 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m19:45:01.631203 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:01.917293 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m19:45:01.920129 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m19:45:01.996710 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m19:45:02.005677 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:45:02.006549 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:45:02.007101 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:02.338059 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m19:45:02.340609 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:45:02.382807 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m19:45:02.388588 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m19:45:02.389183 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m19:45:02.389701 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:02.678155 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m19:45:02.680747 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m19:45:02.752864 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:45:02.753592 [info ] [MainThread]: 
[0m19:45:02.756992 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:45:02.757889 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m19:45:02.759156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m19:45:02.759821 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:45:02.773773 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:02.775145 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:45:02.760233 => 19:45:02.774736
[0m19:45:02.775850 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:45:02.821394 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:02.824538 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:02.825325 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m19:45:02.826079 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:03.971305 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:04.004109 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:45:02.776271 => 19:45:04.003708
[0m19:45:04.004927 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:45:04.055149 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 1.30s]
[0m19:45:04.056342 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:45:04.057091 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m19:45:04.057830 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m19:45:04.059295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m19:45:04.059935 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m19:45:04.065766 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m19:45:04.066967 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 19:45:04.060330 => 19:45:04.066590
[0m19:45:04.067627 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m19:45:04.073674 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m19:45:04.075747 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m19:45:04.076416 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m19:45:04.077081 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:04.593095 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:04.597642 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 19:45:04.068020 => 19:45:04.597243
[0m19:45:04.598384 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m19:45:04.710938 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.65s]
[0m19:45:04.712137 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m19:45:04.712910 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m19:45:04.713996 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m19:45:04.715200 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m19:45:04.715827 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m19:45:04.721717 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m19:45:04.722924 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 19:45:04.716231 => 19:45:04.722537
[0m19:45:04.723561 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m19:45:04.731947 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m19:45:04.733739 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m19:45:04.734431 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m19:45:04.735074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:05.556827 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:05.561151 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 19:45:04.723961 => 19:45:05.560790
[0m19:45:05.561818 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m19:45:05.605427 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.89s]
[0m19:45:05.606651 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m19:45:05.607418 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m19:45:05.608298 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m19:45:05.609392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m19:45:05.610051 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m19:45:05.615860 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:05.617025 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 19:45:05.610457 => 19:45:05.616629
[0m19:45:05.617659 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m19:45:05.624123 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:05.625939 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:05.626671 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m19:45:05.627317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:06.090646 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:06.095312 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 19:45:05.618098 => 19:45:06.094924
[0m19:45:06.096016 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m19:45:06.143974 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.53s]
[0m19:45:06.145204 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m19:45:06.145979 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m19:45:06.146924 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m19:45:06.148076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m19:45:06.148735 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m19:45:06.156410 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m19:45:06.157637 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 19:45:06.149152 => 19:45:06.157160
[0m19:45:06.158325 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m19:45:06.164372 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m19:45:06.165822 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m19:45:06.166532 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m19:45:06.167194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:06.740465 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:06.744872 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 19:45:06.158747 => 19:45:06.744501
[0m19:45:06.745567 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m19:45:06.791019 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.64s]
[0m19:45:06.792253 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m19:45:06.793031 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m19:45:06.793905 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m19:45:06.795060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m19:45:06.795697 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m19:45:06.801350 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m19:45:06.802479 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 19:45:06.796099 => 19:45:06.802093
[0m19:45:06.803132 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m19:45:06.808990 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m19:45:06.810464 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m19:45:06.811106 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m19:45:06.811740 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:07.241286 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:07.245517 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 19:45:06.803523 => 19:45:07.245151
[0m19:45:07.246221 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m19:45:07.313370 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.52s]
[0m19:45:07.314648 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m19:45:07.315410 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m19:45:07.316287 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m19:45:07.317425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m19:45:07.318104 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m19:45:07.324016 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m19:45:07.325193 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 19:45:07.318532 => 19:45:07.324790
[0m19:45:07.325884 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m19:45:07.332277 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m19:45:07.333641 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m19:45:07.334348 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m19:45:07.334990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:07.776172 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:07.780426 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 19:45:07.326370 => 19:45:07.780060
[0m19:45:07.781097 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m19:45:07.826005 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.51s]
[0m19:45:07.827225 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m19:45:07.827980 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m19:45:07.828831 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m19:45:07.829913 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m19:45:07.830597 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m19:45:07.836236 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m19:45:07.837308 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 19:45:07.830998 => 19:45:07.836935
[0m19:45:07.837947 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m19:45:07.846014 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m19:45:07.847568 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m19:45:07.848231 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m19:45:07.848883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:08.292348 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:08.296573 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 19:45:07.838395 => 19:45:08.296220
[0m19:45:08.297226 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m19:45:08.352953 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.52s]
[0m19:45:08.354181 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m19:45:08.354920 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m19:45:08.355782 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m19:45:08.356860 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m19:45:08.357482 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m19:45:08.363405 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m19:45:08.364489 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 19:45:08.357880 => 19:45:08.364114
[0m19:45:08.365139 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m19:45:08.370956 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m19:45:08.373700 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m19:45:08.374426 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m19:45:08.375103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:08.891966 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:08.896209 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 19:45:08.365536 => 19:45:08.895851
[0m19:45:08.896886 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m19:45:08.954923 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.60s]
[0m19:45:08.956132 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m19:45:08.956916 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m19:45:08.957842 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m19:45:08.959180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m19:45:08.959843 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m19:45:08.968363 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 19:45:08.960256 => 19:45:08.967924
[0m19:45:08.969068 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m19:45:09.033663 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:09.034587 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:09.035223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:09.310724 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:09.352534 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:09.353550 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m19:45:14.821184 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m19:45:14.958315 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:14.959127 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:15.013869 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:15.021948 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.022953 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:15.081744 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:15.089798 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.090610 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:15.155628 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:15.163448 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.164189 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:15.232173 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:15.246775 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.247583 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:15.352252 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:15.365851 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m19:45:15.368170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.368829 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m19:45:15.450250 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:15.451175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:15.451908 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:45:18.026097 [debug] [Thread-1 (]: SQL status: SUCCESS 200000 in 3.0 seconds
[0m19:45:18.027027 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:18.027646 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m19:45:18.265565 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:18.272968 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 19:45:08.969483 => 19:45:18.272591
[0m19:45:18.273642 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m19:45:18.321607 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 200000[0m in 9.36s]
[0m19:45:18.322846 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m19:45:18.323643 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m19:45:18.324541 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m19:45:18.325764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m19:45:18.326423 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m19:45:18.339722 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m19:45:18.340888 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 19:45:18.326820 => 19:45:18.340498
[0m19:45:18.341557 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m19:45:18.388338 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:18.389343 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m19:45:18.390187 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:19.221871 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:19.229019 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.229651 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m19:45:19.281992 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:19.289398 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.290190 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m19:45:19.342069 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:19.355612 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.356435 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m19:45:19.421563 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:19.463105 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.465886 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.466558 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m19:45:19.554830 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:19.555695 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:19.556420 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;


============================== 19:45:29.075764 | 9b94e5c6-90a2-4c3b-95e7-15a8efc39fef ==============================
[0m19:45:29.075764 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:45:29.079422 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'static_parser': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m19:45:29.993573 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:45:30.031022 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:45:30.114305 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:45:30.115052 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:45:30.150331 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m19:45:30.153458 [info ] [MainThread]: 
[0m19:45:30.154718 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:45:30.157196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:45:30.177507 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:45:30.178346 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:45:30.178983 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:45:30.746204 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:45:30.748691 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:30.803185 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:45:30.803928 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:45:30.804455 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:31.325930 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:45:31.328381 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:31.386069 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:45:31.386921 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:45:31.387458 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:31.780967 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:45:31.783434 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:45:31.838758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m19:45:31.851850 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m19:45:31.852462 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m19:45:31.852980 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:32.412077 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m19:45:32.414785 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m19:45:32.534686 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m19:45:32.540205 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:45:32.540780 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:45:32.541307 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:33.066611 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m19:45:33.069115 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:45:33.173626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m19:45:33.179360 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m19:45:33.179964 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m19:45:33.180509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:45:33.573366 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m19:45:33.576129 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m19:45:33.669334 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:45:33.670077 [info ] [MainThread]: 
[0m19:45:33.673189 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:45:33.673980 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m19:45:33.675045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m19:45:33.675665 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:45:33.688954 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:33.690003 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:45:33.676056 => 19:45:33.689623
[0m19:45:33.690691 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:45:33.730956 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:33.733859 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:45:33.734591 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m19:45:33.735281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:34.396466 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:34.427776 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:45:33.691084 => 19:45:34.427390
[0m19:45:34.428542 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:45:34.497532 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.82s]
[0m19:45:34.498768 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:45:34.499503 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m19:45:34.500401 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m19:45:34.501461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m19:45:34.502118 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m19:45:34.507773 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m19:45:34.508843 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 19:45:34.502516 => 19:45:34.508473
[0m19:45:34.509480 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m19:45:34.514878 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m19:45:34.516815 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m19:45:34.517474 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m19:45:34.518173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:35.047009 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:35.051256 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 19:45:34.509879 => 19:45:35.050899
[0m19:45:35.051908 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m19:45:35.233438 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.73s]
[0m19:45:35.234712 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m19:45:35.235484 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m19:45:35.236442 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m19:45:35.237791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m19:45:35.238485 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m19:45:35.245868 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m19:45:35.247049 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 19:45:35.238922 => 19:45:35.246649
[0m19:45:35.247727 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m19:45:35.253544 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m19:45:35.255248 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m19:45:35.255922 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m19:45:35.256582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:35.903389 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:35.907677 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 19:45:35.248134 => 19:45:35.907316
[0m19:45:35.908346 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m19:45:35.979978 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.74s]
[0m19:45:35.981172 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m19:45:35.981937 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m19:45:35.982914 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m19:45:35.984007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m19:45:35.984630 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m19:45:35.990393 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:35.991472 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 19:45:35.985024 => 19:45:35.991100
[0m19:45:35.992137 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m19:45:35.997770 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:35.999537 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m19:45:36.000193 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m19:45:36.000835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:36.494262 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:36.498642 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 19:45:35.992529 => 19:45:36.498255
[0m19:45:36.499365 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m19:45:36.581814 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.60s]
[0m19:45:36.583026 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m19:45:36.583749 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m19:45:36.584591 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m19:45:36.585616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m19:45:36.586257 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m19:45:36.591896 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m19:45:36.592964 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 19:45:36.586656 => 19:45:36.592593
[0m19:45:36.593614 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m19:45:36.599394 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m19:45:36.600777 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m19:45:36.601410 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m19:45:36.602055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:37.055643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:37.059923 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 19:45:36.594040 => 19:45:37.059552
[0m19:45:37.060593 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m19:45:37.123985 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.54s]
[0m19:45:37.125198 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m19:45:37.125979 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m19:45:37.126944 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m19:45:37.128039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m19:45:37.128683 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m19:45:37.134561 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m19:45:37.135674 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 19:45:37.129101 => 19:45:37.135286
[0m19:45:37.136353 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m19:45:37.144113 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m19:45:37.145567 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m19:45:37.146263 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m19:45:37.146919 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:38.678369 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m19:45:38.682612 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 19:45:37.136758 => 19:45:38.682246
[0m19:45:38.683283 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m19:45:38.727828 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 1.60s]
[0m19:45:38.729017 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m19:45:38.729742 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m19:45:38.730754 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m19:45:38.731846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m19:45:38.732473 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m19:45:38.738109 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m19:45:38.739174 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 19:45:38.732880 => 19:45:38.738800
[0m19:45:38.739828 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m19:45:38.745353 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m19:45:38.746675 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m19:45:38.747357 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m19:45:38.747971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:39.218794 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:39.223209 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 19:45:38.740217 => 19:45:39.222816
[0m19:45:39.223887 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m19:45:39.361928 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.63s]
[0m19:45:39.363149 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m19:45:39.363877 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m19:45:39.364728 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m19:45:39.365766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m19:45:39.366419 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m19:45:39.371958 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m19:45:39.372981 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 19:45:39.366821 => 19:45:39.372618
[0m19:45:39.373610 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m19:45:39.380967 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m19:45:39.382248 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m19:45:39.382879 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m19:45:39.383497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:39.878117 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:39.882491 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 19:45:39.374005 => 19:45:39.882120
[0m19:45:39.883176 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m19:45:40.088234 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.72s]
[0m19:45:40.089406 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m19:45:40.090188 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m19:45:40.091070 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m19:45:40.092104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m19:45:40.092732 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m19:45:40.098590 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m19:45:40.099666 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 19:45:40.093125 => 19:45:40.099293
[0m19:45:40.100320 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m19:45:40.105869 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m19:45:40.108575 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m19:45:40.109263 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m19:45:40.109959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:40.581625 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:40.585854 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 19:45:40.100712 => 19:45:40.585496
[0m19:45:40.586563 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m19:45:40.635165 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.54s]
[0m19:45:40.636356 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m19:45:40.637107 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m19:45:40.638000 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m19:45:40.639598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m19:45:40.640235 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m19:45:40.648376 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 19:45:40.640638 => 19:45:40.647972
[0m19:45:40.648999 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m19:45:40.708819 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:40.709629 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:40.710256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:40.993662 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:41.034341 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:41.035315 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m19:45:42.321446 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:42.327175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.327837 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:42.385405 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:42.393541 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.394194 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:42.428148 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:42.435805 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.436434 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:42.605618 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:42.613370 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.613998 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:45:42.664579 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:45:42.678601 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.679323 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:45:42.736956 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:45:42.750268 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m19:45:42.752398 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.753024 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m19:45:42.847911 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:42.848809 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:42.849495 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:45:43.168082 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m19:45:43.169034 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:45:43.169645 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m19:45:43.309286 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:43.316948 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 19:45:40.649394 => 19:45:43.316555
[0m19:45:43.317655 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m19:45:43.365570 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.73s]
[0m19:45:43.366829 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m19:45:43.367632 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m19:45:43.368561 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m19:45:43.369831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m19:45:43.370598 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m19:45:43.403786 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m19:45:43.405098 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 19:45:43.371017 => 19:45:43.404687
[0m19:45:43.405764 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m19:45:43.457426 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:43.458515 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m19:45:43.459357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:45:44.789694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:45:44.795353 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:44.795996 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m19:45:44.883890 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:44.891202 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:44.891918 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m19:45:44.951443 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:44.964854 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:44.965617 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m19:45:45.032866 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:45:45.075268 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m19:45:45.078120 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:45.078746 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m19:45:45.139607 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:45:45.140501 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:45:45.141212 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;


============================== 20:33:37.035728 | ed7ca10b-bd4e-4a0d-bf8b-1916146a6bf8 ==============================
[0m20:33:37.035728 [info ] [MainThread]: Running with dbt=1.7.3
[0m20:33:37.039603 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select int__daily_aggregated_sales', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m20:33:38.001532 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m20:33:38.036960 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m20:33:38.115439 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:33:38.116198 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:33:38.150530 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m20:33:38.152743 [info ] [MainThread]: 
[0m20:33:38.153913 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:33:38.155678 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m20:33:38.177077 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:33:38.177938 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:33:38.178592 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:33:38.732596 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m20:33:38.735181 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:33:38.781978 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m20:33:38.795589 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m20:33:38.796388 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m20:33:38.796921 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:33:39.195657 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m20:33:39.198311 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m20:33:39.241954 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m20:33:39.249076 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m20:33:39.249692 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m20:33:39.250228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:33:39.532200 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m20:33:39.534811 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m20:33:39.596171 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m20:33:39.601689 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m20:33:39.602278 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m20:33:39.602787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:33:40.000898 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m20:33:40.003907 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m20:33:40.083689 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:33:40.084488 [info ] [MainThread]: 
[0m20:33:40.087721 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m20:33:40.088567 [info ] [Thread-1 (]: 1 of 1 START sql incremental model intermediate.int__daily_aggregated_sales .... [RUN]
[0m20:33:40.089682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.int__daily_aggregated_sales)
[0m20:33:40.090461 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m20:33:40.133346 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m20:33:40.134702 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 20:33:40.090878 => 20:33:40.134306
[0m20:33:40.135399 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m20:33:40.204772 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:40.205843 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m20:33:40.206708 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:33:40.863605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:33:40.877443 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:40.878321 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m20:33:41.024488 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:33:41.033185 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:41.033967 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m20:33:41.089157 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:33:41.102519 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:41.103311 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m20:33:41.160092 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:33:41.203794 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m20:33:41.206609 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:41.207237 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m20:33:41.275425 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:33:41.276300 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:33:41.277001 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m20:34:03.543784 [debug] [Thread-1 (]: SQL status: SUCCESS 44906 in 22.0 seconds
[0m20:34:03.544774 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:34:03.545407 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m20:34:03.908272 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:34:03.922724 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m20:34:03.931969 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:34:03.932831 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m20:34:04.129030 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:34:04.157581 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 20:33:40.135808 => 20:34:04.157186
[0m20:34:04.158405 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m20:34:04.243561 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 44906[0m in 24.15s]
[0m20:34:04.244805 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m20:34:04.247329 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:34:04.247880 [debug] [MainThread]: Connection 'model.capstone.int__daily_aggregated_sales' was properly closed.
[0m20:34:04.248439 [info ] [MainThread]: 
[0m20:34:04.249039 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 26.10 seconds (26.10s).
[0m20:34:04.250164 [debug] [MainThread]: Command end result
[0m20:34:04.272736 [info ] [MainThread]: 
[0m20:34:04.273565 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:34:04.274157 [info ] [MainThread]: 
[0m20:34:04.274756 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:34:04.276041 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.309052, "process_user_time": 5.080077, "process_kernel_time": 0.251552, "process_mem_max_rss": "162920", "process_out_blocks": "3648", "process_in_blocks": "0"}
[0m20:34:04.276926 [debug] [MainThread]: Command `dbt run` succeeded at 20:34:04.276699 after 27.31 seconds
[0m20:34:04.277505 [debug] [MainThread]: Flushing usage events


============================== 20:35:00.980977 | b485cad9-d8cf-4fd0-bfdb-e0e4a3c98077 ==============================
[0m20:35:00.980977 [info ] [MainThread]: Running with dbt=1.7.3
[0m20:35:00.984840 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m20:35:01.971740 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m20:35:02.010474 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m20:35:02.094702 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:35:02.095497 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:35:02.132792 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m20:35:02.135749 [info ] [MainThread]: 
[0m20:35:02.137110 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:35:02.139757 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_intermediate'
[0m20:35:02.165081 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m20:35:02.166050 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m20:35:02.166616 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:02.698676 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m20:35:02.701565 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m20:35:02.741132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m20:35:02.747776 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m20:35:02.748550 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m20:35:02.749075 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:35:03.110927 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m20:35:03.113846 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m20:35:03.161038 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m20:35:03.171102 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m20:35:03.171892 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m20:35:03.172423 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:35:03.480928 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m20:35:03.483621 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m20:35:03.550501 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:35:03.551408 [info ] [MainThread]: 
[0m20:35:03.554720 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:35:03.555445 [info ] [Thread-1 (]: 1 of 1 START test not_null_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m20:35:03.556626 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m20:35:03.557615 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:35:03.584458 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:35:03.585827 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 20:35:03.558043 => 20:35:03.585430
[0m20:35:03.586560 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:35:03.617568 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:35:03.619285 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:35:03.619940 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m20:35:03.620570 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:35:03.990399 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:35:04.000745 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 20:35:03.586967 => 20:35:04.000172
[0m20:35:04.001603 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m20:35:04.074553 [info ] [Thread-1 (]: 1 of 1 PASS not_null_int__daily_aggregated_sales_warehouse_sk .................. [[32mPASS[0m in 0.52s]
[0m20:35:04.075794 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:35:04.078378 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:35:04.078986 [debug] [MainThread]: Connection 'test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411' was properly closed.
[0m20:35:04.079544 [info ] [MainThread]: 
[0m20:35:04.080167 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m20:35:04.081301 [debug] [MainThread]: Command end result
[0m20:35:04.103031 [info ] [MainThread]: 
[0m20:35:04.103851 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:35:04.104414 [info ] [MainThread]: 
[0m20:35:04.105016 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:35:04.106391 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1940823, "process_user_time": 4.999469, "process_kernel_time": 0.192373, "process_mem_max_rss": "161000", "process_out_blocks": "3616", "process_in_blocks": "0"}
[0m20:35:04.107267 [debug] [MainThread]: Command `dbt test` succeeded at 20:35:04.107053 after 3.20 seconds
[0m20:35:04.107858 [debug] [MainThread]: Flushing usage events


============================== 20:47:13.274498 | e3a25a2a-af8f-4909-b4e2-0f0585750d61 ==============================
[0m20:47:13.274498 [info ] [MainThread]: Running with dbt=1.7.3
[0m20:47:13.278411 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m20:47:14.230687 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m20:47:14.263539 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m20:47:14.345337 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:47:14.346176 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:47:14.381036 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m20:47:14.384197 [info ] [MainThread]: 
[0m20:47:14.385424 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:47:14.387913 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m20:47:14.408540 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:47:14.409389 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:47:14.410010 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:47:14.929074 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m20:47:14.931700 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:47:14.985592 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:47:14.986598 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:47:14.987151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:47:16.044413 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m20:47:16.046998 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:47:16.104032 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m20:47:16.105025 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m20:47:16.105605 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:47:16.413547 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m20:47:16.416232 [debug] [ThreadPool]: On list_tpcds: Close
[0m20:47:16.474501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m20:47:16.487680 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m20:47:16.488363 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m20:47:16.488897 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:47:16.905586 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m20:47:16.908274 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m20:47:16.957488 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m20:47:16.963394 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m20:47:16.964051 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m20:47:16.964594 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:47:17.243103 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m20:47:17.245952 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m20:47:17.297933 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m20:47:17.305870 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m20:47:17.306650 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m20:47:17.307180 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:47:17.572355 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m20:47:17.575025 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m20:47:17.856309 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:47:17.857062 [info ] [MainThread]: 
[0m20:47:17.860571 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m20:47:17.861495 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m20:47:17.862738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m20:47:17.863364 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m20:47:17.877504 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m20:47:17.878840 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 20:47:17.863767 => 20:47:17.878452
[0m20:47:17.879516 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m20:47:17.922712 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m20:47:17.925796 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m20:47:17.926540 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m20:47:17.927229 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:18.378085 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:18.411388 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 20:47:17.879916 => 20:47:18.410974
[0m20:47:18.412207 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m20:47:18.462141 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.60s]
[0m20:47:18.463364 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m20:47:18.464095 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m20:47:18.465064 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m20:47:18.466131 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m20:47:18.466751 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m20:47:18.472474 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m20:47:18.473550 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 20:47:18.467153 => 20:47:18.473180
[0m20:47:18.474233 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m20:47:18.479722 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m20:47:18.481701 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m20:47:18.482394 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m20:47:18.483037 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:18.982079 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:18.986594 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 20:47:18.474623 => 20:47:18.986213
[0m20:47:18.987309 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m20:47:19.038287 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.57s]
[0m20:47:19.039506 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m20:47:19.040246 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m20:47:19.041182 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m20:47:19.042578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m20:47:19.043211 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m20:47:19.050430 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m20:47:19.051506 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 20:47:19.043603 => 20:47:19.051132
[0m20:47:19.052147 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m20:47:19.057681 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m20:47:19.059372 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m20:47:19.060019 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m20:47:19.060655 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:19.637450 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:19.641856 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 20:47:19.052544 => 20:47:19.641473
[0m20:47:19.642583 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m20:47:19.686203 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.64s]
[0m20:47:19.687468 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m20:47:19.688227 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m20:47:19.689125 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m20:47:19.690296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m20:47:19.690934 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m20:47:19.696886 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:47:19.697976 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 20:47:19.691349 => 20:47:19.697597
[0m20:47:19.698669 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m20:47:19.704501 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m20:47:19.706200 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m20:47:19.706975 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m20:47:19.707625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:20.131567 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:20.136077 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 20:47:19.699069 => 20:47:20.135702
[0m20:47:20.136756 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m20:47:20.188355 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.50s]
[0m20:47:20.189563 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m20:47:20.190320 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m20:47:20.191208 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m20:47:20.192279 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m20:47:20.192890 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m20:47:20.198623 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m20:47:20.199689 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 20:47:20.193289 => 20:47:20.199319
[0m20:47:20.200309 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m20:47:20.205872 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m20:47:20.207287 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m20:47:20.207916 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m20:47:20.208539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:20.604114 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:20.608507 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 20:47:20.200705 => 20:47:20.608146
[0m20:47:20.609187 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m20:47:20.663622 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.47s]
[0m20:47:20.664894 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m20:47:20.665669 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m20:47:20.666643 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m20:47:20.667760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m20:47:20.668432 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m20:47:20.674413 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m20:47:20.675497 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 20:47:20.668848 => 20:47:20.675113
[0m20:47:20.676177 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m20:47:20.683793 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m20:47:20.685245 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m20:47:20.685913 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m20:47:20.686605 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:21.069588 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:21.073983 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 20:47:20.676593 => 20:47:21.073601
[0m20:47:21.074698 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m20:47:21.276423 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.61s]
[0m20:47:21.277671 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m20:47:21.278478 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m20:47:21.279409 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m20:47:21.280507 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m20:47:21.281152 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m20:47:21.286996 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m20:47:21.288104 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 20:47:21.281562 => 20:47:21.287709
[0m20:47:21.288781 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m20:47:21.294466 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m20:47:21.295747 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m20:47:21.296430 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m20:47:21.297057 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:21.964295 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:21.968677 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 20:47:21.289197 => 20:47:21.968308
[0m20:47:21.969365 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m20:47:22.017414 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.74s]
[0m20:47:22.018687 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m20:47:22.019440 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m20:47:22.020306 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m20:47:22.021454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m20:47:22.022126 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m20:47:22.027868 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m20:47:22.028944 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 20:47:22.022542 => 20:47:22.028563
[0m20:47:22.029601 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m20:47:22.037700 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m20:47:22.039295 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m20:47:22.039944 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m20:47:22.040562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:22.502303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:22.506607 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 20:47:22.029993 => 20:47:22.506252
[0m20:47:22.507268 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m20:47:22.577693 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.56s]
[0m20:47:22.578992 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m20:47:22.579772 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m20:47:22.580648 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m20:47:22.581740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m20:47:22.582416 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m20:47:22.588529 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m20:47:22.589651 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 20:47:22.582840 => 20:47:22.589262
[0m20:47:22.590361 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m20:47:22.596051 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m20:47:22.598807 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m20:47:22.599533 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m20:47:22.600252 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:23.425462 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:23.429807 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 20:47:22.590768 => 20:47:23.429434
[0m20:47:23.430520 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m20:47:23.530094 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.95s]
[0m20:47:23.531340 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m20:47:23.532119 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m20:47:23.533187 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m20:47:23.534334 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m20:47:23.534960 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m20:47:23.543620 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 20:47:23.535374 => 20:47:23.543123
[0m20:47:23.544353 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m20:47:23.606245 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:23.607093 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m20:47:23.607709 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:23.976509 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m20:47:24.018992 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:24.020037 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m20:47:25.713779 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m20:47:25.719412 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:25.720066 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m20:47:25.837959 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m20:47:25.845902 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:25.846679 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m20:47:25.886958 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m20:47:25.894748 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:25.895431 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m20:47:25.970532 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m20:47:25.978340 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:25.979028 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m20:47:26.058178 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m20:47:26.072328 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:26.073102 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m20:47:26.117912 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m20:47:26.131251 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m20:47:26.133447 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:26.134102 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m20:47:26.209348 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:26.210268 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:26.210960 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:47:26.454580 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m20:47:26.455560 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m20:47:26.456189 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m20:47:26.730327 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:26.737813 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 20:47:23.544764 => 20:47:26.737434
[0m20:47:26.738525 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m20:47:26.783343 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.25s]
[0m20:47:26.784556 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m20:47:26.785322 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m20:47:26.786418 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m20:47:26.787550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m20:47:26.788175 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m20:47:26.820211 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m20:47:26.821510 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 20:47:26.788576 => 20:47:26.821124
[0m20:47:26.822218 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m20:47:26.871464 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:26.872522 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m20:47:26.873341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:27.759294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:27.765050 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:27.765748 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m20:47:27.836044 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:27.843189 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:27.843913 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m20:47:27.882905 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:27.896493 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:27.897315 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m20:47:27.939080 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:27.980538 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m20:47:27.983381 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:27.984029 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m20:47:28.151828 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:28.152724 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:28.153433 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m20:47:34.946972 [debug] [Thread-1 (]: SQL status: SUCCESS 2393 in 7.0 seconds
[0m20:47:34.947959 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:34.948594 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m20:47:35.231183 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:35.247306 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m20:47:35.256229 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m20:47:35.256988 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m20:47:35.358976 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:35.363181 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 20:47:26.822629 => 20:47:35.362802
[0m20:47:35.363864 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m20:47:35.409442 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2393[0m in 8.62s]
[0m20:47:35.410721 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m20:47:35.411486 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m20:47:35.412386 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m20:47:35.413772 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m20:47:35.414450 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m20:47:35.422378 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m20:47:35.423480 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 20:47:35.414867 => 20:47:35.423100
[0m20:47:35.424156 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m20:47:35.432811 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:35.433609 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m20:47:35.434400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:36.063664 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:36.071008 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:36.071721 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m20:47:36.129308 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m20:47:36.138420 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:36.139158 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m20:47:36.201717 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m20:47:36.210778 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:36.211508 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m20:47:36.255253 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m20:47:36.264370 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m20:47:36.268460 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:36.269071 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m20:47:36.385913 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:36.386845 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m20:47:36.387665 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m20:47:39.314444 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b13b5f-0001-91da-0004-d6ae000ac28e
[0m20:47:39.315269 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m20:47:39.316167 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 20:47:35.424567 => 20:47:39.315791
[0m20:47:39.316822 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m20:47:39.358225 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m20:47:39.359546 [error] [Thread-1 (]: 12 of 14 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 3.95s]
[0m20:47:39.360587 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m20:47:39.361352 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:47:39.362234 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m20:47:39.363334 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m20:47:39.363964 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:47:39.382817 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:47:39.384124 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 20:47:39.364395 => 20:47:39.383728
[0m20:47:39.384814 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:47:39.410850 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:47:39.412399 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m20:47:39.413072 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m20:47:39.413691 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:39.747200 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:39.751547 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 20:47:39.385224 => 20:47:39.751145
[0m20:47:39.752236 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m20:47:39.797456 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.43s]
[0m20:47:39.798707 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m20:47:39.800187 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m20:47:39.800974 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m20:47:39.802043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m20:47:39.802662 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m20:47:39.811170 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m20:47:39.812227 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 20:47:39.803064 => 20:47:39.811846
[0m20:47:39.812865 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m20:47:39.822339 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:39.823167 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m20:47:39.823980 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:40.970511 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:40.977692 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:40.978405 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m20:47:41.048799 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:41.056024 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:41.056686 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m20:47:41.096717 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:41.104247 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:41.104998 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m20:47:41.139350 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:47:41.145539 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m20:47:41.148276 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:41.148933 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m20:47:41.239401 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:41.240291 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:41.240984 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m20:47:43.044836 [debug] [Thread-1 (]: SQL status: SUCCESS 200 in 2.0 seconds
[0m20:47:43.046067 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:43.046720 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m20:47:43.796841 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:47:43.803427 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m20:47:43.804999 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m20:47:43.805631 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m20:47:43.982186 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:47:43.986305 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 20:47:39.813258 => 20:47:43.985905
[0m20:47:43.986979 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m20:47:44.031443 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 200[0m in 4.23s]
[0m20:47:44.032659 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m20:47:44.035298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:47:44.035849 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m20:47:44.036499 [info ] [MainThread]: 
[0m20:47:44.037127 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 29.65 seconds (29.65s).
[0m20:47:44.041115 [debug] [MainThread]: Command end result
[0m20:47:44.063138 [info ] [MainThread]: 
[0m20:47:44.063932 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:47:44.064547 [info ] [MainThread]: 
[0m20:47:44.065138 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m20:47:44.065763 [info ] [MainThread]: 
[0m20:47:44.066480 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
[0m20:47:44.067823 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 30.863678, "process_user_time": 7.758059, "process_kernel_time": 0.360012, "process_mem_max_rss": "168192", "process_in_blocks": "272", "process_out_blocks": "4056", "command_success": false}
[0m20:47:44.068713 [debug] [MainThread]: Command `dbt build` failed at 20:47:44.068489 after 30.86 seconds
[0m20:47:44.069321 [debug] [MainThread]: Flushing usage events


============================== 21:08:59.166644 | 23a257dc-4a47-4cd7-bc17-e3bcd7ddfe66 ==============================
[0m21:08:59.166644 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:08:59.170503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m21:09:00.124193 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:09:00.158041 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:09:00.237848 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:09:00.238720 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:09:00.274355 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m21:09:00.277459 [info ] [MainThread]: 
[0m21:09:00.278701 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:09:00.281222 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:09:00.302983 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:09:00.303899 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:09:00.304536 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:09:00.964623 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:09:00.967272 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:09:01.018086 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:09:01.018957 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:09:01.019513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:01.485939 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:09:01.488512 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:09:01.536554 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:09:01.537412 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:09:01.537945 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:01.903340 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:09:01.905858 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:09:01.958358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m21:09:01.972738 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m21:09:01.973540 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m21:09:01.974141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:02.374996 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m21:09:02.377650 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m21:09:02.421942 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m21:09:02.428233 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:09:02.429051 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:09:02.429656 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:02.830402 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m21:09:02.833006 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:09:03.112218 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m21:09:03.118161 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m21:09:03.118859 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m21:09:03.119378 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:03.465712 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m21:09:03.468645 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m21:09:03.520679 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:09:03.521470 [info ] [MainThread]: 
[0m21:09:03.524945 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m21:09:03.525822 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m21:09:03.527059 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m21:09:03.527722 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m21:09:03.542235 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:09:03.543588 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 21:09:03.528148 => 21:09:03.543184
[0m21:09:03.544293 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m21:09:03.591322 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:09:03.594681 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m21:09:03.595587 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m21:09:03.596321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:04.098177 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:04.130154 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 21:09:03.544713 => 21:09:04.129719
[0m21:09:04.130932 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m21:09:04.188534 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.66s]
[0m21:09:04.189753 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m21:09:04.190522 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:09:04.191274 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m21:09:04.192326 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m21:09:04.193118 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:09:04.198838 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:09:04.199917 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:09:04.193521 => 21:09:04.199536
[0m21:09:04.200555 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:09:04.206059 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m21:09:04.208027 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m21:09:04.208705 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m21:09:04.209379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:04.658181 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:04.662580 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:09:04.200950 => 21:09:04.662198
[0m21:09:04.663456 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m21:09:04.707688 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.52s]
[0m21:09:04.708915 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:09:04.709657 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:09:04.710621 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m21:09:04.711959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m21:09:04.712620 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:09:04.720341 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:09:04.721544 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:09:04.713224 => 21:09:04.721159
[0m21:09:04.722244 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:09:04.728337 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:09:04.730232 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:09:04.730892 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:09:04.731539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:05.180732 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:05.185149 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:09:04.722639 => 21:09:05.184773
[0m21:09:05.185826 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:09:05.224797 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.51s]
[0m21:09:05.226080 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:09:05.226833 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:09:05.227708 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m21:09:05.228780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m21:09:05.229419 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:09:05.235328 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:09:05.236442 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:09:05.229831 => 21:09:05.236064
[0m21:09:05.237071 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:09:05.243121 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:09:05.244797 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:09:05.245456 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:09:05.246117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:05.680906 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:05.685265 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:09:05.237463 => 21:09:05.684897
[0m21:09:05.685957 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:09:05.860159 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.63s]
[0m21:09:05.861395 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:09:05.862187 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m21:09:05.863067 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m21:09:05.864177 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m21:09:05.864820 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m21:09:05.870744 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m21:09:05.871861 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 21:09:05.865222 => 21:09:05.871479
[0m21:09:05.872532 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m21:09:05.878463 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m21:09:05.880010 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m21:09:05.880668 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m21:09:05.881316 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:06.248986 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:06.253354 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 21:09:05.872932 => 21:09:06.252987
[0m21:09:06.254041 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m21:09:06.298698 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.43s]
[0m21:09:06.299922 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m21:09:06.300672 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:09:06.301581 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m21:09:06.302701 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m21:09:06.303341 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:09:06.309206 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:09:06.310367 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:09:06.303743 => 21:09:06.309944
[0m21:09:06.311022 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:09:06.319082 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m21:09:06.320696 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m21:09:06.321339 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m21:09:06.321962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:07.022368 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:07.026775 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:09:06.311421 => 21:09:07.026396
[0m21:09:07.027481 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m21:09:07.087788 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.78s]
[0m21:09:07.088983 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:09:07.089727 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m21:09:07.090606 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m21:09:07.091642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m21:09:07.092274 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m21:09:07.097956 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m21:09:07.099068 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 21:09:07.092676 => 21:09:07.098686
[0m21:09:07.099725 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m21:09:07.105284 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m21:09:07.106559 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m21:09:07.107196 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m21:09:07.107806 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:07.620311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:07.624723 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 21:09:07.100109 => 21:09:07.624357
[0m21:09:07.625392 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m21:09:07.674109 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.58s]
[0m21:09:07.675322 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m21:09:07.676065 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m21:09:07.676932 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m21:09:07.677998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m21:09:07.678644 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m21:09:07.684313 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m21:09:07.685366 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 21:09:07.679051 => 21:09:07.684996
[0m21:09:07.686004 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m21:09:07.693332 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m21:09:07.694685 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m21:09:07.695328 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m21:09:07.695941 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:08.168104 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:08.172547 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 21:09:07.686427 => 21:09:08.172178
[0m21:09:08.173231 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m21:09:08.212614 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.53s]
[0m21:09:08.213848 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m21:09:08.214625 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m21:09:08.215475 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m21:09:08.216514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m21:09:08.217149 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m21:09:08.223115 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m21:09:08.224169 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 21:09:08.217550 => 21:09:08.223786
[0m21:09:08.224814 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m21:09:08.230506 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m21:09:08.233196 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m21:09:08.233894 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m21:09:08.234612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:08.689428 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:08.693852 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 21:09:08.225200 => 21:09:08.693468
[0m21:09:08.694555 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m21:09:08.733953 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.52s]
[0m21:09:08.735182 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m21:09:08.735937 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m21:09:08.736969 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m21:09:08.738061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m21:09:08.738687 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m21:09:08.746937 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 21:09:08.739086 => 21:09:08.746528
[0m21:09:08.747581 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m21:09:08.810286 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:08.811148 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:09:08.811776 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:09.097083 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:09:09.140192 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:09.141217 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m21:09:11.236381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m21:09:11.242196 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.242852 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:09:11.299346 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:09:11.307369 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.308057 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:09:11.360869 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:09:11.368929 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.369686 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:09:11.463570 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:09:11.471425 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.472135 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:09:11.514885 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:09:11.529370 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.530165 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:09:11.576050 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:09:11.589810 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m21:09:11.592137 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.592787 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m21:09:11.667586 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:11.668484 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.669178 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m21:09:11.880754 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m21:09:11.881738 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:09:11.882385 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m21:09:12.039641 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:12.047416 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 21:09:08.747984 => 21:09:12.047028
[0m21:09:12.048152 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m21:09:12.090590 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.35s]
[0m21:09:12.091837 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m21:09:12.092603 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m21:09:12.093516 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m21:09:12.094939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m21:09:12.095607 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m21:09:12.128462 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m21:09:12.130165 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 21:09:12.096020 => 21:09:12.129721
[0m21:09:12.130830 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m21:09:12.180372 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:12.181408 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m21:09:12.182280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:12.915304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:12.920996 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:12.921652 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m21:09:12.988548 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:12.995646 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:12.996304 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m21:09:13.044636 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:13.058629 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:13.059480 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m21:09:13.242337 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:13.286356 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m21:09:13.289219 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:13.289883 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m21:09:13.369697 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:13.370629 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:13.371337 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m21:09:19.906805 [debug] [Thread-1 (]: SQL status: SUCCESS 2393 in 7.0 seconds
[0m21:09:19.907774 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:19.908405 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m21:09:20.129316 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:20.145573 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m21:09:20.154599 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:09:20.155372 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m21:09:20.236447 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:20.240521 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 21:09:12.131240 => 21:09:20.240149
[0m21:09:20.241196 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m21:09:20.308507 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2393[0m in 8.21s]
[0m21:09:20.309738 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m21:09:20.310538 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m21:09:20.311461 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m21:09:20.312845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m21:09:20.313660 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m21:09:20.321854 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m21:09:20.323109 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 21:09:20.314101 => 21:09:20.322722
[0m21:09:20.323742 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m21:09:20.332854 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:20.333667 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m21:09:20.334450 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:20.945232 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:20.952591 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:20.953286 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m21:09:21.834320 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 1.0 seconds
[0m21:09:21.843548 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:21.844355 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m21:09:21.911659 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m21:09:21.921057 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:21.921886 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m21:09:22.017488 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m21:09:22.027005 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m21:09:22.031103 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:22.031762 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m21:09:22.116718 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:22.117602 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:09:22.118444 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m21:09:25.946709 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b13b75-0001-9040-0004-d6ae000aa2f6
[0m21:09:25.947565 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m21:09:25.948512 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 21:09:20.324139 => 21:09:25.948104
[0m21:09:25.949196 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m21:09:25.996960 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m21:09:25.998323 [error] [Thread-1 (]: 12 of 14 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 5.69s]
[0m21:09:25.999394 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m21:09:26.000196 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:09:26.001189 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m21:09:26.002462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m21:09:26.003132 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:09:26.022186 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:09:26.023529 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 21:09:26.003550 => 21:09:26.023120
[0m21:09:26.024177 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:09:26.051267 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:09:26.052900 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:09:26.053537 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m21:09:26.054200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:26.532935 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:26.537394 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 21:09:26.024575 => 21:09:26.536968
[0m21:09:26.538114 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m21:09:26.602299 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.60s]
[0m21:09:26.603537 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:09:26.604982 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m21:09:26.605817 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m21:09:26.606922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m21:09:26.607569 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m21:09:26.616437 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m21:09:26.617605 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 21:09:26.607977 => 21:09:26.617216
[0m21:09:26.618276 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m21:09:26.628259 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:26.629173 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m21:09:26.630043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:27.376878 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:09:27.384082 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:27.384837 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m21:09:27.458301 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:27.465261 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:27.465911 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m21:09:27.505759 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:27.513495 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:27.514233 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m21:09:27.563975 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:09:27.569971 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m21:09:27.572556 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:27.573174 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m21:09:27.641740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:27.642647 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:27.643349 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m21:09:29.699204 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 2.0 seconds
[0m21:09:29.700167 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:29.700765 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m21:09:29.986806 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:29.993241 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m21:09:29.994812 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:09:29.995426 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m21:09:30.063526 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:09:30.067753 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 21:09:26.618687 => 21:09:30.067353
[0m21:09:30.068501 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m21:09:30.112106 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 17[0m in 3.51s]
[0m21:09:30.113559 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m21:09:30.116383 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:09:30.116957 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m21:09:30.117587 [info ] [MainThread]: 
[0m21:09:30.118218 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 29.84 seconds (29.84s).
[0m21:09:30.122222 [debug] [MainThread]: Command end result
[0m21:09:30.144854 [info ] [MainThread]: 
[0m21:09:30.145681 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:09:30.146284 [info ] [MainThread]: 
[0m21:09:30.146858 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m21:09:30.147462 [info ] [MainThread]: 
[0m21:09:30.148077 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
[0m21:09:30.149397 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 31.050718, "process_user_time": 7.828409, "process_kernel_time": 0.256436, "process_mem_max_rss": "167936", "process_out_blocks": "4056", "command_success": false, "process_in_blocks": "0"}
[0m21:09:30.150302 [debug] [MainThread]: Command `dbt build` failed at 21:09:30.150068 after 31.05 seconds
[0m21:09:30.150908 [debug] [MainThread]: Flushing usage events


============================== 21:13:38.130444 | 4913c8c8-8412-4f4d-8451-aec24c5683dc ==============================
[0m21:13:38.130444 [info ] [MainThread]: Running with dbt=1.7.3
[0m21:13:38.134289 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m21:13:39.096750 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m21:13:39.130463 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m21:13:39.211474 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:13:39.212274 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:13:39.249695 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m21:13:39.252893 [info ] [MainThread]: 
[0m21:13:39.254183 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:13:39.257265 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m21:13:39.277924 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:13:39.278704 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:13:39.279251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:13:39.792000 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:13:39.794572 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:13:39.851407 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:13:39.852369 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:13:39.852953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:13:40.252214 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m21:13:40.254782 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:13:40.307218 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m21:13:40.308059 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m21:13:40.308593 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:13:40.906759 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m21:13:40.909250 [debug] [ThreadPool]: On list_tpcds: Close
[0m21:13:40.960644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m21:13:40.974064 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m21:13:40.974828 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m21:13:40.975348 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:13:41.274469 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m21:13:41.277063 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m21:13:41.315192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m21:13:41.320697 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m21:13:41.321275 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m21:13:41.321797 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:13:41.589262 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m21:13:41.592083 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m21:13:41.636140 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m21:13:41.643863 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m21:13:41.644498 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m21:13:41.645023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:13:42.005072 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m21:13:42.007786 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m21:13:42.055752 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:13:42.056685 [info ] [MainThread]: 
[0m21:13:42.060101 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m21:13:42.060919 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m21:13:42.061980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m21:13:42.062667 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m21:13:42.076339 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:13:42.077444 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 21:13:42.063186 => 21:13:42.077059
[0m21:13:42.078127 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m21:13:42.118850 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m21:13:42.121910 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m21:13:42.122673 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m21:13:42.123369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:42.557073 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:42.588128 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 21:13:42.078529 => 21:13:42.587733
[0m21:13:42.588898 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m21:13:42.634386 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.57s]
[0m21:13:42.635988 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m21:13:42.636779 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m21:13:42.637673 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m21:13:42.638763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m21:13:42.639638 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m21:13:42.646074 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m21:13:42.647190 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 21:13:42.640061 => 21:13:42.646820
[0m21:13:42.647835 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m21:13:42.653332 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m21:13:42.655465 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m21:13:42.656133 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m21:13:42.656785 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:43.053975 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:43.058565 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 21:13:42.648225 => 21:13:43.058162
[0m21:13:43.059279 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m21:13:43.102208 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.46s]
[0m21:13:43.103431 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m21:13:43.104187 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m21:13:43.105257 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m21:13:43.106611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m21:13:43.107239 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m21:13:43.114716 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m21:13:43.115759 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 21:13:43.107658 => 21:13:43.115383
[0m21:13:43.116400 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m21:13:43.121702 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m21:13:43.123364 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m21:13:43.124016 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m21:13:43.124642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:43.509160 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:43.513635 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 21:13:43.116796 => 21:13:43.513260
[0m21:13:43.514347 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m21:13:43.568249 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.46s]
[0m21:13:43.569451 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m21:13:43.570224 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m21:13:43.571073 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m21:13:43.572135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m21:13:43.572782 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m21:13:43.578446 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:13:43.579481 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 21:13:43.573179 => 21:13:43.579111
[0m21:13:43.580100 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m21:13:43.585478 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m21:13:43.587072 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m21:13:43.587719 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m21:13:43.588345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:43.991729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:43.995981 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 21:13:43.580494 => 21:13:43.995625
[0m21:13:43.996645 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m21:13:44.031508 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.46s]
[0m21:13:44.032700 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m21:13:44.033421 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m21:13:44.034300 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m21:13:44.035328 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m21:13:44.035952 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m21:13:44.042215 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m21:13:44.043347 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 21:13:44.036352 => 21:13:44.042968
[0m21:13:44.044005 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m21:13:44.049727 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m21:13:44.051104 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m21:13:44.051746 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m21:13:44.052354 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:44.488430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:44.492947 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 21:13:44.044408 => 21:13:44.492572
[0m21:13:44.493625 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m21:13:44.538550 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.50s]
[0m21:13:44.539743 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m21:13:44.540490 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m21:13:44.541341 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m21:13:44.542414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m21:13:44.543054 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m21:13:44.548791 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m21:13:44.549832 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 21:13:44.543446 => 21:13:44.549451
[0m21:13:44.550493 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m21:13:44.557618 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m21:13:44.559025 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m21:13:44.559663 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m21:13:44.560363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:44.976820 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:44.981292 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 21:13:44.550877 => 21:13:44.980912
[0m21:13:44.981989 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m21:13:45.029391 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.49s]
[0m21:13:45.030708 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m21:13:45.031489 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m21:13:45.032407 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m21:13:45.033539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m21:13:45.034221 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m21:13:45.040520 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m21:13:45.041790 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 21:13:45.034638 => 21:13:45.041384
[0m21:13:45.042519 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m21:13:45.048776 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m21:13:45.050213 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m21:13:45.050900 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m21:13:45.051546 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:45.958689 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:13:45.963005 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 21:13:45.042936 => 21:13:45.962643
[0m21:13:45.963659 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m21:13:46.018333 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.98s]
[0m21:13:46.019573 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m21:13:46.020317 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m21:13:46.021158 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m21:13:46.022290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m21:13:46.022921 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m21:13:46.029028 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m21:13:46.030160 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 21:13:46.023318 => 21:13:46.029750
[0m21:13:46.030820 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m21:13:46.038090 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m21:13:46.039392 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m21:13:46.040023 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m21:13:46.040633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:46.424184 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:46.428758 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 21:13:46.031216 => 21:13:46.428366
[0m21:13:46.429495 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m21:13:46.480403 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.46s]
[0m21:13:46.481670 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m21:13:46.482474 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m21:13:46.483360 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m21:13:46.484446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m21:13:46.485089 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m21:13:46.491305 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m21:13:46.492449 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 21:13:46.485521 => 21:13:46.492066
[0m21:13:46.493119 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m21:13:46.499146 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m21:13:46.501888 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m21:13:46.502643 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m21:13:46.503363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:46.919862 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:46.924149 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 21:13:46.493536 => 21:13:46.923795
[0m21:13:46.924805 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m21:13:46.996461 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.51s]
[0m21:13:46.997656 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m21:13:46.998446 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m21:13:46.999562 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m21:13:47.000659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m21:13:47.001289 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m21:13:47.009774 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 21:13:47.001686 => 21:13:47.009332
[0m21:13:47.010490 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m21:13:47.070889 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:47.071726 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:13:47.072341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:47.322281 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:13:47.363409 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:47.364418 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m21:13:48.325270 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:13:48.330965 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.331608 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:13:48.388522 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:13:48.396433 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.397113 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:13:48.429410 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:13:48.437281 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.437951 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:13:48.483495 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:13:48.491609 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.492266 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m21:13:48.528147 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m21:13:48.542040 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.542703 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m21:13:48.602715 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m21:13:48.615838 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m21:13:48.617903 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.618559 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m21:13:48.674779 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:48.675680 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.676380 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m21:13:48.964024 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m21:13:48.964997 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m21:13:48.965604 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m21:13:49.090290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:49.098361 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 21:13:47.010881 => 21:13:49.097937
[0m21:13:49.099139 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m21:13:49.144646 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.14s]
[0m21:13:49.145888 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m21:13:49.146692 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m21:13:49.147729 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m21:13:49.149118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m21:13:49.149805 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m21:13:49.182216 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.183512 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 21:13:49.150236 => 21:13:49.183113
[0m21:13:49.184147 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m21:13:49.232990 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.234036 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m21:13:49.234853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:49.782085 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:13:49.787838 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.788527 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m21:13:49.838934 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:49.846057 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.846707 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m21:13:49.893820 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:49.907476 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.908244 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m21:13:49.946530 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:49.988485 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.991326 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:49.991957 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m21:13:50.057604 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:50.058750 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:50.059535 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m21:13:53.848034 [debug] [Thread-1 (]: SQL status: SUCCESS 2393 in 4.0 seconds
[0m21:13:53.849070 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:53.849694 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m21:13:54.140948 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:54.157566 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m21:13:54.166728 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m21:13:54.167597 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m21:13:54.269226 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:54.273445 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 21:13:49.184547 => 21:13:54.273065
[0m21:13:54.274169 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m21:13:54.315861 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2393[0m in 5.17s]
[0m21:13:54.317112 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m21:13:54.317907 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m21:13:54.319034 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m21:13:54.320166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m21:13:54.320822 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m21:13:54.329254 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m21:13:54.330448 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 21:13:54.321248 => 21:13:54.330060
[0m21:13:54.331102 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m21:13:54.340160 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:54.340939 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m21:13:54.341687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:55.115621 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:13:55.122864 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:55.123611 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m21:13:55.179030 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m21:13:55.188007 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:55.188722 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m21:13:55.225020 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m21:13:55.233907 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:55.234551 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m21:13:55.284909 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m21:13:55.294080 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m21:13:55.298246 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:55.298864 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m21:13:55.368855 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:55.369774 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m21:13:55.370660 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m21:13:56.874679 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b13b79-0001-91da-0004-d6ae000ac30a
[0m21:13:56.875487 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m21:13:56.876395 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 21:13:54.331515 => 21:13:56.876021
[0m21:13:56.877043 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m21:13:56.926461 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m21:13:56.927750 [error] [Thread-1 (]: 12 of 14 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 2.61s]
[0m21:13:56.928758 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m21:13:56.929517 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:13:56.930420 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m21:13:56.931469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m21:13:56.932113 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:13:56.950909 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:13:56.952099 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 21:13:56.932513 => 21:13:56.951710
[0m21:13:56.952741 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:13:56.979256 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:13:56.980865 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m21:13:56.981513 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m21:13:56.982179 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:57.397780 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:57.402144 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 21:13:56.953144 => 21:13:57.401714
[0m21:13:57.402823 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m21:13:57.446531 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.52s]
[0m21:13:57.447763 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m21:13:57.449213 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m21:13:57.450074 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m21:13:57.451174 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m21:13:57.451811 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m21:13:57.460643 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m21:13:57.461789 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 21:13:57.452209 => 21:13:57.461416
[0m21:13:57.462466 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m21:13:57.472594 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:57.473450 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m21:13:57.474280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:13:58.029018 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m21:13:58.035965 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:58.036624 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m21:13:58.090821 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:58.097809 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:58.098492 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m21:13:58.139896 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:58.147178 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:58.147827 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m21:13:58.181989 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m21:13:58.188018 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m21:13:58.190664 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:58.191298 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m21:13:58.251164 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:58.252032 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:58.252730 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m21:13:59.055828 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 1.0 seconds
[0m21:13:59.056793 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:59.057405 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m21:13:59.297523 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:59.304120 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m21:13:59.305760 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m21:13:59.306433 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m21:13:59.397340 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m21:13:59.401402 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 21:13:57.462856 => 21:13:59.401039
[0m21:13:59.402114 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m21:13:59.444117 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 17[0m in 1.99s]
[0m21:13:59.445346 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m21:13:59.447875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:13:59.448448 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m21:13:59.449075 [info ] [MainThread]: 
[0m21:13:59.449674 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 20.20 seconds (20.20s).
[0m21:13:59.453792 [debug] [MainThread]: Command end result
[0m21:13:59.475952 [info ] [MainThread]: 
[0m21:13:59.476769 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:13:59.477352 [info ] [MainThread]: 
[0m21:13:59.477917 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m21:13:59.478592 [info ] [MainThread]: 
[0m21:13:59.479193 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
[0m21:13:59.480493 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 21.419111, "process_user_time": 7.722653, "process_kernel_time": 0.3251, "process_mem_max_rss": "167932", "process_out_blocks": "4056", "command_success": false, "process_in_blocks": "0"}
[0m21:13:59.481353 [debug] [MainThread]: Command `dbt build` failed at 21:13:59.481137 after 21.42 seconds
[0m21:13:59.481955 [debug] [MainThread]: Flushing usage events


============================== 01:13:52.858092 | bc88ad8a-7bfd-4d5b-ba87-4ee0c0ce3624 ==============================
[0m01:13:52.858092 [info ] [MainThread]: Running with dbt=1.7.3
[0m01:13:52.861729 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'False'}
[0m01:13:53.767002 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m01:13:53.797304 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m01:13:53.872831 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:13:53.873919 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m01:13:54.240731 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m01:13:54.243802 [info ] [MainThread]: 
[0m01:13:54.244986 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:13:54.247485 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m01:13:54.266851 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:13:54.267551 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:13:54.268167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:13:54.777025 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:13:54.779551 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:13:54.825248 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:13:54.826246 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:13:54.826787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:55.199924 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:13:55.202450 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:13:55.251619 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:13:55.252572 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:13:55.253123 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:55.706618 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:13:55.709000 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:13:55.761230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m01:13:55.773852 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m01:13:55.774465 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m01:13:55.774972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:56.140340 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m01:13:56.142883 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m01:13:56.186439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m01:13:56.193146 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m01:13:56.193704 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m01:13:56.194234 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:56.543645 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m01:13:56.546372 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m01:13:56.587618 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m01:13:56.592182 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m01:13:56.595725 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m01:13:56.596273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:13:56.964289 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m01:13:56.966818 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m01:13:57.008080 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:13:57.008784 [info ] [MainThread]: 
[0m01:13:57.011948 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m01:13:57.012739 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m01:13:57.013921 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m01:13:57.014727 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m01:13:57.028930 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:13:57.030074 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 01:13:57.015973 => 01:13:57.029667
[0m01:13:57.030706 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m01:13:57.071313 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:13:57.074296 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m01:13:57.074995 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m01:13:57.075671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:57.587307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:13:57.618900 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 01:13:57.031100 => 01:13:57.618502
[0m01:13:57.619652 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m01:13:57.698253 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.68s]
[0m01:13:57.699472 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m01:13:57.700253 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m01:13:57.701109 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m01:13:57.702205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m01:13:57.702865 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m01:13:57.708461 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m01:13:57.709540 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 01:13:57.703274 => 01:13:57.709153
[0m01:13:57.710202 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m01:13:57.715703 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m01:13:57.717610 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m01:13:57.718344 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m01:13:57.719016 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:58.179585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:13:58.183994 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 01:13:57.710626 => 01:13:58.183624
[0m01:13:58.184651 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m01:13:58.224715 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.52s]
[0m01:13:58.225869 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m01:13:58.226670 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m01:13:58.227706 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m01:13:58.228829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m01:13:58.229472 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m01:13:58.236716 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m01:13:58.237792 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 01:13:58.229877 => 01:13:58.237421
[0m01:13:58.238452 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m01:13:58.244140 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m01:13:58.245730 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m01:13:58.246427 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m01:13:58.247083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:58.758786 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:13:58.762987 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 01:13:58.238863 => 01:13:58.762633
[0m01:13:58.763636 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m01:13:58.809366 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.58s]
[0m01:13:58.810613 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m01:13:58.811382 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m01:13:58.812313 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m01:13:58.813394 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m01:13:58.814069 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m01:13:58.819804 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:13:58.820944 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 01:13:58.814495 => 01:13:58.820556
[0m01:13:58.821599 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m01:13:58.827901 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:13:58.829619 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m01:13:58.830322 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m01:13:58.830981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:59.241809 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:13:59.246044 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 01:13:58.822011 => 01:13:59.245666
[0m01:13:59.246698 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m01:13:59.286349 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.47s]
[0m01:13:59.287478 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m01:13:59.288210 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m01:13:59.288913 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m01:13:59.290102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m01:13:59.290724 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m01:13:59.296146 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m01:13:59.297192 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 01:13:59.291114 => 01:13:59.296825
[0m01:13:59.297790 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m01:13:59.303219 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m01:13:59.304496 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m01:13:59.305123 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m01:13:59.305739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:13:59.682853 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:13:59.687061 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 01:13:59.298228 => 01:13:59.686711
[0m01:13:59.687706 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m01:13:59.731272 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.44s]
[0m01:13:59.732379 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m01:13:59.733108 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m01:13:59.733952 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m01:13:59.735022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m01:13:59.735642 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m01:13:59.741078 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m01:13:59.742122 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 01:13:59.736037 => 01:13:59.741725
[0m01:13:59.742721 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m01:13:59.749605 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m01:13:59.751189 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m01:13:59.751825 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m01:13:59.752430 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:01.331120 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:14:01.335386 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 01:13:59.743103 => 01:14:01.335026
[0m01:14:01.336060 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m01:14:01.376482 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 1.64s]
[0m01:14:01.377655 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m01:14:01.378417 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m01:14:01.379251 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m01:14:01.380310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m01:14:01.380946 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m01:14:01.386634 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m01:14:01.387699 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 01:14:01.381338 => 01:14:01.387334
[0m01:14:01.388297 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m01:14:01.394087 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m01:14:01.395425 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m01:14:01.396054 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m01:14:01.396664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:01.803857 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:01.808105 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 01:14:01.388701 => 01:14:01.807736
[0m01:14:01.808794 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m01:14:01.853051 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.47s]
[0m01:14:01.854299 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m01:14:01.855073 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m01:14:01.856023 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m01:14:01.857173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m01:14:01.857815 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m01:14:01.865407 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m01:14:01.866618 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 01:14:01.858269 => 01:14:01.866235
[0m01:14:01.867263 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m01:14:01.873893 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m01:14:01.875452 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m01:14:01.876107 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m01:14:01.876746 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:02.388987 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:14:02.393266 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 01:14:01.867676 => 01:14:02.392908
[0m01:14:02.393941 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m01:14:02.438845 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.58s]
[0m01:14:02.439996 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m01:14:02.440735 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m01:14:02.441596 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m01:14:02.442672 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m01:14:02.443298 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m01:14:02.449209 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m01:14:02.450324 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 01:14:02.443685 => 01:14:02.449918
[0m01:14:02.450954 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m01:14:02.456670 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m01:14:02.459393 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m01:14:02.460087 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m01:14:02.460759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:02.952666 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:02.956900 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 01:14:02.451339 => 01:14:02.956549
[0m01:14:02.957541 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m01:14:02.999918 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.56s]
[0m01:14:03.001135 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m01:14:03.001920 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m01:14:03.003026 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m01:14:03.004399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m01:14:03.005021 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m01:14:03.011864 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 01:14:03.005420 => 01:14:03.011410
[0m01:14:03.012567 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m01:14:03.075297 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:03.076146 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:14:03.076745 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:03.372837 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:14:03.413818 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:03.414852 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m01:14:05.650930 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:14:05.656454 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:05.657133 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:14:05.710113 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:14:05.717783 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:05.718468 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:14:05.756851 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:14:05.764456 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:05.765145 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:14:05.862836 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:14:05.872543 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:05.873260 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:14:05.936561 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:14:05.949088 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:05.949876 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:14:06.031733 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:14:06.045108 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m01:14:06.047221 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:06.047840 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m01:14:06.130381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:06.131221 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:06.131890 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:14:06.560426 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m01:14:06.561388 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:14:06.562063 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m01:14:06.712215 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:06.719176 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 01:14:03.012960 => 01:14:06.718808
[0m01:14:06.719837 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m01:14:06.767385 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.76s]
[0m01:14:06.768601 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m01:14:06.769350 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m01:14:06.770281 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m01:14:06.771535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m01:14:06.772175 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m01:14:06.804389 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m01:14:06.805650 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 01:14:06.772578 => 01:14:06.805269
[0m01:14:06.806315 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m01:14:06.854576 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:06.855585 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m01:14:06.856385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:07.531865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:14:07.537779 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.538490 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:14:07.599949 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:07.607013 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.607666 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m01:14:07.688181 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:07.701733 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.702528 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m01:14:07.751904 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:07.795968 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.798736 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.799376 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m01:14:07.903510 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:07.904390 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:07.905123 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m01:14:14.723928 [debug] [Thread-1 (]: SQL status: SUCCESS 2393 in 7.0 seconds
[0m01:14:14.724893 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:14.725544 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m01:14:15.017572 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:15.032229 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:14:15.041697 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:14:15.042582 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m01:14:15.110185 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:15.114637 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 01:14:06.806714 => 01:14:15.114244
[0m01:14:15.115394 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m01:14:15.161060 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2393[0m in 8.39s]
[0m01:14:15.162289 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m01:14:15.163179 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m01:14:15.164157 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m01:14:15.165544 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m01:14:15.166217 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m01:14:15.174350 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m01:14:15.175589 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 01:14:15.166639 => 01:14:15.175205
[0m01:14:15.176215 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m01:14:15.185737 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:15.186672 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
WHERE IC.DBT_VALID_TO IS NULL
  );
[0m01:14:15.187411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:15.931752 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:14:15.939911 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:15.940705 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m01:14:16.046200 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:14:16.055283 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:16.055980 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m01:14:16.114911 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:14:16.123833 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:16.124545 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m01:14:16.190212 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:14:16.199378 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m01:14:16.203476 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:16.204100 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m01:14:16.281999 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:16.282892 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:16.283704 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m01:14:20.315264 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m01:14:20.316233 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:20.316855 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m01:14:20.558276 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:20.564605 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m01:14:20.566136 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:14:20.566758 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m01:14:20.644925 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:20.648946 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 01:14:15.176613 => 01:14:20.648590
[0m01:14:20.649600 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m01:14:20.689399 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 5.52s]
[0m01:14:20.690623 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m01:14:20.691392 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:14:20.692194 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m01:14:20.693531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m01:14:20.694218 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:14:20.714963 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:14:20.716252 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 01:14:20.694650 => 01:14:20.715869
[0m01:14:20.716937 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:14:20.741452 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:14:20.743070 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:14:20.743735 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m01:14:20.744354 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:21.166541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:21.170768 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 01:14:20.717335 => 01:14:21.170375
[0m01:14:21.171429 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m01:14:21.216300 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.52s]
[0m01:14:21.217497 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:14:21.218840 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m01:14:21.219758 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m01:14:21.220809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m01:14:21.221438 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m01:14:21.230072 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m01:14:21.231220 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 01:14:21.221840 => 01:14:21.230840
[0m01:14:21.231862 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m01:14:21.243283 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:21.244175 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m01:14:21.244995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:14:22.079274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:14:22.084830 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:22.085499 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:14:22.139463 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:22.146302 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:22.146931 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m01:14:22.197126 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:22.204185 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:22.204819 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m01:14:22.282135 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:14:22.288153 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m01:14:22.292795 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:22.293429 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m01:14:22.366121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:22.366947 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:22.367625 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m01:14:24.325748 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 2.0 seconds
[0m01:14:24.326715 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:24.327312 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m01:14:24.584592 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:24.590661 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:14:24.592338 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:14:24.592957 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m01:14:24.708102 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:14:24.712063 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 01:14:21.232251 => 01:14:24.711711
[0m01:14:24.712702 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m01:14:24.763941 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 17[0m in 3.54s]
[0m01:14:24.765112 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m01:14:24.767549 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:14:24.768068 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m01:14:24.768663 [info ] [MainThread]: 
[0m01:14:24.769239 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 30.52 seconds (30.52s).
[0m01:14:24.772977 [debug] [MainThread]: Command end result
[0m01:14:24.794068 [info ] [MainThread]: 
[0m01:14:24.794911 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:14:24.795490 [info ] [MainThread]: 
[0m01:14:24.796097 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m01:14:24.797427 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 32.008213, "process_user_time": 7.961728, "process_kernel_time": 0.31211, "process_mem_max_rss": "166488", "process_out_blocks": "5968", "process_in_blocks": "0"}
[0m01:14:24.798314 [debug] [MainThread]: Command `dbt build` succeeded at 01:14:24.798092 after 32.01 seconds
[0m01:14:24.798891 [debug] [MainThread]: Flushing usage events


============================== 01:19:54.584398 | 335d1b15-df08-4e84-a0c9-bd81db051939 ==============================
[0m01:19:54.584398 [info ] [MainThread]: Running with dbt=1.7.3
[0m01:19:54.588134 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'invocation_command': 'dbt build', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m01:19:55.517360 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m01:19:55.549451 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m01:19:55.627165 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:19:55.627894 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:19:55.661623 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m01:19:55.664674 [info ] [MainThread]: 
[0m01:19:55.665844 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:19:55.668335 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m01:19:55.689381 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:19:55.690266 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:19:55.690897 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:56.197091 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:19:56.199640 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:19:56.247795 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:19:56.248684 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:19:56.249214 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:56.657004 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:19:56.659523 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:19:56.707077 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m01:19:56.707911 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m01:19:56.708434 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:57.054405 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:19:57.056869 [debug] [ThreadPool]: On list_tpcds: Close
[0m01:19:57.103495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m01:19:57.116564 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m01:19:57.117265 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m01:19:57.117783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:57.427831 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m01:19:57.430395 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m01:19:57.474476 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m01:19:57.479823 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m01:19:57.480380 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m01:19:57.480919 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:57.767105 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m01:19:57.769820 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m01:19:57.819102 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m01:19:57.827003 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m01:19:57.827604 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m01:19:57.828127 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:58.174621 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m01:19:58.177239 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m01:19:58.233902 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:19:58.235741 [info ] [MainThread]: 
[0m01:19:58.239002 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m01:19:58.239798 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m01:19:58.240867 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m01:19:58.241480 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m01:19:58.254680 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:19:58.255726 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 01:19:58.241873 => 01:19:58.255337
[0m01:19:58.256363 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m01:19:58.296690 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m01:19:58.299616 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m01:19:58.300316 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m01:19:58.301020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:58.733729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:19:58.765044 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 01:19:58.256750 => 01:19:58.764642
[0m01:19:58.765825 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m01:19:58.810977 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.57s]
[0m01:19:58.812176 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m01:19:58.812917 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m01:19:58.813894 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m01:19:58.815003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m01:19:58.815639 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m01:19:58.821529 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m01:19:58.822717 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 01:19:58.816041 => 01:19:58.822325
[0m01:19:58.823378 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m01:19:58.829370 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m01:19:58.831539 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m01:19:58.832212 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m01:19:58.832861 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:59.501690 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:19:59.506038 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 01:19:58.823773 => 01:19:59.505659
[0m01:19:59.506746 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m01:19:59.556563 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.74s]
[0m01:19:59.557753 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m01:19:59.558522 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m01:19:59.559553 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m01:19:59.560625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m01:19:59.561243 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m01:19:59.568338 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m01:19:59.569409 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 01:19:59.561639 => 01:19:59.569039
[0m01:19:59.570089 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m01:19:59.575414 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m01:19:59.577050 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m01:19:59.577702 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m01:19:59.578374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:00.045283 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:00.050938 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 01:19:59.570485 => 01:20:00.050473
[0m01:20:00.051782 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m01:20:00.102258 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.54s]
[0m01:20:00.103580 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m01:20:00.104393 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m01:20:00.105419 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m01:20:00.106672 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m01:20:00.107357 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m01:20:00.116881 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:20:00.120279 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 01:20:00.107786 => 01:20:00.118977
[0m01:20:00.120996 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m01:20:00.127797 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m01:20:00.129757 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m01:20:00.130467 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m01:20:00.131201 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:00.547233 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:00.551657 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 01:20:00.121411 => 01:20:00.551266
[0m01:20:00.552430 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m01:20:00.594011 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.49s]
[0m01:20:00.595242 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m01:20:00.595992 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m01:20:00.596849 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m01:20:00.597945 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m01:20:00.598601 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m01:20:00.604399 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m01:20:00.605586 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 01:20:00.599005 => 01:20:00.605187
[0m01:20:00.606265 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m01:20:00.612398 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m01:20:00.613901 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m01:20:00.614578 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m01:20:00.615198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:01.003949 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:01.008297 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 01:20:00.606663 => 01:20:01.007905
[0m01:20:01.008969 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m01:20:01.050950 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.45s]
[0m01:20:01.052133 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m01:20:01.052884 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m01:20:01.053752 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m01:20:01.054872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m01:20:01.055495 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m01:20:01.061223 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m01:20:01.062371 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 01:20:01.055896 => 01:20:01.061953
[0m01:20:01.063004 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m01:20:01.070824 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m01:20:01.072387 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m01:20:01.073038 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m01:20:01.073671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:01.447512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:01.451834 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 01:20:01.063394 => 01:20:01.451457
[0m01:20:01.452514 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m01:20:01.505998 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.45s]
[0m01:20:01.507240 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m01:20:01.508012 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m01:20:01.508918 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m01:20:01.510064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m01:20:01.510706 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m01:20:01.516663 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m01:20:01.517854 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 01:20:01.511108 => 01:20:01.517470
[0m01:20:01.518517 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m01:20:01.524614 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m01:20:01.526002 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m01:20:01.526695 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m01:20:01.527403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:01.986059 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:01.990936 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 01:20:01.518923 => 01:20:01.990554
[0m01:20:01.991683 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m01:20:02.039805 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.53s]
[0m01:20:02.041041 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m01:20:02.041790 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m01:20:02.042729 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m01:20:02.043855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m01:20:02.044478 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m01:20:02.050660 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m01:20:02.051887 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 01:20:02.044876 => 01:20:02.051491
[0m01:20:02.052531 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m01:20:02.060677 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m01:20:02.062206 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m01:20:02.062857 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m01:20:02.063477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:02.445748 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:02.450184 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 01:20:02.052950 => 01:20:02.449756
[0m01:20:02.450922 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m01:20:02.495040 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.45s]
[0m01:20:02.496267 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m01:20:02.497037 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m01:20:02.498065 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m01:20:02.499368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m01:20:02.500023 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m01:20:02.506510 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m01:20:02.507734 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 01:20:02.500427 => 01:20:02.507328
[0m01:20:02.508363 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m01:20:02.514560 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m01:20:02.517509 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m01:20:02.518265 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m01:20:02.518954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:03.090894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:03.095251 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 01:20:02.508760 => 01:20:03.094883
[0m01:20:03.095947 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m01:20:03.134572 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.64s]
[0m01:20:03.135795 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m01:20:03.136565 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m01:20:03.137509 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m01:20:03.138835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m01:20:03.139467 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m01:20:03.147953 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 01:20:03.139878 => 01:20:03.147471
[0m01:20:03.148702 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m01:20:03.212825 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:03.213699 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:20:03.214357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:03.463929 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:20:03.506040 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:03.507060 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m01:20:04.345261 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:04.351247 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:04.352125 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:20:04.406738 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:20:04.414672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:04.415459 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:20:04.459427 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:20:04.467432 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:04.468256 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:20:05.020671 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 1.0 seconds
[0m01:20:05.029242 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:05.030129 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m01:20:05.290400 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m01:20:05.304855 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:05.305704 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m01:20:05.373523 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m01:20:05.386909 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m01:20:05.389171 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:05.389831 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m01:20:05.461991 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:05.462925 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:05.463613 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:20:05.749814 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m01:20:05.750809 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m01:20:05.751426 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m01:20:05.876226 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:05.883895 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 01:20:03.149109 => 01:20:05.883509
[0m01:20:05.884667 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m01:20:05.929654 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.79s]
[0m01:20:05.931040 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m01:20:05.931858 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m01:20:05.932796 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m01:20:05.934361 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m01:20:05.935242 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m01:20:05.969078 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m01:20:05.970478 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 01:20:05.935824 => 01:20:05.970061
[0m01:20:05.971179 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m01:20:06.023582 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:06.024658 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m01:20:06.025522 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:06.991470 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:06.997630 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:06.998466 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:20:07.060988 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:07.068238 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:07.069044 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m01:20:07.107780 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:07.121398 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:07.122261 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m01:20:07.158309 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:07.201614 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m01:20:07.204517 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:07.205209 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m01:20:07.278977 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:07.279873 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:07.280598 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m01:20:17.750725 [debug] [Thread-1 (]: SQL status: SUCCESS 2393 in 10.0 seconds
[0m01:20:17.751666 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:17.752302 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m01:20:17.985406 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:18.001268 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m01:20:18.011037 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m01:20:18.011868 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m01:20:18.082746 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:18.086791 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 01:20:05.971600 => 01:20:18.086421
[0m01:20:18.087509 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m01:20:18.136674 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2393[0m in 12.20s]
[0m01:20:18.137960 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m01:20:18.138783 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m01:20:18.139730 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m01:20:18.141097 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m01:20:18.141757 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m01:20:18.149940 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m01:20:18.151245 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 01:20:18.142228 => 01:20:18.150846
[0m01:20:18.151939 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m01:20:18.161220 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:18.162075 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
WHERE IC.DBT_VALID_TO IS NULL
  );
[0m01:20:18.162850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:18.929954 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:18.937385 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:18.938102 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m01:20:19.066407 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:20:19.075456 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:19.076248 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m01:20:19.114417 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:20:19.123586 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:19.124400 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m01:20:19.181114 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m01:20:19.190253 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m01:20:19.194425 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:19.195054 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m01:20:19.282242 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:19.283139 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:19.284015 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m01:20:22.787641 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m01:20:22.788608 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:22.789247 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m01:20:23.151749 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:23.158207 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m01:20:23.159741 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m01:20:23.160355 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m01:20:23.274462 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:23.278778 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 01:20:18.152354 => 01:20:23.278395
[0m01:20:23.279470 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m01:20:23.451790 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 5.31s]
[0m01:20:23.452963 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m01:20:23.453714 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:20:23.454423 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m01:20:23.455612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m01:20:23.456242 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:20:23.476363 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:20:23.477629 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 01:20:23.456662 => 01:20:23.477243
[0m01:20:23.478328 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:20:23.502778 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:20:23.504429 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m01:20:23.505084 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m01:20:23.505715 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:24.033068 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:24.037356 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 01:20:23.478727 => 01:20:24.036942
[0m01:20:24.038074 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m01:20:24.083007 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.63s]
[0m01:20:24.084221 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m01:20:24.085673 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m01:20:24.086506 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m01:20:24.087573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m01:20:24.088201 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m01:20:24.096918 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m01:20:24.098113 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 01:20:24.088608 => 01:20:24.097681
[0m01:20:24.098773 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m01:20:24.110505 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:24.111440 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m01:20:24.112255 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:20:24.849025 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:20:24.854928 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:24.855719 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:20:24.941453 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:24.948496 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:24.949222 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m01:20:25.039380 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:25.046822 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:25.047521 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m01:20:25.088577 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:20:25.094750 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m01:20:25.097366 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:25.098001 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m01:20:25.181731 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:25.182628 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:25.183332 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m01:20:26.114943 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 1.0 seconds
[0m01:20:26.115880 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:26.116492 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m01:20:26.410726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:26.418770 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m01:20:26.420298 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m01:20:26.420928 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m01:20:26.494605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:20:26.498598 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 01:20:24.099168 => 01:20:26.498220
[0m01:20:26.499277 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m01:20:26.553159 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 17[0m in 2.47s]
[0m01:20:26.554394 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m01:20:26.556946 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:20:26.557522 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m01:20:26.558180 [info ] [MainThread]: 
[0m01:20:26.558796 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 30.89 seconds (30.89s).
[0m01:20:26.562821 [debug] [MainThread]: Command end result
[0m01:20:26.583906 [info ] [MainThread]: 
[0m01:20:26.584706 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:20:26.585331 [info ] [MainThread]: 
[0m01:20:26.585929 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m01:20:26.587297 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 32.07157, "process_user_time": 7.766066, "process_kernel_time": 0.260565, "process_mem_max_rss": "166916", "process_out_blocks": "4064", "process_in_blocks": "0"}
[0m01:20:26.588165 [debug] [MainThread]: Command `dbt build` succeeded at 01:20:26.587942 after 32.07 seconds
[0m01:20:26.588740 [debug] [MainThread]: Flushing usage events


============================== 17:21:58.863643 | ccf72e56-797a-4d7c-a27e-d1539945aa60 ==============================
[0m17:21:58.863643 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:21:58.867270 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'static_parser': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m17:21:59.769692 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:21:59.801948 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:21:59.883090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:21:59.883840 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:21:59.919278 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:21:59.922387 [info ] [MainThread]: 
[0m17:21:59.923638 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:21:59.926117 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m17:21:59.947156 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:21:59.947970 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:21:59.948586 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:22:00.798624 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m17:22:00.801189 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:22:00.999233 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:22:01.000039 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:22:01.000594 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:01.712406 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m17:22:01.714986 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:22:01.762432 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:22:01.763367 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:22:01.763908 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:02.160214 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:22:02.162749 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:22:02.247283 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m17:22:02.260652 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:22:02.261401 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:22:02.261933 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:02.634589 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m17:22:02.637304 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:22:02.728492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m17:22:02.737755 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:22:02.738461 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:22:02.739000 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:03.149622 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:22:03.152157 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:22:03.283313 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m17:22:03.289156 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:22:03.289819 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:22:03.290380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:22:03.677624 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:22:03.680190 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:22:03.730857 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:22:03.731622 [info ] [MainThread]: 
[0m17:22:03.734830 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m17:22:03.735649 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m17:22:03.736747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m17:22:03.737389 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m17:22:03.751344 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:22:03.752610 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 17:22:03.737816 => 17:22:03.752207
[0m17:22:03.753306 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m17:22:03.796750 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:22:03.799868 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m17:22:03.800634 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m17:22:03.801344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:04.418443 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:04.449985 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 17:22:03.753716 => 17:22:04.449582
[0m17:22:04.450808 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m17:22:04.499949 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.76s]
[0m17:22:04.501159 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m17:22:04.501908 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m17:22:04.502826 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m17:22:04.503896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m17:22:04.504537 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m17:22:04.510147 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m17:22:04.511270 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 17:22:04.504943 => 17:22:04.510893
[0m17:22:04.512168 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m17:22:04.518090 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m17:22:04.520205 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m17:22:04.520873 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m17:22:04.521539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:05.745110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:05.749493 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 17:22:04.512586 => 17:22:05.749116
[0m17:22:05.750262 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m17:22:05.797513 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 1.29s]
[0m17:22:05.798787 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m17:22:05.799528 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m17:22:05.800613 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m17:22:05.801944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m17:22:05.802605 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m17:22:05.809820 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m17:22:05.810997 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 17:22:05.803004 => 17:22:05.810621
[0m17:22:05.811746 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m17:22:05.817794 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m17:22:05.819650 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m17:22:05.820324 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m17:22:05.820963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:06.355421 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:06.359820 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 17:22:05.812156 => 17:22:06.359435
[0m17:22:06.360515 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m17:22:06.411964 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.61s]
[0m17:22:06.413166 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m17:22:06.413909 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m17:22:06.414816 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m17:22:06.415920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m17:22:06.416549 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m17:22:06.422349 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:22:06.423527 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 17:22:06.416951 => 17:22:06.423135
[0m17:22:06.424192 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m17:22:06.430304 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:22:06.432032 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m17:22:06.432686 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m17:22:06.433327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:06.860236 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:06.864737 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 17:22:06.424583 => 17:22:06.864352
[0m17:22:06.865448 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m17:22:06.959715 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.54s]
[0m17:22:06.960928 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m17:22:06.961687 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m17:22:06.962587 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m17:22:06.963668 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m17:22:06.964303 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m17:22:06.969974 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m17:22:06.971121 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 17:22:06.964713 => 17:22:06.970745
[0m17:22:06.971785 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m17:22:06.977472 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m17:22:06.978896 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m17:22:06.979553 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m17:22:06.980185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:08.012427 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:08.016621 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 17:22:06.972185 => 17:22:08.016257
[0m17:22:08.017293 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m17:22:08.067824 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 1.10s]
[0m17:22:08.068996 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m17:22:08.069731 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m17:22:08.070629 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m17:22:08.071680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m17:22:08.072297 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m17:22:08.077768 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m17:22:08.078846 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 17:22:08.072712 => 17:22:08.078484
[0m17:22:08.079486 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m17:22:08.086497 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m17:22:08.087832 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m17:22:08.088484 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m17:22:08.089115 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:08.541787 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:08.546122 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 17:22:08.079872 => 17:22:08.545725
[0m17:22:08.546794 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m17:22:08.601900 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.53s]
[0m17:22:08.603131 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m17:22:08.603897 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m17:22:08.604737 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m17:22:08.605814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m17:22:08.606475 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m17:22:08.612036 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m17:22:08.613116 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 17:22:08.606878 => 17:22:08.612741
[0m17:22:08.613761 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m17:22:08.619354 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m17:22:08.620628 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m17:22:08.621273 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m17:22:08.621895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:09.105606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:09.110088 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 17:22:08.614209 => 17:22:09.109678
[0m17:22:09.110817 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m17:22:09.159339 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.55s]
[0m17:22:09.160553 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m17:22:09.161311 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m17:22:09.162269 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m17:22:09.163388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m17:22:09.164021 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m17:22:09.171521 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m17:22:09.172704 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 17:22:09.164439 => 17:22:09.172320
[0m17:22:09.173374 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m17:22:09.179193 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m17:22:09.180564 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m17:22:09.181219 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m17:22:09.181864 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:09.813710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:09.818081 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 17:22:09.173795 => 17:22:09.817696
[0m17:22:09.818740 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m17:22:09.946509 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.78s]
[0m17:22:09.947732 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m17:22:09.948490 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m17:22:09.949322 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m17:22:09.950391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m17:22:09.951027 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m17:22:09.956691 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m17:22:09.957741 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 17:22:09.951426 => 17:22:09.957358
[0m17:22:09.958404 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m17:22:09.963830 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m17:22:09.966449 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m17:22:09.967150 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m17:22:09.967826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:10.543550 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:10.547724 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 17:22:09.958806 => 17:22:10.547379
[0m17:22:10.548373 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m17:22:10.596729 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.65s]
[0m17:22:10.597936 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m17:22:10.598755 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m17:22:10.599759 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m17:22:10.601031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m17:22:10.601671 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m17:22:10.608306 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 17:22:10.602134 => 17:22:10.607899
[0m17:22:10.608954 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m17:22:10.671818 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:10.672669 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:22:10.673294 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:11.002431 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:22:11.042995 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:11.043976 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m17:22:16.287045 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m17:22:16.292499 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.293182 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:22:16.362576 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:22:16.370420 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.371174 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:22:16.418362 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:22:16.425946 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.426700 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:22:16.484869 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:22:16.494417 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.495142 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:22:16.533308 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:22:16.545531 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.546285 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:22:16.600104 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:22:16.613597 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m17:22:16.615732 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.616371 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m17:22:16.684941 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:16.685755 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:16.686489 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m17:22:20.724663 [debug] [Thread-1 (]: SQL status: SUCCESS 200000 in 4.0 seconds
[0m17:22:20.725643 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:22:20.726313 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m17:22:20.986347 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:20.993486 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 17:22:10.609372 => 17:22:20.993108
[0m17:22:20.994187 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m17:22:21.045751 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 200000[0m in 10.44s]
[0m17:22:21.046986 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m17:22:21.047733 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m17:22:21.048645 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m17:22:21.049956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m17:22:21.050613 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m17:22:21.082582 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m17:22:21.083823 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 17:22:21.051018 => 17:22:21.083445
[0m17:22:21.084458 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m17:22:21.132987 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:21.133989 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m17:22:21.134835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:21.780116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:21.785671 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:21.786349 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m17:22:21.842323 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:21.849297 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:21.850070 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m17:22:21.920999 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:21.934737 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:21.935540 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m17:22:21.987888 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:22.031788 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m17:22:22.034560 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:22.035190 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m17:22:22.115596 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:22.116436 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:22.117140 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m17:22:29.045818 [debug] [Thread-1 (]: SQL status: SUCCESS 4808 in 7.0 seconds
[0m17:22:29.046796 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:29.047435 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m17:22:29.277662 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:29.291227 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m17:22:29.299737 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:22:29.300405 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m17:22:29.384170 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:29.388169 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 17:22:21.084853 => 17:22:29.387798
[0m17:22:29.388872 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m17:22:29.432563 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 4808[0m in 8.38s]
[0m17:22:29.433747 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m17:22:29.434533 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m17:22:29.435423 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m17:22:29.436686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m17:22:29.437295 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m17:22:29.444776 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m17:22:29.445832 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 17:22:29.437690 => 17:22:29.445461
[0m17:22:29.446497 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m17:22:29.455290 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:29.456075 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
WHERE IC.DBT_VALID_TO IS NULL
  );
[0m17:22:29.456831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:30.182585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:30.190217 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:30.190883 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m17:22:30.436354 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m17:22:30.445306 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:30.446050 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m17:22:30.528291 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m17:22:30.537167 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:30.537876 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m17:22:31.152220 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 1.0 seconds
[0m17:22:31.161251 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m17:22:31.165244 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:31.165851 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m17:22:31.252501 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:31.253337 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:31.254195 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m17:22:35.890271 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 5.0 seconds
[0m17:22:35.891223 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:35.891834 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m17:22:36.132563 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:36.138978 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m17:22:36.140488 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:22:36.141103 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m17:22:36.274539 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:36.278485 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 17:22:29.446892 => 17:22:36.278127
[0m17:22:36.279127 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m17:22:36.330269 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 6.89s]
[0m17:22:36.331434 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m17:22:36.332177 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:22:36.332948 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m17:22:36.333984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m17:22:36.334646 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:22:36.354562 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:22:36.355772 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 17:22:36.335043 => 17:22:36.355398
[0m17:22:36.356450 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:22:36.380085 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:22:36.381656 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:22:36.382335 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m17:22:36.382974 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:36.798708 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:36.802902 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 17:22:36.356848 => 17:22:36.802505
[0m17:22:36.803580 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m17:22:36.846628 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.51s]
[0m17:22:36.847819 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:22:36.849216 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m17:22:36.850012 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m17:22:36.851109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m17:22:36.851728 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m17:22:36.860064 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m17:22:36.861127 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 17:22:36.852119 => 17:22:36.860750
[0m17:22:36.861728 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m17:22:36.872742 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:36.873668 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m17:22:36.874512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:22:37.621000 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:22:37.626762 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:37.627470 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m17:22:37.773182 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:37.780036 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:37.780669 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m17:22:37.835921 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:37.843265 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:37.843928 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m17:22:37.929875 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m17:22:37.936114 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m17:22:37.938690 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:37.939318 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m17:22:38.037218 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:38.038129 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:38.038846 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m17:22:40.325906 [debug] [Thread-1 (]: SQL status: SUCCESS 27 in 2.0 seconds
[0m17:22:40.326853 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:40.327454 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m17:22:40.569254 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:40.577160 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m17:22:40.578701 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:22:40.579325 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m17:22:40.691958 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:22:40.696245 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 17:22:36.862146 => 17:22:40.695876
[0m17:22:40.696916 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m17:22:40.739745 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 27[0m in 3.89s]
[0m17:22:40.740928 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m17:22:40.743531 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:22:40.744089 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m17:22:40.744741 [info ] [MainThread]: 
[0m17:22:40.745389 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 40.82 seconds (40.82s).
[0m17:22:40.749420 [debug] [MainThread]: Command end result
[0m17:22:40.770918 [info ] [MainThread]: 
[0m17:22:40.771748 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:22:40.772351 [info ] [MainThread]: 
[0m17:22:40.773002 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m17:22:40.774379 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 41.9784, "process_user_time": 7.778579, "process_kernel_time": 0.289762, "process_mem_max_rss": "166324", "process_out_blocks": "4928", "process_in_blocks": "0"}
[0m17:22:40.775262 [debug] [MainThread]: Command `dbt build` succeeded at 17:22:40.775042 after 41.98 seconds
[0m17:22:40.775868 [debug] [MainThread]: Flushing usage events


============================== 12:29:48.771715 | 32905195-5d08-4d91-ac26-ef97b9f6fdcd ==============================
[0m12:29:48.771715 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:29:48.775394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m12:29:49.700105 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m12:29:49.731778 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:29:49.811151 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:29:49.811871 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:29:49.846179 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m12:29:49.849167 [info ] [MainThread]: 
[0m12:29:49.850376 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:29:49.852841 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m12:29:49.873305 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:29:49.874083 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:29:49.874698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:29:55.600779 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 6.0 seconds
[0m12:29:55.603264 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:29:55.653772 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:29:55.654570 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:29:55.655123 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:55.919916 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m12:29:55.922457 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:29:55.973311 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:29:55.974232 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:29:55.974780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:56.347017 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m12:29:56.349432 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:29:56.412075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m12:29:56.425344 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m12:29:56.426097 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m12:29:56.426651 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:56.730563 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m12:29:56.733339 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m12:29:56.780923 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m12:29:56.790257 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m12:29:56.790879 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m12:29:56.791425 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:57.213354 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m12:29:57.215964 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m12:29:57.259775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m12:29:57.265222 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m12:29:57.265792 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m12:29:57.266350 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:57.553423 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m12:29:57.555942 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m12:29:57.598390 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:29:57.599114 [info ] [MainThread]: 
[0m12:29:57.602409 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m12:29:57.603280 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m12:29:57.604407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m12:29:57.605065 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m12:29:57.618704 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m12:29:57.619842 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 12:29:57.605481 => 12:29:57.619453
[0m12:29:57.620485 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m12:29:57.661739 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m12:29:57.664752 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m12:29:57.665480 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m12:29:57.666241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:29:58.185674 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:29:58.216527 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 12:29:57.620902 => 12:29:58.216141
[0m12:29:58.217286 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m12:29:58.266528 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.66s]
[0m12:29:58.267714 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m12:29:58.268445 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m12:29:58.269428 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m12:29:58.270545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m12:29:58.271184 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m12:29:58.276698 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m12:29:58.277730 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 12:29:58.271587 => 12:29:58.277356
[0m12:29:58.278373 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m12:29:58.283715 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m12:29:58.285624 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m12:29:58.286308 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m12:29:58.286957 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:29:58.736193 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:29:58.740441 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 12:29:58.278759 => 12:29:58.740067
[0m12:29:58.741085 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m12:29:58.812194 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.54s]
[0m12:29:58.813347 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m12:29:58.814099 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m12:29:58.815056 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m12:29:58.816086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m12:29:58.816895 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m12:29:58.822354 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m12:29:58.823383 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 12:29:58.817289 => 12:29:58.823022
[0m12:29:58.824001 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m12:29:58.829338 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m12:29:58.830888 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m12:29:58.831551 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m12:29:58.832176 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:29:59.339331 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:29:59.343534 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 12:29:58.824395 => 12:29:59.343177
[0m12:29:59.344190 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m12:29:59.411931 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.60s]
[0m12:29:59.413154 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m12:29:59.413925 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m12:29:59.414874 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m12:29:59.415968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m12:29:59.416630 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m12:29:59.422348 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m12:29:59.423456 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 12:29:59.417048 => 12:29:59.423071
[0m12:29:59.424100 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m12:29:59.431624 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m12:29:59.433284 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m12:29:59.433967 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m12:29:59.434652 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:00.030223 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:00.035532 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 12:29:59.424517 => 12:30:00.035128
[0m12:30:00.036607 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m12:30:00.098437 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.68s]
[0m12:30:00.099654 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m12:30:00.100972 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m12:30:00.102498 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m12:30:00.104134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m12:30:00.104905 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m12:30:00.111629 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m12:30:00.112942 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 12:30:00.105298 => 12:30:00.112554
[0m12:30:00.113579 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m12:30:00.121593 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m12:30:00.123575 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m12:30:00.124272 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m12:30:00.124904 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:00.557266 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:00.561796 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 12:30:00.113989 => 12:30:00.561408
[0m12:30:00.562616 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m12:30:00.631095 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.53s]
[0m12:30:00.632267 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m12:30:00.633015 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m12:30:00.633919 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m12:30:00.635070 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m12:30:00.635702 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m12:30:00.641417 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m12:30:00.642629 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 12:30:00.636106 => 12:30:00.642235
[0m12:30:00.643417 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m12:30:00.652028 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m12:30:00.653754 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m12:30:00.654649 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m12:30:00.655312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:01.104839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:01.109160 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 12:30:00.643861 => 12:30:01.108788
[0m12:30:01.109868 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m12:30:01.158267 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.52s]
[0m12:30:01.159659 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m12:30:01.161117 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m12:30:01.162867 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m12:30:01.164217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m12:30:01.164900 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m12:30:01.171929 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m12:30:01.173330 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 12:30:01.165599 => 12:30:01.172911
[0m12:30:01.173993 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m12:30:01.180701 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m12:30:01.182340 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m12:30:01.183022 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m12:30:01.183645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:01.684388 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:01.688693 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 12:30:01.174446 => 12:30:01.688309
[0m12:30:01.689416 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m12:30:01.766149 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.60s]
[0m12:30:01.767317 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m12:30:01.768064 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m12:30:01.768961 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m12:30:01.770099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m12:30:01.770749 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m12:30:01.778342 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m12:30:01.779588 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 12:30:01.771161 => 12:30:01.779202
[0m12:30:01.780216 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m12:30:01.786443 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m12:30:01.788112 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m12:30:01.788753 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m12:30:01.789379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:02.233281 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:02.237759 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 12:30:01.780614 => 12:30:02.237379
[0m12:30:02.238522 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m12:30:02.302357 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.53s]
[0m12:30:02.303537 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m12:30:02.304511 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m12:30:02.305452 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m12:30:02.306581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m12:30:02.307219 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m12:30:02.313214 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m12:30:02.314424 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 12:30:02.307625 => 12:30:02.313997
[0m12:30:02.315061 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m12:30:02.321459 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m12:30:02.324436 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m12:30:02.325214 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m12:30:02.325905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:02.800113 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:02.804539 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 12:30:02.315452 => 12:30:02.804053
[0m12:30:02.805271 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m12:30:02.860680 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.55s]
[0m12:30:02.861904 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m12:30:02.862724 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m12:30:02.863787 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m12:30:02.864969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m12:30:02.865617 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m12:30:02.872589 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 12:30:02.866063 => 12:30:02.872115
[0m12:30:02.873337 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m12:30:02.937791 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:02.938699 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:30:02.939324 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:03.215250 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:30:03.255193 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:03.256200 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m12:30:04.474878 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:04.480629 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.481437 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:30:04.549777 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:30:04.558312 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.559125 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:30:04.636906 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:30:04.644668 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.645459 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:30:04.749993 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:30:04.759488 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.760262 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:30:04.829483 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:30:04.842222 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.843071 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:30:04.967094 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:30:04.980352 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m12:30:04.982548 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:04.983182 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m12:30:05.067748 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:05.068588 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:05.069275 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m12:30:05.740683 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m12:30:05.741841 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:30:05.742536 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m12:30:05.903366 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:05.911053 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 12:30:02.873749 => 12:30:05.910664
[0m12:30:05.911822 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m12:30:06.003976 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.14s]
[0m12:30:06.005800 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m12:30:06.006662 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m12:30:06.007470 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m12:30:06.008959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m12:30:06.009648 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m12:30:06.043442 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m12:30:06.044732 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 12:30:06.010390 => 12:30:06.044343
[0m12:30:06.045377 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m12:30:06.096127 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:06.097165 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m12:30:06.098003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:06.794647 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:06.800268 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:06.800989 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m12:30:06.908777 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:06.915638 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:06.916322 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m12:30:07.012614 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:07.026073 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:07.026867 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m12:30:07.208490 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:07.251758 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m12:30:07.254509 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:07.255137 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m12:30:07.409086 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:07.409929 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:07.410682 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m12:30:11.896428 [debug] [Thread-1 (]: SQL status: SUCCESS 2415 in 4.0 seconds
[0m12:30:11.897350 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:11.897965 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m12:30:12.274975 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:12.288320 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m12:30:12.296959 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:30:12.297661 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m12:30:12.387041 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:12.390932 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 12:30:06.045780 => 12:30:12.390569
[0m12:30:12.391617 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m12:30:12.647882 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2415[0m in 6.64s]
[0m12:30:12.649077 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m12:30:12.649818 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m12:30:12.650731 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m12:30:12.652064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m12:30:12.652698 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m12:30:12.660392 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m12:30:12.661464 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 12:30:12.653098 => 12:30:12.661096
[0m12:30:12.662102 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m12:30:12.670860 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:12.671662 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
WHERE IC.DBT_VALID_TO IS NULL
  );
[0m12:30:12.672394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:13.664050 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:13.669660 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:13.670443 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m12:30:13.766388 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:30:13.775594 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:13.776373 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m12:30:13.836208 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:30:13.845089 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:13.845834 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m12:30:13.920514 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:30:13.929651 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m12:30:13.933756 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:13.934432 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m12:30:14.119148 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:14.120006 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:14.120834 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m12:30:18.084075 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m12:30:18.085032 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:18.085673 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m12:30:18.737631 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:18.746594 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m12:30:18.748271 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:30:18.748925 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m12:30:18.826487 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:18.830420 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 12:30:12.662503 => 12:30:18.830054
[0m12:30:18.831120 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m12:30:18.914752 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 6.26s]
[0m12:30:18.915915 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m12:30:18.916666 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:30:18.917428 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m12:30:18.918535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m12:30:18.919179 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:30:18.937920 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:30:18.939238 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 12:30:18.919599 => 12:30:18.938841
[0m12:30:18.939876 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:30:18.964283 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:30:18.965856 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:30:18.966528 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m12:30:18.967159 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:19.340721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:19.344982 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 12:30:18.940275 => 12:30:19.344577
[0m12:30:19.345706 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m12:30:19.507869 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.59s]
[0m12:30:19.509040 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:30:19.510412 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m12:30:19.511200 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m12:30:19.512240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m12:30:19.512876 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m12:30:19.521325 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m12:30:19.522451 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 12:30:19.513274 => 12:30:19.522062
[0m12:30:19.523081 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m12:30:19.535039 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:19.535981 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m12:30:19.536812 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:20.365229 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:20.370995 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:20.371720 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m12:30:20.431931 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:20.439313 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:20.440085 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m12:30:20.592201 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:20.599309 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:20.600024 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m12:30:20.640923 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:30:20.649539 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m12:30:20.652267 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:20.652914 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m12:30:22.516974 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m12:30:22.518040 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:22.518786 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m12:30:24.089707 [debug] [Thread-1 (]: SQL status: SUCCESS 27 in 2.0 seconds
[0m12:30:24.090691 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:24.091311 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m12:30:24.385355 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:24.391584 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m12:30:24.393125 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:30:24.393763 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m12:30:24.481068 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:24.484997 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 12:30:19.523472 => 12:30:24.484642
[0m12:30:24.485672 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m12:30:24.532337 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 27[0m in 5.02s]
[0m12:30:24.533564 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m12:30:24.536195 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:30:24.536785 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m12:30:24.537425 [info ] [MainThread]: 
[0m12:30:24.538081 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 34.69 seconds (34.69s).
[0m12:30:24.541955 [debug] [MainThread]: Command end result
[0m12:30:24.562946 [info ] [MainThread]: 
[0m12:30:24.563767 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:30:24.564363 [info ] [MainThread]: 
[0m12:30:24.564979 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m12:30:24.566331 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 35.86355, "process_user_time": 7.963782, "process_kernel_time": 0.313679, "process_mem_max_rss": "168696", "process_out_blocks": "4896", "process_in_blocks": "0"}
[0m12:30:24.567181 [debug] [MainThread]: Command `dbt build` succeeded at 12:30:24.566963 after 35.86 seconds
[0m12:30:24.567749 [debug] [MainThread]: Flushing usage events


============================== 12:41:15.509426 | c92782bd-945d-45e4-b4f4-28e47efcb0d5 ==============================
[0m12:41:15.509426 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:41:15.513072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'static_parser': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m12:41:16.429322 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m12:41:16.460414 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:41:16.536793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:41:16.537536 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:41:16.571973 [info ] [MainThread]: Found 12 models, 1 snapshot, 1 test, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m12:41:16.575007 [info ] [MainThread]: 
[0m12:41:16.576174 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:41:16.578640 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m12:41:16.599486 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:41:16.600350 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:41:16.600959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:41:17.340798 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m12:41:17.343305 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:41:17.400104 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:41:17.401095 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:41:17.401650 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:17.799997 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m12:41:17.802449 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:41:17.857597 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m12:41:17.858401 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m12:41:17.858945 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:18.275656 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m12:41:18.278093 [debug] [ThreadPool]: On list_tpcds: Close
[0m12:41:18.325268 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m12:41:18.338097 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m12:41:18.338746 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m12:41:18.339263 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:18.625935 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m12:41:18.628512 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m12:41:18.679826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m12:41:18.685347 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m12:41:18.685951 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m12:41:18.686538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:19.017397 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m12:41:19.020183 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m12:41:19.076259 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m12:41:19.083782 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m12:41:19.084390 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m12:41:19.084923 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:41:19.399168 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m12:41:19.401695 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m12:41:19.456639 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:41:19.457839 [info ] [MainThread]: 
[0m12:41:19.460962 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m12:41:19.461747 [info ] [Thread-1 (]: 1 of 14 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m12:41:19.462837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m12:41:19.463464 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m12:41:19.476721 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m12:41:19.477848 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 12:41:19.463868 => 12:41:19.477469
[0m12:41:19.478533 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m12:41:19.519204 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m12:41:19.522255 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m12:41:19.522970 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m12:41:19.523653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:20.032844 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:41:20.063966 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 12:41:19.478930 => 12:41:20.063583
[0m12:41:20.064730 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m12:41:20.111836 [info ] [Thread-1 (]: 1 of 14 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.65s]
[0m12:41:20.113286 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m12:41:20.114074 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m12:41:20.114896 [info ] [Thread-1 (]: 2 of 14 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m12:41:20.115928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m12:41:20.116560 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m12:41:20.121987 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m12:41:20.123040 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 12:41:20.116950 => 12:41:20.122680
[0m12:41:20.123642 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m12:41:20.128904 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m12:41:20.130803 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m12:41:20.131457 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m12:41:20.132098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:20.539994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:20.544463 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 12:41:20.124026 => 12:41:20.544092
[0m12:41:20.545146 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m12:41:20.588607 [info ] [Thread-1 (]: 2 of 14 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.47s]
[0m12:41:20.589826 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m12:41:20.590621 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m12:41:20.591671 [info ] [Thread-1 (]: 3 of 14 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m12:41:20.592943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m12:41:20.593594 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m12:41:20.600809 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m12:41:20.601953 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 12:41:20.594045 => 12:41:20.601561
[0m12:41:20.602628 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m12:41:20.608254 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m12:41:20.609863 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m12:41:20.610570 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m12:41:20.611237 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:21.075224 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:21.079514 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 12:41:20.603032 => 12:41:21.079142
[0m12:41:21.080223 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m12:41:21.132247 [info ] [Thread-1 (]: 3 of 14 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.54s]
[0m12:41:21.133444 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m12:41:21.134229 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m12:41:21.135117 [info ] [Thread-1 (]: 4 of 14 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m12:41:21.136221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m12:41:21.136854 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m12:41:21.142821 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m12:41:21.143981 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 12:41:21.137257 => 12:41:21.143596
[0m12:41:21.144604 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m12:41:21.150525 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m12:41:21.152180 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m12:41:21.152835 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m12:41:21.153470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:21.617216 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:21.621403 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 12:41:21.144998 => 12:41:21.621051
[0m12:41:21.622093 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m12:41:21.670577 [info ] [Thread-1 (]: 4 of 14 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.53s]
[0m12:41:21.671846 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m12:41:21.672573 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m12:41:21.673397 [info ] [Thread-1 (]: 5 of 14 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m12:41:21.674475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m12:41:21.675101 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m12:41:21.680589 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m12:41:21.681675 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 12:41:21.675493 => 12:41:21.681296
[0m12:41:21.682326 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m12:41:21.687742 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m12:41:21.689085 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m12:41:21.689718 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m12:41:21.690359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:22.102001 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:22.106462 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 12:41:21.682716 => 12:41:22.106083
[0m12:41:22.107166 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m12:41:22.154673 [info ] [Thread-1 (]: 5 of 14 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.48s]
[0m12:41:22.155838 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m12:41:22.156579 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m12:41:22.157466 [info ] [Thread-1 (]: 6 of 14 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m12:41:22.158545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m12:41:22.159186 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m12:41:22.164683 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m12:41:22.165725 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 12:41:22.159586 => 12:41:22.165358
[0m12:41:22.166372 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m12:41:22.173498 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m12:41:22.174881 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m12:41:22.175513 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m12:41:22.176132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:22.575881 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:22.580184 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 12:41:22.166773 => 12:41:22.579794
[0m12:41:22.580862 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m12:41:22.624779 [info ] [Thread-1 (]: 6 of 14 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.47s]
[0m12:41:22.625975 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m12:41:22.626884 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m12:41:22.627745 [info ] [Thread-1 (]: 7 of 14 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m12:41:22.628801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m12:41:22.629432 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m12:41:22.634955 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m12:41:22.636010 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 12:41:22.629829 => 12:41:22.635635
[0m12:41:22.636608 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m12:41:22.641997 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m12:41:22.643280 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m12:41:22.643929 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m12:41:22.644533 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:23.020231 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:23.024451 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 12:41:22.636998 => 12:41:23.024094
[0m12:41:23.025109 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m12:41:23.074636 [info ] [Thread-1 (]: 7 of 14 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.45s]
[0m12:41:23.075852 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m12:41:23.076590 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m12:41:23.077493 [info ] [Thread-1 (]: 8 of 14 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m12:41:23.078608 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m12:41:23.079236 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m12:41:23.084916 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m12:41:23.086100 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 12:41:23.079637 => 12:41:23.085695
[0m12:41:23.086734 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m12:41:23.094267 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m12:41:23.095603 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m12:41:23.096243 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m12:41:23.096857 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:23.541589 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:23.545868 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 12:41:23.087128 => 12:41:23.545512
[0m12:41:23.546576 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m12:41:23.588995 [info ] [Thread-1 (]: 8 of 14 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.51s]
[0m12:41:23.590217 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m12:41:23.590948 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m12:41:23.591796 [info ] [Thread-1 (]: 9 of 14 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m12:41:23.592838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m12:41:23.593471 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m12:41:23.599360 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m12:41:23.600502 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 12:41:23.593869 => 12:41:23.600130
[0m12:41:23.601133 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m12:41:23.607036 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m12:41:23.609814 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m12:41:23.610551 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m12:41:23.611223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:24.107616 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:24.111835 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 12:41:23.601525 => 12:41:24.111477
[0m12:41:24.112493 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m12:41:24.160980 [info ] [Thread-1 (]: 9 of 14 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.57s]
[0m12:41:24.162206 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m12:41:24.162952 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m12:41:24.163907 [info ] [Thread-1 (]: 10 of 14 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m12:41:24.165153 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m12:41:24.165772 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m12:41:24.173840 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 12:41:24.166217 => 12:41:24.173424
[0m12:41:24.174536 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m12:41:24.235742 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:24.236572 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:41:24.237181 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:24.528369 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:41:24.568902 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:24.569865 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            nullif(_AIRBYTE_NORMALIZED_AT, _AIRBYTE_NORMALIZED_AT) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(_AIRBYTE_NORMALIZED_AT as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            _AIRBYTE_NORMALIZED_AT as dbt_updated_at,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_from,
            _AIRBYTE_NORMALIZED_AT as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data._AIRBYTE_NORMALIZED_AT)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m12:41:26.901117 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m12:41:26.906537 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:26.907174 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:41:26.957988 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:41:26.965757 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:26.966476 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:41:27.031185 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:41:27.038904 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.039707 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:41:27.074700 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:41:27.082389 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.083056 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m12:41:27.132247 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m12:41:27.146162 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.146909 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m12:41:27.231815 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m12:41:27.244929 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m12:41:27.247034 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.247647 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m12:41:27.337915 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:27.338872 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.339574 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m12:41:27.745480 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m12:41:27.746429 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m12:41:27.747050 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m12:41:27.887770 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:27.895203 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 12:41:24.174929 => 12:41:27.894838
[0m12:41:27.895881 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m12:41:27.940686 [info ] [Thread-1 (]: 10 of 14 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.78s]
[0m12:41:27.941883 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m12:41:27.942662 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m12:41:27.943560 [info ] [Thread-1 (]: 11 of 14 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m12:41:27.944916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m12:41:27.945585 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m12:41:27.977972 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m12:41:27.979273 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 12:41:27.946001 => 12:41:27.978875
[0m12:41:27.979929 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m12:41:28.029790 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.030860 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m12:41:28.031694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:28.655160 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:41:28.660645 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.661313 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m12:41:28.717917 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:28.724895 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.725640 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m12:41:28.768431 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:28.781716 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.782540 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m12:41:28.827182 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:28.868045 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.870816 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.871438 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m12:41:28.944613 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:28.945471 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:28.946221 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m12:41:35.622425 [debug] [Thread-1 (]: SQL status: SUCCESS 2415 in 7.0 seconds
[0m12:41:35.623352 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:35.623960 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m12:41:35.862829 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:35.878251 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m12:41:35.886897 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m12:41:35.887597 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m12:41:35.970791 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:35.974859 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 12:41:27.980384 => 12:41:35.974489
[0m12:41:35.975551 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m12:41:36.025335 [info ] [Thread-1 (]: 11 of 14 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2415[0m in 8.08s]
[0m12:41:36.026622 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m12:41:36.027411 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m12:41:36.028319 [info ] [Thread-1 (]: 12 of 14 START sql incremental model analytics.customer_dim .................... [RUN]
[0m12:41:36.029679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m12:41:36.030367 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m12:41:36.038250 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m12:41:36.039397 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 12:41:36.030785 => 12:41:36.039010
[0m12:41:36.040070 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m12:41:36.049205 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.050078 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
WHERE IC.DBT_VALID_TO IS NULL
  );
[0m12:41:36.050852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:36.651334 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:41:36.658329 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.658996 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m12:41:36.750350 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:41:36.759124 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.759826 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m12:41:36.804519 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:41:36.813249 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.813932 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m12:41:36.863326 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m12:41:36.872352 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m12:41:36.876433 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.877072 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m12:41:36.942497 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:36.943366 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:36.944199 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m12:41:44.029361 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 7.0 seconds
[0m12:41:44.030345 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:44.030969 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m12:41:44.285640 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:44.291951 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m12:41:44.293458 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m12:41:44.294117 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m12:41:44.373369 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:44.377359 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 12:41:36.040492 => 12:41:44.377002
[0m12:41:44.378004 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m12:41:44.421608 [info ] [Thread-1 (]: 12 of 14 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 8.39s]
[0m12:41:44.422795 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m12:41:44.423543 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:41:44.424333 [info ] [Thread-1 (]: 13 of 14 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m12:41:44.425390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m12:41:44.426036 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:41:44.445896 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:41:44.447143 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 12:41:44.426448 => 12:41:44.446763
[0m12:41:44.447807 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:41:44.471133 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:41:44.472642 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m12:41:44.473286 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m12:41:44.473905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:45.085047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:41:45.089513 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 12:41:44.448209 => 12:41:45.089114
[0m12:41:45.090214 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m12:41:45.171089 [info ] [Thread-1 (]: 13 of 14 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.75s]
[0m12:41:45.172292 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m12:41:45.173754 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m12:41:45.174630 [info ] [Thread-1 (]: 14 of 14 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m12:41:45.175726 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now model.capstone.weekly_sales_inventory)
[0m12:41:45.176354 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m12:41:45.184863 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m12:41:45.185957 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 12:41:45.176758 => 12:41:45.185577
[0m12:41:45.186597 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m12:41:45.198354 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.199295 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m12:41:45.200114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:41:45.644164 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:45.649746 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.650466 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m12:41:45.700012 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:45.706796 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.707466 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m12:41:45.749917 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:45.756692 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.757345 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m12:41:45.806932 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:41:45.813018 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m12:41:45.815562 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.816191 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m12:41:45.893293 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:45.894234 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:45.894955 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m12:41:47.465007 [debug] [Thread-1 (]: SQL status: SUCCESS 27 in 2.0 seconds
[0m12:41:47.465939 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:47.466599 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m12:41:47.749238 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:47.757394 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m12:41:47.758994 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m12:41:47.759630 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m12:41:47.833836 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:41:47.837777 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 12:41:45.186990 => 12:41:47.837422
[0m12:41:47.838455 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m12:41:47.885811 [info ] [Thread-1 (]: 14 of 14 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 27[0m in 2.71s]
[0m12:41:47.887038 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m12:41:47.889468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:41:47.890006 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m12:41:47.890676 [info ] [MainThread]: 
[0m12:41:47.891281 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 1 test in 0 hours 0 minutes and 31.31 seconds (31.31s).
[0m12:41:47.895427 [debug] [MainThread]: Command end result
[0m12:41:47.916164 [info ] [MainThread]: 
[0m12:41:47.917023 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:41:47.917621 [info ] [MainThread]: 
[0m12:41:47.918604 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=0 SKIP=0 TOTAL=14
[0m12:41:47.919977 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 32.47799, "process_user_time": 7.600098, "process_kernel_time": 0.316063, "process_mem_max_rss": "167224", "process_out_blocks": "4072", "process_in_blocks": "0"}
[0m12:41:47.920827 [debug] [MainThread]: Command `dbt build` succeeded at 12:41:47.920614 after 32.48 seconds
[0m12:41:47.921409 [debug] [MainThread]: Flushing usage events


============================== 17:31:11.577966 | 1254f7d6-b4be-4d66-89ea-23fbcb51e748 ==============================
[0m17:31:11.577966 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:31:11.581750 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:31:12.507479 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:31:12.538666 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:31:12.618949 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 2 files changed.
[0m17:31:12.620219 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m17:31:12.620934 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:31:13.139084 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  invalid syntax for function call expression
    line 4
      config(
[0m17:31:13.140580 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.6325675, "process_user_time": 4.309207, "process_kernel_time": 0.263791, "process_mem_max_rss": "153848", "process_in_blocks": "8", "process_out_blocks": "16", "command_success": false}
[0m17:31:13.141602 [debug] [MainThread]: Command `dbt test` failed at 17:31:13.141378 after 1.63 seconds
[0m17:31:13.142212 [debug] [MainThread]: Flushing usage events


============================== 17:32:23.119496 | 5815a509-85a7-4344-86d7-8afe1fbe727f ==============================
[0m17:32:23.119496 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:32:23.123162 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:32:24.043339 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:32:24.074850 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:32:24.154920 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 2 files changed.
[0m17:32:24.156206 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m17:32:24.156896 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:32:24.649093 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  invalid syntax for function call expression
    line 4
      config(
[0m17:32:24.650537 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.5984341, "process_user_time": 4.300152, "process_kernel_time": 0.256023, "process_mem_max_rss": "153724", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m17:32:24.651519 [debug] [MainThread]: Command `dbt test` failed at 17:32:24.651286 after 1.60 seconds
[0m17:32:24.652098 [debug] [MainThread]: Flushing usage events


============================== 17:36:31.301046 | 4722ed6b-80e6-47c1-8c3c-a9f552748c96 ==============================
[0m17:36:31.301046 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:36:31.304689 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:36:32.244300 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:36:32.276563 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:36:32.354703 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 2 files changed.
[0m17:36:32.356035 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:36:32.356777 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m17:36:32.861479 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot customer_snapshot (snapshots/customer_snapshot.sql)
  invalid syntax for function call expression
    line 4
      config(
[0m17:36:32.862968 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.6292216, "process_user_time": 4.400974, "process_kernel_time": 0.216084, "process_mem_max_rss": "153768", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m17:36:32.863969 [debug] [MainThread]: Command `dbt test` failed at 17:36:32.863739 after 1.63 seconds
[0m17:36:32.864565 [debug] [MainThread]: Flushing usage events


============================== 17:37:19.833099 | 1fb90e6e-c185-4a17-a82b-d192f8254357 ==============================
[0m17:37:19.833099 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:37:19.836938 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt test', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m17:37:20.775898 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:37:20.807901 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:37:20.884426 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 2 files changed.
[0m17:37:20.885678 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m17:37:20.886414 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:37:21.482413 [info ] [MainThread]: Found 12 models, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:37:21.484863 [info ] [MainThread]: 
[0m17:37:21.485441 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m17:37:21.486261 [debug] [MainThread]: Command end result
[0m17:37:21.516570 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 1.7526242, "process_user_time": 4.504422, "process_kernel_time": 0.235735, "process_mem_max_rss": "159728", "process_out_blocks": "5408", "process_in_blocks": "0"}
[0m17:37:21.517560 [debug] [MainThread]: Command `dbt test` succeeded at 17:37:21.517346 after 1.75 seconds
[0m17:37:21.518160 [debug] [MainThread]: Flushing usage events


============================== 17:37:58.935897 | abdb874b-68a2-4009-8827-a0b4348092aa ==============================
[0m17:37:58.935897 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:37:58.939676 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m17:37:59.872586 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:37:59.905531 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:37:59.982939 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m17:37:59.984043 [debug] [MainThread]: Partial parsing: added file: capstone://models/intermediate/_int__test.yml
[0m17:38:00.423099 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:38:00.426145 [info ] [MainThread]: 
[0m17:38:00.427387 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:38:00.429914 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_intermediate'
[0m17:38:00.452529 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:38:00.453281 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:38:00.453873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:00.856201 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:38:00.858782 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:38:00.917701 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m17:38:00.923544 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:38:00.924153 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:38:00.924675 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:01.523110 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m17:38:01.525628 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:38:01.574264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m17:38:01.581403 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:38:01.582097 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:38:01.582669 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:02.054450 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m17:38:02.057300 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:38:02.109677 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:38:02.110570 [info ] [MainThread]: 
[0m17:38:02.113759 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:02.114504 [info ] [Thread-1 (]: 1 of 4 START test not_null_int__daily_aggregated_sales_item_sk ................. [RUN]
[0m17:38:02.115631 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m17:38:02.116659 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:02.143337 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:02.144606 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 17:38:02.117102 => 17:38:02.144198
[0m17:38:02.145276 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:02.175470 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:02.177042 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:02.177757 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m17:38:02.178466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:03.020710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:38:03.030977 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 17:38:02.145704 => 17:38:03.030462
[0m17:38:03.031801 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m17:38:03.083517 [info ] [Thread-1 (]: 1 of 4 PASS not_null_int__daily_aggregated_sales_item_sk ....................... [[32mPASS[0m in 0.97s]
[0m17:38:03.084747 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:03.085497 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:03.086319 [info ] [Thread-1 (]: 2 of 4 START test not_null_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m17:38:03.087413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m17:38:03.088062 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:03.095955 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:03.097144 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 17:38:03.088494 => 17:38:03.096747
[0m17:38:03.097786 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:03.103121 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:03.104561 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:03.105223 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m17:38:03.105862 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:03.512055 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:38:03.515448 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 17:38:03.098236 => 17:38:03.515034
[0m17:38:03.516135 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m17:38:03.567031 [info ] [Thread-1 (]: 2 of 4 PASS not_null_int__daily_aggregated_sales_warehouse_sk .................. [[32mPASS[0m in 0.48s]
[0m17:38:03.568393 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:03.569164 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd
[0m17:38:03.569980 [info ] [Thread-1 (]: 3 of 4 START test not_null_int__daily_aggregated_sales_wk_sk ................... [RUN]
[0m17:38:03.571065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd)
[0m17:38:03.571712 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd
[0m17:38:03.579651 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd"
[0m17:38:03.580675 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd (compile): 17:38:03.572120 => 17:38:03.580287
[0m17:38:03.581301 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd
[0m17:38:03.587752 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd"
[0m17:38:03.588965 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd"
[0m17:38:03.589603 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_sk
from tpcds.intermediate.int__daily_aggregated_sales
where wk_sk is null



      
    ) dbt_internal_test
[0m17:38:03.590256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:03.916792 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b1416e-0001-91f5-0004-d6ae000b514e
[0m17:38:03.917595 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 7
invalid identifier 'WK_SK'
[0m17:38:03.918543 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd (execute): 17:38:03.581708 => 17:38:03.918141
[0m17:38:03.919227 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd: Close
[0m17:38:03.972180 [debug] [Thread-1 (]: Database Error in test not_null_int__daily_aggregated_sales_wk_sk (models/intermediate/_int__test.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'WK_SK'
  compiled Code at target/run/capstone/models/intermediate/_int__test.yml/not_null_int__daily_aggregated_sales_wk_sk.sql
[0m17:38:03.973215 [error] [Thread-1 (]: 3 of 4 ERROR not_null_int__daily_aggregated_sales_wk_sk ........................ [[31mERROR[0m in 0.40s]
[0m17:38:03.974286 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd
[0m17:38:03.975046 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:03.975993 [info ] [Thread-1 (]: 4 of 4 START test not_null_int__daily_aggregated_sales_yr_num .................. [RUN]
[0m17:38:03.977076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_sk.c53e33c3dd, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m17:38:03.977720 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:03.985882 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:03.987003 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 17:38:03.978164 => 17:38:03.986602
[0m17:38:03.987671 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:03.992859 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:03.994191 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:03.994861 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m17:38:03.995531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:04.591829 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:38:04.595212 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 17:38:03.988118 => 17:38:04.594798
[0m17:38:04.595889 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m17:38:04.643373 [info ] [Thread-1 (]: 4 of 4 PASS not_null_int__daily_aggregated_sales_yr_num ........................ [[32mPASS[0m in 0.67s]
[0m17:38:04.644590 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:04.647012 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:04.647552 [debug] [MainThread]: Connection 'test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7' was properly closed.
[0m17:38:04.648140 [info ] [MainThread]: 
[0m17:38:04.648754 [info ] [MainThread]: Finished running 4 tests in 0 hours 0 minutes and 4.22 seconds (4.22s).
[0m17:38:04.650711 [debug] [MainThread]: Command end result
[0m17:38:04.672956 [info ] [MainThread]: 
[0m17:38:04.673738 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:38:04.674326 [info ] [MainThread]: 
[0m17:38:04.674901 [error] [MainThread]:   Database Error in test not_null_int__daily_aggregated_sales_wk_sk (models/intermediate/_int__test.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'WK_SK'
  compiled Code at target/run/capstone/models/intermediate/_int__test.yml/not_null_int__daily_aggregated_sales_wk_sk.sql
[0m17:38:04.675493 [info ] [MainThread]: 
[0m17:38:04.676098 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m17:38:04.677403 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 5.8114767, "process_user_time": 5.428362, "process_kernel_time": 0.284583, "process_mem_max_rss": "165232", "process_in_blocks": "16", "process_out_blocks": "5568", "command_success": false}
[0m17:38:04.678318 [debug] [MainThread]: Command `dbt test` failed at 17:38:04.678088 after 5.81 seconds
[0m17:38:04.678924 [debug] [MainThread]: Flushing usage events


============================== 17:38:48.966228 | be64b8d6-2a5e-47f5-824f-e155ead2f0bb ==============================
[0m17:38:48.966228 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:38:48.970064 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'False'}
[0m17:38:49.900262 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:38:49.933253 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:38:50.011346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:38:50.012666 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/_int__test.yml
[0m17:38:50.618812 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:38:50.621705 [info ] [MainThread]: 
[0m17:38:50.622890 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:38:50.625286 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_staging'
[0m17:38:50.646907 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:38:50.647570 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:38:50.648093 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:51.062524 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m17:38:51.065309 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:38:51.122480 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m17:38:51.130113 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:38:51.130747 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:38:51.131264 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:51.502094 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:38:51.504606 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:38:51.551987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m17:38:51.556602 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:38:51.558099 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:38:51.558644 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:51.837228 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:38:51.839842 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:38:51.890954 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:38:51.891675 [info ] [MainThread]: 
[0m17:38:51.894715 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:51.895384 [info ] [Thread-1 (]: 1 of 4 START test not_null_int__daily_aggregated_sales_item_sk ................. [RUN]
[0m17:38:51.896436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m17:38:51.897048 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:51.922922 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:51.924203 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 17:38:51.897725 => 17:38:51.923812
[0m17:38:51.924838 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:51.954011 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:51.955596 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:38:51.956246 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m17:38:51.956857 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:52.298822 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:38:52.308654 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 17:38:51.925240 => 17:38:52.308206
[0m17:38:52.309369 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m17:38:52.360343 [info ] [Thread-1 (]: 1 of 4 PASS not_null_int__daily_aggregated_sales_item_sk ....................... [[32mPASS[0m in 0.46s]
[0m17:38:52.361524 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:38:52.362274 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:52.363081 [info ] [Thread-1 (]: 2 of 4 START test not_null_int__daily_aggregated_sales_warehouse_sk ............ [RUN]
[0m17:38:52.364118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m17:38:52.364742 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:52.373868 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:52.374981 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 17:38:52.365154 => 17:38:52.374600
[0m17:38:52.375601 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:52.380333 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:52.381583 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:38:52.382239 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m17:38:52.382869 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:52.764319 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:38:52.767778 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 17:38:52.376002 => 17:38:52.767364
[0m17:38:52.768457 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m17:38:52.813718 [info ] [Thread-1 (]: 2 of 4 PASS not_null_int__daily_aggregated_sales_warehouse_sk .................. [[32mPASS[0m in 0.45s]
[0m17:38:52.814971 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:38:52.815748 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:38:52.816564 [info ] [Thread-1 (]: 3 of 4 START test not_null_int__daily_aggregated_sales_wk_num .................. [RUN]
[0m17:38:52.817644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m17:38:52.818337 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:38:52.826096 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:38:52.827137 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 17:38:52.818766 => 17:38:52.826758
[0m17:38:52.827780 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:38:52.832678 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:38:52.833904 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:38:52.834631 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m17:38:52.835272 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:55.613956 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m17:38:55.617280 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 17:38:52.828187 => 17:38:55.616886
[0m17:38:55.617953 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m17:38:55.664622 [info ] [Thread-1 (]: 3 of 4 PASS not_null_int__daily_aggregated_sales_wk_num ........................ [[32mPASS[0m in 2.85s]
[0m17:38:55.665840 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:38:55.666732 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:55.667379 [info ] [Thread-1 (]: 4 of 4 START test not_null_int__daily_aggregated_sales_yr_num .................. [RUN]
[0m17:38:55.668562 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m17:38:55.669183 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:55.676676 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:55.677733 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 17:38:55.669581 => 17:38:55.677359
[0m17:38:55.678383 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:55.683286 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:55.684573 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:38:55.685203 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m17:38:55.685824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:56.045737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:38:56.049106 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 17:38:55.678776 => 17:38:56.048716
[0m17:38:56.049776 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m17:38:56.089997 [info ] [Thread-1 (]: 4 of 4 PASS not_null_int__daily_aggregated_sales_yr_num ........................ [[32mPASS[0m in 0.42s]
[0m17:38:56.091227 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:38:56.093713 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:56.094318 [debug] [MainThread]: Connection 'test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7' was properly closed.
[0m17:38:56.094902 [info ] [MainThread]: 
[0m17:38:56.095488 [info ] [MainThread]: Finished running 4 tests in 0 hours 0 minutes and 5.47 seconds (5.47s).
[0m17:38:56.097233 [debug] [MainThread]: Command end result
[0m17:38:56.118238 [info ] [MainThread]: 
[0m17:38:56.119045 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:38:56.119606 [info ] [MainThread]: 
[0m17:38:56.120202 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m17:38:56.121450 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.2241983, "process_user_time": 5.567182, "process_kernel_time": 0.264094, "process_mem_max_rss": "167728", "process_out_blocks": "5568", "process_in_blocks": "0"}
[0m17:38:56.122331 [debug] [MainThread]: Command `dbt test` succeeded at 17:38:56.122114 after 7.23 seconds
[0m17:38:56.122909 [debug] [MainThread]: Flushing usage events


============================== 17:40:00.847986 | 4f9143d9-f108-44e8-a418-b205ee525e78 ==============================
[0m17:40:00.847986 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:40:00.851620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --full-refresh', 'introspect': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m17:40:01.822582 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:40:01.856769 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:40:01.943637 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:40:01.944428 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:40:01.982502 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:40:01.986010 [info ] [MainThread]: 
[0m17:40:01.987456 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:40:01.990232 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m17:40:02.013266 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:40:02.014311 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:40:02.014985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:40:02.594745 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m17:40:02.597266 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:40:02.648472 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:40:02.649396 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:40:02.649953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:02.984621 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:40:02.987217 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:40:03.042643 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:40:03.043622 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:40:03.044221 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:03.326747 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:40:03.329532 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:40:03.407956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m17:40:03.421276 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:40:03.422019 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:40:03.422573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:03.776178 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:40:03.778868 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:40:03.827382 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m17:40:03.834818 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:40:03.835544 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:40:03.836096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:04.134955 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m17:40:04.137748 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:40:04.178782 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m17:40:04.186722 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:40:04.187392 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:40:04.187927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:04.578917 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:40:04.581470 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:40:04.627725 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:40:04.628653 [info ] [MainThread]: 
[0m17:40:04.632057 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m17:40:04.632919 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m17:40:04.634093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m17:40:04.634835 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m17:40:04.648916 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:40:04.650200 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 17:40:04.635439 => 17:40:04.649770
[0m17:40:04.650876 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m17:40:04.693959 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:40:04.697058 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m17:40:04.697790 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m17:40:04.698536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:05.243921 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:40:05.275900 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 17:40:04.651273 => 17:40:05.275501
[0m17:40:05.276700 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m17:40:05.356237 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.72s]
[0m17:40:05.357454 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m17:40:05.358234 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m17:40:05.359264 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m17:40:05.360358 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m17:40:05.361003 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m17:40:05.366726 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m17:40:05.367850 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 17:40:05.361410 => 17:40:05.367474
[0m17:40:05.368530 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m17:40:05.374576 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m17:40:05.376768 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m17:40:05.377439 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m17:40:05.378145 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:05.921303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:40:05.925532 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 17:40:05.368929 => 17:40:05.925178
[0m17:40:05.926239 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m17:40:05.977672 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.62s]
[0m17:40:05.978885 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m17:40:05.979628 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m17:40:05.980552 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m17:40:05.981883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m17:40:05.982545 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m17:40:05.988317 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m17:40:05.989480 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 17:40:05.982948 => 17:40:05.989095
[0m17:40:05.990202 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m17:40:05.996286 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m17:40:05.998143 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m17:40:05.998806 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m17:40:05.999455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:06.502235 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:40:06.506630 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 17:40:05.990601 => 17:40:06.506251
[0m17:40:06.507358 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m17:40:06.552743 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.57s]
[0m17:40:06.553985 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m17:40:06.554825 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m17:40:06.555745 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m17:40:06.556875 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m17:40:06.557545 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m17:40:06.563578 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:40:06.564719 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 17:40:06.557965 => 17:40:06.564323
[0m17:40:06.565406 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m17:40:06.573182 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:40:06.574931 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m17:40:06.575615 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m17:40:06.576285 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:07.138741 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:40:07.143206 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 17:40:06.565829 => 17:40:07.142823
[0m17:40:07.143924 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m17:40:07.187295 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.63s]
[0m17:40:07.188535 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m17:40:07.189309 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m17:40:07.190216 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m17:40:07.191289 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m17:40:07.191964 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m17:40:07.198145 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m17:40:07.199292 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 17:40:07.192379 => 17:40:07.198901
[0m17:40:07.199995 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m17:40:07.205913 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m17:40:07.207433 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m17:40:07.208103 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m17:40:07.208749 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:07.658985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:07.663255 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 17:40:07.200418 => 17:40:07.662892
[0m17:40:07.663941 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m17:40:07.710351 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.52s]
[0m17:40:07.711634 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m17:40:07.712436 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m17:40:07.713382 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m17:40:07.714555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m17:40:07.715228 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m17:40:07.721098 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m17:40:07.722272 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 17:40:07.715661 => 17:40:07.721842
[0m17:40:07.722965 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m17:40:07.730810 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m17:40:07.732417 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m17:40:07.733107 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m17:40:07.733772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:08.519257 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:40:08.523752 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 17:40:07.723390 => 17:40:08.523356
[0m17:40:08.524464 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m17:40:08.573732 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.86s]
[0m17:40:08.575003 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m17:40:08.575783 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m17:40:08.576715 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m17:40:08.577837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m17:40:08.578528 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m17:40:08.584452 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m17:40:08.585631 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 17:40:08.578947 => 17:40:08.585242
[0m17:40:08.586370 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m17:40:08.592367 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m17:40:08.593780 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m17:40:08.594478 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m17:40:08.595134 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:09.047005 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:09.051445 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 17:40:08.586785 => 17:40:09.051061
[0m17:40:09.052212 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m17:40:09.101777 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.52s]
[0m17:40:09.103026 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m17:40:09.103788 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m17:40:09.104677 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m17:40:09.105783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m17:40:09.106452 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m17:40:09.114139 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m17:40:09.115375 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 17:40:09.106852 => 17:40:09.114991
[0m17:40:09.116049 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m17:40:09.122477 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m17:40:09.124015 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m17:40:09.124700 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m17:40:09.125334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:09.518707 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:09.523085 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 17:40:09.116462 => 17:40:09.522701
[0m17:40:09.523788 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m17:40:09.573395 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.47s]
[0m17:40:09.574660 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m17:40:09.575435 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m17:40:09.576339 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m17:40:09.577436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m17:40:09.578099 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m17:40:09.583985 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m17:40:09.585060 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 17:40:09.578505 => 17:40:09.584689
[0m17:40:09.585712 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m17:40:09.591608 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m17:40:09.594440 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m17:40:09.595148 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m17:40:09.595852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:10.005158 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:10.009561 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 17:40:09.586148 => 17:40:10.009185
[0m17:40:10.010311 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m17:40:10.057745 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.48s]
[0m17:40:10.059037 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m17:40:10.059811 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m17:40:10.060742 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m17:40:10.061995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m17:40:10.062663 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m17:40:10.070762 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 17:40:10.063064 => 17:40:10.070314
[0m17:40:10.071457 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m17:40:10.147418 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:10.148322 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m17:40:10.148998 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:10.504345 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m17:40:10.519607 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:10.520429 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:40:10.590193 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:40:10.602517 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:10.603293 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:40:10.668280 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:40:10.718706 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:10.720338 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m17:40:13.507303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m17:40:13.512852 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.513563 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:40:13.576468 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:40:13.584297 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.585072 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:40:13.635169 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:40:13.643008 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.643727 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:40:13.699612 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:40:13.707355 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.708140 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:40:13.750057 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:40:13.764575 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.765422 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:40:13.809578 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:40:13.823242 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m17:40:13.825522 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.826212 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m17:40:13.905304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:13.906240 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:13.906955 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m17:40:14.483498 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m17:40:14.484599 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:40:14.485229 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m17:40:14.623788 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:14.631773 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 17:40:10.071858 => 17:40:14.631363
[0m17:40:14.632709 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m17:40:14.683609 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 4.62s]
[0m17:40:14.684961 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m17:40:14.685771 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m17:40:14.686599 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m17:40:14.687755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m17:40:14.688604 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m17:40:14.722639 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m17:40:14.724059 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 17:40:14.689509 => 17:40:14.723659
[0m17:40:14.724754 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m17:40:14.770964 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m17:40:14.775113 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:40:14.776037 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m17:40:14.776865 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:19.060535 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m17:40:19.074733 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m17:40:19.083797 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:40:19.084549 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m17:40:19.138366 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:19.142859 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 17:40:14.725173 => 17:40:19.142459
[0m17:40:19.143578 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m17:40:19.230417 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 4.54s]
[0m17:40:19.231623 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m17:40:19.232364 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m17:40:19.233294 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m17:40:19.234719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m17:40:19.235565 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m17:40:19.243779 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m17:40:19.244891 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 17:40:19.235983 => 17:40:19.244507
[0m17:40:19.245551 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m17:40:19.251691 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m17:40:19.255294 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:40:19.256045 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m17:40:19.256790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:24.136634 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m17:40:24.143025 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m17:40:24.144638 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:40:24.145298 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m17:40:24.185213 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:24.189882 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 17:40:19.245953 => 17:40:24.189503
[0m17:40:24.190640 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m17:40:24.239132 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 5.00s]
[0m17:40:24.240322 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m17:40:24.241082 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:40:24.241878 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m17:40:24.242977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m17:40:24.243613 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:40:24.262119 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:40:24.263346 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 17:40:24.244031 => 17:40:24.262962
[0m17:40:24.264032 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:40:24.288118 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:40:24.289698 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:40:24.290382 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m17:40:24.291012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:24.670464 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:24.674831 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 17:40:24.264433 => 17:40:24.674404
[0m17:40:24.675547 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m17:40:24.721956 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.48s]
[0m17:40:24.723211 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:40:24.723985 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:40:24.724801 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m17:40:24.725863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m17:40:24.726552 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:40:24.736622 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:40:24.737803 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 17:40:24.726957 => 17:40:24.737417
[0m17:40:24.738502 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:40:24.743661 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:40:24.745033 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:40:24.745679 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m17:40:24.746335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:25.168619 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:25.172020 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 17:40:24.738897 => 17:40:25.171613
[0m17:40:25.172728 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m17:40:25.218375 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.49s]
[0m17:40:25.219584 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:40:25.220338 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:40:25.221158 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m17:40:25.222255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m17:40:25.222886 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:40:25.230663 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:40:25.231748 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 17:40:25.223307 => 17:40:25.231377
[0m17:40:25.232394 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:40:25.237235 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:40:25.238608 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:40:25.239245 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m17:40:25.239872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:25.696695 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:25.700152 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 17:40:25.232796 => 17:40:25.699724
[0m17:40:25.700881 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m17:40:26.019624 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.80s]
[0m17:40:26.020824 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:40:26.021563 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:40:26.022398 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m17:40:26.023462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m17:40:26.024099 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:40:26.031733 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:40:26.032872 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 17:40:26.024507 => 17:40:26.032496
[0m17:40:26.033544 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:40:26.038872 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:40:26.040270 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:40:26.040921 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m17:40:26.041543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:26.397061 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:26.400523 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 17:40:26.033949 => 17:40:26.400092
[0m17:40:26.401237 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m17:40:26.465462 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.44s]
[0m17:40:26.466700 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:40:26.468238 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m17:40:26.469121 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m17:40:26.470291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m17:40:26.470959 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m17:40:26.479726 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m17:40:26.480914 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 17:40:26.471387 => 17:40:26.480508
[0m17:40:26.481571 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m17:40:26.490127 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m17:40:26.494252 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:40:26.495095 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m17:40:26.495931 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:40:28.910995 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m17:40:28.917255 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m17:40:28.919016 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:40:28.919660 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m17:40:28.957128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:40:28.961612 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 17:40:26.481990 => 17:40:28.961242
[0m17:40:28.962332 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m17:40:29.004150 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.53s]
[0m17:40:29.005411 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m17:40:29.007951 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:40:29.008515 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m17:40:29.009163 [info ] [MainThread]: 
[0m17:40:29.009781 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 27.02 seconds (27.02s).
[0m17:40:29.014533 [debug] [MainThread]: Command end result
[0m17:40:29.036589 [info ] [MainThread]: 
[0m17:40:29.037454 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:40:29.038073 [info ] [MainThread]: 
[0m17:40:29.038689 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m17:40:29.040011 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 28.259527, "process_user_time": 8.127639, "process_kernel_time": 0.266805, "process_mem_max_rss": "166792", "process_out_blocks": "4152", "process_in_blocks": "0"}
[0m17:40:29.040876 [debug] [MainThread]: Command `dbt build` succeeded at 17:40:29.040658 after 28.26 seconds
[0m17:40:29.041471 [debug] [MainThread]: Flushing usage events


============================== 17:53:23.692377 | 69c893a0-a3e6-4214-9a46-b736a5d14698 ==============================
[0m17:53:23.692377 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:53:23.696077 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt run --select customer_snapshot', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:53:24.637154 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:53:24.669509 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:53:24.748842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:53:24.750111 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:53:25.075993 [error] [MainThread]: Encountered an error:
Parsing Error
  at path []: A snapshot must have a materialized value of 'snapshot'
[0m17:53:25.077557 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4548159, "process_user_time": 4.214698, "process_kernel_time": 0.243749, "process_mem_max_rss": "151176", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m17:53:25.078472 [debug] [MainThread]: Command `dbt run` failed at 17:53:25.078250 after 1.46 seconds
[0m17:53:25.079072 [debug] [MainThread]: Flushing usage events


============================== 17:53:56.114912 | 6ad89738-331d-4439-ae90-0c85686017b3 ==============================
[0m17:53:56.114912 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:53:56.118548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'invocation_command': 'dbt build --full-refresh', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:53:57.034811 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:53:57.065777 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:53:57.142501 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:53:57.143643 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:53:57.464530 [error] [MainThread]: Encountered an error:
Parsing Error
  at path []: A snapshot must have a materialized value of 'snapshot'
[0m17:53:57.466104 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 1.4180124, "process_user_time": 4.129945, "process_kernel_time": 0.200115, "process_mem_max_rss": "151140", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m17:53:57.466996 [debug] [MainThread]: Command `dbt build` failed at 17:53:57.466765 after 1.42 seconds
[0m17:53:57.467600 [debug] [MainThread]: Flushing usage events


============================== 17:56:27.007264 | 134bc92c-da0b-4036-a7ef-953a15dc6ebf ==============================
[0m17:56:27.007264 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:56:27.010901 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'invocation_command': 'dbt run --select customer_snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m17:56:27.933864 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:56:27.964993 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:56:28.044725 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:56:28.045905 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m17:56:28.422129 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:56:28.424222 [info ] [MainThread]: 
[0m17:56:28.424809 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m17:56:28.425615 [debug] [MainThread]: Command end result
[0m17:56:28.444361 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.504342, "process_user_time": 4.246801, "process_kernel_time": 0.203814, "process_mem_max_rss": "156404", "process_out_blocks": "5456", "process_in_blocks": "0"}
[0m17:56:28.445364 [debug] [MainThread]: Command `dbt run` succeeded at 17:56:28.445139 after 1.51 seconds
[0m17:56:28.445957 [debug] [MainThread]: Flushing usage events


============================== 17:56:46.083407 | 54f757a9-598a-43ac-89d2-01d3b6b2e7b6 ==============================
[0m17:56:46.083407 [info ] [MainThread]: Running with dbt=1.7.3
[0m17:56:46.087040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build --full-refresh', 'send_anonymous_usage_stats': 'False'}
[0m17:56:47.024018 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m17:56:47.055830 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m17:56:47.135056 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:56:47.135802 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:56:47.171375 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m17:56:47.174505 [info ] [MainThread]: 
[0m17:56:47.175693 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:56:47.178122 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m17:56:47.199242 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:56:47.200141 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:56:47.200751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:56:47.812065 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m17:56:47.814560 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:56:47.883491 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:56:47.884439 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:56:47.884985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:56:48.364344 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:56:48.366834 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:56:48.416991 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m17:56:48.417692 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m17:56:48.418245 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:56:48.777507 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m17:56:48.779948 [debug] [ThreadPool]: On list_tpcds: Close
[0m17:56:48.835844 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m17:56:48.848780 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m17:56:48.849444 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m17:56:48.849961 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:56:49.222986 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:56:49.225494 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m17:56:49.280448 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m17:56:49.287125 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m17:56:49.287729 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m17:56:49.288246 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:56:49.576347 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m17:56:49.579144 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m17:56:49.622650 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m17:56:49.630109 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m17:56:49.630676 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m17:56:49.631194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:56:49.948135 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:56:49.950633 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m17:56:49.989787 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:56:49.990670 [info ] [MainThread]: 
[0m17:56:49.993785 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m17:56:49.994599 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m17:56:49.995649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m17:56:49.996263 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m17:56:50.010365 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:56:50.011596 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 17:56:49.996660 => 17:56:50.011219
[0m17:56:50.012220 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m17:56:50.053410 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m17:56:50.056424 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m17:56:50.057157 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m17:56:50.057852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:50.601738 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:56:50.632521 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 17:56:50.012624 => 17:56:50.632133
[0m17:56:50.633262 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m17:56:50.712460 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.72s]
[0m17:56:50.713664 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m17:56:50.714452 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m17:56:50.715199 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m17:56:50.716388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m17:56:50.717029 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m17:56:50.723094 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m17:56:50.724148 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 17:56:50.717435 => 17:56:50.723778
[0m17:56:50.724770 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m17:56:50.730287 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m17:56:50.732234 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m17:56:50.732911 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m17:56:50.733567 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:51.269803 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:56:51.274376 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 17:56:50.725169 => 17:56:51.273985
[0m17:56:51.275040 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m17:56:51.316867 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.60s]
[0m17:56:51.318259 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m17:56:51.319000 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m17:56:51.320015 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m17:56:51.321150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m17:56:51.321774 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m17:56:51.327384 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m17:56:51.328455 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 17:56:51.322192 => 17:56:51.328079
[0m17:56:51.329057 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m17:56:51.334481 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m17:56:51.336058 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m17:56:51.336705 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m17:56:51.337326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:51.787596 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:51.791813 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 17:56:51.329457 => 17:56:51.791462
[0m17:56:51.792475 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m17:56:51.846303 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.53s]
[0m17:56:51.847485 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m17:56:51.848215 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m17:56:51.849097 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m17:56:51.850177 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m17:56:51.850798 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m17:56:51.856388 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:56:51.857460 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 17:56:51.851191 => 17:56:51.857089
[0m17:56:51.858095 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m17:56:51.865173 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m17:56:51.866731 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m17:56:51.867374 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m17:56:51.867993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:52.304096 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:52.308357 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 17:56:51.858489 => 17:56:52.307990
[0m17:56:52.309014 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m17:56:52.417603 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.57s]
[0m17:56:52.418939 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m17:56:52.419667 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m17:56:52.420389 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m17:56:52.421556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m17:56:52.422199 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m17:56:52.427825 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m17:56:52.428877 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 17:56:52.422601 => 17:56:52.428513
[0m17:56:52.429488 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m17:56:52.434932 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m17:56:52.436249 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m17:56:52.436885 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m17:56:52.437505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:52.877960 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:52.882208 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 17:56:52.429879 => 17:56:52.881828
[0m17:56:52.882855 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m17:56:52.959573 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.54s]
[0m17:56:52.960745 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m17:56:52.961483 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m17:56:52.962348 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m17:56:52.963414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m17:56:52.964050 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m17:56:52.970123 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m17:56:52.971177 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 17:56:52.964449 => 17:56:52.970812
[0m17:56:52.971793 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m17:56:52.979027 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m17:56:52.980401 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m17:56:52.981039 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m17:56:52.981679 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:53.372252 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:53.376631 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 17:56:52.972188 => 17:56:53.376256
[0m17:56:53.377678 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m17:56:53.431462 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.47s]
[0m17:56:53.432681 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m17:56:53.433452 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m17:56:53.434388 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m17:56:53.435627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m17:56:53.436272 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m17:56:53.442797 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m17:56:53.443930 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 17:56:53.436682 => 17:56:53.443554
[0m17:56:53.444547 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m17:56:53.450534 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m17:56:53.451926 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m17:56:53.452560 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m17:56:53.453173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:53.898618 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:53.902769 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 17:56:53.444940 => 17:56:53.902418
[0m17:56:53.903409 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m17:56:54.030376 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.59s]
[0m17:56:54.031689 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m17:56:54.032431 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m17:56:54.033258 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m17:56:54.034320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m17:56:54.034943 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m17:56:54.042191 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m17:56:54.043233 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 17:56:54.035337 => 17:56:54.042871
[0m17:56:54.043841 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m17:56:54.049034 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m17:56:54.050292 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m17:56:54.050929 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m17:56:54.051553 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:54.574344 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:56:54.578498 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 17:56:54.044232 => 17:56:54.578141
[0m17:56:54.579159 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m17:56:54.620635 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.59s]
[0m17:56:54.621793 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m17:56:54.622569 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m17:56:54.623432 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m17:56:54.624465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m17:56:54.625089 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m17:56:54.630988 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m17:56:54.632052 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 17:56:54.625490 => 17:56:54.631687
[0m17:56:54.632656 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m17:56:54.638213 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m17:56:54.640848 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m17:56:54.641527 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m17:56:54.642239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:55.256253 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:56:55.260462 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 17:56:54.633048 => 17:56:55.260105
[0m17:56:55.261132 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m17:56:55.321723 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.70s]
[0m17:56:55.322914 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m17:56:55.323655 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m17:56:55.324524 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m17:56:55.325704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m17:56:55.326348 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m17:56:55.334394 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 17:56:55.326735 => 17:56:55.333959
[0m17:56:55.335062 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m17:56:55.409545 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:55.410449 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m17:56:55.411105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:56:56.145882 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m17:56:56.161189 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:56.162005 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:56:56.207065 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:56:56.219485 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:56.220291 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:56:56.269520 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:56:56.319316 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:56.320927 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m17:56:58.523276 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m17:56:58.529014 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.529661 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:56:58.587656 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:56:58.595413 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.596073 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:56:58.676704 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:56:58.684316 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.684967 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:56:58.737782 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:56:58.745542 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.746268 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m17:56:58.791943 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m17:56:58.806222 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.807027 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m17:56:58.860846 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m17:56:58.874036 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m17:56:58.876053 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.876675 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m17:56:58.940406 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:58.941270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:58.941974 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m17:56:59.218227 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m17:56:59.219143 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m17:56:59.219750 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m17:56:59.334817 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:56:59.342057 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 17:56:55.335467 => 17:56:59.341670
[0m17:56:59.342707 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m17:56:59.393076 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 4.07s]
[0m17:56:59.394295 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m17:56:59.395055 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m17:56:59.395948 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m17:56:59.397123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m17:56:59.397753 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m17:56:59.429474 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m17:56:59.430775 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 17:56:59.398185 => 17:56:59.430396
[0m17:56:59.431442 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m17:56:59.474726 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m17:56:59.478622 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:56:59.479408 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m17:56:59.480196 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:03.099641 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m17:57:03.114195 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m17:57:03.123124 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m17:57:03.123922 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m17:57:03.165034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:57:03.169262 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 17:56:59.431858 => 17:57:03.168891
[0m17:57:03.169926 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m17:57:03.217619 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 3.82s]
[0m17:57:03.219216 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m17:57:03.219968 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m17:57:03.220903 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m17:57:03.222498 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m17:57:03.223127 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m17:57:03.231081 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m17:57:03.232156 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 17:57:03.223547 => 17:57:03.231791
[0m17:57:03.232756 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m17:57:03.238890 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m17:57:03.242449 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:57:03.243176 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m17:57:03.243908 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:08.151108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m17:57:08.157363 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m17:57:08.158903 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m17:57:08.159512 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m17:57:08.198688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:57:08.203218 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 17:57:03.233163 => 17:57:08.202855
[0m17:57:08.203873 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m17:57:08.247761 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 5.03s]
[0m17:57:08.248947 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m17:57:08.249711 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:57:08.250515 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m17:57:08.251584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m17:57:08.252230 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:57:08.271219 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:57:08.272477 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 17:57:08.252632 => 17:57:08.272089
[0m17:57:08.273116 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:57:08.297202 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:57:08.298748 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m17:57:08.299394 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m17:57:08.300021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:08.882879 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:57:08.887045 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 17:57:08.273520 => 17:57:08.886644
[0m17:57:08.887738 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m17:57:08.928805 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.68s]
[0m17:57:08.929977 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m17:57:08.930785 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:57:08.931585 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m17:57:08.932607 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m17:57:08.933247 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:57:08.942771 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:57:08.943870 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 17:57:08.933648 => 17:57:08.943492
[0m17:57:08.944482 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:57:08.949117 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:57:08.950375 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m17:57:08.951013 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m17:57:08.951644 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:09.557848 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:57:09.561247 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 17:57:08.944881 => 17:57:09.560835
[0m17:57:09.561945 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m17:57:09.613231 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.68s]
[0m17:57:09.614484 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m17:57:09.615268 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:57:09.616107 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m17:57:09.617188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m17:57:09.617837 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:57:09.625543 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:57:09.626657 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 17:57:09.618343 => 17:57:09.626280
[0m17:57:09.627282 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:57:09.632136 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:57:09.633427 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m17:57:09.634121 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m17:57:09.634756 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:09.994968 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:57:09.998346 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 17:57:09.627698 => 17:57:09.997926
[0m17:57:09.999006 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m17:57:10.043251 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.43s]
[0m17:57:10.044432 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m17:57:10.045175 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:57:10.045932 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m17:57:10.046986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m17:57:10.047616 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:57:10.055099 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:57:10.056155 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 17:57:10.048007 => 17:57:10.055789
[0m17:57:10.056769 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:57:10.061544 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:57:10.062788 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m17:57:10.063431 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m17:57:10.064055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:10.390827 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:57:10.394132 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 17:57:10.057158 => 17:57:10.393714
[0m17:57:10.394788 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m17:57:10.449297 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.40s]
[0m17:57:10.450637 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m17:57:10.451777 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m17:57:10.452889 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m17:57:10.454006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m17:57:10.454657 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m17:57:10.462935 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m17:57:10.463989 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 17:57:10.455057 => 17:57:10.463621
[0m17:57:10.464635 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m17:57:10.472499 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m17:57:10.476577 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:57:10.477372 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m17:57:10.478207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:13.333349 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m17:57:13.339610 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m17:57:13.341303 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m17:57:13.341940 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m17:57:13.387769 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:57:13.392042 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 17:57:10.465040 => 17:57:13.391677
[0m17:57:13.392724 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m17:57:13.436602 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.98s]
[0m17:57:13.437768 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m17:57:13.440295 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:57:13.440914 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m17:57:13.441575 [info ] [MainThread]: 
[0m17:57:13.442229 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 26.27 seconds (26.27s).
[0m17:57:13.447116 [debug] [MainThread]: Command end result
[0m17:57:13.468942 [info ] [MainThread]: 
[0m17:57:13.469707 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:57:13.470358 [info ] [MainThread]: 
[0m17:57:13.471002 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m17:57:13.472336 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 27.456203, "process_user_time": 7.91592, "process_kernel_time": 0.288275, "process_mem_max_rss": "166792", "process_out_blocks": "4152", "process_in_blocks": "0"}
[0m17:57:13.473286 [debug] [MainThread]: Command `dbt build` succeeded at 17:57:13.473052 after 27.46 seconds
[0m17:57:13.473879 [debug] [MainThread]: Flushing usage events


============================== 18:01:19.285807 | 7998443e-57d4-4d89-ba70-107110bcdf61 ==============================
[0m18:01:19.285807 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:01:19.289413 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select customer_snapshot', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:01:20.210177 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:01:20.242127 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:01:20.320806 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m18:01:20.321875 [debug] [MainThread]: Partial parsing: added file: capstone://snapshots/customer_snapshot.yml
[0m18:01:20.322624 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m18:01:20.747941 [warn ] [MainThread]: [[33mWARNING[0m]: 'customer_snapshot' is a snapshot node, but it is specified in the models
section of snapshots/customer_snapshot.yml. To fix this error, place the
`customer_snapshot` specification under the snapshots key instead.
[0m18:01:20.796032 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:01:20.798163 [info ] [MainThread]: 
[0m18:01:20.798752 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m18:01:20.799536 [debug] [MainThread]: Command end result
[0m18:01:20.818983 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6001652, "process_user_time": 4.280833, "process_kernel_time": 0.244003, "process_mem_max_rss": "157812", "process_out_blocks": "5464", "process_in_blocks": "0"}
[0m18:01:20.819986 [debug] [MainThread]: Command `dbt run` succeeded at 18:01:20.819762 after 1.60 seconds
[0m18:01:20.820569 [debug] [MainThread]: Flushing usage events


============================== 18:05:02.406922 | 28ff42bf-d467-4736-8f08-5ee87f38eb32 ==============================
[0m18:05:02.406922 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:05:02.410942 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select customer_snapshot', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:05:03.388537 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:05:03.425006 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:05:03.511113 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:05:03.512349 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.yml
[0m18:05:03.735401 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:05:03.737624 [info ] [MainThread]: 
[0m18:05:03.738306 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m18:05:03.739154 [debug] [MainThread]: Command end result
[0m18:05:03.760227 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4226019, "process_user_time": 4.194236, "process_kernel_time": 0.280803, "process_mem_max_rss": "154744", "process_out_blocks": "5456", "process_in_blocks": "0"}
[0m18:05:03.761277 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:03.761051 after 1.42 seconds
[0m18:05:03.761887 [debug] [MainThread]: Flushing usage events


============================== 18:05:20.584580 | e32f2b79-6c05-4a68-b20f-a38cc61fc2a7 ==============================
[0m18:05:20.584580 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:05:20.588383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --full-refresh', 'introspect': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:05:21.545547 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:05:21.578136 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:05:21.658632 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:05:21.659380 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:05:21.694606 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:05:21.697772 [info ] [MainThread]: 
[0m18:05:21.699170 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:05:21.701834 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:05:21.722353 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:05:21.723124 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:05:21.723649 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:05:22.246098 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m18:05:22.248579 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:05:22.301628 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:05:22.302415 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:05:22.302966 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:22.616489 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:05:22.619052 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:05:22.706465 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:05:22.707409 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:05:22.707969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:23.090671 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:05:23.093145 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:05:23.155156 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m18:05:23.168510 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:05:23.169272 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:05:23.169810 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:23.511871 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:05:23.514688 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:05:23.559164 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m18:05:23.568154 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:05:23.568851 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:05:23.569391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:24.010592 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:05:24.013458 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:05:24.061396 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m18:05:24.067144 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:05:24.067764 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:05:24.068285 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:24.477862 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:05:24.480771 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:05:24.541196 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:05:24.542312 [info ] [MainThread]: 
[0m18:05:24.546202 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m18:05:24.547167 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m18:05:24.548881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m18:05:24.549518 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m18:05:24.564045 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:05:24.565320 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 18:05:24.550283 => 18:05:24.564927
[0m18:05:24.565967 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m18:05:24.609507 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:05:24.612650 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m18:05:24.613465 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m18:05:24.614231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:25.018813 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:25.051088 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 18:05:24.566410 => 18:05:25.050686
[0m18:05:25.051886 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m18:05:25.102748 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.55s]
[0m18:05:25.104102 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m18:05:25.104904 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m18:05:25.105799 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m18:05:25.106917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m18:05:25.107565 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m18:05:25.113588 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m18:05:25.115126 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 18:05:25.107961 => 18:05:25.114674
[0m18:05:25.115805 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m18:05:25.122382 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m18:05:25.124631 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m18:05:25.125317 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m18:05:25.125986 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:25.584309 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:25.588986 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 18:05:25.116218 => 18:05:25.588613
[0m18:05:25.589679 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m18:05:25.657058 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.55s]
[0m18:05:25.658325 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m18:05:25.659099 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m18:05:25.660028 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m18:05:25.661281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m18:05:25.662115 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m18:05:25.668202 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m18:05:25.669380 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 18:05:25.662633 => 18:05:25.668983
[0m18:05:25.670065 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m18:05:25.676254 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m18:05:25.678064 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m18:05:25.678746 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m18:05:25.679408 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:26.186094 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:05:26.190456 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 18:05:25.670487 => 18:05:26.190069
[0m18:05:26.191169 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m18:05:28.835214 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 3.17s]
[0m18:05:28.836430 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m18:05:28.837187 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m18:05:28.838159 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m18:05:28.839284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m18:05:28.839930 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m18:05:28.845856 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:05:28.847037 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 18:05:28.840331 => 18:05:28.846650
[0m18:05:28.847674 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m18:05:28.855351 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:05:28.857088 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m18:05:28.857747 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m18:05:28.858438 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:29.480184 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:05:29.484435 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 18:05:28.848066 => 18:05:29.484070
[0m18:05:29.485106 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m18:05:29.534408 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.70s]
[0m18:05:29.535602 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m18:05:29.536347 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m18:05:29.537231 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m18:05:29.538323 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m18:05:29.538951 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m18:05:29.544577 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m18:05:29.545687 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 18:05:29.539352 => 18:05:29.545306
[0m18:05:29.546366 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m18:05:29.552197 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m18:05:29.553596 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m18:05:29.554269 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m18:05:29.554887 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:30.008243 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:30.013534 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 18:05:29.546762 => 18:05:30.013064
[0m18:05:30.014397 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m18:05:30.074682 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.54s]
[0m18:05:30.075952 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m18:05:30.076735 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m18:05:30.077673 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m18:05:30.078888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m18:05:30.079542 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m18:05:30.085552 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m18:05:30.086793 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 18:05:30.079949 => 18:05:30.086398
[0m18:05:30.087443 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m18:05:30.095888 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m18:05:30.097606 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m18:05:30.098355 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m18:05:30.098988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:30.531467 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:30.535722 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 18:05:30.087852 => 18:05:30.535350
[0m18:05:30.536406 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m18:05:30.584516 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.51s]
[0m18:05:30.585759 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m18:05:30.586564 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m18:05:30.587459 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m18:05:30.588573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m18:05:30.589223 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m18:05:30.595105 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m18:05:30.596245 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 18:05:30.589635 => 18:05:30.595852
[0m18:05:30.596903 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m18:05:30.602771 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m18:05:30.604047 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m18:05:30.604712 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m18:05:30.605340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:31.007985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:31.012264 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 18:05:30.597311 => 18:05:31.011885
[0m18:05:31.012953 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m18:05:31.058416 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.47s]
[0m18:05:31.059601 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m18:05:31.060355 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m18:05:31.061217 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m18:05:31.062313 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m18:05:31.062964 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m18:05:31.070347 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m18:05:31.071522 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 18:05:31.063372 => 18:05:31.071139
[0m18:05:31.072141 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m18:05:31.078066 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m18:05:31.079520 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m18:05:31.080152 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m18:05:31.080778 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:31.438924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:31.443348 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 18:05:31.072542 => 18:05:31.442947
[0m18:05:31.444232 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m18:05:31.497735 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.44s]
[0m18:05:31.499154 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m18:05:31.499933 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m18:05:31.500848 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m18:05:31.501967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m18:05:31.502656 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m18:05:31.508774 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m18:05:31.509974 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 18:05:31.503077 => 18:05:31.509574
[0m18:05:31.510675 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m18:05:31.516986 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m18:05:31.519921 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m18:05:31.520671 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m18:05:31.521388 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:32.075676 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:05:32.079904 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 18:05:31.511096 => 18:05:32.079544
[0m18:05:32.080555 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m18:05:32.125956 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.62s]
[0m18:05:32.127167 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m18:05:32.127894 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m18:05:32.128754 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m18:05:32.129941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m18:05:32.130725 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m18:05:32.138103 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 18:05:32.131140 => 18:05:32.137677
[0m18:05:32.138749 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m18:05:32.213063 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:32.213948 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m18:05:32.214638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:32.693160 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m18:05:32.707940 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:32.708643 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:05:32.760072 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:05:32.772346 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:32.773102 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:05:32.831274 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:05:32.881100 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:32.882883 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m18:05:34.222593 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:05:34.228076 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.228762 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:05:34.284112 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:05:34.291865 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.292609 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:05:34.351750 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:05:34.359383 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.360059 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:05:34.408242 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:05:34.416144 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.416863 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:05:34.465920 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:05:34.480293 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.481134 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:05:34.534188 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:05:34.547213 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m18:05:34.549353 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.549965 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m18:05:34.638762 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:34.639622 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.640305 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m18:05:34.971610 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m18:05:34.972535 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:05:34.973142 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m18:05:35.124885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:35.132715 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 18:05:32.139143 => 18:05:35.132323
[0m18:05:35.133429 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m18:05:35.186279 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.06s]
[0m18:05:35.187481 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m18:05:35.188242 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m18:05:35.189305 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m18:05:35.190399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m18:05:35.191024 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m18:05:35.222956 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m18:05:35.224259 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 18:05:35.191432 => 18:05:35.223868
[0m18:05:35.224904 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m18:05:35.268638 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m18:05:35.272580 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:05:35.273410 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m18:05:35.274275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:38.047078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m18:05:38.060598 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m18:05:38.069083 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:05:38.069750 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m18:05:38.132247 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:38.136500 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 18:05:35.225309 => 18:05:38.136132
[0m18:05:38.137181 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m18:05:38.179388 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 2.99s]
[0m18:05:38.180578 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m18:05:38.181326 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m18:05:38.182291 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m18:05:38.183727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m18:05:38.184523 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m18:05:38.192582 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m18:05:38.193694 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 18:05:38.185026 => 18:05:38.193316
[0m18:05:38.194348 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m18:05:38.200671 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m18:05:38.204305 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:05:38.205056 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m18:05:38.205816 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:42.409362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m18:05:42.415533 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m18:05:42.417089 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:05:42.417722 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m18:05:42.470470 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:42.475080 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 18:05:38.194753 => 18:05:42.474700
[0m18:05:42.475763 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m18:05:42.525439 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 4.34s]
[0m18:05:42.526719 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m18:05:42.527500 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:05:42.528344 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m18:05:42.529432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m18:05:42.530114 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:05:42.548929 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:05:42.550233 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 18:05:42.530538 => 18:05:42.549787
[0m18:05:42.550909 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:05:42.575793 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:05:42.577393 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:05:42.578087 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m18:05:42.578771 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:43.006670 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:43.010910 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 18:05:42.551325 => 18:05:43.010510
[0m18:05:43.011585 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m18:05:43.061102 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.53s]
[0m18:05:43.062346 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:05:43.063118 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:05:43.063910 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m18:05:43.064996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m18:05:43.065645 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:05:43.075673 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:05:43.076907 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 18:05:43.066072 => 18:05:43.076516
[0m18:05:43.077545 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:05:43.082704 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:05:43.083999 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:05:43.084632 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m18:05:43.085261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:43.345767 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:43.349167 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 18:05:43.077937 => 18:05:43.348756
[0m18:05:43.350205 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m18:05:43.419425 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.35s]
[0m18:05:43.420660 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:05:43.421448 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:05:43.422378 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m18:05:43.423478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m18:05:43.424121 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:05:43.431690 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:05:43.432751 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 18:05:43.424543 => 18:05:43.432378
[0m18:05:43.433372 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:05:43.438194 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:05:43.439443 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:05:43.440084 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m18:05:43.440694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:43.803622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:43.807000 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 18:05:43.433762 => 18:05:43.806602
[0m18:05:43.807671 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m18:05:43.858673 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.44s]
[0m18:05:43.859866 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:05:43.860628 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:05:43.861424 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m18:05:43.862505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m18:05:43.863146 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:05:43.870814 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:05:43.871969 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 18:05:43.863550 => 18:05:43.871583
[0m18:05:43.872594 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:05:43.877875 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:05:43.879228 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:05:43.879876 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m18:05:43.880494 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:44.342617 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:44.346318 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 18:05:43.872993 => 18:05:44.345839
[0m18:05:44.347051 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m18:05:44.394794 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.53s]
[0m18:05:44.396031 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:05:44.397677 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:05:44.398537 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m18:05:44.399616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m18:05:44.400246 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:05:44.408702 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:05:44.409812 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:05:44.400650 => 18:05:44.409431
[0m18:05:44.410478 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:05:44.418843 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:05:44.423042 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:05:44.423859 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:05:44.424660 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:46.372290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:05:46.378786 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m18:05:46.380648 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:05:46.381316 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m18:05:46.418304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:05:46.422693 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:05:44.410873 => 18:05:46.422314
[0m18:05:46.423403 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:05:46.472013 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.07s]
[0m18:05:46.473212 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:05:46.475858 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:46.476436 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:05:46.477095 [info ] [MainThread]: 
[0m18:05:46.477707 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 24.78 seconds (24.78s).
[0m18:05:46.482363 [debug] [MainThread]: Command end result
[0m18:05:46.505205 [info ] [MainThread]: 
[0m18:05:46.506043 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:46.506641 [info ] [MainThread]: 
[0m18:05:46.507245 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m18:05:46.508564 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 25.993979, "process_user_time": 8.038997, "process_kernel_time": 0.343924, "process_mem_max_rss": "166904", "process_out_blocks": "4144", "process_in_blocks": "0"}
[0m18:05:46.509414 [debug] [MainThread]: Command `dbt build` succeeded at 18:05:46.509198 after 25.99 seconds
[0m18:05:46.510005 [debug] [MainThread]: Flushing usage events


============================== 18:07:23.255654 | 4760bc67-9a85-4f87-b362-7270b18605e3 ==============================
[0m18:07:23.255654 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:07:23.259245 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select customer_snapshot', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m18:07:24.185906 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:07:24.217075 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:07:24.294456 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:07:24.295692 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.yml
[0m18:07:24.730987 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:07:24.733102 [info ] [MainThread]: 
[0m18:07:24.733707 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m18:07:24.734571 [debug] [MainThread]: Command end result
[0m18:07:24.753360 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5647023, "process_user_time": 4.257227, "process_kernel_time": 0.219769, "process_mem_max_rss": "157496", "process_out_blocks": "5464", "process_in_blocks": "0"}
[0m18:07:24.754404 [debug] [MainThread]: Command `dbt run` succeeded at 18:07:24.754175 after 1.57 seconds
[0m18:07:24.755023 [debug] [MainThread]: Flushing usage events


============================== 18:07:32.837476 | 2e37dfb7-98e3-4b91-ae5a-9c36a4990c5e ==============================
[0m18:07:32.837476 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:07:32.841310 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build --full-refresh', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:07:33.768445 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:07:33.799288 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:07:33.876517 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:07:33.877261 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:07:33.911771 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:07:33.914952 [info ] [MainThread]: 
[0m18:07:33.916134 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:07:33.918510 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:07:33.938215 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:07:33.938930 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:07:33.939451 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:07:34.482477 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m18:07:34.484916 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:07:34.535079 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:07:34.535824 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:07:34.536431 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:34.900231 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:07:34.902776 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:07:34.952474 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:07:34.953342 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:07:34.953895 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:35.309825 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:07:35.312261 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:07:35.397683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m18:07:35.410637 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:07:35.411301 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:07:35.411827 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:35.765376 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:07:35.767925 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:07:35.810400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m18:07:35.817259 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:07:35.817839 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:07:35.818414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:36.185250 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:07:36.187774 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:07:36.238872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m18:07:36.244630 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:07:36.245285 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:07:36.245826 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:36.539376 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:07:36.542118 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:07:36.594416 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:07:36.595257 [info ] [MainThread]: 
[0m18:07:36.598393 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m18:07:36.599198 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m18:07:36.600253 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m18:07:36.600904 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m18:07:36.614245 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:07:36.615338 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 18:07:36.601298 => 18:07:36.614948
[0m18:07:36.615953 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m18:07:36.656402 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:07:36.659354 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m18:07:36.660055 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m18:07:36.660744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:37.078077 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:37.109227 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 18:07:36.616348 => 18:07:37.108835
[0m18:07:37.109992 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m18:07:37.172404 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.57s]
[0m18:07:37.173617 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m18:07:37.174371 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m18:07:37.175315 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m18:07:37.176368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m18:07:37.176993 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m18:07:37.182607 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m18:07:37.183668 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 18:07:37.177389 => 18:07:37.183284
[0m18:07:37.184285 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m18:07:37.189767 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m18:07:37.191761 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m18:07:37.192449 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m18:07:37.193103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:37.605849 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:37.610067 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 18:07:37.184691 => 18:07:37.609686
[0m18:07:37.610715 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m18:07:37.656456 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.48s]
[0m18:07:37.657628 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m18:07:37.658377 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m18:07:37.659357 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m18:07:37.660505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m18:07:37.661127 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m18:07:37.666792 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m18:07:37.667834 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 18:07:37.661546 => 18:07:37.667466
[0m18:07:37.668464 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m18:07:37.673728 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m18:07:37.675337 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m18:07:37.675977 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m18:07:37.676603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:38.031128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:38.035406 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 18:07:37.668851 => 18:07:38.035040
[0m18:07:38.036083 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m18:07:38.095423 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.43s]
[0m18:07:38.096660 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m18:07:38.097425 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m18:07:38.098358 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m18:07:38.099496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m18:07:38.100156 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m18:07:38.106363 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:07:38.107487 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 18:07:38.100571 => 18:07:38.107098
[0m18:07:38.108158 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m18:07:38.115732 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:07:38.117346 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m18:07:38.118058 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m18:07:38.118703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:38.567188 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:38.571491 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 18:07:38.108566 => 18:07:38.571115
[0m18:07:38.572162 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m18:07:38.614214 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.51s]
[0m18:07:38.615402 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m18:07:38.616159 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m18:07:38.617029 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m18:07:38.618112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m18:07:38.618765 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m18:07:38.624491 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m18:07:38.625582 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 18:07:38.619169 => 18:07:38.625193
[0m18:07:38.626264 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m18:07:38.631900 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m18:07:38.633291 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m18:07:38.633945 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m18:07:38.634635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:38.969805 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:38.974237 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 18:07:38.626684 => 18:07:38.973825
[0m18:07:38.974923 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m18:07:39.010910 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.39s]
[0m18:07:39.012109 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m18:07:39.012846 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m18:07:39.013689 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m18:07:39.014773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m18:07:39.015408 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m18:07:39.021148 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m18:07:39.022220 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 18:07:39.015815 => 18:07:39.021810
[0m18:07:39.022870 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m18:07:39.029819 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m18:07:39.031237 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m18:07:39.031887 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m18:07:39.032507 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:39.523559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:39.528035 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 18:07:39.023265 => 18:07:39.527633
[0m18:07:39.528724 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m18:07:39.582867 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.57s]
[0m18:07:39.584088 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m18:07:39.584846 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m18:07:39.585745 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m18:07:39.586843 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m18:07:39.587492 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m18:07:39.593851 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m18:07:39.595009 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 18:07:39.587935 => 18:07:39.594621
[0m18:07:39.595679 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m18:07:39.601365 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m18:07:39.602686 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m18:07:39.603339 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m18:07:39.603981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:39.994643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:39.999023 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 18:07:39.596098 => 18:07:39.998642
[0m18:07:39.999705 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m18:07:40.042952 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.46s]
[0m18:07:40.044176 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m18:07:40.044939 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m18:07:40.045813 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m18:07:40.046927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m18:07:40.047587 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m18:07:40.054937 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m18:07:40.056053 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 18:07:40.047998 => 18:07:40.055664
[0m18:07:40.056717 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m18:07:40.062192 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m18:07:40.063525 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m18:07:40.064188 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m18:07:40.064820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:40.474645 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:40.478850 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 18:07:40.057137 => 18:07:40.478485
[0m18:07:40.479505 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m18:07:40.539317 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.49s]
[0m18:07:40.540508 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m18:07:40.541249 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m18:07:40.542152 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m18:07:40.543209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m18:07:40.543832 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m18:07:40.549518 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m18:07:40.550601 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 18:07:40.544225 => 18:07:40.550230
[0m18:07:40.551232 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m18:07:40.556642 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m18:07:40.559323 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m18:07:40.560028 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m18:07:40.560704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:40.969663 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:40.973873 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 18:07:40.551629 => 18:07:40.973509
[0m18:07:40.974562 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m18:07:41.141745 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.60s]
[0m18:07:41.143103 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m18:07:41.143856 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m18:07:41.144719 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m18:07:41.146085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m18:07:41.146712 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m18:07:41.154371 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 18:07:41.147112 => 18:07:41.153898
[0m18:07:41.155057 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m18:07:41.231051 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:41.231949 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m18:07:41.232622 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:41.695852 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m18:07:41.711074 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:41.711787 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:07:41.769625 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:07:41.782047 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:41.782787 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:07:41.830517 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:07:41.880384 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:41.882039 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m18:07:43.108030 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:07:43.113542 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.114258 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:07:43.164709 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:07:43.172408 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.173121 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:07:43.211213 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:07:43.218876 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.219605 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:07:43.267327 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:07:43.275610 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.276394 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:07:43.328880 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:07:43.342851 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.343552 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:07:43.394668 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:07:43.407555 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m18:07:43.409643 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.410273 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m18:07:43.468550 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:43.469406 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.470112 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m18:07:43.709854 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m18:07:43.710826 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:07:43.711429 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m18:07:43.844723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:43.852375 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 18:07:41.155471 => 18:07:43.851992
[0m18:07:43.853074 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m18:07:43.896186 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.75s]
[0m18:07:43.897405 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m18:07:43.898211 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m18:07:43.899162 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m18:07:43.900400 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m18:07:43.901334 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m18:07:43.933157 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m18:07:43.934452 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 18:07:43.901851 => 18:07:43.934062
[0m18:07:43.935125 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m18:07:43.978149 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m18:07:43.982103 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:07:43.982916 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m18:07:43.983703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:46.067016 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:07:46.080531 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m18:07:46.089206 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:07:46.089939 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m18:07:46.170323 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:46.174562 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 18:07:43.935523 => 18:07:46.174188
[0m18:07:46.175232 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m18:07:46.473496 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 2.57s]
[0m18:07:46.474780 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m18:07:46.475520 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m18:07:46.476445 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m18:07:46.477827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m18:07:46.478611 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m18:07:46.486635 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m18:07:46.487765 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 18:07:46.479035 => 18:07:46.487389
[0m18:07:46.488407 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m18:07:46.494812 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m18:07:46.498466 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:07:46.499225 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m18:07:46.499979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:49.985742 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m18:07:49.992022 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m18:07:49.993643 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:07:49.994316 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m18:07:50.038264 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:50.042903 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 18:07:46.488811 => 18:07:50.042529
[0m18:07:50.043589 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m18:07:50.083345 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 3.61s]
[0m18:07:50.084563 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m18:07:50.085314 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:07:50.086126 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m18:07:50.087178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m18:07:50.087818 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:07:50.106203 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:07:50.107486 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 18:07:50.088224 => 18:07:50.107093
[0m18:07:50.108171 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:07:50.131806 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:07:50.133332 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:07:50.133981 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m18:07:50.134650 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:50.566889 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:50.571181 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 18:07:50.108570 => 18:07:50.570747
[0m18:07:50.571902 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m18:07:50.615029 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.53s]
[0m18:07:50.616200 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:07:50.616952 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:07:50.617718 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m18:07:50.618790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m18:07:50.619442 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:07:50.629167 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:07:50.630283 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 18:07:50.619865 => 18:07:50.629855
[0m18:07:50.630934 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:07:50.635648 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:07:50.636960 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:07:50.637596 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m18:07:50.638242 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:51.027156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:51.030573 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 18:07:50.631330 => 18:07:51.030163
[0m18:07:51.031250 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m18:07:51.078673 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.46s]
[0m18:07:51.079868 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:07:51.080609 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:07:51.081414 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m18:07:51.082534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m18:07:51.083180 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:07:51.090901 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:07:51.091974 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 18:07:51.083588 => 18:07:51.091601
[0m18:07:51.092616 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:07:51.097382 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:07:51.098683 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:07:51.099320 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m18:07:51.099938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:51.608355 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:07:51.611769 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 18:07:51.093014 => 18:07:51.611370
[0m18:07:51.612428 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m18:07:51.657033 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.57s]
[0m18:07:51.658208 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:07:51.658973 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:07:51.659756 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m18:07:51.660801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m18:07:51.661424 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:07:51.669186 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:07:51.670268 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 18:07:51.661829 => 18:07:51.669855
[0m18:07:51.670910 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:07:51.675661 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:07:51.676908 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:07:51.677530 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m18:07:51.678189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:52.055145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:52.058497 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 18:07:51.671315 => 18:07:52.058100
[0m18:07:52.059173 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m18:07:52.115412 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.45s]
[0m18:07:52.116601 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:07:52.118067 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:07:52.118928 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m18:07:52.120011 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m18:07:52.120900 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:07:52.129327 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:07:52.130427 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:07:52.121325 => 18:07:52.130050
[0m18:07:52.131076 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:07:52.138967 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:07:52.143230 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:07:52.144067 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:07:52.144871 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:54.087105 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:07:54.093370 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m18:07:54.095025 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:07:54.095648 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m18:07:54.147747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:07:54.151982 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:07:52.131471 => 18:07:54.151609
[0m18:07:54.152626 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:07:54.191364 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.07s]
[0m18:07:54.192677 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:07:54.195136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:07:54.195692 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:07:54.196348 [info ] [MainThread]: 
[0m18:07:54.197057 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 20.28 seconds (20.28s).
[0m18:07:54.201681 [debug] [MainThread]: Command end result
[0m18:07:54.226842 [info ] [MainThread]: 
[0m18:07:54.227629 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:07:54.228219 [info ] [MainThread]: 
[0m18:07:54.228811 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m18:07:54.230133 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 21.46296, "process_user_time": 7.932297, "process_kernel_time": 0.300147, "process_mem_max_rss": "167052", "process_out_blocks": "4144", "process_in_blocks": "0"}
[0m18:07:54.231006 [debug] [MainThread]: Command `dbt build` succeeded at 18:07:54.230788 after 21.46 seconds
[0m18:07:54.231577 [debug] [MainThread]: Flushing usage events


============================== 18:09:03.570594 | 0552dce8-bae9-46c7-a650-4fa33b7d5735 ==============================
[0m18:09:03.570594 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:09:03.574281 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build --full-refresh', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:09:04.502822 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:09:04.533595 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:09:04.611164 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:09:04.612416 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.yml
[0m18:09:05.050976 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:09:05.054093 [info ] [MainThread]: 
[0m18:09:05.055279 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:09:05.057623 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:09:05.077711 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:09:05.078475 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:09:05.078994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:09:05.436299 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:09:05.438823 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:09:05.482856 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:09:05.483763 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:09:05.484293 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:05.864248 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:09:05.866748 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:09:05.917444 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:09:05.918678 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:09:05.919212 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:06.252356 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:09:06.254805 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:09:06.303269 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m18:09:06.316478 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:09:06.317216 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:09:06.317737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:06.676893 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:09:06.679672 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:09:06.721343 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m18:09:06.728708 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:09:06.729295 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:09:06.729811 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:06.997839 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:09:07.000440 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:09:07.040998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m18:09:07.046503 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:09:07.047082 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:09:07.047686 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:07.383165 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:09:07.385758 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:09:07.460488 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:09:07.461378 [info ] [MainThread]: 
[0m18:09:07.464677 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m18:09:07.465487 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m18:09:07.466573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m18:09:07.467195 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m18:09:07.480812 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:09:07.481967 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 18:09:07.467596 => 18:09:07.481584
[0m18:09:07.482659 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m18:09:07.523480 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:09:07.526501 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m18:09:07.527209 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m18:09:07.527897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:08.027892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:08.059132 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 18:09:07.483046 => 18:09:08.058730
[0m18:09:08.059910 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m18:09:08.123580 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.66s]
[0m18:09:08.124779 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m18:09:08.125508 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m18:09:08.126392 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m18:09:08.127438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m18:09:08.128069 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m18:09:08.133771 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m18:09:08.134866 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 18:09:08.128477 => 18:09:08.134500
[0m18:09:08.135511 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m18:09:08.141028 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m18:09:08.142988 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m18:09:08.143665 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m18:09:08.144336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:08.522252 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:08.526502 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 18:09:08.135911 => 18:09:08.526140
[0m18:09:08.527156 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m18:09:08.568511 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.44s]
[0m18:09:08.569697 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m18:09:08.570475 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m18:09:08.571376 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m18:09:08.572721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m18:09:08.573337 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m18:09:08.580602 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m18:09:08.581650 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 18:09:08.573738 => 18:09:08.581280
[0m18:09:08.582277 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m18:09:08.587558 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m18:09:08.589134 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m18:09:08.589786 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m18:09:08.590443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:09.010202 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:09.014594 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 18:09:08.582664 => 18:09:09.014212
[0m18:09:09.015280 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m18:09:09.062424 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.49s]
[0m18:09:09.063649 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m18:09:09.064431 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m18:09:09.065324 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m18:09:09.066451 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m18:09:09.067113 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m18:09:09.073022 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:09:09.074154 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 18:09:09.067528 => 18:09:09.073731
[0m18:09:09.074808 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m18:09:09.080361 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:09:09.081924 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m18:09:09.082642 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m18:09:09.083298 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:09.504290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:09.508516 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 18:09:09.075214 => 18:09:09.508159
[0m18:09:09.509165 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m18:09:09.551847 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.49s]
[0m18:09:09.553027 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m18:09:09.553762 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m18:09:09.554505 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m18:09:09.555706 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m18:09:09.556334 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m18:09:09.562204 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m18:09:09.563254 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 18:09:09.556726 => 18:09:09.562881
[0m18:09:09.563864 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m18:09:09.569153 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m18:09:09.570465 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m18:09:09.571110 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m18:09:09.571733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:09.949368 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:09.953620 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 18:09:09.564263 => 18:09:09.953256
[0m18:09:09.954295 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m18:09:10.003708 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.45s]
[0m18:09:10.004937 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m18:09:10.005707 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m18:09:10.006640 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m18:09:10.007733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m18:09:10.008364 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m18:09:10.014518 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m18:09:10.015621 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 18:09:10.008760 => 18:09:10.015249
[0m18:09:10.016244 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m18:09:10.023924 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m18:09:10.025413 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m18:09:10.026077 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m18:09:10.026713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:10.411369 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:10.415642 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 18:09:10.016635 => 18:09:10.415270
[0m18:09:10.416323 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m18:09:10.467924 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.46s]
[0m18:09:10.469094 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m18:09:10.469823 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m18:09:10.470699 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m18:09:10.471715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m18:09:10.472327 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m18:09:10.478284 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m18:09:10.479322 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 18:09:10.472721 => 18:09:10.478959
[0m18:09:10.479934 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m18:09:10.485382 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m18:09:10.486613 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m18:09:10.487244 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m18:09:10.487855 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:10.888686 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:10.893070 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 18:09:10.480335 => 18:09:10.892698
[0m18:09:10.893739 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m18:09:10.957119 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.49s]
[0m18:09:10.958354 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m18:09:10.959093 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m18:09:10.959998 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m18:09:10.961058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m18:09:10.961676 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m18:09:10.967260 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m18:09:10.968307 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 18:09:10.962096 => 18:09:10.967942
[0m18:09:10.968921 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m18:09:10.976136 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m18:09:10.977412 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m18:09:10.978074 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m18:09:10.978697 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:11.335480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:11.339693 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 18:09:10.969312 => 18:09:11.339329
[0m18:09:11.340339 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m18:09:11.392668 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.43s]
[0m18:09:11.393849 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m18:09:11.394626 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m18:09:11.395497 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m18:09:11.396527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m18:09:11.397164 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m18:09:11.403177 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m18:09:11.404240 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 18:09:11.397584 => 18:09:11.403872
[0m18:09:11.404850 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m18:09:11.410441 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m18:09:11.413143 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m18:09:11.413837 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m18:09:11.414561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:11.802537 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:11.806782 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 18:09:11.405243 => 18:09:11.806422
[0m18:09:11.807455 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m18:09:11.859594 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.46s]
[0m18:09:11.860769 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m18:09:11.861520 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m18:09:11.862452 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m18:09:11.863701 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m18:09:11.864458 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m18:09:11.873620 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 18:09:11.864871 => 18:09:11.873224
[0m18:09:11.874278 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m18:09:11.949234 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:11.950152 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m18:09:11.950830 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:12.451721 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m18:09:12.466732 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:12.467508 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:09:12.512995 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:09:12.652062 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:12.652904 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:09:12.695196 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:09:12.743708 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:12.745349 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m18:09:14.255877 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:09:14.261400 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.262094 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:09:14.368463 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:09:14.376826 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.377546 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:09:14.425971 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:09:14.433592 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.434284 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:09:14.493101 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:09:14.500920 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.501590 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m18:09:14.550164 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m18:09:14.562953 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.563676 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m18:09:14.630280 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m18:09:14.643343 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m18:09:14.645393 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.646007 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m18:09:14.726205 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:14.727055 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.727730 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m18:09:14.985528 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m18:09:14.986527 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:09:14.987171 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m18:09:15.108246 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:15.116079 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 18:09:11.874675 => 18:09:15.115703
[0m18:09:15.116765 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m18:09:15.162800 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 3.30s]
[0m18:09:15.164000 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m18:09:15.164754 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m18:09:15.165779 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m18:09:15.167100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m18:09:15.167866 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m18:09:15.200375 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m18:09:15.201661 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 18:09:15.168275 => 18:09:15.201278
[0m18:09:15.202320 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m18:09:15.246560 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m18:09:15.250609 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:09:15.251420 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m18:09:15.252220 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:17.503252 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:09:17.518364 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m18:09:17.527006 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:09:17.527749 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m18:09:17.591676 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:17.596123 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 18:09:15.202730 => 18:09:17.595758
[0m18:09:17.596826 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m18:09:17.660937 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 2.49s]
[0m18:09:17.662322 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m18:09:17.663126 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m18:09:17.664069 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m18:09:17.665495 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m18:09:17.666178 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m18:09:17.674916 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m18:09:17.675999 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 18:09:17.666899 => 18:09:17.675632
[0m18:09:17.676643 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m18:09:17.682852 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m18:09:17.686616 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:09:17.687373 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m18:09:17.688094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:21.690638 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m18:09:21.696859 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m18:09:21.698415 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:09:21.699045 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m18:09:21.737039 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:21.743765 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 18:09:17.677054 => 18:09:21.743387
[0m18:09:21.744456 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m18:09:21.841484 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 4.18s]
[0m18:09:21.842702 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m18:09:21.843449 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:09:21.844246 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m18:09:21.845269 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m18:09:21.845894 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:09:21.864121 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:09:21.865241 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 18:09:21.846337 => 18:09:21.864868
[0m18:09:21.865902 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:09:21.889460 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:09:21.890889 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:09:21.891536 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m18:09:21.892154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:22.328020 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:22.332250 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 18:09:21.866344 => 18:09:22.331852
[0m18:09:22.332934 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m18:09:22.378783 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.53s]
[0m18:09:22.380003 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:09:22.380769 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:09:22.381582 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m18:09:22.382707 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m18:09:22.383341 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:09:22.391045 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:09:22.392131 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 18:09:22.383744 => 18:09:22.391759
[0m18:09:22.392787 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:09:22.399754 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:09:22.401089 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:09:22.401741 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m18:09:22.402409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:22.742914 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:22.746332 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 18:09:22.393188 => 18:09:22.745886
[0m18:09:22.747005 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m18:09:22.841597 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.46s]
[0m18:09:22.842807 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:09:22.843549 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:09:22.844311 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m18:09:22.845348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m18:09:22.845978 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:09:22.853655 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:09:22.854758 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 18:09:22.846418 => 18:09:22.854388
[0m18:09:22.855433 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:09:22.860432 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:09:22.861761 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:09:22.862428 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m18:09:22.863045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:23.289023 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:23.292445 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 18:09:22.855831 => 18:09:23.292030
[0m18:09:23.293137 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m18:09:23.336313 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.49s]
[0m18:09:23.337506 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:09:23.338279 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:09:23.339076 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m18:09:23.340138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m18:09:23.340785 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:09:23.349983 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:09:23.351069 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 18:09:23.341189 => 18:09:23.350690
[0m18:09:23.351717 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:09:23.356506 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:09:23.357801 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:09:23.358477 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m18:09:23.359103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:23.739953 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:23.743363 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 18:09:23.352115 => 18:09:23.742960
[0m18:09:23.744047 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m18:09:23.785876 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.45s]
[0m18:09:23.787070 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:09:23.788460 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:09:23.789290 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m18:09:23.790437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m18:09:23.791079 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:09:23.799672 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:09:23.800724 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:09:23.791475 => 18:09:23.800361
[0m18:09:23.801332 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:09:23.807235 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:09:23.811305 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:09:23.812092 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:09:23.812882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:25.634178 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:09:25.640656 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m18:09:25.642417 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:09:25.643065 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m18:09:25.688822 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:09:25.693216 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:09:23.801732 => 18:09:25.692835
[0m18:09:25.693882 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:09:25.865884 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 2.08s]
[0m18:09:25.867091 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:09:25.869469 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:09:25.870040 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:09:25.870692 [info ] [MainThread]: 
[0m18:09:25.871293 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 20.82 seconds (20.82s).
[0m18:09:25.875889 [debug] [MainThread]: Command end result
[0m18:09:25.895851 [info ] [MainThread]: 
[0m18:09:25.896600 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:09:25.897185 [info ] [MainThread]: 
[0m18:09:25.897783 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m18:09:25.899094 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 22.397139, "process_user_time": 8.464913, "process_kernel_time": 0.284853, "process_mem_max_rss": "167064", "process_out_blocks": "5992", "process_in_blocks": "0"}
[0m18:09:25.899955 [debug] [MainThread]: Command `dbt build` succeeded at 18:09:25.899739 after 22.40 seconds
[0m18:09:25.900533 [debug] [MainThread]: Flushing usage events


============================== 18:10:49.786108 | 6e0b6fcf-e0c8-4851-9a43-a679cacccaec ==============================
[0m18:10:49.786108 [info ] [MainThread]: Running with dbt=1.7.3
[0m18:10:49.789754 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build --full-refresh', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m18:10:50.724324 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m18:10:50.756511 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m18:10:50.837695 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:10:50.839059 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.yml
[0m18:10:51.292195 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m18:10:51.295427 [info ] [MainThread]: 
[0m18:10:51.296666 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:10:51.299031 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m18:10:51.319000 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:10:51.319738 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:10:51.320260 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:10:51.723785 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:10:51.726310 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:10:51.773881 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:10:51.774828 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:10:51.775381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:52.114609 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:10:52.117046 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:10:52.168942 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m18:10:52.169864 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m18:10:52.170431 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:52.517403 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m18:10:52.519918 [debug] [ThreadPool]: On list_tpcds: Close
[0m18:10:52.562990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m18:10:52.576277 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m18:10:52.576913 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m18:10:52.577448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:52.859543 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:52.862142 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m18:10:52.910649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m18:10:52.915804 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m18:10:52.916376 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m18:10:52.916899 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:53.339013 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m18:10:53.341705 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m18:10:53.383851 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m18:10:53.389388 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m18:10:53.389991 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m18:10:53.390552 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:53.804405 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m18:10:53.807195 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m18:10:53.852716 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:10:53.853565 [info ] [MainThread]: 
[0m18:10:53.856946 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m18:10:53.857734 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m18:10:53.858805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m18:10:53.859411 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m18:10:53.872939 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:10:53.874464 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 18:10:53.859788 => 18:10:53.874075
[0m18:10:53.875174 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m18:10:53.915583 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m18:10:53.918929 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m18:10:53.919644 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m18:10:53.920328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:54.338585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:54.370153 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 18:10:53.875649 => 18:10:54.369731
[0m18:10:54.370945 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m18:10:54.419594 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.56s]
[0m18:10:54.420769 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m18:10:54.421489 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m18:10:54.422467 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m18:10:54.423502 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m18:10:54.424118 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m18:10:54.429856 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m18:10:54.431002 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 18:10:54.424518 => 18:10:54.430622
[0m18:10:54.431616 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m18:10:54.437607 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m18:10:54.439864 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m18:10:54.440534 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m18:10:54.441175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:54.881393 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:54.885650 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 18:10:54.432004 => 18:10:54.885273
[0m18:10:54.886358 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m18:10:54.932575 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.51s]
[0m18:10:54.933750 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m18:10:54.934507 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m18:10:54.935496 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m18:10:54.936781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m18:10:54.937541 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m18:10:54.945002 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m18:10:54.946176 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 18:10:54.937947 => 18:10:54.945763
[0m18:10:54.946802 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m18:10:54.952415 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m18:10:54.954045 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m18:10:54.954697 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m18:10:54.955336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:55.332893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:55.337127 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 18:10:54.947192 => 18:10:55.336768
[0m18:10:55.337786 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m18:10:55.383450 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.45s]
[0m18:10:55.384644 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m18:10:55.385376 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m18:10:55.386309 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m18:10:55.387354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m18:10:55.388005 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m18:10:55.393835 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:10:55.394946 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 18:10:55.388402 => 18:10:55.394568
[0m18:10:55.395560 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m18:10:55.401123 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m18:10:55.402762 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m18:10:55.403410 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m18:10:55.404038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:55.793094 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:55.797494 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 18:10:55.395951 => 18:10:55.797121
[0m18:10:55.798183 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m18:10:55.838774 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.45s]
[0m18:10:55.839883 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m18:10:55.840596 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m18:10:55.841500 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m18:10:55.842555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m18:10:55.843170 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m18:10:55.848801 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m18:10:55.849840 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 18:10:55.843560 => 18:10:55.849475
[0m18:10:55.850496 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m18:10:55.855904 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m18:10:55.857197 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m18:10:55.857828 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m18:10:55.858466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:56.262977 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:56.267368 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 18:10:55.850889 => 18:10:56.266997
[0m18:10:56.268050 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m18:10:56.318884 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.48s]
[0m18:10:56.320108 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m18:10:56.320864 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m18:10:56.321815 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m18:10:56.322917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m18:10:56.323559 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m18:10:56.329326 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m18:10:56.330445 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 18:10:56.323976 => 18:10:56.330057
[0m18:10:56.331074 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m18:10:56.338605 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m18:10:56.340045 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m18:10:56.340695 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m18:10:56.341336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:56.831924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:56.836160 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 18:10:56.331473 => 18:10:56.835800
[0m18:10:56.836828 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m18:10:56.879566 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.56s]
[0m18:10:56.880895 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m18:10:56.881705 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m18:10:56.882668 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m18:10:56.883811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m18:10:56.884532 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m18:10:56.890897 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m18:10:56.892373 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 18:10:56.885020 => 18:10:56.891997
[0m18:10:56.893225 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m18:10:56.899123 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m18:10:56.900866 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m18:10:56.901598 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m18:10:56.902347 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:57.296838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:57.301032 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 18:10:56.893708 => 18:10:57.300668
[0m18:10:57.301679 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m18:10:57.352881 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.47s]
[0m18:10:57.354076 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m18:10:57.354805 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m18:10:57.355673 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m18:10:57.356732 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m18:10:57.357358 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m18:10:57.363569 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m18:10:57.364630 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 18:10:57.357772 => 18:10:57.364261
[0m18:10:57.365238 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m18:10:57.372477 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m18:10:57.373737 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m18:10:57.374397 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m18:10:57.374997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:57.766708 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:57.770933 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 18:10:57.365620 => 18:10:57.770573
[0m18:10:57.771597 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m18:10:57.818566 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.46s]
[0m18:10:57.819750 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m18:10:57.820485 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m18:10:57.821366 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m18:10:57.822481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m18:10:57.823103 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m18:10:57.828978 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m18:10:57.830040 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 18:10:57.823508 => 18:10:57.829662
[0m18:10:57.830700 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m18:10:57.836143 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m18:10:57.838778 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m18:10:57.839473 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m18:10:57.840141 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:58.239393 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:10:58.243531 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 18:10:57.831113 => 18:10:58.243168
[0m18:10:58.244177 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m18:10:58.298877 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.48s]
[0m18:10:58.300050 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m18:10:58.300790 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m18:10:58.301683 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m18:10:58.302990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m18:10:58.303621 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m18:10:58.312965 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 18:10:58.304012 => 18:10:58.312548
[0m18:10:58.313632 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m18:10:58.400884 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m18:10:58.403466 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m18:10:58.404154 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

    ) sbq



        );
[0m18:10:58.404824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:00.512895 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:11:00.522213 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 18:10:58.314054 => 18:11:00.521805
[0m18:11:00.522922 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m18:11:00.563240 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 1[0m in 2.26s]
[0m18:11:00.564451 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m18:11:00.565221 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m18:11:00.566227 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m18:11:00.567611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m18:11:00.568300 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m18:11:00.603438 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m18:11:00.604748 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 18:11:00.568969 => 18:11:00.604352
[0m18:11:00.605446 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m18:11:00.654525 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m18:11:00.658658 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:11:00.659500 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace transient table tpcds.intermediate.int__daily_aggregated_sales
         as
        (
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
        );
[0m18:11:00.660317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:03.389667 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m18:11:03.403387 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m18:11:03.411967 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m18:11:03.412673 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m18:11:03.444109 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:03.448360 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 18:11:00.605860 => 18:11:03.447992
[0m18:11:03.449039 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m18:11:03.499290 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 1[0m in 2.93s]
[0m18:11:03.500503 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m18:11:03.501253 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m18:11:03.502429 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m18:11:03.503572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m18:11:03.504199 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m18:11:03.648277 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m18:11:03.649599 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 18:11:03.504614 => 18:11:03.649228
[0m18:11:03.650284 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m18:11:03.656880 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m18:11:03.660630 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:11:03.661415 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace transient table tpcds.analytics.customer_dim
         as
        (

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
        );
[0m18:11:03.662183 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:05.712011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:11:05.718495 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m18:11:05.720276 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m18:11:05.720894 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m18:11:05.782328 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:05.786726 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 18:11:03.650678 => 18:11:05.786344
[0m18:11:05.787403 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m18:11:05.825465 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 1[0m in 2.32s]
[0m18:11:05.826741 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m18:11:05.827518 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:11:05.828320 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m18:11:05.829402 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m18:11:05.830102 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:11:05.848818 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:11:05.850083 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 18:11:05.830528 => 18:11:05.849651
[0m18:11:05.850791 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:11:05.877073 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:11:05.878750 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m18:11:05.879422 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m18:11:05.880072 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:06.301752 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:06.306151 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 18:11:05.851211 => 18:11:06.305674
[0m18:11:06.306894 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m18:11:06.353293 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.52s]
[0m18:11:06.354535 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m18:11:06.355280 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:11:06.356057 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m18:11:06.357128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m18:11:06.357755 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:11:06.365501 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:11:06.366725 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 18:11:06.358183 => 18:11:06.366337
[0m18:11:06.367384 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:11:06.372650 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:11:06.374043 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m18:11:06.374697 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m18:11:06.375333 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:06.763188 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:06.766579 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 18:11:06.367787 => 18:11:06.766169
[0m18:11:06.767243 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m18:11:06.811563 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.45s]
[0m18:11:06.812795 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m18:11:06.813555 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:11:06.814240 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m18:11:06.815500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m18:11:06.816149 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:11:06.825471 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:11:06.826632 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 18:11:06.816549 => 18:11:06.826249
[0m18:11:06.827258 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:11:06.832220 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:11:06.833512 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m18:11:06.834175 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m18:11:06.834797 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:07.273683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:07.277109 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 18:11:06.827655 => 18:11:07.276700
[0m18:11:07.277780 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m18:11:07.319712 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.50s]
[0m18:11:07.320890 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m18:11:07.321620 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:11:07.322308 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m18:11:07.323480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m18:11:07.324118 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:11:07.331769 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:11:07.332831 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 18:11:07.324534 => 18:11:07.332457
[0m18:11:07.333446 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:11:07.338352 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:11:07.339637 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m18:11:07.340276 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m18:11:07.340892 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:07.812500 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:07.815953 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 18:11:07.333838 => 18:11:07.815550
[0m18:11:07.816625 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m18:11:07.860023 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.54s]
[0m18:11:07.861197 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m18:11:07.862658 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m18:11:07.863448 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m18:11:07.864487 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m18:11:07.865121 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m18:11:07.873760 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m18:11:07.874890 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 18:11:07.865518 => 18:11:07.874511
[0m18:11:07.875523 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m18:11:07.881676 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m18:11:07.885989 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:11:07.886850 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace transient table tpcds.analytics.weekly_sales_inventory
         as
        (

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
        );
[0m18:11:07.887673 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:09.477155 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:11:09.483424 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m18:11:09.486279 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m18:11:09.486922 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m18:11:09.528103 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m18:11:09.532433 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 18:11:07.875924 => 18:11:09.532051
[0m18:11:09.533127 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m18:11:09.571220 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 1[0m in 1.71s]
[0m18:11:09.572393 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m18:11:09.575088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:11:09.575679 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m18:11:09.576365 [info ] [MainThread]: 
[0m18:11:09.577005 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 18.28 seconds (18.28s).
[0m18:11:09.581661 [debug] [MainThread]: Command end result
[0m18:11:09.602339 [info ] [MainThread]: 
[0m18:11:09.603155 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:11:09.603772 [info ] [MainThread]: 
[0m18:11:09.604402 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m18:11:09.605771 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 19.887197, "process_user_time": 8.275559, "process_kernel_time": 0.291368, "process_mem_max_rss": "166832", "process_out_blocks": "5944", "process_in_blocks": "0"}
[0m18:11:09.606694 [debug] [MainThread]: Command `dbt build` succeeded at 18:11:09.606468 after 19.89 seconds
[0m18:11:09.607293 [debug] [MainThread]: Flushing usage events


============================== 14:45:25.806230 | e7cd1d91-52d9-4f09-b9aa-079270fe30ee ==============================
[0m14:45:25.806230 [info ] [MainThread]: Running with dbt=1.7.3
[0m14:45:25.809925 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m14:45:26.744965 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m14:45:26.777233 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m14:45:26.857489 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:45:26.858265 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:45:26.893227 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m14:45:26.896384 [info ] [MainThread]: 
[0m14:45:26.897583 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:45:26.907150 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m14:45:26.931932 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m14:45:26.932684 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m14:45:26.933190 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:45:27.647816 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m14:45:27.650307 [debug] [ThreadPool]: On list_tpcds: Close
[0m14:45:27.697181 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m14:45:27.697949 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m14:45:27.698504 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:45:28.061355 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m14:45:28.063886 [debug] [ThreadPool]: On list_tpcds: Close
[0m14:45:28.120885 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m14:45:28.121690 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m14:45:28.122271 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:45:28.481985 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m14:45:28.484532 [debug] [ThreadPool]: On list_tpcds: Close
[0m14:45:28.535746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m14:45:28.549232 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m14:45:28.549937 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m14:45:28.550526 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:45:28.893672 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m14:45:28.896324 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m14:45:28.955090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m14:45:28.961721 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m14:45:28.962327 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m14:45:28.962845 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:45:29.286927 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m14:45:29.289636 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m14:45:29.333210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m14:45:29.340613 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m14:45:29.341176 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m14:45:29.341692 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:45:29.795787 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m14:45:29.798317 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m14:45:29.878050 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:45:29.878937 [info ] [MainThread]: 
[0m14:45:29.882053 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m14:45:29.882866 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m14:45:29.883937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m14:45:29.897090 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m14:45:29.911068 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m14:45:29.912298 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 14:45:29.897696 => 14:45:29.911925
[0m14:45:29.912919 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m14:45:29.954436 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m14:45:29.957500 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m14:45:29.958243 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m14:45:29.958948 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:30.452170 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:30.483726 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 14:45:29.913303 => 14:45:30.483330
[0m14:45:30.484507 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m14:45:30.534114 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.65s]
[0m14:45:30.535377 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m14:45:30.536126 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m14:45:30.537004 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m14:45:30.538143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m14:45:30.538802 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m14:45:30.558340 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m14:45:30.560024 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 14:45:30.539230 => 14:45:30.559624
[0m14:45:30.560710 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m14:45:30.566534 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m14:45:30.568518 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m14:45:30.569207 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m14:45:30.569876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:31.154705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:31.158888 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 14:45:30.561114 => 14:45:31.158510
[0m14:45:31.159551 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m14:45:31.205864 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.67s]
[0m14:45:31.207115 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m14:45:31.207851 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m14:45:31.208745 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m14:45:31.209979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m14:45:31.210694 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m14:45:31.216363 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m14:45:31.217489 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 14:45:31.211092 => 14:45:31.217114
[0m14:45:31.218179 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m14:45:31.224087 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m14:45:31.225826 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m14:45:31.226518 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m14:45:31.227154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:31.657527 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:31.661981 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 14:45:31.218578 => 14:45:31.661601
[0m14:45:31.662709 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m14:45:31.715648 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.51s]
[0m14:45:31.716867 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m14:45:31.717621 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m14:45:31.718507 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m14:45:31.719576 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m14:45:31.720224 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m14:45:31.725719 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m14:45:31.727279 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 14:45:31.720629 => 14:45:31.726885
[0m14:45:31.728040 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m14:45:31.735391 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m14:45:31.737414 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m14:45:31.738204 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m14:45:31.738944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:32.245142 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:32.249369 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 14:45:31.728540 => 14:45:32.249008
[0m14:45:32.250051 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m14:45:32.295437 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.58s]
[0m14:45:32.296538 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m14:45:32.297251 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m14:45:32.298155 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m14:45:32.299283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m14:45:32.299895 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m14:45:32.305375 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m14:45:32.306433 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 14:45:32.300300 => 14:45:32.306069
[0m14:45:32.307069 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m14:45:32.312275 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m14:45:32.313574 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m14:45:32.314217 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m14:45:32.314825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:32.706129 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:32.710316 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 14:45:32.307451 => 14:45:32.709926
[0m14:45:32.710972 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m14:45:32.756096 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.46s]
[0m14:45:32.757423 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m14:45:32.758279 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m14:45:32.759114 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m14:45:32.760367 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m14:45:32.760996 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m14:45:32.766686 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m14:45:32.767774 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 14:45:32.761406 => 14:45:32.767389
[0m14:45:32.768424 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m14:45:32.775965 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m14:45:32.777468 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m14:45:32.778142 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m14:45:32.778772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:33.161697 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:33.166189 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 14:45:32.768817 => 14:45:33.165774
[0m14:45:33.166897 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m14:45:33.229978 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.47s]
[0m14:45:33.231191 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m14:45:33.231931 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m14:45:33.232776 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m14:45:33.233825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m14:45:33.234489 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m14:45:33.240889 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m14:45:33.241971 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 14:45:33.234880 => 14:45:33.241592
[0m14:45:33.242627 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m14:45:33.247939 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m14:45:33.249168 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m14:45:33.249789 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m14:45:33.250441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:33.795875 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:33.800171 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 14:45:33.243019 => 14:45:33.799803
[0m14:45:33.800837 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m14:45:33.848445 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.61s]
[0m14:45:33.849623 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m14:45:33.850371 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m14:45:33.851243 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m14:45:33.852318 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m14:45:33.852930 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m14:45:33.860319 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m14:45:33.861597 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 14:45:33.853332 => 14:45:33.861220
[0m14:45:33.862249 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m14:45:33.868231 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m14:45:33.869654 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m14:45:33.870319 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m14:45:33.870954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:34.290994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:34.295144 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 14:45:33.862649 => 14:45:34.294788
[0m14:45:34.295796 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m14:45:34.400572 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.55s]
[0m14:45:34.401748 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m14:45:34.402521 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m14:45:34.403354 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m14:45:34.404383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m14:45:34.405012 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m14:45:34.410768 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m14:45:34.411816 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 14:45:34.405407 => 14:45:34.411445
[0m14:45:34.412439 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m14:45:34.417819 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m14:45:34.420469 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m14:45:34.421166 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m14:45:34.421868 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:34.943380 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:34.947589 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 14:45:34.412831 => 14:45:34.947225
[0m14:45:34.948239 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m14:45:35.028891 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.62s]
[0m14:45:35.030248 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m14:45:35.030980 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m14:45:35.031874 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m14:45:35.033192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m14:45:35.033816 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m14:45:35.041281 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 14:45:35.034265 => 14:45:35.040869
[0m14:45:35.041998 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m14:45:35.117786 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:35.118717 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK, _AIRBYTE_NORMALIZED_AT from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m14:45:35.119365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:35.939802 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m14:45:35.955404 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:35.956167 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m14:45:36.024736 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m14:45:36.037080 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:36.037890 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m14:45:36.152706 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m14:45:36.204720 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:36.206433 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ) or snapshotted_data."_AIRBYTE_NORMALIZED_AT" != source_data."_AIRBYTE_NORMALIZED_AT"
        or
        (
            ((snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and not (source_data."_AIRBYTE_NORMALIZED_AT" is null))
            or
            ((not snapshotted_data."_AIRBYTE_NORMALIZED_AT" is null) and (source_data."_AIRBYTE_NORMALIZED_AT" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m14:45:42.193707 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 6.0 seconds
[0m14:45:42.199163 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.199807 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m14:45:42.262258 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m14:45:42.269806 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.270493 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m14:45:42.381342 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m14:45:42.389217 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.390046 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m14:45:42.549095 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m14:45:42.557063 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.557983 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m14:45:42.604481 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m14:45:42.618473 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.619284 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m14:45:42.661052 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m14:45:42.676237 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m14:45:42.679010 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.679739 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m14:45:42.767996 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:42.768852 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:42.769531 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m14:45:45.978977 [debug] [Thread-1 (]: SQL status: SUCCESS 200000 in 3.0 seconds
[0m14:45:45.979932 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m14:45:45.980559 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m14:45:46.228821 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:46.236249 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 14:45:35.042455 => 14:45:46.235871
[0m14:45:46.236992 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m14:45:46.294974 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 200000[0m in 11.26s]
[0m14:45:46.296165 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m14:45:46.296930 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m14:45:46.297850 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m14:45:46.299166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m14:45:46.299811 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m14:45:46.332220 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m14:45:46.333517 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 14:45:46.300209 => 14:45:46.333131
[0m14:45:46.334219 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m14:45:46.381422 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:46.382468 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m14:45:46.383293 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:47.566185 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:47.571817 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.572568 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m14:45:47.638317 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:45:47.645564 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.646318 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m14:45:47.740751 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:45:47.754431 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.755325 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m14:45:47.807271 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:45:47.848259 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.850987 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.851618 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m14:45:47.950611 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:47.951658 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:47.952475 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m14:45:53.219385 [debug] [Thread-1 (]: SQL status: SUCCESS 4633 in 5.0 seconds
[0m14:45:53.220357 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:53.220997 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m14:45:53.473490 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:53.490551 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m14:45:53.500003 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m14:45:53.500896 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m14:45:53.787523 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:53.791658 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 14:45:46.334623 => 14:45:53.791282
[0m14:45:53.792354 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m14:45:53.849833 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 4633[0m in 7.55s]
[0m14:45:53.851182 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m14:45:53.851935 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m14:45:53.853039 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m14:45:53.854230 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m14:45:53.854850 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m14:45:53.862532 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m14:45:53.863568 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 14:45:53.855256 => 14:45:53.863206
[0m14:45:53.864206 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m14:45:53.872761 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:53.873583 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m14:45:53.874334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:54.678779 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:45:54.685759 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:54.686486 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m14:45:54.764637 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m14:45:54.773524 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:54.774314 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m14:45:54.871177 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m14:45:54.881588 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:54.882508 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m14:45:54.938114 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m14:45:54.948722 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m14:45:54.953027 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:54.953651 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m14:45:55.097390 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:55.098276 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m14:45:55.099105 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m14:45:58.200127 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b14661-0001-91db-0004-d6ae000bf11e
[0m14:45:58.200919 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m14:45:58.201805 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 14:45:53.864596 => 14:45:58.201437
[0m14:45:58.202491 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m14:45:58.246242 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m14:45:58.247502 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 4.39s]
[0m14:45:58.248509 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m14:45:58.249269 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m14:45:58.249956 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m14:45:58.251241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m14:45:58.251875 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m14:45:58.271105 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m14:45:58.272358 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 14:45:58.252275 => 14:45:58.271974
[0m14:45:58.273018 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m14:45:58.298632 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m14:45:58.300195 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m14:45:58.300837 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m14:45:58.301459 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:58.721123 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:58.725377 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 14:45:58.273431 => 14:45:58.724929
[0m14:45:58.726141 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m14:45:58.771582 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.52s]
[0m14:45:58.772766 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m14:45:58.773521 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m14:45:58.774325 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m14:45:58.775397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m14:45:58.776030 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m14:45:58.784216 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m14:45:58.785321 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 14:45:58.776435 => 14:45:58.784945
[0m14:45:58.785967 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m14:45:58.790954 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m14:45:58.792293 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m14:45:58.792921 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m14:45:58.793538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:59.172683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:59.176023 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 14:45:58.786402 => 14:45:59.175629
[0m14:45:59.176690 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m14:45:59.257613 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.48s]
[0m14:45:59.258818 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m14:45:59.259544 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m14:45:59.260346 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m14:45:59.261375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m14:45:59.261993 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m14:45:59.270951 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m14:45:59.271992 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 14:45:59.262425 => 14:45:59.271631
[0m14:45:59.272630 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m14:45:59.277259 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m14:45:59.278532 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m14:45:59.279159 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m14:45:59.279771 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:45:59.685893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:45:59.689307 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 14:45:59.273030 => 14:45:59.688912
[0m14:45:59.689979 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m14:45:59.742437 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.48s]
[0m14:45:59.743631 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m14:45:59.744379 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m14:45:59.745180 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m14:45:59.746287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m14:45:59.746923 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m14:45:59.754467 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m14:45:59.755541 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 14:45:59.747315 => 14:45:59.755161
[0m14:45:59.756150 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m14:45:59.761022 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m14:45:59.762373 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m14:45:59.763008 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m14:45:59.763633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:00.144340 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:46:00.147837 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 14:45:59.756542 => 14:46:00.147371
[0m14:46:00.148563 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m14:46:02.016224 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 2.27s]
[0m14:46:02.017689 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m14:46:02.019204 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m14:46:02.020033 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m14:46:02.021300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m14:46:02.021932 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m14:46:02.031156 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m14:46:02.032458 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 14:46:02.022381 => 14:46:02.032054
[0m14:46:02.033128 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m14:46:02.043916 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:02.044985 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m14:46:02.045832 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:02.680447 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:46:02.686357 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:02.687131 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m14:46:02.747870 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:46:02.756561 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:02.757389 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m14:46:02.816474 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:46:02.992144 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:02.992989 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m14:46:03.107561 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m14:46:03.114493 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m14:46:03.117983 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:03.118752 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m14:46:03.198253 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:46:03.199127 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:03.199824 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m14:46:05.158846 [debug] [Thread-1 (]: SQL status: SUCCESS 34 in 2.0 seconds
[0m14:46:05.159801 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:05.160413 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m14:46:05.396461 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:46:05.402941 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m14:46:05.404597 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m14:46:05.405319 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m14:46:05.492197 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:46:05.496278 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 14:46:02.033528 => 14:46:05.495899
[0m14:46:05.496973 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m14:46:05.549804 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 34[0m in 3.53s]
[0m14:46:05.551166 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m14:46:05.553769 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:46:05.554381 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m14:46:05.555258 [info ] [MainThread]: 
[0m14:46:05.556270 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 38.66 seconds (38.66s).
[0m14:46:05.561186 [debug] [MainThread]: Command end result
[0m14:46:05.583520 [info ] [MainThread]: 
[0m14:46:05.584313 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:46:05.584870 [info ] [MainThread]: 
[0m14:46:05.585423 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m14:46:05.586015 [info ] [MainThread]: 
[0m14:46:05.586637 [info ] [MainThread]: Done. PASS=16 WARN=0 ERROR=1 SKIP=0 TOTAL=17
[0m14:46:05.587951 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 39.85059, "process_user_time": 8.505033, "process_kernel_time": 0.224828, "process_mem_max_rss": "167788", "process_out_blocks": "5000", "command_success": false, "process_in_blocks": "0"}
[0m14:46:05.588814 [debug] [MainThread]: Command `dbt build` failed at 14:46:05.588592 after 39.85 seconds
[0m14:46:05.589394 [debug] [MainThread]: Flushing usage events


============================== 15:00:26.210246 | e913c65f-25b8-4571-9fba-ef95171a6f79 ==============================
[0m15:00:26.210246 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:00:26.214007 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt snapshot', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m15:00:27.180369 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m15:00:27.213499 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m15:00:27.296449 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:00:27.297661 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m15:00:27.744892 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m15:00:27.747683 [info ] [MainThread]: 
[0m15:00:27.748898 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:00:27.751213 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m15:00:27.772556 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:00:27.773454 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:00:27.774192 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:28.184725 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m15:00:28.187339 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:00:28.264210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m15:00:28.277302 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m15:00:28.278070 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m15:00:28.278614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:29.179949 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m15:00:29.182511 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m15:00:29.229429 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m15:00:29.235123 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m15:00:29.235788 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m15:00:29.236315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:29.596585 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:00:29.599300 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m15:00:29.714107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m15:00:29.719222 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m15:00:29.719817 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m15:00:29.720333 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:30.196414 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m15:00:30.199222 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m15:00:30.303365 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:00:30.304403 [info ] [MainThread]: 
[0m15:00:30.307559 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m15:00:30.308350 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m15:00:30.309450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now snapshot.capstone.customer_snapshot)
[0m15:00:30.310179 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m15:00:30.325058 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 15:00:30.310672 => 15:00:30.324531
[0m15:00:30.325951 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m15:00:30.447711 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m15:00:30.450407 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:00:30.451092 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

    ) sbq



        );
[0m15:00:30.451758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:34.016855 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m15:00:34.049617 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 15:00:30.326478 => 15:00:34.049225
[0m15:00:34.050413 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m15:00:34.123370 [info ] [Thread-1 (]: 1 of 1 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 1[0m in 3.81s]
[0m15:00:34.124622 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m15:00:34.127053 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:34.127586 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m15:00:34.128137 [info ] [MainThread]: 
[0m15:00:34.128739 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.38 seconds (6.38s).
[0m15:00:34.129809 [debug] [MainThread]: Command end result
[0m15:00:34.150498 [info ] [MainThread]: 
[0m15:00:34.151299 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:00:34.151879 [info ] [MainThread]: 
[0m15:00:34.152471 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:00:34.153739 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.011265, "process_user_time": 5.278827, "process_kernel_time": 0.255797, "process_mem_max_rss": "165012", "process_out_blocks": "5496", "process_in_blocks": "0"}
[0m15:00:34.154630 [debug] [MainThread]: Command `dbt snapshot` succeeded at 15:00:34.154405 after 8.01 seconds
[0m15:00:34.155202 [debug] [MainThread]: Flushing usage events


============================== 15:08:20.008794 | 2b5d4718-9f2b-4389-a6ff-c6879917ed2f ==============================
[0m15:08:20.008794 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:08:20.012552 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m15:08:20.936006 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m15:08:20.967059 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m15:08:21.045214 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:21.045929 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:21.080576 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m15:08:21.083245 [info ] [MainThread]: 
[0m15:08:21.084407 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:08:21.086014 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m15:08:21.113924 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:08:21.114693 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:08:21.115221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:21.996197 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m15:08:21.998658 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:08:22.079903 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m15:08:22.092679 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m15:08:22.093247 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m15:08:22.093774 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:22.510760 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m15:08:22.513491 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m15:08:22.571948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m15:08:22.579505 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m15:08:22.580068 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m15:08:22.580605 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:22.930670 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m15:08:22.933144 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m15:08:22.986551 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m15:08:22.991886 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m15:08:22.992442 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m15:08:22.992955 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:24.154436 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m15:08:24.156910 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m15:08:24.239869 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:24.240593 [info ] [MainThread]: 
[0m15:08:24.243610 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m15:08:24.244404 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m15:08:24.245462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now snapshot.capstone.customer_snapshot)
[0m15:08:24.246137 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m15:08:24.261278 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 15:08:24.246806 => 15:08:24.260828
[0m15:08:24.262160 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m15:08:24.361185 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:24.362232 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m15:08:24.362997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:28.789910 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 4.0 seconds
[0m15:08:28.803934 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:28.804695 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:08:28.909058 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:08:28.922089 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:28.922827 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:08:28.968787 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:08:29.017759 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:29.019353 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m15:08:30.646974 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m15:08:30.652526 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:30.653184 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:08:30.818769 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:08:30.827231 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:30.827914 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:08:30.884800 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:08:30.892482 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:30.893299 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:08:30.965820 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:08:30.973651 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:30.974363 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:08:31.036397 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:08:31.048693 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:31.049470 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:08:31.110650 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:08:31.124357 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m15:08:31.127032 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:31.127777 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m15:08:31.210815 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:08:31.211737 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:31.212496 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m15:08:31.624023 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m15:08:31.624992 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:08:31.625616 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m15:08:31.830937 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:08:31.870571 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 15:08:24.262601 => 15:08:31.870148
[0m15:08:31.871467 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m15:08:31.935376 [info ] [Thread-1 (]: 1 of 1 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 0[0m in 7.69s]
[0m15:08:31.936744 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m15:08:31.939247 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:31.939816 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m15:08:31.940400 [info ] [MainThread]: 
[0m15:08:31.941002 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 10.86 seconds (10.86s).
[0m15:08:31.942343 [debug] [MainThread]: Command end result
[0m15:08:31.972033 [info ] [MainThread]: 
[0m15:08:31.972795 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:31.973374 [info ] [MainThread]: 
[0m15:08:31.973979 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:08:31.975272 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.033367, "process_user_time": 4.994195, "process_kernel_time": 0.263637, "process_mem_max_rss": "162804", "process_out_blocks": "3696", "process_in_blocks": "0"}
[0m15:08:31.976134 [debug] [MainThread]: Command `dbt snapshot` succeeded at 15:08:31.975908 after 12.03 seconds
[0m15:08:31.976700 [debug] [MainThread]: Flushing usage events


============================== 15:17:54.749247 | d492a0d1-5074-4db8-8906-f6654a7ef673 ==============================
[0m15:17:54.749247 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:17:54.752992 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'invocation_command': 'dbt snapshot', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m15:17:55.662196 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m15:17:55.692821 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m15:17:55.771586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:17:55.772319 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:17:55.805758 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m15:17:55.808451 [info ] [MainThread]: 
[0m15:17:55.809603 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:17:55.811313 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m15:17:55.831805 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:17:55.832554 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:17:55.833164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:56.340276 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m15:17:56.342734 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:17:56.392448 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m15:17:56.405263 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m15:17:56.405915 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m15:17:56.406469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:56.704395 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m15:17:56.707209 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m15:17:56.765274 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m15:17:56.772789 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m15:17:56.773372 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m15:17:56.773917 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:57.125308 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m15:17:57.127800 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m15:17:57.172729 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m15:17:57.178133 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m15:17:57.178710 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m15:17:57.179229 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:57.783598 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m15:17:57.786101 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m15:17:57.858542 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:57.859253 [info ] [MainThread]: 
[0m15:17:57.862188 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m15:17:57.862965 [info ] [Thread-1 (]: 1 of 1 START snapshot intermediate.customer_snapshot ........................... [RUN]
[0m15:17:57.864018 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now snapshot.capstone.customer_snapshot)
[0m15:17:57.864630 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m15:17:57.879064 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 15:17:57.865134 => 15:17:57.878647
[0m15:17:57.879725 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m15:17:57.964357 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:17:57.965222 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m15:17:57.965878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:58.961409 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m15:17:58.975120 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:17:58.975917 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:17:59.026249 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:17:59.039302 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:17:59.040055 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:17:59.097754 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:17:59.146405 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:17:59.148001 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m15:18:01.045060 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m15:18:01.050559 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.051244 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:18:01.107306 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:18:01.115885 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.116590 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:18:01.151951 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:18:01.159704 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.160471 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:18:01.218098 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:18:01.225914 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.226779 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:18:01.278327 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:18:01.290495 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.291340 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:18:01.339990 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:18:01.353096 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m15:18:01.355296 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.355937 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m15:18:01.410969 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:18:01.411820 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.412517 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m15:18:01.669881 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m15:18:01.670837 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:18:01.671460 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m15:18:01.830041 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:18:01.860928 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 15:17:57.880122 => 15:18:01.860526
[0m15:18:01.861737 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m15:18:01.938063 [info ] [Thread-1 (]: 1 of 1 OK snapshotted intermediate.customer_snapshot ........................... [[32mSUCCESS 0[0m in 4.07s]
[0m15:18:01.939405 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m15:18:01.942094 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:18:01.942690 [debug] [MainThread]: Connection 'snapshot.capstone.customer_snapshot' was properly closed.
[0m15:18:01.943272 [info ] [MainThread]: 
[0m15:18:01.943934 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.13 seconds (6.13s).
[0m15:18:01.945789 [debug] [MainThread]: Command end result
[0m15:18:01.969583 [info ] [MainThread]: 
[0m15:18:01.970479 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:18:01.971084 [info ] [MainThread]: 
[0m15:18:01.971708 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:18:01.973082 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 7.291959, "process_user_time": 5.015982, "process_kernel_time": 0.283628, "process_mem_max_rss": "162832", "process_out_blocks": "3688", "process_in_blocks": "0"}
[0m15:18:01.974010 [debug] [MainThread]: Command `dbt snapshot` succeeded at 15:18:01.973779 after 7.29 seconds
[0m15:18:01.974679 [debug] [MainThread]: Flushing usage events


============================== 15:19:37.501022 | 32dc7275-6613-42da-a98a-e10256b84a8b ==============================
[0m15:19:37.501022 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:19:37.504787 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'invocation_command': 'dbt build', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m15:19:38.453655 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m15:19:38.485627 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m15:19:38.565459 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:19:38.566256 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:19:38.600507 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m15:19:38.603668 [info ] [MainThread]: 
[0m15:19:38.609832 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:19:38.618692 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m15:19:38.641958 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:19:38.642749 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:19:38.643276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:39.233977 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m15:19:39.236448 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:19:39.405970 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:19:39.406884 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:19:39.407427 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:39.793333 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m15:19:39.795785 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:19:39.865581 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m15:19:39.866438 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m15:19:39.866975 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:40.183070 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m15:19:40.185456 [debug] [ThreadPool]: On list_tpcds: Close
[0m15:19:40.233330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m15:19:40.246459 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m15:19:40.247188 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m15:19:40.247705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:40.848019 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m15:19:40.850840 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m15:19:40.931730 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m15:19:40.940469 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m15:19:40.941065 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m15:19:40.941594 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:41.420780 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m15:19:41.423337 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m15:19:41.486306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m15:19:41.491823 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m15:19:41.492448 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m15:19:41.492973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:41.776277 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m15:19:41.778887 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m15:19:41.838750 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:41.839466 [info ] [MainThread]: 
[0m15:19:41.842686 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m15:19:41.843543 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m15:19:41.844614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m15:19:41.845248 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m15:19:41.858957 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m15:19:41.860100 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 15:19:41.845759 => 15:19:41.859710
[0m15:19:41.860755 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m15:19:41.900912 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m15:19:41.903916 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m15:19:41.904639 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m15:19:41.905351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:42.848289 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:42.878966 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 15:19:41.861152 => 15:19:42.878574
[0m15:19:42.879747 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m15:19:42.933063 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 1.09s]
[0m15:19:42.934270 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m15:19:42.935003 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m15:19:42.935833 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m15:19:42.936849 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m15:19:42.937483 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m15:19:42.943425 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m15:19:42.944463 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 15:19:42.937880 => 15:19:42.944101
[0m15:19:42.945108 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m15:19:42.950501 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m15:19:42.952417 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m15:19:42.953079 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m15:19:42.953733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:43.438939 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:43.443103 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 15:19:42.945506 => 15:19:43.442745
[0m15:19:43.443765 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m15:19:43.483776 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.55s]
[0m15:19:43.484936 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m15:19:43.485672 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m15:19:43.486577 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m15:19:43.487776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m15:19:43.488511 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m15:19:43.494323 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m15:19:43.495385 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 15:19:43.488921 => 15:19:43.495007
[0m15:19:43.496038 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m15:19:43.501514 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m15:19:43.503150 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m15:19:43.503815 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m15:19:43.504448 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:43.931398 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:43.935603 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 15:19:43.496432 => 15:19:43.935236
[0m15:19:43.936254 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m15:19:43.981433 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.49s]
[0m15:19:43.982681 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m15:19:43.983415 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m15:19:43.984270 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m15:19:43.985300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m15:19:43.985934 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m15:19:43.991747 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m15:19:43.992782 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 15:19:43.986374 => 15:19:43.992409
[0m15:19:43.993422 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m15:19:44.000633 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m15:19:44.002404 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m15:19:44.003066 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m15:19:44.003714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:44.491169 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:44.495452 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 15:19:43.993821 => 15:19:44.495072
[0m15:19:44.496122 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m15:19:45.108087 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 1.12s]
[0m15:19:45.109416 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m15:19:45.110182 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m15:19:45.110908 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m15:19:45.111921 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m15:19:45.112676 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m15:19:45.118184 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m15:19:45.119239 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 15:19:45.113082 => 15:19:45.118863
[0m15:19:45.119880 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m15:19:45.125436 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m15:19:45.126806 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m15:19:45.127447 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m15:19:45.128060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:45.902482 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:45.906704 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 15:19:45.120280 => 15:19:45.906350
[0m15:19:45.907363 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m15:19:45.967636 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.86s]
[0m15:19:45.968831 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m15:19:45.969566 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m15:19:45.970449 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m15:19:45.971504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m15:19:45.972126 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m15:19:45.977622 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m15:19:45.978662 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 15:19:45.972552 => 15:19:45.978297
[0m15:19:45.979324 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m15:19:45.986264 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m15:19:45.987617 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m15:19:45.988258 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m15:19:45.988873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:47.207548 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:47.211769 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 15:19:45.979715 => 15:19:47.211402
[0m15:19:47.212442 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m15:19:47.259666 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 1.29s]
[0m15:19:47.260853 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m15:19:47.261590 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m15:19:47.262492 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m15:19:47.263533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m15:19:47.264176 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m15:19:47.269972 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m15:19:47.271064 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 15:19:47.264578 => 15:19:47.270697
[0m15:19:47.271704 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m15:19:47.277034 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m15:19:47.278327 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m15:19:47.278965 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m15:19:47.279579 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:47.916899 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:47.921189 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 15:19:47.272112 => 15:19:47.920814
[0m15:19:47.921865 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m15:19:47.999811 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.74s]
[0m15:19:48.001030 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m15:19:48.001808 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m15:19:48.002618 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m15:19:48.003758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m15:19:48.004564 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m15:19:48.012063 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m15:19:48.013181 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 15:19:48.004995 => 15:19:48.012788
[0m15:19:48.013840 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m15:19:48.019484 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m15:19:48.020814 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m15:19:48.021498 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m15:19:48.022161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:50.771912 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m15:19:50.776083 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 15:19:48.014278 => 15:19:50.775726
[0m15:19:50.776735 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m15:19:50.881433 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 2.88s]
[0m15:19:50.882657 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m15:19:50.883406 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m15:19:50.884259 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m15:19:50.885290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m15:19:50.885917 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m15:19:50.891758 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m15:19:50.892806 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 15:19:50.886348 => 15:19:50.892441
[0m15:19:50.893409 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m15:19:50.898851 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m15:19:50.901486 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m15:19:50.902210 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m15:19:50.902922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:51.571175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:51.575359 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 15:19:50.893812 => 15:19:51.575006
[0m15:19:51.575998 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m15:19:51.631483 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.75s]
[0m15:19:51.632663 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m15:19:51.633404 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m15:19:51.634315 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m15:19:51.635535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m15:19:51.636303 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m15:19:51.644058 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 15:19:51.636705 => 15:19:51.643653
[0m15:19:51.644693 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m15:19:51.718044 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:51.718906 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m15:19:51.719556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:52.216224 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m15:19:52.230870 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:52.231604 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:19:52.283983 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:19:52.295810 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:52.296497 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:19:52.358282 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:19:52.407195 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:52.408727 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m15:19:53.343575 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:53.348970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.349615 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:19:53.429567 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:19:53.437229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.437948 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:19:53.507656 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:19:53.515648 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.516420 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:19:53.656192 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:19:53.663956 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.669011 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m15:19:53.722164 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m15:19:53.737290 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.738112 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m15:19:53.809186 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m15:19:53.822635 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m15:19:53.825344 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.826111 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m15:19:53.925869 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:53.926760 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:53.927499 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m15:19:54.286472 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m15:19:54.287392 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m15:19:54.287994 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m15:19:54.475488 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:54.483191 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 15:19:51.645086 => 15:19:54.482821
[0m15:19:54.483999 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m15:19:54.546603 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.91s]
[0m15:19:54.548309 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m15:19:54.549301 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m15:19:54.550411 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m15:19:54.551565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m15:19:54.552222 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m15:19:54.585292 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m15:19:54.586563 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 15:19:54.552667 => 15:19:54.586161
[0m15:19:54.587222 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m15:19:54.634316 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:54.635332 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m15:19:54.636156 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:55.464277 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:55.469933 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.470658 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m15:19:55.531617 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:19:55.538535 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.539195 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m15:19:55.620480 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:19:55.635715 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.636516 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m15:19:55.721968 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:19:55.780412 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.786063 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.786817 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m15:19:55.879716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:55.881259 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:55.882130 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m15:19:56.553854 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m15:19:56.554943 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:56.555619 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m15:19:56.699583 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:56.726625 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m15:19:56.736097 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m15:19:56.736909 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m15:19:56.852016 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:56.856241 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 15:19:54.587639 => 15:19:56.855850
[0m15:19:56.856916 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m15:19:56.912239 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 0[0m in 2.36s]
[0m15:19:56.913442 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m15:19:56.914226 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m15:19:56.915147 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m15:19:56.916433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m15:19:56.917051 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m15:19:56.925183 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m15:19:56.926316 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 15:19:56.917454 => 15:19:56.925912
[0m15:19:56.926923 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m15:19:56.952824 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:56.953771 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m15:19:56.954577 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:57.644227 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:19:57.651191 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:57.651837 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m15:19:57.774621 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m15:19:57.783657 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:57.784509 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m15:19:57.844464 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m15:19:57.854779 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:57.855637 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m15:19:57.895173 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m15:19:57.904391 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m15:19:57.908371 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:57.909001 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m15:19:57.992578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:57.993541 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:57.994518 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m15:19:59.650264 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 2.0 seconds
[0m15:19:59.651191 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:59.651791 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m15:19:59.892808 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:19:59.899089 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m15:19:59.900615 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m15:19:59.901227 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m15:20:00.001475 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:20:00.006247 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 15:19:56.927315 => 15:20:00.005814
[0m15:20:00.007001 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m15:20:00.069688 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 3.15s]
[0m15:20:00.071759 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m15:20:00.072603 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:20:00.073277 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m15:20:00.075217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m15:20:00.076082 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:20:00.108636 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m15:20:00.109981 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 15:20:00.076522 => 15:20:00.109585
[0m15:20:00.110705 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:20:00.143602 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m15:20:00.145324 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m15:20:00.146055 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m15:20:00.146854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:20:00.659161 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:20:00.663334 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 15:20:00.111113 => 15:20:00.662915
[0m15:20:00.664026 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m15:20:00.714844 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.64s]
[0m15:20:00.716055 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:20:00.716813 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:20:00.717742 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m15:20:00.718974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m15:20:00.719635 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:20:00.728216 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m15:20:00.729442 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 15:20:00.720083 => 15:20:00.729049
[0m15:20:00.730180 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:20:00.735612 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m15:20:00.737047 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m15:20:00.737708 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m15:20:00.738378 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:20:01.431573 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:20:01.435467 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 15:20:00.730597 => 15:20:01.434986
[0m15:20:01.436362 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m15:20:01.482260 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.76s]
[0m15:20:01.483464 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:20:01.484218 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:20:01.485717 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m15:20:01.487083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m15:20:01.487733 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:20:01.496955 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m15:20:01.498486 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 15:20:01.488146 => 15:20:01.497974
[0m15:20:01.499163 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:20:01.505082 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m15:20:01.506626 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m15:20:01.507268 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m15:20:01.507885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:20:01.873369 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:20:01.877005 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 15:20:01.499569 => 15:20:01.876528
[0m15:20:01.877793 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m15:20:01.925495 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.44s]
[0m15:20:01.926788 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:20:01.927582 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:20:01.928249 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m15:20:01.929376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m15:20:01.930137 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:20:01.939427 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m15:20:01.941308 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 15:20:01.930646 => 15:20:01.940713
[0m15:20:01.942010 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:20:01.950608 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m15:20:01.953678 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m15:20:01.954568 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m15:20:01.955247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:20:02.242691 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:20:02.246201 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 15:20:01.942564 => 15:20:02.245764
[0m15:20:02.247019 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m15:20:02.295269 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.37s]
[0m15:20:02.296623 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:20:02.298093 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m15:20:02.298881 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m15:20:02.299984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m15:20:02.300611 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m15:20:02.310211 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m15:20:02.311495 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 15:20:02.301333 => 15:20:02.311111
[0m15:20:02.312148 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m15:20:02.322509 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:02.323551 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m15:20:02.324381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:20:02.839364 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:20:02.846638 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:02.847448 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m15:20:02.902909 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:20:03.044900 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:03.045749 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m15:20:03.093847 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:20:03.101721 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:03.102722 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m15:20:03.160572 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m15:20:03.167359 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m15:20:03.170315 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:03.171036 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m15:20:03.262997 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:20:03.263896 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:03.264657 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m15:20:04.060128 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m15:20:04.061110 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:04.061735 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m15:20:05.386157 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:20:05.392295 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m15:20:05.394477 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m15:20:05.395216 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m15:20:05.514774 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:20:05.518822 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 15:20:02.312546 => 15:20:05.518456
[0m15:20:05.519511 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m15:20:05.591547 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 0[0m in 3.29s]
[0m15:20:05.592937 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m15:20:05.595514 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:20:05.596076 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m15:20:05.596739 [info ] [MainThread]: 
[0m15:20:05.597357 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 26.99 seconds (26.99s).
[0m15:20:05.603373 [debug] [MainThread]: Command end result
[0m15:20:05.631265 [info ] [MainThread]: 
[0m15:20:05.632107 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:20:05.632733 [info ] [MainThread]: 
[0m15:20:05.633360 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m15:20:05.634767 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 28.201406, "process_user_time": 8.422623, "process_kernel_time": 0.261647, "process_mem_max_rss": "165520", "process_out_blocks": "4184", "process_in_blocks": "0"}
[0m15:20:05.635674 [debug] [MainThread]: Command `dbt build` succeeded at 15:20:05.635446 after 28.20 seconds
[0m15:20:05.636270 [debug] [MainThread]: Flushing usage events


============================== 15:27:30.025625 | 425e9a9b-47a9-4e88-bb5f-dbfa442ec4f0 ==============================
[0m15:27:30.025625 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:27:30.029556 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m15:27:30.957947 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m15:27:30.989553 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m15:27:31.068001 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:27:31.068739 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:27:31.083182 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m15:27:31.086220 [info ] [MainThread]: 
[0m15:27:31.087331 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:27:31.089527 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds_intermediate'
[0m15:27:31.112405 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m15:27:31.113266 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m15:27:31.113881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:27:32.041920 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m15:27:32.044529 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m15:27:32.096631 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m15:27:32.102282 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m15:27:32.102841 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m15:27:32.103362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:27:32.611154 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m15:27:32.613967 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m15:27:32.707557 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m15:27:32.715070 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m15:27:32.715629 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m15:27:32.716142 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:27:33.015677 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m15:27:33.018238 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m15:27:33.081590 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:27:33.082500 [info ] [MainThread]: 
[0m15:27:33.085574 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m15:27:33.086591 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m15:27:33.087211 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m15:27:33.102712 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m15:27:33.103800 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 15:27:33.087603 => 15:27:33.103425
[0m15:27:33.104441 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m15:27:33.105207 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 15:27:33.104842 => 15:27:33.104864
[0m15:27:33.106625 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m15:27:33.107325 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m15:27:33.108412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m15:27:33.109038 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m15:27:33.113988 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m15:27:33.114974 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 15:27:33.109437 => 15:27:33.114618
[0m15:27:33.115607 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m15:27:33.116350 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 15:27:33.115999 => 15:27:33.116013
[0m15:27:33.117720 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m15:27:33.118441 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m15:27:33.119744 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m15:27:33.120443 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m15:27:33.125915 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m15:27:33.126957 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 15:27:33.121010 => 15:27:33.126585
[0m15:27:33.127615 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m15:27:33.128380 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 15:27:33.128018 => 15:27:33.128033
[0m15:27:33.129765 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m15:27:33.130551 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m15:27:33.131745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m15:27:33.132384 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m15:27:33.137216 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m15:27:33.138235 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 15:27:33.132793 => 15:27:33.137832
[0m15:27:33.138882 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m15:27:33.139655 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 15:27:33.139291 => 15:27:33.139305
[0m15:27:33.141017 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m15:27:33.141735 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m15:27:33.142950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m15:27:33.143590 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m15:27:33.148352 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m15:27:33.149314 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 15:27:33.143987 => 15:27:33.148945
[0m15:27:33.149965 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m15:27:33.150771 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 15:27:33.150407 => 15:27:33.150420
[0m15:27:33.152116 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m15:27:33.152830 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m15:27:33.153985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m15:27:33.154654 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m15:27:33.161098 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m15:27:33.162122 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 15:27:33.155068 => 15:27:33.161714
[0m15:27:33.162766 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m15:27:33.163546 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 15:27:33.163181 => 15:27:33.163194
[0m15:27:33.164903 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m15:27:33.165606 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m15:27:33.166730 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m15:27:33.167368 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m15:27:33.171989 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m15:27:33.172950 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 15:27:33.167764 => 15:27:33.172579
[0m15:27:33.173588 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m15:27:33.174419 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 15:27:33.173996 => 15:27:33.174008
[0m15:27:33.175765 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m15:27:33.176476 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m15:27:33.177542 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m15:27:33.178210 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m15:27:33.183028 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m15:27:33.184001 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 15:27:33.178617 => 15:27:33.183631
[0m15:27:33.184654 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m15:27:33.185439 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 15:27:33.185072 => 15:27:33.185085
[0m15:27:33.186833 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m15:27:33.187545 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m15:27:33.188654 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m15:27:33.189298 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m15:27:33.193906 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m15:27:33.194901 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 15:27:33.189697 => 15:27:33.194528
[0m15:27:33.195548 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m15:27:33.196308 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 15:27:33.195948 => 15:27:33.195960
[0m15:27:33.197659 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m15:27:33.198402 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m15:27:33.199742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m15:27:33.200442 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m15:27:33.209402 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 15:27:33.200855 => 15:27:33.208977
[0m15:27:33.210112 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m15:27:33.210926 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 15:27:33.210531 => 15:27:33.210549
[0m15:27:33.212339 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m15:27:33.213066 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m15:27:33.214061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m15:27:33.214700 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m15:27:33.259434 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m15:27:33.260743 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 15:27:33.215099 => 15:27:33.260331
[0m15:27:33.261421 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m15:27:33.262285 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 15:27:33.261852 => 15:27:33.261872
[0m15:27:33.263760 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m15:27:33.264510 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m15:27:33.265883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m15:27:33.266566 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m15:27:33.273914 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m15:27:33.274984 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 15:27:33.266976 => 15:27:33.274603
[0m15:27:33.275651 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m15:27:33.276429 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 15:27:33.276060 => 15:27:33.276074
[0m15:27:33.277832 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m15:27:33.278598 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m15:27:33.279756 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now model.capstone.weekly_sales_inventory)
[0m15:27:33.280409 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m15:27:33.288376 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m15:27:33.289387 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 15:27:33.280821 => 15:27:33.289010
[0m15:27:33.290080 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m15:27:33.290873 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 15:27:33.290507 => 15:27:33.290521
[0m15:27:33.292247 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m15:27:33.292972 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:27:33.294099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.weekly_sales_inventory, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m15:27:33.294737 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:27:33.314044 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m15:27:33.315165 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 15:27:33.295141 => 15:27:33.314771
[0m15:27:33.315839 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:27:33.316647 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 15:27:33.316262 => 15:27:33.316280
[0m15:27:33.318082 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m15:27:33.318825 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:27:33.319941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m15:27:33.320600 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:27:33.327568 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m15:27:33.328580 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 15:27:33.321004 => 15:27:33.328188
[0m15:27:33.329236 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:27:33.330074 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 15:27:33.329658 => 15:27:33.329672
[0m15:27:33.331460 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m15:27:33.332176 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:27:33.333307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m15:27:33.333961 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:27:33.340780 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m15:27:33.341783 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 15:27:33.334403 => 15:27:33.341398
[0m15:27:33.342462 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:27:33.343237 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 15:27:33.342859 => 15:27:33.342873
[0m15:27:33.344613 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m15:27:33.345344 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:27:33.346491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m15:27:33.347147 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:27:33.353963 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m15:27:33.354998 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 15:27:33.347554 => 15:27:33.354619
[0m15:27:33.355671 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:27:33.356461 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 15:27:33.356083 => 15:27:33.356098
[0m15:27:33.357873 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m15:27:33.359486 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:27:33.360060 [debug] [MainThread]: Connection 'test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7' was properly closed.
[0m15:27:33.364429 [debug] [MainThread]: Command end result
[0m15:27:33.404515 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m15:27:33.405184 [info ] [MainThread]: Building catalog
[0m15:27:33.410327 [debug] [ThreadPool]: Acquiring new snowflake connection 'tpcds.information_schema'
[0m15:27:33.434884 [debug] [ThreadPool]: Using snowflake connection "tpcds.information_schema"
[0m15:27:33.436173 [debug] [ThreadPool]: On tpcds.information_schema: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "tpcds.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        coalesce(table_type, 'DYNAMIC TABLE') as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from tpcds.INFORMATION_SCHEMA.tables
            where (
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('weekly_sales_inventory')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__income_band')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('income_band')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('customer_snapshot')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('int__daily_aggregated_sales')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('customer_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__web_sales')
                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from tpcds.INFORMATION_SCHEMA.columns
            where (
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('weekly_sales_inventory')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__income_band')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('income_band')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('customer_snapshot')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_address')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__household_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('catalog_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('inventory')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('web_sales')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__date_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__customer_demographics')
                )
             or 
                (
                    upper("table_schema") = upper('intermediate')
                    and upper("table_name") = upper('int__daily_aggregated_sales')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('customer_dim')
                )
             or 
                (
                    upper("table_schema") = upper('staging')
                    and upper("table_name") = upper('stg_tpcds__web_sales')
                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m15:27:33.437284 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:27:37.305545 [debug] [ThreadPool]: SQL status: SUCCESS 387 in 4.0 seconds
[0m15:27:37.773796 [debug] [ThreadPool]: On tpcds.information_schema: Close
[0m15:27:37.922755 [info ] [MainThread]: Catalog written to /home/ubuntu/capstone_dbt_project/capstone/target/catalog.json
[0m15:27:37.924648 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 7.970855, "process_user_time": 5.316147, "process_kernel_time": 0.27502, "process_mem_max_rss": "165880", "process_in_blocks": "2944", "process_out_blocks": "7816"}
[0m15:27:37.925644 [debug] [MainThread]: Command `dbt docs generate` succeeded at 15:27:37.925424 after 7.97 seconds
[0m15:27:37.926232 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:27:37.926742 [debug] [MainThread]: Connection 'tpcds.information_schema' was properly closed.
[0m15:27:37.927263 [debug] [MainThread]: Flushing usage events


============================== 15:28:18.306408 | a671d394-d696-4188-8c4d-a33fa73b743a ==============================
[0m15:28:18.306408 [info ] [MainThread]: Running with dbt=1.7.3
[0m15:28:18.310060 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs serve --port 8000', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m19:14:51.110300 [error] [MainThread]: Encountered an error:

[0m19:14:51.116610 [error] [MainThread]: Traceback (most recent call last):
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/requires.py", line 90, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/requires.py", line 75, in wrapper
    return func(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/requires.py", line 168, in wrapper
    return func(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/requires.py", line 197, in wrapper
    return func(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/requires.py", line 244, in wrapper
    return func(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/cli/main.py", line 324, in docs_serve
    results = task.run()
  File "/home/ubuntu/.local/lib/python3.10/site-packages/dbt/task/serve.py", line 28, in run
    httpd.serve_forever()
  File "/usr/lib/python3.10/socketserver.py", line 232, in serve_forever
    ready = selector.select(poll_interval)
  File "/usr/lib/python3.10/selectors.py", line 416, in select
    fd_event_list = self._selector.poll(timeout)
KeyboardInterrupt

[0m19:14:51.118428 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 13592.879, "process_user_time": 5.809175, "process_kernel_time": 0.329036, "process_mem_max_rss": "145172", "process_in_blocks": "224", "process_out_blocks": "2968", "command_success": false}
[0m19:14:51.119461 [debug] [MainThread]: Command `dbt docs serve` failed at 19:14:51.119242 after 13592.88 seconds
[0m19:14:51.120035 [debug] [MainThread]: Flushing usage events


============================== 19:24:52.821368 | ac8fc3a4-8516-4c51-a9ba-c0cad49fbde4 ==============================
[0m19:24:52.821368 [info ] [MainThread]: Running with dbt=1.7.3
[0m19:24:52.825089 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m19:24:53.785868 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m19:24:53.817539 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m19:24:53.897159 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:53.897904 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:53.933336 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m19:24:53.936473 [info ] [MainThread]: 
[0m19:24:53.937660 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:24:53.940173 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m19:24:53.961509 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:24:53.962303 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:24:53.962867 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:56.516235 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 3.0 seconds
[0m19:24:56.518908 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:24:56.605148 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:24:56.605994 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:24:56.606550 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:56.933760 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:24:56.936244 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:24:56.995841 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m19:24:56.996676 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m19:24:56.997201 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:57.334396 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m19:24:57.336866 [debug] [ThreadPool]: On list_tpcds: Close
[0m19:24:57.387137 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_intermediate)
[0m19:24:57.400382 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m19:24:57.401032 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m19:24:57.401584 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:57.782984 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m19:24:57.785515 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m19:24:57.826956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m19:24:57.833606 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m19:24:57.834331 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m19:24:57.834855 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:58.158617 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m19:24:58.161354 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m19:24:58.211109 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m19:24:58.218549 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m19:24:58.219104 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m19:24:58.219649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:58.628738 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m19:24:58.631405 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m19:24:58.673383 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:24:58.674171 [info ] [MainThread]: 
[0m19:24:58.677413 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m19:24:58.678265 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m19:24:58.679369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m19:24:58.680021 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m19:24:58.693827 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:24:58.695130 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 19:24:58.680434 => 19:24:58.694731
[0m19:24:58.695833 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m19:24:58.737702 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m19:24:58.740783 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m19:24:58.741532 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m19:24:58.742267 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:59.219222 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:24:59.249955 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 19:24:58.696247 => 19:24:59.249565
[0m19:24:59.250750 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m19:24:59.300186 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.62s]
[0m19:24:59.301390 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m19:24:59.302155 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m19:24:59.303031 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m19:24:59.304064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m19:24:59.304689 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m19:24:59.310211 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m19:24:59.311260 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 19:24:59.305081 => 19:24:59.310895
[0m19:24:59.311901 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m19:24:59.317470 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m19:24:59.319575 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m19:24:59.320233 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m19:24:59.320883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:59.839441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:24:59.843799 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 19:24:59.312289 => 19:24:59.843407
[0m19:24:59.844495 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m19:24:59.899648 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.60s]
[0m19:24:59.900861 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m19:24:59.901591 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m19:24:59.902577 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m19:24:59.903887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m19:24:59.904522 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m19:24:59.911689 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m19:24:59.912827 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 19:24:59.904913 => 19:24:59.912448
[0m19:24:59.913484 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m19:24:59.919189 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m19:24:59.920925 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m19:24:59.921574 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m19:24:59.922242 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:00.366758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:00.371106 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 19:24:59.913884 => 19:25:00.370720
[0m19:25:00.371858 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m19:25:00.419810 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.52s]
[0m19:25:00.421021 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m19:25:00.421767 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m19:25:00.422730 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m19:25:00.423836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m19:25:00.424467 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m19:25:00.430158 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:25:00.431286 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 19:25:00.424860 => 19:25:00.430901
[0m19:25:00.431946 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m19:25:00.438009 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m19:25:00.439854 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m19:25:00.440525 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m19:25:00.441158 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:00.822176 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:00.826444 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 19:25:00.432347 => 19:25:00.826070
[0m19:25:00.827157 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m19:25:00.883686 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.46s]
[0m19:25:00.884892 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m19:25:00.885619 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m19:25:00.886520 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m19:25:00.887559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m19:25:00.888206 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m19:25:00.893811 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m19:25:00.894989 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 19:25:00.888594 => 19:25:00.894607
[0m19:25:00.895632 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m19:25:00.901257 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m19:25:00.902614 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m19:25:00.903252 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m19:25:00.903872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:01.320665 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:01.324950 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 19:25:00.896029 => 19:25:01.324587
[0m19:25:01.325637 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m19:25:01.371215 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.48s]
[0m19:25:01.372423 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m19:25:01.373152 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m19:25:01.373896 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m19:25:01.375304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m19:25:01.375971 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m19:25:01.381722 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m19:25:01.382892 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 19:25:01.376381 => 19:25:01.382510
[0m19:25:01.383543 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m19:25:01.391299 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m19:25:01.392955 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m19:25:01.393624 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m19:25:01.394266 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:01.836271 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:01.840605 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 19:25:01.383934 => 19:25:01.840232
[0m19:25:01.841322 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m19:25:01.892406 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.52s]
[0m19:25:01.893657 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m19:25:01.894450 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m19:25:01.895370 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m19:25:01.896479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m19:25:01.897112 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m19:25:01.902976 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m19:25:01.904137 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 19:25:01.897521 => 19:25:01.903739
[0m19:25:01.904802 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m19:25:01.911103 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m19:25:01.912780 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m19:25:01.913466 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m19:25:01.914121 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:02.384940 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:02.389441 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 19:25:01.905198 => 19:25:02.389044
[0m19:25:02.390221 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m19:25:02.447356 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.55s]
[0m19:25:02.448652 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m19:25:02.449456 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m19:25:02.450449 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m19:25:02.451729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m19:25:02.452397 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m19:25:02.460272 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m19:25:02.461751 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 19:25:02.452812 => 19:25:02.461259
[0m19:25:02.463766 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m19:25:02.470835 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m19:25:02.472535 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m19:25:02.473240 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m19:25:02.473882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:02.857034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:02.861319 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 19:25:02.464210 => 19:25:02.860940
[0m19:25:02.862011 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m19:25:02.909345 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.46s]
[0m19:25:02.910787 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m19:25:02.911632 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m19:25:02.912579 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m19:25:02.913767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m19:25:02.914468 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m19:25:02.920582 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m19:25:02.921741 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 19:25:02.914883 => 19:25:02.921353
[0m19:25:02.922467 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m19:25:02.928665 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m19:25:02.931601 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m19:25:02.932364 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m19:25:02.933073 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:03.502249 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:25:03.506518 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 19:25:02.922879 => 19:25:03.506151
[0m19:25:03.507221 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m19:25:03.558664 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.64s]
[0m19:25:03.559916 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m19:25:03.560659 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m19:25:03.561525 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m19:25:03.562868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m19:25:03.563503 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m19:25:03.571207 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 19:25:03.563896 => 19:25:03.570729
[0m19:25:03.571939 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m19:25:03.649116 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:03.650052 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:25:03.650730 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:04.650466 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:25:04.666216 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:04.667070 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:25:04.720010 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:25:04.733188 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:04.734112 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:25:04.767110 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:25:04.817996 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:04.819703 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m19:25:07.753172 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m19:25:07.759849 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:07.760551 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:25:07.809636 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:25:07.817612 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:07.818410 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:25:07.864186 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:25:07.872004 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:07.872810 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:25:07.952178 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:25:07.959990 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:07.960754 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m19:25:08.142271 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m19:25:08.154585 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:08.157264 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m19:25:08.245059 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m19:25:08.258271 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m19:25:08.260512 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:08.261159 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m19:25:08.339136 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:08.340014 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:08.340700 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:25:08.867853 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:25:08.868791 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m19:25:08.869393 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m19:25:09.087985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:09.095847 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 19:25:03.572331 => 19:25:09.095444
[0m19:25:09.096629 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m19:25:09.147589 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 5.58s]
[0m19:25:09.148841 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m19:25:09.149595 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m19:25:09.150689 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m19:25:09.151959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m19:25:09.152587 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m19:25:09.185585 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m19:25:09.186939 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 19:25:09.152994 => 19:25:09.186547
[0m19:25:09.187615 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m19:25:09.236354 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:09.237378 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m19:25:09.238248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:10.845736 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m19:25:10.852705 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:10.853399 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m19:25:10.920678 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:10.927969 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:10.928704 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m19:25:10.981087 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:10.994562 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:10.995398 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m19:25:11.052727 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:11.095333 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m19:25:11.098160 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:11.098824 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m19:25:11.181449 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:11.182412 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:11.183158 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m19:25:15.696509 [debug] [Thread-1 (]: SQL status: SUCCESS 2218 in 5.0 seconds
[0m19:25:15.697546 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:15.698242 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m19:25:16.004937 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:16.019266 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m19:25:16.027994 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m19:25:16.028766 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m19:25:16.104278 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:16.108369 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 19:25:09.188017 => 19:25:16.107975
[0m19:25:16.109066 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m19:25:16.303547 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2218[0m in 7.15s]
[0m19:25:16.304791 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m19:25:16.305579 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m19:25:16.306836 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m19:25:16.308216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m19:25:16.308868 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m19:25:16.319237 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m19:25:16.320522 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 19:25:16.309280 => 19:25:16.320123
[0m19:25:16.321157 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m19:25:16.330627 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:16.331564 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m19:25:16.332315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:17.240435 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:25:17.245936 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:17.246630 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m19:25:17.324560 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m19:25:17.334763 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:17.335526 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m19:25:17.389586 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m19:25:17.398877 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:17.399691 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m19:25:17.442601 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m19:25:17.451608 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m19:25:17.455681 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:17.456355 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m19:25:17.592311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:17.593201 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:17.594062 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m19:25:21.572847 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m19:25:21.573843 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:21.574502 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m19:25:21.795101 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:21.801448 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m19:25:21.803007 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m19:25:21.803619 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m19:25:21.884985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:21.889105 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 19:25:16.321565 => 19:25:21.888733
[0m19:25:21.889801 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m19:25:21.949982 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 5.64s]
[0m19:25:21.951224 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m19:25:21.952017 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m19:25:21.952701 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m19:25:21.953930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m19:25:21.954603 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m19:25:21.973044 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m19:25:21.974358 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 19:25:21.955009 => 19:25:21.973933
[0m19:25:21.975022 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m19:25:22.000810 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m19:25:22.002518 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m19:25:22.003211 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m19:25:22.003838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:22.608799 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:25:22.613200 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 19:25:21.975427 => 19:25:22.612751
[0m19:25:22.613925 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m19:25:22.687471 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 0.73s]
[0m19:25:22.688676 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m19:25:22.689427 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m19:25:22.690224 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m19:25:22.691312 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m19:25:22.691951 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m19:25:22.699521 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m19:25:22.700646 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 19:25:22.692351 => 19:25:22.700272
[0m19:25:22.701267 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m19:25:22.706116 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m19:25:22.707363 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m19:25:22.708010 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m19:25:22.708624 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:23.083724 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:23.087094 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 19:25:22.701660 => 19:25:23.086681
[0m19:25:23.087833 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m19:25:23.165634 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 0.47s]
[0m19:25:23.166856 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m19:25:23.167615 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m19:25:23.168427 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m19:25:23.169498 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m19:25:23.170160 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m19:25:23.178989 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m19:25:23.180080 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 19:25:23.170569 => 19:25:23.179707
[0m19:25:23.180725 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m19:25:23.185557 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m19:25:23.186898 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m19:25:23.187540 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m19:25:23.188164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:23.614268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:23.617703 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 19:25:23.181125 => 19:25:23.617294
[0m19:25:23.618424 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m19:25:23.678272 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.51s]
[0m19:25:23.679505 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m19:25:23.680275 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m19:25:23.681103 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m19:25:23.682212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m19:25:23.682867 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m19:25:23.690519 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m19:25:23.691712 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 19:25:23.683273 => 19:25:23.691318
[0m19:25:23.692383 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m19:25:23.697699 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m19:25:23.699051 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m19:25:23.699716 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m19:25:23.700348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:24.356834 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:25:24.360262 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 19:25:23.692803 => 19:25:24.359857
[0m19:25:24.360958 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m19:25:24.423899 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.74s]
[0m19:25:24.425117 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m19:25:24.426654 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m19:25:24.427514 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m19:25:24.428623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m19:25:24.429265 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m19:25:24.565779 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m19:25:24.567064 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 19:25:24.429676 => 19:25:24.566689
[0m19:25:24.567683 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m19:25:24.576640 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:24.577456 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m19:25:24.578288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:25.225961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:25:25.231459 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:25.232099 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m19:25:25.300175 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:25.308171 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:25.308896 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m19:25:25.361441 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:25.368522 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:25.369198 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m19:25:25.448866 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:25:25.455058 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m19:25:25.457568 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:25.458245 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m19:25:25.563033 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:25.563885 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:25.564595 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m19:25:29.597899 [debug] [Thread-1 (]: SQL status: SUCCESS 34 in 4.0 seconds
[0m19:25:29.598879 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:29.599502 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m19:25:29.898699 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:29.904828 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m19:25:29.906411 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m19:25:29.907044 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m19:25:29.985784 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:25:29.989708 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 19:25:24.568072 => 19:25:29.989345
[0m19:25:29.990401 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m19:25:30.067357 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 34[0m in 5.64s]
[0m19:25:30.068579 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m19:25:30.071175 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:25:30.071740 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m19:25:30.072453 [info ] [MainThread]: 
[0m19:25:30.073069 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 36.14 seconds (36.14s).
[0m19:25:30.077751 [debug] [MainThread]: Command end result
[0m19:25:30.100968 [info ] [MainThread]: 
[0m19:25:30.101762 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:25:30.102399 [info ] [MainThread]: 
[0m19:25:30.102993 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m19:25:30.104319 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 37.351135, "process_user_time": 8.471283, "process_kernel_time": 0.293045, "process_mem_max_rss": "165768", "process_out_blocks": "5088", "process_in_blocks": "0"}
[0m19:25:30.105181 [debug] [MainThread]: Command `dbt build` succeeded at 19:25:30.104965 after 37.35 seconds
[0m19:25:30.105757 [debug] [MainThread]: Flushing usage events


============================== 22:00:05.011790 | da9c31c2-fed1-4c50-8f0d-92ecc9d2f277 ==============================
[0m22:00:05.011790 [info ] [MainThread]: Running with dbt=1.7.3
[0m22:00:05.015748 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m22:00:06.002380 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m22:00:06.037303 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m22:00:06.118370 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:00:06.119063 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:00:06.156750 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m22:00:06.160122 [info ] [MainThread]: 
[0m22:00:06.161441 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:00:06.164313 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m22:00:06.185985 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m22:00:06.186891 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m22:00:06.187433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:00:08.275612 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 2.0 seconds
[0m22:00:08.278096 [debug] [ThreadPool]: On list_tpcds: Close
[0m22:00:08.537847 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m22:00:08.538724 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m22:00:08.539213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:09.269962 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m22:00:09.272407 [debug] [ThreadPool]: On list_tpcds: Close
[0m22:00:09.700887 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m22:00:09.701692 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m22:00:09.702182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:10.836088 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m22:00:10.838443 [debug] [ThreadPool]: On list_tpcds: Close
[0m22:00:10.974491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m22:00:10.987608 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m22:00:10.988238 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m22:00:10.988670 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:11.902575 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m22:00:11.905031 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m22:00:12.055550 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m22:00:12.062483 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m22:00:12.063047 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m22:00:12.063503 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:13.032408 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m22:00:13.034892 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m22:00:13.196457 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_staging)
[0m22:00:13.201867 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m22:00:13.202450 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m22:00:13.202893 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:00:14.808862 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 2.0 seconds
[0m22:00:14.811611 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m22:00:15.105684 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:00:15.106377 [info ] [MainThread]: 
[0m22:00:15.109888 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m22:00:15.110842 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m22:00:15.112012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_staging, now model.capstone.stg_tpcds__catalog_sales)
[0m22:00:15.112564 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m22:00:15.126764 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m22:00:15.128001 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 22:00:15.112924 => 22:00:15.127621
[0m22:00:15.128559 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m22:00:15.173511 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m22:00:15.176614 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m22:00:15.177347 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m22:00:15.177969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:17.633653 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m22:00:17.667871 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 22:00:15.128897 => 22:00:17.667490
[0m22:00:17.668638 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m22:00:17.824749 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 2.71s]
[0m22:00:17.826071 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m22:00:17.826755 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m22:00:17.827466 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m22:00:17.828690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m22:00:17.829250 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m22:00:17.835297 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m22:00:17.836432 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 22:00:17.829590 => 22:00:17.836080
[0m22:00:17.836968 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m22:00:17.843062 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m22:00:17.845131 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m22:00:17.845710 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m22:00:17.846312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:22.282374 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m22:00:22.286587 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 22:00:17.837305 => 22:00:22.286234
[0m22:00:22.287203 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m22:00:22.404572 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 4.58s]
[0m22:00:22.405693 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m22:00:22.406398 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m22:00:22.407209 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m22:00:22.408600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m22:00:22.409182 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m22:00:22.414885 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m22:00:22.415958 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 22:00:22.409527 => 22:00:22.415606
[0m22:00:22.416504 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m22:00:22.422569 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m22:00:22.424346 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m22:00:22.424939 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m22:00:22.425497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:23.053479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:23.057663 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 22:00:22.416856 => 22:00:23.057324
[0m22:00:23.058261 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m22:00:23.231490 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.82s]
[0m22:00:23.232591 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m22:00:23.233237 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m22:00:23.234044 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m22:00:23.235021 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m22:00:23.235568 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m22:00:23.241055 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m22:00:23.242109 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 22:00:23.235905 => 22:00:23.241729
[0m22:00:23.242647 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m22:00:23.250154 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m22:00:23.251735 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m22:00:23.252299 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m22:00:23.252833 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:24.979989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m22:00:24.984190 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 22:00:23.242989 => 22:00:24.983846
[0m22:00:24.984777 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m22:00:25.052913 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 1.82s]
[0m22:00:25.054290 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m22:00:25.054958 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m22:00:25.055734 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m22:00:25.056734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m22:00:25.057271 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m22:00:25.063077 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m22:00:25.064422 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 22:00:25.057609 => 22:00:25.064014
[0m22:00:25.065003 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m22:00:25.071494 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m22:00:25.073052 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m22:00:25.073604 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m22:00:25.074159 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:26.130676 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:26.134801 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 22:00:25.065351 => 22:00:26.134475
[0m22:00:26.135362 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m22:00:26.188621 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 1.13s]
[0m22:00:26.189743 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m22:00:26.190433 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m22:00:26.191289 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m22:00:26.192292 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m22:00:26.192850 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m22:00:26.198335 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m22:00:26.199336 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 22:00:26.193190 => 22:00:26.198996
[0m22:00:26.199868 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m22:00:26.207214 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m22:00:26.208732 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m22:00:26.209304 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m22:00:26.209841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:27.268617 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:27.272800 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 22:00:26.200210 => 22:00:27.272467
[0m22:00:27.273366 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m22:00:27.355888 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 1.16s]
[0m22:00:27.356986 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m22:00:27.357628 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m22:00:27.358434 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m22:00:27.359592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m22:00:27.360154 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m22:00:27.365593 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m22:00:27.366608 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 22:00:27.360501 => 22:00:27.366269
[0m22:00:27.367140 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m22:00:27.372586 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m22:00:27.373806 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m22:00:27.374380 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m22:00:27.374921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:28.427003 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:28.431190 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 22:00:27.367471 => 22:00:28.430847
[0m22:00:28.431799 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m22:00:28.549610 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 1.19s]
[0m22:00:28.550822 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m22:00:28.551524 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m22:00:28.552464 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m22:00:28.553563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m22:00:28.554158 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m22:00:28.561772 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m22:00:28.562960 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 22:00:28.554513 => 22:00:28.562584
[0m22:00:28.563552 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m22:00:28.569623 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m22:00:28.571100 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m22:00:28.571664 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m22:00:28.572208 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:29.465772 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:29.469925 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 22:00:28.563902 => 22:00:29.469582
[0m22:00:29.470556 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m22:00:29.526505 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.97s]
[0m22:00:29.527612 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m22:00:29.528265 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m22:00:29.529026 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m22:00:29.530050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m22:00:29.530597 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m22:00:29.536262 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m22:00:29.537287 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 22:00:29.530934 => 22:00:29.536938
[0m22:00:29.537851 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m22:00:29.544290 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m22:00:29.547072 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m22:00:29.547695 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m22:00:29.548314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:30.779194 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:30.783360 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 22:00:29.538224 => 22:00:30.783020
[0m22:00:30.783972 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m22:00:30.910862 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 1.38s]
[0m22:00:30.911991 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m22:00:30.912666 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m22:00:30.913627 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m22:00:30.914658 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m22:00:30.915193 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m22:00:30.922616 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 22:00:30.915535 => 22:00:30.922224
[0m22:00:30.923196 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m22:00:31.000595 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:31.001429 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m22:00:31.001991 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:32.568285 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 2.0 seconds
[0m22:00:32.583796 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:32.584562 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m22:00:32.655708 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m22:00:32.668256 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:32.668972 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m22:00:32.838073 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m22:00:32.888173 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:32.889660 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m22:00:38.918272 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 6.0 seconds
[0m22:00:38.923686 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:38.924340 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m22:00:39.174403 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m22:00:39.181906 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.182502 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m22:00:39.221184 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m22:00:39.228702 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.229281 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m22:00:39.300614 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m22:00:39.308134 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.308715 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m22:00:39.353972 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m22:00:39.368075 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.368732 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m22:00:39.419390 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m22:00:39.432883 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m22:00:39.435075 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.435615 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m22:00:39.519036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:39.519831 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:39.520449 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m22:00:40.844469 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m22:00:40.845370 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m22:00:40.845893 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m22:00:41.024512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:41.032210 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 22:00:30.923540 => 22:00:41.031849
[0m22:00:41.032894 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m22:00:41.083645 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 10.17s]
[0m22:00:41.084785 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m22:00:41.085462 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m22:00:41.086156 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m22:00:41.087564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m22:00:41.088309 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m22:00:41.121001 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m22:00:41.122267 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 22:00:41.088674 => 22:00:41.121850
[0m22:00:41.122843 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m22:00:41.170467 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:41.171385 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m22:00:41.172116 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:42.248997 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:42.254759 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.255468 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m22:00:42.311068 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:00:42.318078 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.318705 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m22:00:42.394667 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:00:42.407814 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.408498 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m22:00:42.460821 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:00:42.502525 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.505206 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.505749 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m22:00:42.635741 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:42.636529 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:42.637143 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m22:00:47.139732 [debug] [Thread-1 (]: SQL status: SUCCESS 2218 in 5.0 seconds
[0m22:00:47.140615 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:47.141152 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
COMMIT
[0m22:00:48.221323 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:48.236876 [debug] [Thread-1 (]: Applying DROP to: tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m22:00:48.245613 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m22:00:48.246225 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
drop view if exists tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp cascade
[0m22:00:48.422660 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:48.426745 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 22:00:41.123179 => 22:00:48.426385
[0m22:00:48.427403 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m22:00:48.481382 [info ] [Thread-1 (]: 11 of 17 OK created sql incremental model intermediate.int__daily_aggregated_sales  [[32mSUCCESS 2218[0m in 7.39s]
[0m22:00:48.482578 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m22:00:48.483254 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m22:00:48.484053 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m22:00:48.485382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m22:00:48.485970 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m22:00:48.493804 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m22:00:48.494951 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 22:00:48.486358 => 22:00:48.494586
[0m22:00:48.495532 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m22:00:48.504664 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:48.505477 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m22:00:48.506185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:51.384817 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m22:00:51.391923 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:51.392608 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m22:00:51.475029 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m22:00:51.483778 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:51.484399 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m22:00:51.612464 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m22:00:51.621253 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:51.621834 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m22:00:51.673852 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m22:00:51.682822 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m22:00:51.686701 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:51.687224 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m22:00:51.767524 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:51.768281 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:51.769013 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m22:00:55.351364 [debug] [Thread-1 (]: SQL status: SUCCESS 100000 in 4.0 seconds
[0m22:00:55.352239 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:55.352759 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
COMMIT
[0m22:00:55.916973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:55.923205 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.customer_dim__dbt_tmp
[0m22:00:55.924702 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m22:00:55.925232 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
drop view if exists tpcds.analytics.customer_dim__dbt_tmp cascade
[0m22:00:56.078294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:00:56.082358 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 22:00:48.495896 => 22:00:56.081972
[0m22:00:56.082943 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m22:00:56.155005 [info ] [Thread-1 (]: 12 of 17 OK created sql incremental model analytics.customer_dim ............... [[32mSUCCESS 100000[0m in 7.67s]
[0m22:00:56.156099 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m22:00:56.156782 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m22:00:56.157474 [info ] [Thread-1 (]: 13 of 17 START test not_null_int__daily_aggregated_sales_item_sk ............... [RUN]
[0m22:00:56.158585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.customer_dim, now test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619)
[0m22:00:56.159126 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m22:00:56.179631 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m22:00:56.180834 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (compile): 22:00:56.159475 => 22:00:56.180484
[0m22:00:56.181377 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m22:00:56.205599 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m22:00:56.207102 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"
[0m22:00:56.207650 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select item_sk
from tpcds.intermediate.int__daily_aggregated_sales
where item_sk is null



      
    ) dbt_internal_test
[0m22:00:56.208173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:57.344464 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:57.348718 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619 (execute): 22:00:56.181719 => 22:00:57.348341
[0m22:00:57.349293 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619: Close
[0m22:00:57.445557 [info ] [Thread-1 (]: 13 of 17 PASS not_null_int__daily_aggregated_sales_item_sk ..................... [[32mPASS[0m in 1.29s]
[0m22:00:57.446716 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m22:00:57.447415 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m22:00:57.448125 [info ] [Thread-1 (]: 14 of 17 START test not_null_int__daily_aggregated_sales_warehouse_sk .......... [RUN]
[0m22:00:57.449099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619, now test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411)
[0m22:00:57.449647 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m22:00:57.457091 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m22:00:57.458133 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (compile): 22:00:57.450008 => 22:00:57.457745
[0m22:00:57.458684 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m22:00:57.463481 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m22:00:57.464676 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"
[0m22:00:57.465229 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select warehouse_sk
from tpcds.intermediate.int__daily_aggregated_sales
where warehouse_sk is null



      
    ) dbt_internal_test
[0m22:00:57.465768 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:58.477153 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:58.480647 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411 (execute): 22:00:57.459028 => 22:00:58.480263
[0m22:00:58.481253 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411: Close
[0m22:00:58.606854 [info ] [Thread-1 (]: 14 of 17 PASS not_null_int__daily_aggregated_sales_warehouse_sk ................ [[32mPASS[0m in 1.16s]
[0m22:00:58.607941 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m22:00:58.608613 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m22:00:58.609284 [info ] [Thread-1 (]: 15 of 17 START test not_null_int__daily_aggregated_sales_wk_num ................ [RUN]
[0m22:00:58.610268 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411, now test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec)
[0m22:00:58.610795 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m22:00:58.618294 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m22:00:58.619359 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (compile): 22:00:58.611135 => 22:00:58.619019
[0m22:00:58.619885 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m22:00:58.624936 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m22:00:58.626198 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"
[0m22:00:58.626749 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select wk_num
from tpcds.intermediate.int__daily_aggregated_sales
where wk_num is null



      
    ) dbt_internal_test
[0m22:00:58.627277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:59.195771 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:59.199054 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec (execute): 22:00:58.620223 => 22:00:59.198690
[0m22:00:59.199638 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec: Close
[0m22:00:59.256056 [info ] [Thread-1 (]: 15 of 17 PASS not_null_int__daily_aggregated_sales_wk_num ...................... [[32mPASS[0m in 0.65s]
[0m22:00:59.257179 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m22:00:59.257865 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m22:00:59.258803 [info ] [Thread-1 (]: 16 of 17 START test not_null_int__daily_aggregated_sales_yr_num ................ [RUN]
[0m22:00:59.259786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec, now test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7)
[0m22:00:59.260328 [debug] [Thread-1 (]: Began compiling node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m22:00:59.267672 [debug] [Thread-1 (]: Writing injected SQL for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m22:00:59.268689 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (compile): 22:00:59.260662 => 22:00:59.268345
[0m22:00:59.269212 [debug] [Thread-1 (]: Began executing node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m22:00:59.276078 [debug] [Thread-1 (]: Writing runtime sql for node "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m22:00:59.277256 [debug] [Thread-1 (]: Using snowflake connection "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"
[0m22:00:59.277804 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select yr_num
from tpcds.intermediate.int__daily_aggregated_sales
where yr_num is null



      
    ) dbt_internal_test
[0m22:00:59.278365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:59.829000 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:00:59.832254 [debug] [Thread-1 (]: Timing info for test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7 (execute): 22:00:59.269557 => 22:00:59.831893
[0m22:00:59.832823 [debug] [Thread-1 (]: On test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7: Close
[0m22:00:59.907532 [info ] [Thread-1 (]: 16 of 17 PASS not_null_int__daily_aggregated_sales_yr_num ...................... [[32mPASS[0m in 0.65s]
[0m22:00:59.908850 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m22:00:59.910246 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m22:00:59.910960 [info ] [Thread-1 (]: 17 of 17 START sql incremental model analytics.weekly_sales_inventory .......... [RUN]
[0m22:00:59.911912 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7, now model.capstone.weekly_sales_inventory)
[0m22:00:59.912446 [debug] [Thread-1 (]: Began compiling node model.capstone.weekly_sales_inventory
[0m22:00:59.920735 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.weekly_sales_inventory"
[0m22:00:59.921722 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (compile): 22:00:59.912777 => 22:00:59.921385
[0m22:00:59.922294 [debug] [Thread-1 (]: Began executing node model.capstone.weekly_sales_inventory
[0m22:00:59.931454 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:00:59.932225 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
create or replace  temporary view tpcds.analytics.weekly_sales_inventory__dbt_tmp
  
   as (
    

WITH 
    -- sales weekly table
    agg_wkly_sales AS 
    (
        SELECT 
            warehouse_sk, 
            item_sk, 
            wk_num, 
            yr_num,
            sold_date_bow_sk,
            sold_date_bow_cal_date,
            SUM(daily_quantity) AS  weekly_quantity, 
            SUM(daily_net_profit) AS weekly_net_profit, 
            SUM(daily_sales_amt) AS weekly_sales_amt,
            SUM(daily_quantity)/7 AS avg_qty_dy
        FROM tpcds.intermediate.int__daily_aggregated_sales

         

        WHERE 
        sold_date_bow_sk >= NVL((select MAX(sold_date_bow_sk) from tpcds.analytics.weekly_sales_inventory), 0)

                
        
        GROUP BY 1, 2, 3, 4, 5, 6),
    -- inventory weekly table
    -- step 1.
    -- each warehouse and item's last day of recording to inventory table is different
    -- find the last day of each week (eow) to for each item+warehouse to pull the quantity in next step
    eow_inventory_day AS
    (
        SELECT 
            WAREHOUSE_SK,
            ITEM_SK,
            YR_num,
            WK_num,
            MAX(DATE_SK) AS eow_sk
        FROM tpcds.staging.stg_tpcds__inventory
        INNER JOIN tpcds.staging.stg_tpcds__date_dim
            ON date_sk = d_date_sk
        GROUP BY 1, 2, 3, 4
        ORDER BY 1, 2, 3, 4),

        
    -- inventory weekly table
    -- step 2.            
    -- using the last day (from inv table) of the week to find weekly qty on hand     
    agg_wkly_inventory_stg AS
    (
        SELECT DISTINCT
            inv.WAREHOUSE_SK AS WAREHOUSE_SK,
            inv.ITEM_SK AS ITEM_SK,
            eow.YR_num AS YR_num,
            eow.WK_num AS WK_num,
            case 
                when inv.date_sk = eow.eow_sk 
                    THEN inv.QUANTITY_ON_HAND
                else NULL
                end as inv_on_hand_qty_wk
        FROM tpcds.staging.stg_tpcds__inventory AS inv
        INNER JOIN eow_inventory_day AS eow USING(WAREHOUSE_SK, ITEM_SK)
        HAVING inv_on_hand_qty_wk is not null
    ),

    -- final weekly table, join inv and sales
    agg_wkly_inventory AS
    (
        select 
            sales.WAREHOUSE_SK AS WAREHOUSE_SK,
            sales.ITEM_SK AS ITEM_SK,
            sales.sold_date_bow_sk AS sold_date_bow_sk,
            sales.yr_num AS SOLD_YR_NUM,
            sales.wk_num AS SOLD_WK_NUM,
            sales.weekly_quantity AS SUM_QTY_WK,
            sales.weekly_sales_amt AS SUM_AMT_WK,
            sales.weekly_net_profit AS SUM_PROFIT_WK,
            sales.avg_qty_dy AS AVG_QTY_DY,
            inv.inv_on_hand_qty_wk AS inv_on_hand_qty_wk,
            inv.inv_on_hand_qty_wk/sales.weekly_quantity AS wks_sply,
            case 
                when sales.avg_qty_dy > 0 and sales.avg_qty_dy > inv.inv_on_hand_qty_wk
                then True
                else false
                end as low_stock_flg_wk
        FROM agg_wkly_sales AS sales 
        INNER JOIN agg_wkly_inventory_stg AS inv
            ON inv.WAREHOUSE_SK = sales.warehouse_sk
                AND inv.item_sk = sales.item_sk
                AND inv.wk_num = sales.wk_num
                AND inv.yr_num = sales.yr_num
    )

SELECT 
    WAREHOUSE_SK,
    ITEM_SK,
    sold_date_bow_sk,
    SOLD_YR_NUM,
    SOLD_WK_NUM,
    SUM_QTY_WK,
    SUM_AMT_WK,
    SUM_PROFIT_WK,
    AVG_QTY_DY,
    inv_on_hand_qty_wk,
    wks_sply,
    low_stock_flg_wk
FROM agg_wkly_inventory
  );
[0m22:00:59.932950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:00.730657 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m22:01:00.737383 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:00.738001 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m22:01:00.828987 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:01:00.966889 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:00.967626 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table tpcds.analytics.weekly_sales_inventory
[0m22:01:01.189388 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:01:01.196384 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:01.197018 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
describe table "TPCDS"."ANALYTICS"."WEEKLY_SALES_INVENTORY"
[0m22:01:01.265540 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m22:01:01.271757 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.weekly_sales_inventory"
[0m22:01:01.274558 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:01.275124 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
-- back compat for old kwarg name
  
  begin;
[0m22:01:01.610080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:01:01.610851 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:01.611466 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
merge into tpcds.analytics.weekly_sales_inventory as DBT_INTERNAL_DEST
        using tpcds.analytics.weekly_sales_inventory__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_bow_sk = DBT_INTERNAL_DEST.sold_date_bow_sk
                )

    
    when matched then update set
        "WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_YR_NUM" = DBT_INTERNAL_SOURCE."SOLD_YR_NUM","SOLD_WK_NUM" = DBT_INTERNAL_SOURCE."SOLD_WK_NUM","SUM_QTY_WK" = DBT_INTERNAL_SOURCE."SUM_QTY_WK","SUM_AMT_WK" = DBT_INTERNAL_SOURCE."SUM_AMT_WK","SUM_PROFIT_WK" = DBT_INTERNAL_SOURCE."SUM_PROFIT_WK","AVG_QTY_DY" = DBT_INTERNAL_SOURCE."AVG_QTY_DY","INV_ON_HAND_QTY_WK" = DBT_INTERNAL_SOURCE."INV_ON_HAND_QTY_WK","WKS_SPLY" = DBT_INTERNAL_SOURCE."WKS_SPLY","LOW_STOCK_FLG_WK" = DBT_INTERNAL_SOURCE."LOW_STOCK_FLG_WK"
    

    when not matched then insert
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")
    values
        ("WAREHOUSE_SK", "ITEM_SK", "SOLD_DATE_BOW_SK", "SOLD_YR_NUM", "SOLD_WK_NUM", "SUM_QTY_WK", "SUM_AMT_WK", "SUM_PROFIT_WK", "AVG_QTY_DY", "INV_ON_HAND_QTY_WK", "WKS_SPLY", "LOW_STOCK_FLG_WK")

;
[0m22:01:10.665220 [debug] [Thread-1 (]: SQL status: SUCCESS 34 in 9.0 seconds
[0m22:01:10.666108 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:10.666642 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
COMMIT
[0m22:01:11.110668 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:01:11.116496 [debug] [Thread-1 (]: Applying DROP to: tpcds.analytics.weekly_sales_inventory__dbt_tmp
[0m22:01:11.118086 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.weekly_sales_inventory"
[0m22:01:11.118631 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.weekly_sales_inventory"} */
drop view if exists tpcds.analytics.weekly_sales_inventory__dbt_tmp cascade
[0m22:01:11.309229 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m22:01:11.313237 [debug] [Thread-1 (]: Timing info for model.capstone.weekly_sales_inventory (execute): 22:00:59.922637 => 22:01:11.312889
[0m22:01:11.313818 [debug] [Thread-1 (]: On model.capstone.weekly_sales_inventory: Close
[0m22:01:11.441847 [info ] [Thread-1 (]: 17 of 17 OK created sql incremental model analytics.weekly_sales_inventory ..... [[32mSUCCESS 34[0m in 11.53s]
[0m22:01:11.442998 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m22:01:11.445446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:01:11.445915 [debug] [MainThread]: Connection 'model.capstone.weekly_sales_inventory' was properly closed.
[0m22:01:11.446498 [info ] [MainThread]: 
[0m22:01:11.446999 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 1 minutes and 5.29 seconds (65.29s).
[0m22:01:11.451312 [debug] [MainThread]: Command end result
[0m22:01:11.474697 [info ] [MainThread]: 
[0m22:01:11.475399 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:01:11.475903 [info ] [MainThread]: 
[0m22:01:11.476439 [info ] [MainThread]: Done. PASS=17 WARN=0 ERROR=0 SKIP=0 TOTAL=17
[0m22:01:11.477675 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 66.53862, "process_user_time": 8.664344, "process_kernel_time": 0.272135, "process_mem_max_rss": "165900", "process_out_blocks": "4296", "process_in_blocks": "0"}
[0m22:01:11.478478 [debug] [MainThread]: Command `dbt build` succeeded at 22:01:11.478291 after 66.54 seconds
[0m22:01:11.478962 [debug] [MainThread]: Flushing usage events


============================== 03:00:04.601381 | 3e7fbed9-31fe-46ba-af70-75b8be24decc ==============================
[0m03:00:04.601381 [info ] [MainThread]: Running with dbt=1.7.3
[0m03:00:04.605372 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'False'}
[0m03:00:05.589173 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m03:00:05.622005 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m03:00:05.703528 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:00:05.704584 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__inventory.sql
[0m03:00:06.082007 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m03:00:06.085299 [info ] [MainThread]: 
[0m03:00:06.086524 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:00:06.089065 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m03:00:06.110119 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:06.110856 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:06.111297 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:07.095100 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m03:00:07.097860 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:07.152736 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:07.153680 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:07.154253 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:07.555883 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:00:07.558427 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:07.627853 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:07.628729 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:07.629302 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:08.004689 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:00:08.007216 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:08.055313 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m03:00:08.069853 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m03:00:08.070717 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m03:00:08.071271 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:08.443394 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m03:00:08.446264 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m03:00:08.555413 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_analytics)
[0m03:00:08.562800 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m03:00:08.563446 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m03:00:08.564023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:08.999457 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m03:00:09.002073 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m03:00:09.045983 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_intermediate)
[0m03:00:09.051285 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m03:00:09.051899 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m03:00:09.052447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:09.448465 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m03:00:09.451121 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m03:00:09.537812 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:00:09.538491 [info ] [MainThread]: 
[0m03:00:09.541677 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m03:00:09.542582 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m03:00:09.543825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m03:00:09.544486 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m03:00:09.559365 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:09.560995 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 03:00:09.544933 => 03:00:09.560629
[0m03:00:09.561651 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m03:00:09.602617 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:09.606094 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:09.606815 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m03:00:09.607523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:10.058201 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:10.089591 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 03:00:09.562118 => 03:00:10.089219
[0m03:00:10.090333 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m03:00:10.154046 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.61s]
[0m03:00:10.155220 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m03:00:10.155867 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m03:00:10.156663 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m03:00:10.157624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m03:00:10.158187 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m03:00:10.163623 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m03:00:10.164625 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 03:00:10.158531 => 03:00:10.164281
[0m03:00:10.165144 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m03:00:10.172453 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m03:00:10.174426 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m03:00:10.175011 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m03:00:10.175572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:10.681419 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:10.685728 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 03:00:10.165485 => 03:00:10.685391
[0m03:00:10.686504 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m03:00:10.764776 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.61s]
[0m03:00:10.766306 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m03:00:10.767117 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m03:00:10.768315 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m03:00:10.769594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m03:00:10.770272 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m03:00:10.775911 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m03:00:10.777384 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 03:00:10.770714 => 03:00:10.777030
[0m03:00:10.778006 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m03:00:10.783542 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m03:00:10.785550 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m03:00:10.786248 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m03:00:10.786911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:11.229048 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:11.233431 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 03:00:10.778502 => 03:00:11.233073
[0m03:00:11.234102 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m03:00:11.289567 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.52s]
[0m03:00:11.290745 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m03:00:11.291445 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m03:00:11.292269 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m03:00:11.293320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m03:00:11.293891 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m03:00:11.301387 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:11.302571 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 03:00:11.294281 => 03:00:11.302194
[0m03:00:11.303135 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m03:00:11.308972 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:11.310610 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:11.311191 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m03:00:11.311762 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:11.780287 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:11.784521 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 03:00:11.303501 => 03:00:11.784181
[0m03:00:11.785157 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m03:00:11.827697 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.53s]
[0m03:00:11.828877 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m03:00:11.829559 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m03:00:11.830389 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m03:00:11.831389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m03:00:11.831956 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m03:00:11.837552 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m03:00:11.838603 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 03:00:11.832304 => 03:00:11.838252
[0m03:00:11.839140 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m03:00:11.844894 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m03:00:11.846315 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m03:00:11.846878 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m03:00:11.847428 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:12.433498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:12.438421 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 03:00:11.839483 => 03:00:12.438060
[0m03:00:12.439187 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m03:00:12.499448 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.67s]
[0m03:00:12.500873 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m03:00:12.501659 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m03:00:12.502570 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m03:00:12.503828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m03:00:12.504693 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m03:00:12.510920 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m03:00:12.512715 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 03:00:12.505180 => 03:00:12.512332
[0m03:00:12.513389 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m03:00:12.519530 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m03:00:12.521467 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m03:00:12.522198 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m03:00:12.522886 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:12.975883 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:12.980297 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 03:00:12.513849 => 03:00:12.979958
[0m03:00:12.981032 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m03:00:13.032749 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.53s]
[0m03:00:13.034211 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m03:00:13.034967 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m03:00:13.035904 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m03:00:13.037169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m03:00:13.037810 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m03:00:13.043493 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m03:00:13.045008 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 03:00:13.038298 => 03:00:13.044655
[0m03:00:13.045637 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m03:00:13.053336 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m03:00:13.055153 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m03:00:13.055823 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m03:00:13.056457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:13.512737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:13.517100 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 03:00:13.046108 => 03:00:13.516762
[0m03:00:13.517823 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m03:00:13.617018 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.58s]
[0m03:00:13.618491 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m03:00:13.619270 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m03:00:13.620192 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m03:00:13.621467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m03:00:13.622176 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m03:00:13.627948 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m03:00:13.629521 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 03:00:13.622631 => 03:00:13.629157
[0m03:00:13.630213 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m03:00:13.636162 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m03:00:13.637955 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m03:00:13.638672 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    -- rename columns by removing the prefix
SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m03:00:13.639337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:16.325524 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m03:00:16.329716 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 03:00:13.630665 => 03:00:16.329378
[0m03:00:16.330315 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m03:00:16.849127 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 3.23s]
[0m03:00:16.851389 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m03:00:16.852170 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m03:00:16.852928 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m03:00:16.854248 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m03:00:16.854911 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m03:00:16.862368 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m03:00:16.863992 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 03:00:16.855357 => 03:00:16.863635
[0m03:00:16.864636 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m03:00:16.870659 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m03:00:16.873321 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m03:00:16.873926 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m03:00:16.874561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:18.733289 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:00:18.737925 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 03:00:16.865082 => 03:00:18.737564
[0m03:00:18.738765 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m03:00:19.253185 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 2.40s]
[0m03:00:19.254640 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m03:00:19.255420 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m03:00:19.256378 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m03:00:19.257597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m03:00:19.258252 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m03:00:19.265747 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 03:00:19.258689 => 03:00:19.265330
[0m03:00:19.266508 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m03:00:19.344151 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:19.345132 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m03:00:19.345821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:21.253400 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 2.0 seconds
[0m03:00:21.267352 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:21.268083 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:22.208813 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 1.0 seconds
[0m03:00:22.221138 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:22.222006 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:22.389372 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:22.440507 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:22.442189 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:00:24.567639 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:00:24.573024 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:24.573646 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:24.670338 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:00:24.677904 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:24.678545 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:26.687272 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 2.0 seconds
[0m03:00:26.696061 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:26.696673 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:26.886919 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:00:26.894528 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:26.895168 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:27.029122 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:27.041532 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:27.042253 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:27.212890 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:00:27.226546 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m03:00:27.228647 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:27.229182 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m03:00:27.384921 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:27.385731 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:27.386423 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:00:28.473892 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m03:00:28.474805 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:28.475333 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m03:00:28.757230 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:28.764841 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 03:00:19.266957 => 03:00:28.764486
[0m03:00:28.765586 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m03:00:28.889684 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 9.63s]
[0m03:00:28.890824 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m03:00:28.891505 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m03:00:28.892405 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m03:00:28.893368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m03:00:28.894181 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m03:00:28.926520 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m03:00:28.927725 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 03:00:28.894525 => 03:00:28.927361
[0m03:00:28.928269 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m03:00:28.977518 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:28.978541 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m03:00:28.979295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:31.473110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:00:31.478802 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:31.479546 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m03:00:31.686457 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:31.693377 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:31.694127 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m03:00:31.746357 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:31.761442 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:31.762298 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m03:00:31.888486 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:31.930981 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m03:00:31.933678 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:31.934244 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m03:00:32.075384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:32.076160 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:32.076794 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m03:00:36.062210 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b14db4-0001-92b8-0004-d6ae000c7dee
[0m03:00:36.062944 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m03:00:36.063742 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 03:00:28.928615 => 03:00:36.063386
[0m03:00:36.064334 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m03:00:36.558131 [debug] [Thread-1 (]: Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m03:00:36.559374 [error] [Thread-1 (]: 11 of 17 ERROR creating sql incremental model intermediate.int__daily_aggregated_sales  [[31mERROR[0m in 7.67s]
[0m03:00:36.560377 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m03:00:36.561069 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m03:00:36.562275 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m03:00:36.563546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m03:00:36.564219 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m03:00:36.572330 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m03:00:36.573929 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 03:00:36.564671 => 03:00:36.573552
[0m03:00:36.574635 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m03:00:36.583864 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:36.584739 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m03:00:36.585517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:37.659615 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:37.665218 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:37.665956 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m03:00:37.797683 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:37.808307 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:37.809160 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m03:00:37.900066 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:37.909089 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:37.909784 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m03:00:37.998943 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:38.008139 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m03:00:38.012280 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:38.012838 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m03:00:38.133808 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:38.134647 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:38.135427 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m03:00:43.928151 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b14db4-0001-92b8-0004-d6ae000c7dfa
[0m03:00:43.928910 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m03:00:43.929748 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 03:00:36.575091 => 03:00:43.929351
[0m03:00:43.930377 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m03:00:44.028199 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m03:00:44.029437 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 7.47s]
[0m03:00:44.030420 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m03:00:44.031132 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m03:00:44.031988 [info ] [Thread-1 (]: 13 of 17 SKIP test not_null_int__daily_aggregated_sales_item_sk ................ [[33mSKIP[0m]
[0m03:00:44.032937 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m03:00:44.033697 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:00:44.034449 [info ] [Thread-1 (]: 14 of 17 SKIP test not_null_int__daily_aggregated_sales_warehouse_sk ........... [[33mSKIP[0m]
[0m03:00:44.035546 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:00:44.036289 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m03:00:44.037018 [info ] [Thread-1 (]: 15 of 17 SKIP test not_null_int__daily_aggregated_sales_wk_num ................. [[33mSKIP[0m]
[0m03:00:44.037944 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m03:00:44.038947 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m03:00:44.039780 [info ] [Thread-1 (]: 16 of 17 SKIP test not_null_int__daily_aggregated_sales_yr_num ................. [[33mSKIP[0m]
[0m03:00:44.040704 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m03:00:44.042064 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m03:00:44.042774 [info ] [Thread-1 (]: 17 of 17 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m03:00:44.043743 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m03:00:44.046246 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:00:44.046819 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m03:00:44.047498 [info ] [MainThread]: 
[0m03:00:44.048331 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 37.96 seconds (37.96s).
[0m03:00:44.052320 [debug] [MainThread]: Command end result
[0m03:00:44.075662 [info ] [MainThread]: 
[0m03:00:44.076674 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m03:00:44.077434 [info ] [MainThread]: 
[0m03:00:44.078239 [error] [MainThread]:   Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m03:00:44.079023 [info ] [MainThread]: 
[0m03:00:44.079787 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m03:00:44.080576 [info ] [MainThread]: 
[0m03:00:44.081382 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=5 TOTAL=17
[0m03:00:44.083009 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 39.55463, "process_user_time": 8.096993, "process_kernel_time": 0.336748, "process_mem_max_rss": "168960", "process_out_blocks": "6776", "command_success": false, "process_in_blocks": "0"}
[0m03:00:44.083946 [debug] [MainThread]: Command `dbt build` failed at 03:00:44.083743 after 39.56 seconds
[0m03:00:44.084587 [debug] [MainThread]: Flushing usage events


============================== 03:00:04.173003 | 9d6ed62a-e34a-46ec-91af-41f65361a3cd ==============================
[0m03:00:04.173003 [info ] [MainThread]: Running with dbt=1.7.3
[0m03:00:04.176788 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'False'}
[0m03:00:05.137082 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m03:00:05.168574 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m03:00:05.250422 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:00:05.251047 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:00:05.289467 [info ] [MainThread]: Found 12 models, 4 tests, 1 snapshot, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m03:00:05.292525 [info ] [MainThread]: 
[0m03:00:05.293637 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:00:05.296230 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m03:00:05.316591 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:05.317238 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:05.317652 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:08.711194 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 3.0 seconds
[0m03:00:08.713535 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:08.815995 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:08.816619 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:08.817036 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:09.124590 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m03:00:09.126997 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:09.220050 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m03:00:09.220811 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m03:00:09.221262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:09.891599 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m03:00:09.893861 [debug] [ThreadPool]: On list_tpcds: Close
[0m03:00:10.054121 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m03:00:10.067065 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m03:00:10.067659 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m03:00:10.068070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:10.597642 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m03:00:10.600447 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m03:00:10.655103 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m03:00:10.662227 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m03:00:10.662760 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m03:00:10.663171 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:11.224220 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m03:00:11.226879 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m03:00:11.283258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m03:00:11.288800 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m03:00:11.289348 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m03:00:11.289789 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:11.681593 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m03:00:11.683986 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m03:00:11.778206 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:00:11.778820 [info ] [MainThread]: 
[0m03:00:11.781966 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m03:00:11.782713 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m03:00:11.783664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m03:00:11.784200 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m03:00:11.797686 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:11.798833 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 03:00:11.784523 => 03:00:11.798487
[0m03:00:11.799363 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m03:00:11.842385 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:11.845323 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m03:00:11.845940 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    

SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m03:00:11.846559 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:13.272642 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:13.304056 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 03:00:11.799686 => 03:00:13.303690
[0m03:00:13.304710 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m03:00:13.591960 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 1.81s]
[0m03:00:13.593027 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m03:00:13.593672 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m03:00:13.594481 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m03:00:13.595436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m03:00:13.595991 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m03:00:13.601659 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m03:00:13.602742 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 03:00:13.596319 => 03:00:13.602397
[0m03:00:13.603251 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m03:00:13.609076 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m03:00:13.611037 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m03:00:13.611591 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    select 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m03:00:13.612135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:14.502520 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:14.506750 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 03:00:13.603575 => 03:00:14.506403
[0m03:00:14.507328 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m03:00:14.552833 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.96s]
[0m03:00:14.553880 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m03:00:14.554575 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m03:00:14.555203 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m03:00:14.556536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m03:00:14.557061 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m03:00:14.562937 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m03:00:14.564043 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 03:00:14.557374 => 03:00:14.563696
[0m03:00:14.564567 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m03:00:14.570411 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m03:00:14.571990 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m03:00:14.572544 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m03:00:14.573093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:15.051980 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:15.056161 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 03:00:14.564887 => 03:00:15.055824
[0m03:00:15.056735 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m03:00:15.106645 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.55s]
[0m03:00:15.107701 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m03:00:15.108360 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m03:00:15.109142 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m03:00:15.110157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m03:00:15.110684 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m03:00:15.116217 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:15.117272 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 03:00:15.111012 => 03:00:15.116917
[0m03:00:15.117795 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m03:00:15.125662 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:15.127379 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m03:00:15.127947 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    select
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m03:00:15.128479 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:16.157078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:16.161157 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 03:00:15.118184 => 03:00:16.160824
[0m03:00:16.161720 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m03:00:16.303528 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 1.19s]
[0m03:00:16.304596 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m03:00:16.305239 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m03:00:16.305870 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m03:00:16.307158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m03:00:16.307692 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m03:00:16.313386 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m03:00:16.314488 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 03:00:16.308022 => 03:00:16.314135
[0m03:00:16.315001 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m03:00:16.320747 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m03:00:16.322003 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m03:00:16.322564 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m03:00:16.323058 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:17.333034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:17.337071 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 03:00:16.315326 => 03:00:17.336742
[0m03:00:17.337632 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m03:00:17.530166 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 1.22s]
[0m03:00:17.531202 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m03:00:17.531830 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m03:00:17.532593 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m03:00:17.533559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m03:00:17.534109 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m03:00:17.541118 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m03:00:17.542237 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 03:00:17.534432 => 03:00:17.541844
[0m03:00:17.542748 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m03:00:17.548555 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m03:00:17.549965 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m03:00:17.550528 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    select
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m03:00:17.551041 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:18.135724 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:18.139730 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 03:00:17.543071 => 03:00:18.139395
[0m03:00:18.140297 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m03:00:18.190572 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.66s]
[0m03:00:18.191633 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m03:00:18.192273 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m03:00:18.193041 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m03:00:18.193967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m03:00:18.194521 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m03:00:18.200024 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m03:00:18.201000 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 03:00:18.194849 => 03:00:18.200666
[0m03:00:18.201755 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m03:00:18.207545 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m03:00:18.208761 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m03:00:18.209279 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m03:00:18.209781 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:18.951832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:18.955856 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 03:00:18.202128 => 03:00:18.955515
[0m03:00:18.956412 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m03:00:19.177254 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.98s]
[0m03:00:19.178377 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m03:00:19.179020 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m03:00:19.179788 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m03:00:19.180752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m03:00:19.181270 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m03:00:19.186779 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m03:00:19.187790 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 03:00:19.181588 => 03:00:19.187443
[0m03:00:19.188295 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m03:00:19.193863 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m03:00:19.195142 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m03:00:19.195673 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    -- rename columns by removing the prefix
SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m03:00:19.196180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:23.740447 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m03:00:23.744503 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 03:00:19.188611 => 03:00:23.744174
[0m03:00:23.745090 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m03:00:24.712072 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 5.53s]
[0m03:00:24.713112 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m03:00:24.713727 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m03:00:24.714525 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m03:00:24.715436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m03:00:24.715958 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m03:00:24.721632 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m03:00:24.722595 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 03:00:24.716274 => 03:00:24.722266
[0m03:00:24.723090 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m03:00:24.729992 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m03:00:24.732504 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m03:00:24.733089 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m03:00:24.733647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:26.524885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:00:26.529197 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 03:00:24.723400 => 03:00:26.528872
[0m03:00:26.529744 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m03:00:27.427281 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 2.71s]
[0m03:00:27.428367 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m03:00:27.429029 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m03:00:27.429839 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m03:00:27.430877 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m03:00:27.431643 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m03:00:27.439118 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 03:00:27.431982 => 03:00:27.438716
[0m03:00:27.439692 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m03:00:27.516464 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:27.517246 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m03:00:27.517823 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:30.355775 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 3.0 seconds
[0m03:00:30.369181 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:30.369803 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:30.672288 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:30.684459 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:30.685149 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:30.929899 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:30.979707 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:30.981169 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:00:38.418781 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 7.0 seconds
[0m03:00:38.424043 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:38.424577 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:41.292795 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 3.0 seconds
[0m03:00:41.300215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:41.300787 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:41.423336 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:41.430666 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:41.431196 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:41.514650 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:00:41.523803 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:41.524420 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m03:00:41.676904 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m03:00:41.688968 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:41.689591 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m03:00:41.987911 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m03:00:42.001267 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m03:00:42.003429 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:42.003963 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m03:00:42.208593 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:42.209332 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:42.209932 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:00:42.927772 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m03:00:42.928577 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m03:00:42.929073 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m03:00:43.134317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:43.141124 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 03:00:27.440020 => 03:00:43.140782
[0m03:00:43.141725 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m03:00:43.263320 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 15.83s]
[0m03:00:43.264376 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m03:00:43.265016 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m03:00:43.265805 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m03:00:43.266826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m03:00:43.267507 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m03:00:43.299456 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m03:00:43.300609 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 03:00:43.267891 => 03:00:43.300253
[0m03:00:43.301136 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m03:00:43.350069 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:43.350962 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
-- CREATE OR REPLACE TRANSIENT TABLE TPCDS.INTERMEDIATE.DAILY_AGGREGATED_SALES_TMP AS
WITH 
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happens, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the sk for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m03:00:43.351666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:44.759059 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m03:00:44.764388 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:44.764952 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m03:00:45.164831 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:45.171674 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:45.172316 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m03:00:45.568327 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:45.581886 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:45.582664 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m03:00:45.738010 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m03:00:45.782572 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m03:00:45.785207 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:45.785738 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m03:00:46.199915 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:46.200690 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m03:00:46.201287 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m03:00:51.517660 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b15354-0001-927b-0004-d6ae000cf9ae
[0m03:00:51.518450 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m03:00:51.519250 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 03:00:43.301470 => 03:00:51.518885
[0m03:00:51.519815 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m03:00:54.319424 [debug] [Thread-1 (]: Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m03:00:54.320569 [error] [Thread-1 (]: 11 of 17 ERROR creating sql incremental model intermediate.int__daily_aggregated_sales  [[31mERROR[0m in 11.05s]
[0m03:00:54.321471 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m03:00:54.322150 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m03:00:54.323029 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m03:00:54.324298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m03:00:54.324889 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m03:00:54.332529 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m03:00:54.333596 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 03:00:54.325223 => 03:00:54.333255
[0m03:00:54.334155 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m03:00:54.343196 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:54.343992 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    

SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m03:00:54.344615 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:00:56.558350 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m03:00:56.563914 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:56.564558 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m03:00:56.916564 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:56.927564 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:56.928284 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m03:00:57.029403 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:57.038723 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:57.039423 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m03:00:57.109756 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m03:00:57.119135 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m03:00:57.123298 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:57.123896 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m03:00:57.344036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m03:00:57.344775 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m03:00:57.345496 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m03:01:04.525330 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b15354-0001-925e-0004-d6ae000ced5e
[0m03:01:04.526133 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m03:01:04.526923 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 03:00:54.334491 => 03:01:04.526570
[0m03:01:04.527488 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m03:01:14.409870 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m03:01:14.411062 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 20.09s]
[0m03:01:14.411971 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m03:01:14.412639 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m03:01:14.413412 [info ] [Thread-1 (]: 13 of 17 SKIP test not_null_int__daily_aggregated_sales_item_sk ................ [[33mSKIP[0m]
[0m03:01:14.414095 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m03:01:14.414727 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:01:14.415419 [info ] [Thread-1 (]: 14 of 17 SKIP test not_null_int__daily_aggregated_sales_warehouse_sk ........... [[33mSKIP[0m]
[0m03:01:14.416060 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m03:01:14.416672 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m03:01:14.417380 [info ] [Thread-1 (]: 15 of 17 SKIP test not_null_int__daily_aggregated_sales_wk_num ................. [[33mSKIP[0m]
[0m03:01:14.418007 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m03:01:14.418671 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m03:01:14.419290 [info ] [Thread-1 (]: 16 of 17 SKIP test not_null_int__daily_aggregated_sales_yr_num ................. [[33mSKIP[0m]
[0m03:01:14.419981 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m03:01:14.421341 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m03:01:14.421940 [info ] [Thread-1 (]: 17 of 17 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m03:01:14.422580 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m03:01:14.424881 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:01:14.425340 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m03:01:14.425895 [info ] [MainThread]: 
[0m03:01:14.426458 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 1 minutes and 9.13 seconds (69.13s).
[0m03:01:14.430124 [debug] [MainThread]: Command end result
[0m03:01:14.451129 [info ] [MainThread]: 
[0m03:01:14.451833 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m03:01:14.452297 [info ] [MainThread]: 
[0m03:01:14.452759 [error] [MainThread]:   Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m03:01:14.453251 [info ] [MainThread]: 
[0m03:01:14.453702 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m03:01:14.454229 [info ] [MainThread]: 
[0m03:01:14.454749 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=5 TOTAL=17
[0m03:01:14.456006 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 70.35273, "process_user_time": 7.61435, "process_kernel_time": 0.313942, "process_mem_max_rss": "168460", "process_out_blocks": "4912", "command_success": false, "process_in_blocks": "0"}
[0m03:01:14.456786 [debug] [MainThread]: Command `dbt build` failed at 03:01:14.456593 after 70.35 seconds
[0m03:01:14.457295 [debug] [MainThread]: Flushing usage events


============================== 04:29:02.946271 | 7ee09fd0-c474-480b-b076-b276074d7156 ==============================
[0m04:29:02.946271 [info ] [MainThread]: Running with dbt=1.7.3
[0m04:29:02.950314 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'profiles_dir': '/home/ubuntu/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'invocation_command': 'dbt build', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m04:29:03.941785 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m04:29:03.975427 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m04:29:04.056253 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 12 files changed.
[0m04:29:04.057355 [debug] [MainThread]: Partial parsing: added file: capstone://models/analytics/analytics_models.yml
[0m04:29:04.058104 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_demographics.sql
[0m04:29:04.058787 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/customer_dim.sql
[0m04:29:04.059460 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer.sql
[0m04:29:04.060127 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__customer_address.sql
[0m04:29:04.060803 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__web_sales.sql
[0m04:29:04.061496 [debug] [MainThread]: Partial parsing: updated file: capstone://snapshots/customer_snapshot.sql
[0m04:29:04.062257 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__income_band.sql
[0m04:29:04.062998 [debug] [MainThread]: Partial parsing: updated file: capstone://models/intermediate/int__daily_aggregated_sales.sql
[0m04:29:04.063671 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__date_dim.sql
[0m04:29:04.064330 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__household_demographics.sql
[0m04:29:04.065012 [debug] [MainThread]: Partial parsing: updated file: capstone://models/analytics/weekly_sales_inventory.sql
[0m04:29:04.065676 [debug] [MainThread]: Partial parsing: updated file: capstone://models/staging/tpcds/stg_tpcds__catalog_sales.sql
[0m04:29:04.985866 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m04:29:04.989235 [info ] [MainThread]: 
[0m04:29:04.990607 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:29:04.993297 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m04:29:05.013831 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:29:05.014617 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:29:05.015146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:29:05.548668 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m04:29:05.551259 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:29:05.598685 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:29:05.599562 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:29:05.600114 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:05.934719 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m04:29:05.937172 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:29:05.980097 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:29:05.981092 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:29:05.981621 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:06.853292 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m04:29:06.855739 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:29:06.918401 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_analytics)
[0m04:29:06.931943 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m04:29:06.932622 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m04:29:06.933174 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:07.456991 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m04:29:07.459554 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m04:29:07.499924 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now list_tpcds_staging)
[0m04:29:07.505588 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m04:29:07.506215 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m04:29:07.506740 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:07.813363 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m04:29:07.816093 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m04:29:07.861684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m04:29:07.869446 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m04:29:07.870051 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m04:29:07.870587 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:08.194400 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m04:29:08.196992 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m04:29:08.493645 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:29:08.494391 [info ] [MainThread]: 
[0m04:29:08.497473 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m04:29:08.498301 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m04:29:08.499341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now model.capstone.stg_tpcds__catalog_sales)
[0m04:29:08.500228 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m04:29:08.513605 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:29:08.514714 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 04:29:08.500652 => 04:29:08.514333
[0m04:29:08.515376 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m04:29:08.555194 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:29:08.558189 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m04:29:08.558900 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    
-- rename the source columns
SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m04:29:08.559590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:09.051316 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:09.082425 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 04:29:08.515769 => 04:29:09.082002
[0m04:29:09.083225 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m04:29:09.129281 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.63s]
[0m04:29:09.130524 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m04:29:09.131279 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m04:29:09.132169 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m04:29:09.133227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m04:29:09.133868 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m04:29:09.139392 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m04:29:09.140461 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 04:29:09.134299 => 04:29:09.140091
[0m04:29:09.141102 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m04:29:09.146557 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m04:29:09.148549 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m04:29:09.149219 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    -- rename the source columns
SELECT 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m04:29:09.149885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:09.606517 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:09.610920 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 04:29:09.141505 => 04:29:09.610537
[0m04:29:09.611619 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m04:29:09.657420 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.52s]
[0m04:29:09.658643 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m04:29:09.659380 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m04:29:09.660154 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m04:29:09.661408 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m04:29:09.662331 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m04:29:09.669733 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m04:29:09.670879 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 04:29:09.662918 => 04:29:09.670505
[0m04:29:09.671527 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m04:29:09.809572 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m04:29:09.811492 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m04:29:09.812151 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    -- rename the source columns
SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m04:29:09.812802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:10.282098 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:10.286301 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 04:29:09.671942 => 04:29:10.285891
[0m04:29:10.286967 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m04:29:10.324952 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.66s]
[0m04:29:10.326137 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m04:29:10.326885 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m04:29:10.327757 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m04:29:10.328792 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m04:29:10.329430 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m04:29:10.335371 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:29:10.336442 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 04:29:10.329827 => 04:29:10.336069
[0m04:29:10.337097 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m04:29:10.342680 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:29:10.344341 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m04:29:10.344997 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    -- rename the source columns
SELECT
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m04:29:10.345654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:10.874270 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:29:10.878543 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 04:29:10.337494 => 04:29:10.878156
[0m04:29:10.879233 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m04:29:13.451133 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 3.12s]
[0m04:29:13.452358 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m04:29:13.453100 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m04:29:13.453947 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m04:29:13.455029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m04:29:13.455665 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m04:29:13.461213 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m04:29:13.462337 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 04:29:13.456067 => 04:29:13.461921
[0m04:29:13.462987 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m04:29:13.468325 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m04:29:13.469682 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m04:29:13.470346 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    -- rename the source columns
SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m04:29:13.470977 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:14.040910 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:29:14.045108 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 04:29:13.463390 => 04:29:14.044745
[0m04:29:14.045772 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m04:29:14.114050 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.66s]
[0m04:29:14.115250 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m04:29:14.116013 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m04:29:14.116907 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m04:29:14.117958 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m04:29:14.118633 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m04:29:14.124146 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m04:29:14.125187 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 04:29:14.119046 => 04:29:14.124814
[0m04:29:14.125840 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m04:29:14.132994 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m04:29:14.134382 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m04:29:14.135037 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    -- rename the source columns
SELECT
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m04:29:14.135673 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:14.617789 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:14.622131 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 04:29:14.126278 => 04:29:14.621735
[0m04:29:14.622803 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m04:29:14.679467 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.56s]
[0m04:29:14.680669 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m04:29:14.681410 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m04:29:14.682295 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m04:29:14.683365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m04:29:14.683996 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m04:29:14.689659 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m04:29:14.690750 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 04:29:14.684390 => 04:29:14.690371
[0m04:29:14.691389 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m04:29:14.697036 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m04:29:14.698443 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m04:29:14.699086 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    -- rename the source columns
SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m04:29:14.699716 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:15.697732 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:29:15.701926 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 04:29:14.691782 => 04:29:15.701569
[0m04:29:15.702613 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m04:29:15.749792 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 1.07s]
[0m04:29:15.751021 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m04:29:15.751766 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m04:29:15.752666 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m04:29:15.753753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m04:29:15.754420 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m04:29:15.760021 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m04:29:15.761124 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 04:29:15.754820 => 04:29:15.760736
[0m04:29:15.761768 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m04:29:15.769241 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m04:29:15.770659 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m04:29:15.771301 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    -- rename columns by removing the prefix
SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m04:29:15.771927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:16.208407 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:16.212628 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 04:29:15.762199 => 04:29:16.212272
[0m04:29:16.213307 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m04:29:16.257114 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.50s]
[0m04:29:16.258325 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m04:29:16.259060 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m04:29:16.259923 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m04:29:16.260971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m04:29:16.261597 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m04:29:16.267328 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m04:29:16.268370 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 04:29:16.261999 => 04:29:16.268001
[0m04:29:16.268987 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m04:29:16.274419 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m04:29:16.277103 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m04:29:16.277801 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    -- rename the source columns
SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m04:29:16.278528 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:16.709363 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:16.713698 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 04:29:16.269382 => 04:29:16.713329
[0m04:29:16.714424 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m04:29:16.762835 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.50s]
[0m04:29:16.764023 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m04:29:16.764789 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m04:29:16.765716 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m04:29:16.766985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m04:29:16.767640 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m04:29:16.776706 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 04:29:16.768041 => 04:29:16.776275
[0m04:29:16.777380 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m04:29:16.851862 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:16.852737 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m04:29:16.853403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:17.807459 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m04:29:17.822756 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:17.823544 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:29:17.885817 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:29:17.898215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:17.898962 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:29:17.968071 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:29:18.017474 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:18.019140 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m04:29:20.323172 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m04:29:20.329633 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.330453 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:29:20.392640 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:29:20.400414 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.401179 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:29:20.453437 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:29:20.461058 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.461821 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:29:20.516527 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:29:20.524523 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.525330 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:29:20.569116 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:29:20.581699 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.584542 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:29:20.645224 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:29:20.658707 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m04:29:20.660928 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.661588 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m04:29:20.720569 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:20.721463 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.722202 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m04:29:20.949458 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m04:29:20.950439 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:29:20.951074 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m04:29:21.115458 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:21.122972 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 04:29:16.777779 => 04:29:21.122579
[0m04:29:21.123719 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m04:29:21.180829 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 4.41s]
[0m04:29:21.182065 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m04:29:21.182845 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m04:29:21.183810 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m04:29:21.185090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m04:29:21.185735 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m04:29:21.199164 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m04:29:21.200423 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 04:29:21.186180 => 04:29:21.200027
[0m04:29:21.201108 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m04:29:21.248984 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:21.250267 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
WITH 
    -- union the web sales and catalog sales data into one view
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happen, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the date surrogate key for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m04:29:21.251182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:21.987919 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:29:21.993509 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:21.994277 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m04:29:22.050370 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:29:22.059215 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:22.060032 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m04:29:22.113154 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:29:22.126833 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:22.127689 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m04:29:22.194281 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:29:22.237888 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m04:29:22.240723 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:22.241383 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m04:29:22.325985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:22.326886 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:29:22.327634 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m04:29:25.740582 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153ad-0001-92ec-0004-d6ae000d4ade
[0m04:29:25.741389 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:29:25.742360 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 04:29:21.201513 => 04:29:25.741925
[0m04:29:25.743028 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m04:29:25.794774 [debug] [Thread-1 (]: Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:29:25.796105 [error] [Thread-1 (]: 11 of 17 ERROR creating sql incremental model intermediate.int__daily_aggregated_sales  [[31mERROR[0m in 4.61s]
[0m04:29:25.797162 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m04:29:25.797928 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m04:29:25.798961 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m04:29:25.800353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m04:29:25.801059 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m04:29:25.809443 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m04:29:25.810665 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 04:29:25.801468 => 04:29:25.810286
[0m04:29:25.811295 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m04:29:25.822557 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:25.823460 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    
-- pull custome attributes together
SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m04:29:25.824210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:26.509064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:29:26.514691 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:26.515419 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m04:29:26.572949 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:29:26.581699 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:26.582385 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m04:29:26.646063 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:29:26.655012 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:26.655763 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m04:29:26.796031 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:29:26.805088 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m04:29:26.809142 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:26.809757 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m04:29:26.911171 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:29:26.912056 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:29:26.912898 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m04:29:32.082849 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153ad-0001-925e-0004-d6ae000cee2a
[0m04:29:32.083670 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:29:32.084572 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 04:29:25.811707 => 04:29:32.084185
[0m04:29:32.085236 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m04:29:32.135261 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:29:32.136565 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 6.34s]
[0m04:29:32.137576 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m04:29:32.138397 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:29:32.139292 [info ] [Thread-1 (]: 13 of 17 SKIP test not_null_int__daily_aggregated_sales_item_sk ................ [[33mSKIP[0m]
[0m04:29:32.140067 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:29:32.140811 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:29:32.141636 [info ] [Thread-1 (]: 14 of 17 SKIP test not_null_int__daily_aggregated_sales_warehouse_sk ........... [[33mSKIP[0m]
[0m04:29:32.142508 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:29:32.143237 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:29:32.143911 [info ] [Thread-1 (]: 15 of 17 SKIP test not_null_int__daily_aggregated_sales_wk_num ................. [[33mSKIP[0m]
[0m04:29:32.144756 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:29:32.145478 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:29:32.146314 [info ] [Thread-1 (]: 16 of 17 SKIP test not_null_int__daily_aggregated_sales_yr_num ................. [[33mSKIP[0m]
[0m04:29:32.147059 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:29:32.148400 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m04:29:32.149125 [info ] [Thread-1 (]: 17 of 17 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m04:29:32.150140 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m04:29:32.152836 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:29:32.153393 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m04:29:32.154070 [info ] [MainThread]: 
[0m04:29:32.154688 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 27.16 seconds (27.16s).
[0m04:29:32.158425 [debug] [MainThread]: Command end result
[0m04:29:32.182670 [info ] [MainThread]: 
[0m04:29:32.183488 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m04:29:32.184049 [info ] [MainThread]: 
[0m04:29:32.184622 [error] [MainThread]:   Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:29:32.185189 [info ] [MainThread]: 
[0m04:29:32.185736 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:29:32.186344 [info ] [MainThread]: 
[0m04:29:32.186944 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=5 TOTAL=17
[0m04:29:32.188270 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 29.314926, "process_user_time": 8.306888, "process_kernel_time": 0.344031, "process_mem_max_rss": "172820", "process_out_blocks": "5872", "command_success": false, "process_in_blocks": "0"}
[0m04:29:32.189137 [debug] [MainThread]: Command `dbt build` failed at 04:29:32.188917 after 29.32 seconds
[0m04:29:32.189734 [debug] [MainThread]: Flushing usage events


============================== 04:39:49.930178 | 5c2c227b-5e34-4912-a54b-4cf4f660f051 ==============================
[0m04:39:49.930178 [info ] [MainThread]: Running with dbt=1.7.3
[0m04:39:49.933804 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'target_path': 'None', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'send_anonymous_usage_stats': 'False'}
[0m04:39:50.844923 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m04:39:50.877661 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m04:39:50.960723 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:39:50.961522 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:39:50.998220 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m04:39:51.001450 [info ] [MainThread]: 
[0m04:39:51.002783 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:39:51.005202 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m04:39:51.025992 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:39:51.026781 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:39:51.027319 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:39:51.534807 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m04:39:51.537317 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:39:51.588947 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:39:51.589794 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:39:51.590349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:39:51.966243 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m04:39:51.968697 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:39:52.014929 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:39:52.015852 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:39:52.016399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:39:52.458967 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m04:39:52.461413 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:39:52.515946 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m04:39:52.528984 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m04:39:52.529666 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m04:39:52.530211 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:39:52.976993 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m04:39:52.979831 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m04:39:53.061604 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m04:39:53.070659 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m04:39:53.071302 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m04:39:53.071841 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:39:53.422760 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m04:39:53.425316 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m04:39:53.471311 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m04:39:53.476913 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m04:39:53.477515 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m04:39:53.478102 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:39:53.779039 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m04:39:53.781607 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m04:39:53.830847 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:39:53.831575 [info ] [MainThread]: 
[0m04:39:53.834860 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m04:39:53.835686 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m04:39:53.836754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m04:39:53.837389 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m04:39:53.850925 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:39:53.852110 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 04:39:53.837866 => 04:39:53.851722
[0m04:39:53.852739 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m04:39:53.894990 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:39:53.897991 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m04:39:53.898749 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    
-- rename the source columns
SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m04:39:53.899439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:54.353375 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:54.385596 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 04:39:53.853138 => 04:39:54.385185
[0m04:39:54.386438 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m04:39:54.497495 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.66s]
[0m04:39:54.498737 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m04:39:54.499470 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m04:39:54.500447 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m04:39:54.501522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m04:39:54.502184 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m04:39:54.508051 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m04:39:54.509123 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 04:39:54.502585 => 04:39:54.508740
[0m04:39:54.509737 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m04:39:54.515829 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m04:39:54.517996 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m04:39:54.518730 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    -- rename the source columns
SELECT 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m04:39:54.519383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:54.907800 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:54.911964 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 04:39:54.510172 => 04:39:54.911598
[0m04:39:54.912620 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m04:39:54.952703 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.45s]
[0m04:39:54.953889 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m04:39:54.954652 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m04:39:54.955622 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m04:39:54.956825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m04:39:54.957451 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m04:39:54.963006 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m04:39:54.964076 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 04:39:54.957844 => 04:39:54.963703
[0m04:39:54.964684 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m04:39:54.970141 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m04:39:54.971744 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m04:39:54.972397 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    -- rename the source columns
SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m04:39:54.973047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:55.397172 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:55.401311 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 04:39:54.965107 => 04:39:55.400950
[0m04:39:55.401963 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m04:39:55.443594 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.49s]
[0m04:39:55.444784 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m04:39:55.445507 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m04:39:55.446386 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m04:39:55.447447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m04:39:55.448081 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m04:39:55.453822 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:39:55.454897 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 04:39:55.448491 => 04:39:55.454528
[0m04:39:55.455518 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m04:39:55.462447 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:39:55.463990 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m04:39:55.464640 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    -- rename the source columns
SELECT
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m04:39:55.465279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:55.840066 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:55.844320 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 04:39:55.455917 => 04:39:55.843935
[0m04:39:55.845009 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m04:39:55.888319 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.44s]
[0m04:39:55.889499 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m04:39:55.890254 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m04:39:55.891157 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m04:39:55.892179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m04:39:55.892839 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m04:39:55.898777 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m04:39:55.899824 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 04:39:55.893233 => 04:39:55.899453
[0m04:39:55.900428 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m04:39:55.905731 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m04:39:55.907066 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m04:39:55.907705 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    -- rename the source columns
SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m04:39:55.908319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:56.271268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:56.275417 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 04:39:55.900825 => 04:39:56.275044
[0m04:39:56.276072 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m04:39:56.317654 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.43s]
[0m04:39:56.318913 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m04:39:56.319697 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m04:39:56.320585 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m04:39:56.321676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m04:39:56.322366 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m04:39:56.327915 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m04:39:56.329036 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 04:39:56.322778 => 04:39:56.328647
[0m04:39:56.329700 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m04:39:56.336993 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m04:39:56.338477 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m04:39:56.339146 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    -- rename the source columns
SELECT
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m04:39:56.339788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:57.091887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:39:57.096504 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 04:39:56.330153 => 04:39:57.096110
[0m04:39:57.097202 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m04:39:57.141926 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.82s]
[0m04:39:57.143197 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m04:39:57.143928 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m04:39:57.144814 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m04:39:57.145862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m04:39:57.146523 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m04:39:57.152656 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m04:39:57.153719 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 04:39:57.146923 => 04:39:57.153342
[0m04:39:57.154391 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m04:39:57.159715 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m04:39:57.161003 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m04:39:57.161641 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    -- rename the source columns
SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m04:39:57.162278 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:57.659091 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:57.663234 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 04:39:57.154777 => 04:39:57.662873
[0m04:39:57.663882 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m04:39:57.731229 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.59s]
[0m04:39:57.732446 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m04:39:57.733182 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m04:39:57.734102 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m04:39:57.735179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m04:39:57.735807 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m04:39:57.743125 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m04:39:57.744187 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 04:39:57.736214 => 04:39:57.743805
[0m04:39:57.744828 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m04:39:57.750154 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m04:39:57.751496 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m04:39:57.752143 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    -- rename columns by removing the prefix
SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m04:39:57.752772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:58.171277 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:58.175487 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 04:39:57.745220 => 04:39:58.175121
[0m04:39:58.176152 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m04:39:58.236589 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.50s]
[0m04:39:58.237788 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m04:39:58.238569 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m04:39:58.239451 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m04:39:58.240498 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m04:39:58.241123 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m04:39:58.247147 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m04:39:58.248223 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 04:39:58.241530 => 04:39:58.247842
[0m04:39:58.248864 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m04:39:58.254447 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m04:39:58.257153 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m04:39:58.257856 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    -- rename the source columns
SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m04:39:58.258572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:58.665782 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:39:58.669930 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 04:39:58.249321 => 04:39:58.669568
[0m04:39:58.670626 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m04:39:58.715475 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.47s]
[0m04:39:58.716664 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m04:39:58.717423 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m04:39:58.718472 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m04:39:58.719500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m04:39:58.720132 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m04:39:58.727908 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 04:39:58.720527 => 04:39:58.727458
[0m04:39:58.728596 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m04:39:58.803015 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:39:58.803890 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
select * from (
        select SALUTATION, PREFERRED_CUST_FLAG, FIRST_SALES_DATE_SK, LOGIN, CURRENT_CDEMO_SK, FIRST_NAME, CURRENT_HDEMO_SK, CURRENT_ADDR_SK, LAST_NAME, CUSTOMER_ID, LAST_REVIEW_DATE_SK, BIRTH_MONTH, BIRTH_COUNTRY, BIRTH_YEAR, BIRTH_DAY, EMAIL_ADDRESS, FIRST_SHIPTO_DATE_SK from (
                



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m04:39:58.804555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:39:59.220693 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m04:39:59.235483 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:39:59.236201 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:39:59.271787 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:39:59.283739 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:39:59.284400 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:39:59.330475 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:39:59.380170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:39:59.381772 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace temporary table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer


    ),

    snapshotted_data as (

        select *,
            CUSTOMER_SK as dbt_unique_key

        from "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            CUSTOMER_SK as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."SALUTATION" != source_data."SALUTATION"
        or
        (
            ((snapshotted_data."SALUTATION" is null) and not (source_data."SALUTATION" is null))
            or
            ((not snapshotted_data."SALUTATION" is null) and (source_data."SALUTATION" is null))
        ) or snapshotted_data."PREFERRED_CUST_FLAG" != source_data."PREFERRED_CUST_FLAG"
        or
        (
            ((snapshotted_data."PREFERRED_CUST_FLAG" is null) and not (source_data."PREFERRED_CUST_FLAG" is null))
            or
            ((not snapshotted_data."PREFERRED_CUST_FLAG" is null) and (source_data."PREFERRED_CUST_FLAG" is null))
        ) or snapshotted_data."FIRST_SALES_DATE_SK" != source_data."FIRST_SALES_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SALES_DATE_SK" is null) and not (source_data."FIRST_SALES_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SALES_DATE_SK" is null) and (source_data."FIRST_SALES_DATE_SK" is null))
        ) or snapshotted_data."LOGIN" != source_data."LOGIN"
        or
        (
            ((snapshotted_data."LOGIN" is null) and not (source_data."LOGIN" is null))
            or
            ((not snapshotted_data."LOGIN" is null) and (source_data."LOGIN" is null))
        ) or snapshotted_data."CURRENT_CDEMO_SK" != source_data."CURRENT_CDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_CDEMO_SK" is null) and not (source_data."CURRENT_CDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_CDEMO_SK" is null) and (source_data."CURRENT_CDEMO_SK" is null))
        ) or snapshotted_data."FIRST_NAME" != source_data."FIRST_NAME"
        or
        (
            ((snapshotted_data."FIRST_NAME" is null) and not (source_data."FIRST_NAME" is null))
            or
            ((not snapshotted_data."FIRST_NAME" is null) and (source_data."FIRST_NAME" is null))
        ) or snapshotted_data."CURRENT_HDEMO_SK" != source_data."CURRENT_HDEMO_SK"
        or
        (
            ((snapshotted_data."CURRENT_HDEMO_SK" is null) and not (source_data."CURRENT_HDEMO_SK" is null))
            or
            ((not snapshotted_data."CURRENT_HDEMO_SK" is null) and (source_data."CURRENT_HDEMO_SK" is null))
        ) or snapshotted_data."CURRENT_ADDR_SK" != source_data."CURRENT_ADDR_SK"
        or
        (
            ((snapshotted_data."CURRENT_ADDR_SK" is null) and not (source_data."CURRENT_ADDR_SK" is null))
            or
            ((not snapshotted_data."CURRENT_ADDR_SK" is null) and (source_data."CURRENT_ADDR_SK" is null))
        ) or snapshotted_data."LAST_NAME" != source_data."LAST_NAME"
        or
        (
            ((snapshotted_data."LAST_NAME" is null) and not (source_data."LAST_NAME" is null))
            or
            ((not snapshotted_data."LAST_NAME" is null) and (source_data."LAST_NAME" is null))
        ) or snapshotted_data."CUSTOMER_ID" != source_data."CUSTOMER_ID"
        or
        (
            ((snapshotted_data."CUSTOMER_ID" is null) and not (source_data."CUSTOMER_ID" is null))
            or
            ((not snapshotted_data."CUSTOMER_ID" is null) and (source_data."CUSTOMER_ID" is null))
        ) or snapshotted_data."LAST_REVIEW_DATE_SK" != source_data."LAST_REVIEW_DATE_SK"
        or
        (
            ((snapshotted_data."LAST_REVIEW_DATE_SK" is null) and not (source_data."LAST_REVIEW_DATE_SK" is null))
            or
            ((not snapshotted_data."LAST_REVIEW_DATE_SK" is null) and (source_data."LAST_REVIEW_DATE_SK" is null))
        ) or snapshotted_data."BIRTH_MONTH" != source_data."BIRTH_MONTH"
        or
        (
            ((snapshotted_data."BIRTH_MONTH" is null) and not (source_data."BIRTH_MONTH" is null))
            or
            ((not snapshotted_data."BIRTH_MONTH" is null) and (source_data."BIRTH_MONTH" is null))
        ) or snapshotted_data."BIRTH_COUNTRY" != source_data."BIRTH_COUNTRY"
        or
        (
            ((snapshotted_data."BIRTH_COUNTRY" is null) and not (source_data."BIRTH_COUNTRY" is null))
            or
            ((not snapshotted_data."BIRTH_COUNTRY" is null) and (source_data."BIRTH_COUNTRY" is null))
        ) or snapshotted_data."BIRTH_YEAR" != source_data."BIRTH_YEAR"
        or
        (
            ((snapshotted_data."BIRTH_YEAR" is null) and not (source_data."BIRTH_YEAR" is null))
            or
            ((not snapshotted_data."BIRTH_YEAR" is null) and (source_data."BIRTH_YEAR" is null))
        ) or snapshotted_data."BIRTH_DAY" != source_data."BIRTH_DAY"
        or
        (
            ((snapshotted_data."BIRTH_DAY" is null) and not (source_data."BIRTH_DAY" is null))
            or
            ((not snapshotted_data."BIRTH_DAY" is null) and (source_data."BIRTH_DAY" is null))
        ) or snapshotted_data."EMAIL_ADDRESS" != source_data."EMAIL_ADDRESS"
        or
        (
            ((snapshotted_data."EMAIL_ADDRESS" is null) and not (source_data."EMAIL_ADDRESS" is null))
            or
            ((not snapshotted_data."EMAIL_ADDRESS" is null) and (source_data."EMAIL_ADDRESS" is null))
        ) or snapshotted_data."FIRST_SHIPTO_DATE_SK" != source_data."FIRST_SHIPTO_DATE_SK"
        or
        (
            ((snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and not (source_data."FIRST_SHIPTO_DATE_SK" is null))
            or
            ((not snapshotted_data."FIRST_SHIPTO_DATE_SK" is null) and (source_data."FIRST_SHIPTO_DATE_SK" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m04:40:00.684698 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:40:00.690169 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:00.690840 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:40:00.746854 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:40:00.754409 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:00.755040 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:40:00.809084 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:40:00.816614 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:00.817246 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:40:00.878083 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:40:00.885714 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:00.886451 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT"
[0m04:40:00.928350 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 0.0 seconds
[0m04:40:00.942645 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:00.943393 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
describe table "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp"
[0m04:40:01.045240 [debug] [Thread-1 (]: SQL status: SUCCESS 25 in 0.0 seconds
[0m04:40:01.058621 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m04:40:01.060752 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:01.061378 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
BEGIN
[0m04:40:01.142622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:40:01.143504 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:01.144191 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
merge into "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT" as DBT_INTERNAL_DEST
    using "TPCDS"."INTERMEDIATE"."CUSTOMER_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "_AIRBYTE_NORMALIZED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m04:40:01.434362 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m04:40:01.435325 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:40:01.435983 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
COMMIT
[0m04:40:01.594294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:40:01.602002 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 04:39:58.728997 => 04:40:01.601595
[0m04:40:01.602832 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m04:40:01.667895 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 0[0m in 2.95s]
[0m04:40:01.669119 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m04:40:01.669950 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m04:40:01.670762 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m04:40:01.672156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m04:40:01.672921 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m04:40:01.706062 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m04:40:01.707368 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 04:40:01.673409 => 04:40:01.706967
[0m04:40:01.708006 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m04:40:01.756582 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:01.757596 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
WITH 
    -- union the web sales and catalog sales data into one view
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happen, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the date surrogate key for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m04:40:01.758619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:40:02.376536 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:40:02.382241 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.383017 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m04:40:02.493321 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:40:02.500258 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.500976 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m04:40:02.558187 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:40:02.571886 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.572772 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m04:40:02.627088 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:40:02.669839 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.672606 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.673253 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m04:40:02.749229 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:40:02.750133 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:40:02.750891 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m04:40:03.617070 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153b8-0001-927b-0004-d6ae000cfb1a
[0m04:40:03.617929 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:40:03.618928 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 04:40:01.708413 => 04:40:03.618524
[0m04:40:03.619613 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m04:40:03.662929 [debug] [Thread-1 (]: Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:40:03.664293 [error] [Thread-1 (]: 11 of 17 ERROR creating sql incremental model intermediate.int__daily_aggregated_sales  [[31mERROR[0m in 1.99s]
[0m04:40:03.665400 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m04:40:03.666227 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m04:40:03.667302 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m04:40:03.668794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m04:40:03.669511 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m04:40:03.680439 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m04:40:03.681783 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 04:40:03.669926 => 04:40:03.681373
[0m04:40:03.682503 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m04:40:03.692101 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:03.693075 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    
-- pull custome attributes together
SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m04:40:03.693849 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:40:04.638502 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:40:04.644333 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:04.645180 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m04:40:04.761610 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:40:04.770693 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:04.771512 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m04:40:04.831430 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:40:04.840736 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:04.841580 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m04:40:04.928486 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:40:04.938095 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m04:40:04.942412 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:04.943146 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m04:40:05.088774 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:40:05.089633 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:40:05.090479 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m04:40:09.176274 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153b8-0001-92fc-0004-d6ae000d556e
[0m04:40:09.177095 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:40:09.177978 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 04:40:03.682920 => 04:40:09.177603
[0m04:40:09.178681 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m04:40:09.221100 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:40:09.222488 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 5.55s]
[0m04:40:09.223537 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m04:40:09.224318 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:40:09.225238 [info ] [Thread-1 (]: 13 of 17 SKIP test not_null_int__daily_aggregated_sales_item_sk ................ [[33mSKIP[0m]
[0m04:40:09.226046 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:40:09.226784 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:40:09.227602 [info ] [Thread-1 (]: 14 of 17 SKIP test not_null_int__daily_aggregated_sales_warehouse_sk ........... [[33mSKIP[0m]
[0m04:40:09.228460 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:40:09.229196 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:40:09.229876 [info ] [Thread-1 (]: 15 of 17 SKIP test not_null_int__daily_aggregated_sales_wk_num ................. [[33mSKIP[0m]
[0m04:40:09.230820 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:40:09.231538 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:40:09.232368 [info ] [Thread-1 (]: 16 of 17 SKIP test not_null_int__daily_aggregated_sales_yr_num ................. [[33mSKIP[0m]
[0m04:40:09.233130 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:40:09.234513 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m04:40:09.235223 [info ] [Thread-1 (]: 17 of 17 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m04:40:09.236010 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m04:40:09.238500 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:40:09.239077 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m04:40:09.239743 [info ] [MainThread]: 
[0m04:40:09.240373 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 18.24 seconds (18.24s).
[0m04:40:09.244198 [debug] [MainThread]: Command end result
[0m04:40:09.265835 [info ] [MainThread]: 
[0m04:40:09.266704 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m04:40:09.267291 [info ] [MainThread]: 
[0m04:40:09.267884 [error] [MainThread]:   Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:40:09.268478 [info ] [MainThread]: 
[0m04:40:09.269122 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:40:09.269736 [info ] [MainThread]: 
[0m04:40:09.270393 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=5 TOTAL=17
[0m04:40:09.271800 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 19.408808, "process_user_time": 7.315653, "process_kernel_time": 0.295212, "process_mem_max_rss": "167560", "process_out_blocks": "4048", "command_success": false, "process_in_blocks": "0"}
[0m04:40:09.272703 [debug] [MainThread]: Command `dbt build` failed at 04:40:09.272474 after 19.41 seconds
[0m04:40:09.273333 [debug] [MainThread]: Flushing usage events


============================== 04:56:59.762633 | 082f4e77-5877-4ce2-812d-ad4e3e1998bc ==============================
[0m04:56:59.762633 [info ] [MainThread]: Running with dbt=1.7.3
[0m04:56:59.766478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/ubuntu/capstone_dbt_project/capstone/logs', 'fail_fast': 'False', 'profiles_dir': '/home/ubuntu/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'log_format': '{{run_started_at}} | {{run_status}} | {{run_duration}} | {{run_end_at}} | {{target_name}} | {{run_timestamp}} | {{dbt_version}} | {{dbt_cmd}}', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m04:57:00.714641 [info ] [MainThread]: Registered adapter: snowflake=1.7.1
[0m04:57:00.747197 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m04:57:00.826122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:57:00.826877 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:57:00.861882 [info ] [MainThread]: Found 12 models, 1 snapshot, 4 tests, 9 sources, 0 exposures, 0 metrics, 805 macros, 0 groups, 0 semantic models
[0m04:57:00.865049 [info ] [MainThread]: 
[0m04:57:00.866550 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:57:00.868968 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_tpcds'
[0m04:57:00.890394 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:57:00.891306 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:57:00.891932 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:57:03.337595 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 2.0 seconds
[0m04:57:03.340163 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:57:03.396510 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:57:03.397361 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:57:03.397904 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:57:03.765596 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m04:57:03.768147 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:57:03.815218 [debug] [ThreadPool]: Using snowflake connection "list_tpcds"
[0m04:57:03.816208 [debug] [ThreadPool]: On list_tpcds: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds"} */
show terse schemas in database tpcds
    limit 10000
[0m04:57:03.816782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:57:04.175546 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m04:57:04.177962 [debug] [ThreadPool]: On list_tpcds: Close
[0m04:57:04.246411 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds, now list_tpcds_staging)
[0m04:57:04.259820 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_staging"
[0m04:57:04.260562 [debug] [ThreadPool]: On list_tpcds_staging: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_staging"} */
show terse objects in tpcds.staging limit 10000
[0m04:57:04.261084 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:57:04.532939 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m04:57:04.535898 [debug] [ThreadPool]: On list_tpcds_staging: Close
[0m04:57:04.588919 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_staging, now list_tpcds_intermediate)
[0m04:57:04.597705 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_intermediate"
[0m04:57:04.598370 [debug] [ThreadPool]: On list_tpcds_intermediate: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_intermediate"} */
show terse objects in tpcds.intermediate limit 10000
[0m04:57:04.598895 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:57:04.884523 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:04.886977 [debug] [ThreadPool]: On list_tpcds_intermediate: Close
[0m04:57:04.931041 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_tpcds_intermediate, now list_tpcds_analytics)
[0m04:57:04.936379 [debug] [ThreadPool]: Using snowflake connection "list_tpcds_analytics"
[0m04:57:04.937031 [debug] [ThreadPool]: On list_tpcds_analytics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "connection_name": "list_tpcds_analytics"} */
show terse objects in tpcds.analytics limit 10000
[0m04:57:04.937554 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:57:05.234242 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m04:57:05.236748 [debug] [ThreadPool]: On list_tpcds_analytics: Close
[0m04:57:05.290536 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:57:05.291259 [info ] [MainThread]: 
[0m04:57:05.294593 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__catalog_sales
[0m04:57:05.295459 [info ] [Thread-1 (]: 1 of 17 START sql view model staging.stg_tpcds__catalog_sales .................. [RUN]
[0m04:57:05.296601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_tpcds_analytics, now model.capstone.stg_tpcds__catalog_sales)
[0m04:57:05.297228 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__catalog_sales
[0m04:57:05.310970 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:57:05.312203 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (compile): 04:57:05.297624 => 04:57:05.311819
[0m04:57:05.312876 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__catalog_sales
[0m04:57:05.354469 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__catalog_sales"
[0m04:57:05.357534 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__catalog_sales"
[0m04:57:05.358366 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__catalog_sales"} */
create or replace   view tpcds.staging.stg_tpcds__catalog_sales
  
   as (
    
-- rename the source columns
SELECT 
    CS_WAREHOUSE_SK AS WAREHOUSE_SK,
    CS_SHIP_DATE_SK AS SHIP_DATE_SK,
    CS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
    CS_QUANTITY AS QUANTITY,
    CS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
    CS_SOLD_TIME_SK AS SOLD_TIME_SK,
    CS_PROMO_SK AS PROMO_SK,
    CS_LIST_PRICE AS LIST_PRICE,
    CS_EXT_SHIP_COST AS EXT_SHIP_COST,
    CS_NET_PAID AS NET_PAID,
    CS_SOLD_DATE_SK AS SOLD_DATE_SK,
    CS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
    CS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
    CS_EXT_TAX AS EXT_TAX,
    CS_CATALOG_PAGE_SK AS CATALOG_PAGE_SK,
    CS_NET_PROFIT AS NET_PROFIT,
    CS_ITEM_SK AS ITEM_SK,
    CS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
    CS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
    CS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
    CS_COUPON_AMT AS COUPON_AMT,
    CS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
    CS_ORDER_NUMBER AS ORDER_NUMBER,
    CS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
    CS_SHIP_MODE_SK AS SHIP_MODE_SK,
    CS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
    CS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
    CS_BILL_ADDR_SK AS BILL_ADDR_SK,
    CS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
    CS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
    CS_WHOLESALE_COST AS WHOLESALE_COST,
    CS_SALES_PRICE AS SALES_PRICE,
    CS_CALL_CENTER_SK AS CALL_CENTER_SK,
    CS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,    
    _AIRBYTE_NORMALIZED_AT
FROM 
    tpcds.raw.catalog_sales
  );
[0m04:57:05.359060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:05.769197 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:05.800786 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__catalog_sales (execute): 04:57:05.313277 => 04:57:05.800395
[0m04:57:05.801575 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__catalog_sales: Close
[0m04:57:05.856495 [info ] [Thread-1 (]: 1 of 17 OK created sql view model staging.stg_tpcds__catalog_sales ............. [[32mSUCCESS 1[0m in 0.56s]
[0m04:57:05.857697 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__catalog_sales
[0m04:57:05.858454 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer
[0m04:57:05.859430 [info ] [Thread-1 (]: 2 of 17 START sql view model staging.stg_tpcds__customer ....................... [RUN]
[0m04:57:05.860492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__catalog_sales, now model.capstone.stg_tpcds__customer)
[0m04:57:05.861121 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer
[0m04:57:05.866838 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer"
[0m04:57:05.867981 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (compile): 04:57:05.861515 => 04:57:05.867602
[0m04:57:05.868636 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer
[0m04:57:05.874937 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer"
[0m04:57:05.877159 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer"
[0m04:57:05.877844 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer"} */
create or replace   view tpcds.staging.stg_tpcds__customer
  
   as (
    -- rename the source columns
SELECT 
    C_SALUTATION AS SALUTATION,
    C_PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    C_FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    C_CUSTOMER_SK AS CUSTOMER_SK,
    C_LOGIN AS LOGIN,
    C_CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    C_FIRST_NAME AS FIRST_NAME,
    C_CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    C_CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    C_LAST_NAME AS LAST_NAME,
    C_CUSTOMER_ID AS CUSTOMER_ID,
    C_LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    C_BIRTH_MONTH AS BIRTH_MONTH,
    C_BIRTH_COUNTRY AS BIRTH_COUNTRY,
    C_BIRTH_YEAR AS BIRTH_YEAR,
    C_BIRTH_DAY AS BIRTH_DAY,
    C_EMAIL_ADDRESS AS EMAIL_ADDRESS,
    C_FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.customer
  );
[0m04:57:05.878537 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:06.281263 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:06.285483 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer (execute): 04:57:05.869052 => 04:57:06.285122
[0m04:57:06.286198 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer: Close
[0m04:57:06.337750 [info ] [Thread-1 (]: 2 of 17 OK created sql view model staging.stg_tpcds__customer .................. [[32mSUCCESS 1[0m in 0.48s]
[0m04:57:06.339005 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer
[0m04:57:06.339761 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_address
[0m04:57:06.340705 [info ] [Thread-1 (]: 3 of 17 START sql view model staging.stg_tpcds__customer_address ............... [RUN]
[0m04:57:06.342010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer, now model.capstone.stg_tpcds__customer_address)
[0m04:57:06.342698 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_address
[0m04:57:06.348401 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_address"
[0m04:57:06.349519 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (compile): 04:57:06.343108 => 04:57:06.349123
[0m04:57:06.350238 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_address
[0m04:57:06.356128 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_address"
[0m04:57:06.357899 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_address"
[0m04:57:06.358620 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_address"} */
create or replace   view tpcds.staging.stg_tpcds__customer_address
  
   as (
    -- rename the source columns
SELECT
    CA_STREET_NAME AS STREET_NAME,
    CA_SUITE_NUMBER AS SUITE_NUMBER,
    CA_STATE AS STATE,
    CA_LOCATION_TYPE AS LOCATION_TYPE,
    CA_ADDRESS_SK AS ADDRESS_SK,
    CA_COUNTRY AS COUNTRY,
    CA_ADDRESS_ID AS ADDRESS_ID,
    CA_COUNTY AS COUNTY,
    CA_STREET_NUMBER AS STREET_NUMBER,
    CA_ZIP AS ZIP,
    CA_CITY AS CITY,
    CA_STREET_TYPE AS STREET_TYPE,
    CA_GMT_OFFSET AS GMT_OFFSET
FROM 
    tpcds.raw.customer_address
  );
[0m04:57:06.359277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:06.802096 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:06.806438 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_address (execute): 04:57:06.350653 => 04:57:06.806058
[0m04:57:06.807171 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_address: Close
[0m04:57:06.852939 [info ] [Thread-1 (]: 3 of 17 OK created sql view model staging.stg_tpcds__customer_address .......... [[32mSUCCESS 1[0m in 0.51s]
[0m04:57:06.854186 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_address
[0m04:57:06.854929 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__customer_demographics
[0m04:57:06.855880 [info ] [Thread-1 (]: 4 of 17 START sql view model staging.stg_tpcds__customer_demographics .......... [RUN]
[0m04:57:06.856972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_address, now model.capstone.stg_tpcds__customer_demographics)
[0m04:57:06.857593 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__customer_demographics
[0m04:57:06.863333 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:57:06.864430 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (compile): 04:57:06.857994 => 04:57:06.864050
[0m04:57:06.865118 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__customer_demographics
[0m04:57:06.873063 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__customer_demographics"
[0m04:57:06.874889 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__customer_demographics"
[0m04:57:06.875569 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__customer_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__customer_demographics
  
   as (
    -- rename the source columns
SELECT
    CD_DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    CD_DEMO_SK AS DEMO_SK,
    CD_DEP_COUNT AS DEP_COUNT,
    CD_CREDIT_RATING AS CREDIT_RATING,
    CD_EDUCATION_STATUS AS EDUCATION_STATUS,
    CD_PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    CD_MARITAL_STATUS AS MARITAL_STATUS,
    CD_DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    CD_GENDER AS GENDER
FROM 
    tpcds.raw.customer_demographics
  );
[0m04:57:06.876197 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:07.291116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:07.295395 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__customer_demographics (execute): 04:57:06.865515 => 04:57:07.295018
[0m04:57:07.296078 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__customer_demographics: Close
[0m04:57:07.345759 [info ] [Thread-1 (]: 4 of 17 OK created sql view model staging.stg_tpcds__customer_demographics ..... [[32mSUCCESS 1[0m in 0.49s]
[0m04:57:07.346948 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__customer_demographics
[0m04:57:07.347671 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__date_dim
[0m04:57:07.348558 [info ] [Thread-1 (]: 5 of 17 START sql view model staging.stg_tpcds__date_dim ....................... [RUN]
[0m04:57:07.349584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__customer_demographics, now model.capstone.stg_tpcds__date_dim)
[0m04:57:07.350239 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__date_dim
[0m04:57:07.355852 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__date_dim"
[0m04:57:07.356974 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (compile): 04:57:07.350634 => 04:57:07.356600
[0m04:57:07.357610 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__date_dim
[0m04:57:07.363482 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__date_dim"
[0m04:57:07.364922 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__date_dim"
[0m04:57:07.365551 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__date_dim"} */
create or replace   view tpcds.staging.stg_tpcds__date_dim
  
   as (
    -- rename the source columns
SELECT 
    D_DATE_ID AS DATE_ID, 
    CAL_DT, 
    DAY_OF_WK_DESC, 
    WK_NUM, 
    MNTH_NUM, 
    YR_MNTH_NUM, 
    D_DATE_SK, 
    YR_NUM, 
    DAY_OF_WK_NUM, 
    YR_WK_NUM, 
    _AIRBYTE_NORMALIZED_AT
FROM tpcds.raw.date_dim
  );
[0m04:57:07.366201 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:07.793755 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:07.797956 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__date_dim (execute): 04:57:07.358007 => 04:57:07.797586
[0m04:57:07.798665 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__date_dim: Close
[0m04:57:07.843818 [info ] [Thread-1 (]: 5 of 17 OK created sql view model staging.stg_tpcds__date_dim .................. [[32mSUCCESS 1[0m in 0.49s]
[0m04:57:07.845006 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__date_dim
[0m04:57:07.845758 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__household_demographics
[0m04:57:07.846705 [info ] [Thread-1 (]: 6 of 17 START sql view model staging.stg_tpcds__household_demographics ......... [RUN]
[0m04:57:07.847819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__date_dim, now model.capstone.stg_tpcds__household_demographics)
[0m04:57:07.848458 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__household_demographics
[0m04:57:07.854095 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__household_demographics"
[0m04:57:07.855202 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (compile): 04:57:07.848857 => 04:57:07.854815
[0m04:57:07.855860 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__household_demographics
[0m04:57:07.863578 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__household_demographics"
[0m04:57:07.865182 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__household_demographics"
[0m04:57:07.865862 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__household_demographics"} */
create or replace   view tpcds.staging.stg_tpcds__household_demographics
  
   as (
    -- rename the source columns
SELECT
    HD_BUY_POTENTIAL AS BUY_POTENTIAL, 
    HD_INCOME_BAND_SK AS INCOME_BAND_SK, 
    HD_DEMO_SK AS DEMO_SK, 
    HD_DEP_COUNT AS DEP_COUNT, 
    HD_VEHICLE_COUNT AS VEHICLE_COUNT
FROM 
    tpcds.raw.household_demographics
  );
[0m04:57:07.866536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:08.238095 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:08.242460 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__household_demographics (execute): 04:57:07.856254 => 04:57:08.242075
[0m04:57:08.243159 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__household_demographics: Close
[0m04:57:08.287667 [info ] [Thread-1 (]: 6 of 17 OK created sql view model staging.stg_tpcds__household_demographics .... [[32mSUCCESS 1[0m in 0.44s]
[0m04:57:08.288888 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__household_demographics
[0m04:57:08.289654 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__income_band
[0m04:57:08.290566 [info ] [Thread-1 (]: 7 of 17 START sql view model staging.stg_tpcds__income_band .................... [RUN]
[0m04:57:08.291638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__household_demographics, now model.capstone.stg_tpcds__income_band)
[0m04:57:08.292315 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__income_band
[0m04:57:08.298184 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__income_band"
[0m04:57:08.299328 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (compile): 04:57:08.292779 => 04:57:08.298942
[0m04:57:08.300005 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__income_band
[0m04:57:08.305780 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__income_band"
[0m04:57:08.307188 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__income_band"
[0m04:57:08.307843 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__income_band"} */
create or replace   view tpcds.staging.stg_tpcds__income_band
  
   as (
    -- rename the source columns
SELECT 
    IB_LOWER_BOUND AS LOWER_BOUND,
    IB_INCOME_BAND_SK AS INCOME_BAND_SK,
    IB_UPPER_BOUND AS UPPER_BOUND
FROM
    tpcds.raw.income_band
  );
[0m04:57:08.308480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:08.676834 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:08.681127 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__income_band (execute): 04:57:08.300421 => 04:57:08.680761
[0m04:57:08.681826 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__income_band: Close
[0m04:57:08.721395 [info ] [Thread-1 (]: 7 of 17 OK created sql view model staging.stg_tpcds__income_band ............... [[32mSUCCESS 1[0m in 0.43s]
[0m04:57:08.722612 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__income_band
[0m04:57:08.723348 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__inventory
[0m04:57:08.724223 [info ] [Thread-1 (]: 8 of 17 START sql view model staging.stg_tpcds__inventory ...................... [RUN]
[0m04:57:08.725355 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__income_band, now model.capstone.stg_tpcds__inventory)
[0m04:57:08.725994 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__inventory
[0m04:57:08.733421 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__inventory"
[0m04:57:08.734650 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (compile): 04:57:08.726433 => 04:57:08.734266
[0m04:57:08.735327 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__inventory
[0m04:57:08.741387 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__inventory"
[0m04:57:08.742928 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__inventory"
[0m04:57:08.743568 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__inventory"} */
create or replace   view tpcds.staging.stg_tpcds__inventory
  
   as (
    -- rename columns by removing the prefix
SELECT 
    INV_DATE_SK AS DATE_SK,
    INV_ITEM_SK AS ITEM_SK,
    INV_QUANTITY_ON_HAND AS QUANTITY_ON_HAND,
    INV_WAREHOUSE_SK AS WAREHOUSE_SK
FROM
    tpcds.raw.inventory
  );
[0m04:57:08.744190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:09.185180 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:09.189525 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__inventory (execute): 04:57:08.735717 => 04:57:09.189144
[0m04:57:09.190256 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__inventory: Close
[0m04:57:09.240524 [info ] [Thread-1 (]: 8 of 17 OK created sql view model staging.stg_tpcds__inventory ................. [[32mSUCCESS 1[0m in 0.52s]
[0m04:57:09.241706 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__inventory
[0m04:57:09.242493 [debug] [Thread-1 (]: Began running node model.capstone.stg_tpcds__web_sales
[0m04:57:09.243242 [info ] [Thread-1 (]: 9 of 17 START sql view model staging.stg_tpcds__web_sales ...................... [RUN]
[0m04:57:09.244492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__inventory, now model.capstone.stg_tpcds__web_sales)
[0m04:57:09.245118 [debug] [Thread-1 (]: Began compiling node model.capstone.stg_tpcds__web_sales
[0m04:57:09.251020 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.stg_tpcds__web_sales"
[0m04:57:09.252167 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (compile): 04:57:09.245519 => 04:57:09.251774
[0m04:57:09.252824 [debug] [Thread-1 (]: Began executing node model.capstone.stg_tpcds__web_sales
[0m04:57:09.258954 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.stg_tpcds__web_sales"
[0m04:57:09.261782 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.stg_tpcds__web_sales"
[0m04:57:09.262546 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.stg_tpcds__web_sales"} */
create or replace   view tpcds.staging.stg_tpcds__web_sales
  
   as (
    -- rename the source columns
SELECT
   WS_ORDER_NUMBER AS ORDER_NUMBER,
   WS_SHIP_MODE_SK AS SHIP_MODE_SK,
   WS_SOLD_TIME_SK AS SOLD_TIME_SK,
   WS_SHIP_ADDR_SK AS SHIP_ADDR_SK,
   WS_NET_PAID_INC_TAX AS NET_PAID_INC_TAX,
   WS_PROMO_SK AS PROMO_SK,
   WS_NET_PAID_INC_SHIP AS NET_PAID_INC_SHIP,
   WS_QUANTITY AS QUANTITY,
   WS_EXT_SALES_PRICE AS EXT_SALES_PRICE,
   WS_WEB_SITE_SK AS WEB_SITE_SK,
   WS_SHIP_DATE_SK AS SHIP_DATE_SK,
   WS_BILL_CDEMO_SK AS BILL_CDEMO_SK,
   WS_NET_PROFIT AS NET_PROFIT,
   WS_NET_PAID AS NET_PAID,
   WS_EXT_SHIP_COST AS EXT_SHIP_COST,
   WS_BILL_CUSTOMER_SK AS BILL_CUSTOMER_SK,
   WS_COUPON_AMT AS COUPON_AMT,
   WS_WHOLESALE_COST AS WHOLESALE_COST,
   WS_SHIP_CUSTOMER_SK AS SHIP_CUSTOMER_SK,
   WS_BILL_HDEMO_SK AS BILL_HDEMO_SK,
   WS_SOLD_DATE_SK AS SOLD_DATE_SK,
   WS_SHIP_CDEMO_SK AS SHIP_CDEMO_SK,
   WS_WAREHOUSE_SK AS WAREHOUSE_SK,
   WS_EXT_TAX AS EXT_TAX,
   WS_ITEM_SK AS ITEM_SK,
   WS_SHIP_HDEMO_SK AS SHIP_HDEMO_SK,
   WS_EXT_WHOLESALE_COST AS EXT_WHOLESALE_COST,
   WS_NET_PAID_INC_SHIP_TAX AS NET_PAID_INC_SHIP_TAX,
   WS_EXT_DISCOUNT_AMT AS EXT_DISCOUNT_AMT,
   WS_SALES_PRICE AS SALES_PRICE,
   WS_WEB_PAGE_SK AS WEB_PAGE_SK,
   WS_EXT_LIST_PRICE AS EXT_LIST_PRICE,
   WS_LIST_PRICE AS LIST_PRICE,
   WS_BILL_ADDR_SK AS BILL_ADDR_SK, 
   _AIRBYTE_NORMALIZED_AT
FROM
    tpcds.raw.web_sales
  );
[0m04:57:09.263238 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:09.683421 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:09.687605 [debug] [Thread-1 (]: Timing info for model.capstone.stg_tpcds__web_sales (execute): 04:57:09.253215 => 04:57:09.687235
[0m04:57:09.688263 [debug] [Thread-1 (]: On model.capstone.stg_tpcds__web_sales: Close
[0m04:57:09.729487 [info ] [Thread-1 (]: 9 of 17 OK created sql view model staging.stg_tpcds__web_sales ................. [[32mSUCCESS 1[0m in 0.48s]
[0m04:57:09.730704 [debug] [Thread-1 (]: Finished running node model.capstone.stg_tpcds__web_sales
[0m04:57:09.731444 [debug] [Thread-1 (]: Began running node snapshot.capstone.customer_snapshot
[0m04:57:09.732304 [info ] [Thread-1 (]: 10 of 17 START snapshot intermediate.customer_snapshot ......................... [RUN]
[0m04:57:09.733699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.stg_tpcds__web_sales, now snapshot.capstone.customer_snapshot)
[0m04:57:09.734382 [debug] [Thread-1 (]: Began compiling node snapshot.capstone.customer_snapshot
[0m04:57:09.741894 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (compile): 04:57:09.734784 => 04:57:09.741447
[0m04:57:09.742650 [debug] [Thread-1 (]: Began executing node snapshot.capstone.customer_snapshot
[0m04:57:09.831594 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.capstone.customer_snapshot"
[0m04:57:09.834250 [debug] [Thread-1 (]: Using snowflake connection "snapshot.capstone.customer_snapshot"
[0m04:57:09.834952 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "snapshot.capstone.customer_snapshot"} */
create or replace transient table tpcds.intermediate.customer_snapshot
         as
        (

    select *,
        md5(coalesce(cast(CUSTOMER_SK as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



SELECT 
    SALUTATION,
    PREFERRED_CUST_FLAG,
    FIRST_SALES_DATE_SK,
    CUSTOMER_SK,
    LOGIN,
    CURRENT_CDEMO_SK,
    FIRST_NAME,
    CURRENT_HDEMO_SK,
    CURRENT_ADDR_SK,
    LAST_NAME,
    CUSTOMER_ID,
    LAST_REVIEW_DATE_SK,
    BIRTH_MONTH,
    BIRTH_COUNTRY,
    BIRTH_YEAR,
    BIRTH_DAY,
    EMAIL_ADDRESS,
    FIRST_SHIPTO_DATE_SK,
    _AIRBYTE_NORMALIZED_AT 
FROM
    tpcds.staging.stg_tpcds__customer

    ) sbq



        );
[0m04:57:09.835612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:11.955060 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m04:57:11.964082 [debug] [Thread-1 (]: Timing info for snapshot.capstone.customer_snapshot (execute): 04:57:09.743047 => 04:57:11.963721
[0m04:57:11.964766 [debug] [Thread-1 (]: On snapshot.capstone.customer_snapshot: Close
[0m04:57:12.008020 [info ] [Thread-1 (]: 10 of 17 OK snapshotted intermediate.customer_snapshot ......................... [[32mSUCCESS 1[0m in 2.27s]
[0m04:57:12.009197 [debug] [Thread-1 (]: Finished running node snapshot.capstone.customer_snapshot
[0m04:57:12.009945 [debug] [Thread-1 (]: Began running node model.capstone.int__daily_aggregated_sales
[0m04:57:12.010860 [info ] [Thread-1 (]: 11 of 17 START sql incremental model intermediate.int__daily_aggregated_sales .. [RUN]
[0m04:57:12.012142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.capstone.customer_snapshot, now model.capstone.int__daily_aggregated_sales)
[0m04:57:12.012784 [debug] [Thread-1 (]: Began compiling node model.capstone.int__daily_aggregated_sales
[0m04:57:12.046595 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.047891 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (compile): 04:57:12.013181 => 04:57:12.047498
[0m04:57:12.048559 [debug] [Thread-1 (]: Began executing node model.capstone.int__daily_aggregated_sales
[0m04:57:12.100072 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.101085 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
create or replace  temporary view tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
  
   as (
    
WITH 
    -- union the web sales and catalog sales data into one view
    cs_ws_union AS
        (
        /* assumes order_number is the atomic level, extract order_number to make sure all transactions are pulled,
            so that even 2 similar transactions (same item, same warehouse, same date and quantity, different order no.)
            happen, both rows of data are extracted.
            use distinct to avoid duplicate */
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            SALES_PRICE * QUANTITY AS sales_amt
        FROM tpcds.staging.stg_tpcds__web_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        UNION
        SELECT DISTINCT
            ORDER_NUMBER AS order_number,
            ITEM_SK AS item_sk,
            WAREHOUSE_SK AS warehouse_sk,
            SOLD_DATE_SK as sold_date_sk,
            QUANTITY as quantity,
            NET_PROFIT as net_profit,
            SALES_PRICE as sales_price,
            sales_price * quantity AS sales_amt
        FROM tpcds.staging.stg_tpcds__catalog_sales
        WHERE 
            quantity IS NOT NULL
            AND sales_amt IS NOT NULL
            AND WAREHOUSE_SK IS NOT NULL
        ),
    -- aggregate all the sales data to daily level
    daily_agg AS
        (
            select 
                item_sk,
                warehouse_sk,
                sold_date_sk,
                sum(quantity) AS daily_quantity,
                SUM(net_profit) AS daily_net_profit,
                SUM(sales_amt) AS daily_sales_amt
            From cs_ws_union
             

            WHERE 
            sold_date_sk >= NVL((select MAX(sold_date_sk) from tpcds.intermediate.int__daily_aggregated_sales), 0)

            
            GROUP BY 1, 2, 3
        ),
    -- get the date surrogate key for the first day/begin of week (bow) 
    bow as 
        (
            select 
                wk_num, 
                yr_num, 
                d_date_sk as bow_sk,
                cal_dt as cal_date
            from tpcds.staging.stg_tpcds__date_dim
            where day_of_wk_num = 0)
    -- add the bow sk to the daily table
SELECT 
    item_sk, 
    warehouse_sk, 
    sold_date_sk, 
    md5(cast(coalesce(cast(item_sk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_sk as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as item_warehouse_sk,
    dt.cal_dt as sold_cal_date,
    daily_quantity, 
    daily_net_profit, 
    daily_sales_amt,
    dt.wk_num as wk_num, 
    dt.yr_num as yr_num,
    bow.bow_sk AS sold_date_bow_sk,
    bow.cal_date as sold_date_bow_cal_date
FROM daily_agg
INNER JOIN tpcds.staging.stg_tpcds__date_dim AS dt 
    ON daily_agg.sold_date_sk = dt.d_date_sk 
INNER JOIN bow 
    ON dt.wk_num = bow.wk_num AND dt.yr_num = bow.yr_num
  );
[0m04:57:12.101894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:12.606876 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:57:12.621309 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.622110 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp
[0m04:57:12.668424 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:57:12.675515 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.676223 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table tpcds.intermediate.int__daily_aggregated_sales
[0m04:57:12.737952 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:57:12.751404 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.752242 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
describe table "TPCDS"."INTERMEDIATE"."INT__DAILY_AGGREGATED_SALES"
[0m04:57:12.787981 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m04:57:12.835080 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.838084 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.838810 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
-- back compat for old kwarg name
  
  begin;
[0m04:57:12.891381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:12.892227 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.int__daily_aggregated_sales"
[0m04:57:12.892941 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.int__daily_aggregated_sales"} */
merge into tpcds.intermediate.int__daily_aggregated_sales as DBT_INTERNAL_DEST
        using tpcds.intermediate.int__daily_aggregated_sales__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.warehouse_sk = DBT_INTERNAL_DEST.warehouse_sk
                ) and (
                    DBT_INTERNAL_SOURCE.item_sk = DBT_INTERNAL_DEST.item_sk
                ) and (
                    DBT_INTERNAL_SOURCE.sold_date_sk = DBT_INTERNAL_DEST.sold_date_sk
                )

    
    when matched then update set
        "ITEM_SK" = DBT_INTERNAL_SOURCE."ITEM_SK","WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."WAREHOUSE_SK","SOLD_DATE_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_SK","ITEM_WAREHOUSE_SK" = DBT_INTERNAL_SOURCE."ITEM_WAREHOUSE_SK","SOLD_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_CAL_DATE","DAILY_QUANTITY" = DBT_INTERNAL_SOURCE."DAILY_QUANTITY","DAILY_NET_PROFIT" = DBT_INTERNAL_SOURCE."DAILY_NET_PROFIT","DAILY_SALES_AMT" = DBT_INTERNAL_SOURCE."DAILY_SALES_AMT","WK_NUM" = DBT_INTERNAL_SOURCE."WK_NUM","YR_NUM" = DBT_INTERNAL_SOURCE."YR_NUM","SOLD_DATE_BOW_SK" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_SK","SOLD_DATE_BOW_CAL_DATE" = DBT_INTERNAL_SOURCE."SOLD_DATE_BOW_CAL_DATE"
    

    when not matched then insert
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")
    values
        ("ITEM_SK", "WAREHOUSE_SK", "SOLD_DATE_SK", "ITEM_WAREHOUSE_SK", "SOLD_CAL_DATE", "DAILY_QUANTITY", "DAILY_NET_PROFIT", "DAILY_SALES_AMT", "WK_NUM", "YR_NUM", "SOLD_DATE_BOW_SK", "SOLD_DATE_BOW_CAL_DATE")

;
[0m04:57:13.712475 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153c9-0001-92fc-0004-d6ae000d56ba
[0m04:57:13.713313 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:57:13.714322 [debug] [Thread-1 (]: Timing info for model.capstone.int__daily_aggregated_sales (execute): 04:57:12.048964 => 04:57:13.713865
[0m04:57:13.715015 [debug] [Thread-1 (]: On model.capstone.int__daily_aggregated_sales: Close
[0m04:57:13.762838 [debug] [Thread-1 (]: Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:57:13.764144 [error] [Thread-1 (]: 11 of 17 ERROR creating sql incremental model intermediate.int__daily_aggregated_sales  [[31mERROR[0m in 1.75s]
[0m04:57:13.765231 [debug] [Thread-1 (]: Finished running node model.capstone.int__daily_aggregated_sales
[0m04:57:13.766040 [debug] [Thread-1 (]: Began running node model.capstone.customer_dim
[0m04:57:13.767093 [info ] [Thread-1 (]: 12 of 17 START sql incremental model analytics.customer_dim .................... [RUN]
[0m04:57:13.768644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.capstone.int__daily_aggregated_sales, now model.capstone.customer_dim)
[0m04:57:13.769302 [debug] [Thread-1 (]: Began compiling node model.capstone.customer_dim
[0m04:57:13.777481 [debug] [Thread-1 (]: Writing injected SQL for node "model.capstone.customer_dim"
[0m04:57:13.778630 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (compile): 04:57:13.769716 => 04:57:13.778250
[0m04:57:13.779260 [debug] [Thread-1 (]: Began executing node model.capstone.customer_dim
[0m04:57:13.790519 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:13.791373 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
create or replace  temporary view tpcds.analytics.customer_dim__dbt_tmp
  
   as (
    
-- pull custome attributes together
SELECT 
    IC.SALUTATION AS SALUTATION,
    IC.PREFERRED_CUST_FLAG AS PREFERRED_CUST_FLAG,
    IC.FIRST_SALES_DATE_SK AS FIRST_SALES_DATE_SK,
    IC.CUSTOMER_SK AS CUSTOMER_SK,
    IC.LOGIN AS LOGIN,
    IC.CURRENT_CDEMO_SK AS CURRENT_CDEMO_SK,
    IC.FIRST_NAME AS FIRST_NAME,
    IC.CURRENT_HDEMO_SK AS CURRENT_HDEMO_SK,
    IC.CURRENT_ADDR_SK AS CURRENT_ADDR_SK,
    IC.LAST_NAME AS LAST_NAME,
    IC.CUSTOMER_ID AS CUSTOMER_ID,
    IC.LAST_REVIEW_DATE_SK AS LAST_REVIEW_DATE_SK,
    IC.BIRTH_MONTH AS BIRTH_MONTH,
    IC.BIRTH_COUNTRY AS BIRTH_COUNTRY,
    IC.BIRTH_YEAR AS BIRTH_YEAR,
    IC.BIRTH_DAY AS BIRTH_DAY,
    IC.EMAIL_ADDRESS AS EMAIL_ADDRESS,
    IC.FIRST_SHIPTO_DATE_SK AS FIRST_SHIPTO_DATE_SK,
    RCA.STREET_NAME AS STREET_NAME,
    RCA.SUITE_NUMBER AS SUITE_NUMBER,
    RCA.STATE AS STATE,
    RCA.LOCATION_TYPE AS LOCATION_TYPE,
    RCA.COUNTRY AS COUNTRY,
    RCA.ADDRESS_ID AS ADDRESS_ID,
    RCA.COUNTY AS COUNTY,
    RCA.STREET_NUMBER AS STREET_NUMBER,
    RCA.ZIP AS ZIP,
    RCA.CITY AS CITY,
    RCA.GMT_OFFSET AS GMT_OFFSET,
    RCD.DEP_EMPLOYED_COUNT AS DEP_EMPLOYED_COUNT,
    RCD.DEP_COUNT AS DEP_COUNT,
    RCD.CREDIT_RATING AS CREDIT_RATING,
    RCD.EDUCATION_STATUS AS EDUCATION_STATUS,
    RCD.PURCHASE_ESTIMATE AS PURCHASE_ESTIMATE,
    RCD.MARITAL_STATUS AS MARITAL_STATUS,
    RCD.DEP_COLLEGE_COUNT AS DEP_COLLEGE_COUNT,
    RCD.GENDER AS GENDER,
    RHD.BUY_POTENTIAL AS BUY_POTENTIAL,
    RHD.VEHICLE_COUNT AS VEHICLE_COUNT,
    RHD.INCOME_BAND_SK AS INCOME_BAND_SK,
    RI.LOWER_BOUND AS LOWER_BOUND,
    RI.UPPER_BOUND AS UPPER_BOUND,
    IC.DBT_VALID_FROM AS START_DATE,
    IC.DBT_VALID_TO AS END_DATE
 FROM tpcds.intermediate.customer_snapshot AS IC
 LEFT JOIN tpcds.staging.stg_tpcds__customer_address AS RCA 
    ON IC.CURRENT_ADDR_SK = RCA.ADDRESS_SK
 LEFT JOIN tpcds.staging.stg_tpcds__customer_demographics AS RCD 
    ON IC.CURRENT_CDEMO_SK = RCD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__household_demographics AS RHD 
    ON IC.CURRENT_HDEMO_SK = RHD.DEMO_SK
 LEFT JOIN tpcds.staging.stg_tpcds__income_band AS RI 
    ON RHD.INCOME_BAND_SK = RI.INCOME_BAND_SK
-- keep both the old and new records in the table, so comment out below filter
-- WHERE IC.DBT_VALID_TO IS NULL
  );
[0m04:57:13.792123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:57:14.363050 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m04:57:14.368662 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:14.369414 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim__dbt_tmp
[0m04:57:14.476569 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:57:14.485907 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:14.486819 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table tpcds.analytics.customer_dim
[0m04:57:14.534436 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:57:14.543922 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:14.544754 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
describe table "TPCDS"."ANALYTICS"."CUSTOMER_DIM"
[0m04:57:14.609431 [debug] [Thread-1 (]: SQL status: SUCCESS 44 in 0.0 seconds
[0m04:57:14.618852 [debug] [Thread-1 (]: Writing runtime sql for node "model.capstone.customer_dim"
[0m04:57:14.623075 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:14.623766 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
-- back compat for old kwarg name
  
  begin;
[0m04:57:14.704835 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m04:57:14.705709 [debug] [Thread-1 (]: Using snowflake connection "model.capstone.customer_dim"
[0m04:57:14.706633 [debug] [Thread-1 (]: On model.capstone.customer_dim: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "capstone", "target_name": "dev", "node_id": "model.capstone.customer_dim"} */
merge into tpcds.analytics.customer_dim as DBT_INTERNAL_DEST
        using tpcds.analytics.customer_dim__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.CUSTOMER_SK = DBT_INTERNAL_DEST.CUSTOMER_SK
                )

    
    when matched then update set
        "SALUTATION" = DBT_INTERNAL_SOURCE."SALUTATION","PREFERRED_CUST_FLAG" = DBT_INTERNAL_SOURCE."PREFERRED_CUST_FLAG","FIRST_SALES_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SALES_DATE_SK","CUSTOMER_SK" = DBT_INTERNAL_SOURCE."CUSTOMER_SK","LOGIN" = DBT_INTERNAL_SOURCE."LOGIN","CURRENT_CDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_CDEMO_SK","FIRST_NAME" = DBT_INTERNAL_SOURCE."FIRST_NAME","CURRENT_HDEMO_SK" = DBT_INTERNAL_SOURCE."CURRENT_HDEMO_SK","CURRENT_ADDR_SK" = DBT_INTERNAL_SOURCE."CURRENT_ADDR_SK","LAST_NAME" = DBT_INTERNAL_SOURCE."LAST_NAME","CUSTOMER_ID" = DBT_INTERNAL_SOURCE."CUSTOMER_ID","LAST_REVIEW_DATE_SK" = DBT_INTERNAL_SOURCE."LAST_REVIEW_DATE_SK","BIRTH_MONTH" = DBT_INTERNAL_SOURCE."BIRTH_MONTH","BIRTH_COUNTRY" = DBT_INTERNAL_SOURCE."BIRTH_COUNTRY","BIRTH_YEAR" = DBT_INTERNAL_SOURCE."BIRTH_YEAR","BIRTH_DAY" = DBT_INTERNAL_SOURCE."BIRTH_DAY","EMAIL_ADDRESS" = DBT_INTERNAL_SOURCE."EMAIL_ADDRESS","FIRST_SHIPTO_DATE_SK" = DBT_INTERNAL_SOURCE."FIRST_SHIPTO_DATE_SK","STREET_NAME" = DBT_INTERNAL_SOURCE."STREET_NAME","SUITE_NUMBER" = DBT_INTERNAL_SOURCE."SUITE_NUMBER","STATE" = DBT_INTERNAL_SOURCE."STATE","LOCATION_TYPE" = DBT_INTERNAL_SOURCE."LOCATION_TYPE","COUNTRY" = DBT_INTERNAL_SOURCE."COUNTRY","ADDRESS_ID" = DBT_INTERNAL_SOURCE."ADDRESS_ID","COUNTY" = DBT_INTERNAL_SOURCE."COUNTY","STREET_NUMBER" = DBT_INTERNAL_SOURCE."STREET_NUMBER","ZIP" = DBT_INTERNAL_SOURCE."ZIP","CITY" = DBT_INTERNAL_SOURCE."CITY","GMT_OFFSET" = DBT_INTERNAL_SOURCE."GMT_OFFSET","DEP_EMPLOYED_COUNT" = DBT_INTERNAL_SOURCE."DEP_EMPLOYED_COUNT","DEP_COUNT" = DBT_INTERNAL_SOURCE."DEP_COUNT","CREDIT_RATING" = DBT_INTERNAL_SOURCE."CREDIT_RATING","EDUCATION_STATUS" = DBT_INTERNAL_SOURCE."EDUCATION_STATUS","PURCHASE_ESTIMATE" = DBT_INTERNAL_SOURCE."PURCHASE_ESTIMATE","MARITAL_STATUS" = DBT_INTERNAL_SOURCE."MARITAL_STATUS","DEP_COLLEGE_COUNT" = DBT_INTERNAL_SOURCE."DEP_COLLEGE_COUNT","GENDER" = DBT_INTERNAL_SOURCE."GENDER","BUY_POTENTIAL" = DBT_INTERNAL_SOURCE."BUY_POTENTIAL","VEHICLE_COUNT" = DBT_INTERNAL_SOURCE."VEHICLE_COUNT","INCOME_BAND_SK" = DBT_INTERNAL_SOURCE."INCOME_BAND_SK","LOWER_BOUND" = DBT_INTERNAL_SOURCE."LOWER_BOUND","UPPER_BOUND" = DBT_INTERNAL_SOURCE."UPPER_BOUND","START_DATE" = DBT_INTERNAL_SOURCE."START_DATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE"
    

    when not matched then insert
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")
    values
        ("SALUTATION", "PREFERRED_CUST_FLAG", "FIRST_SALES_DATE_SK", "CUSTOMER_SK", "LOGIN", "CURRENT_CDEMO_SK", "FIRST_NAME", "CURRENT_HDEMO_SK", "CURRENT_ADDR_SK", "LAST_NAME", "CUSTOMER_ID", "LAST_REVIEW_DATE_SK", "BIRTH_MONTH", "BIRTH_COUNTRY", "BIRTH_YEAR", "BIRTH_DAY", "EMAIL_ADDRESS", "FIRST_SHIPTO_DATE_SK", "STREET_NAME", "SUITE_NUMBER", "STATE", "LOCATION_TYPE", "COUNTRY", "ADDRESS_ID", "COUNTY", "STREET_NUMBER", "ZIP", "CITY", "GMT_OFFSET", "DEP_EMPLOYED_COUNT", "DEP_COUNT", "CREDIT_RATING", "EDUCATION_STATUS", "PURCHASE_ESTIMATE", "MARITAL_STATUS", "DEP_COLLEGE_COUNT", "GENDER", "BUY_POTENTIAL", "VEHICLE_COUNT", "INCOME_BAND_SK", "LOWER_BOUND", "UPPER_BOUND", "START_DATE", "END_DATE")

;
[0m04:57:18.778479 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b153c9-0001-925e-0004-d6ae000cefee
[0m04:57:18.779275 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m04:57:18.780163 [debug] [Thread-1 (]: Timing info for model.capstone.customer_dim (execute): 04:57:13.779658 => 04:57:18.779783
[0m04:57:18.780809 [debug] [Thread-1 (]: On model.capstone.customer_dim: Close
[0m04:57:18.840701 [debug] [Thread-1 (]: Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:57:18.842005 [error] [Thread-1 (]: 12 of 17 ERROR creating sql incremental model analytics.customer_dim ........... [[31mERROR[0m in 5.07s]
[0m04:57:18.843054 [debug] [Thread-1 (]: Finished running node model.capstone.customer_dim
[0m04:57:18.843837 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:57:18.844754 [info ] [Thread-1 (]: 13 of 17 SKIP test not_null_int__daily_aggregated_sales_item_sk ................ [[33mSKIP[0m]
[0m04:57:18.845508 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_item_sk.8f8f929619
[0m04:57:18.846239 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:57:18.847022 [info ] [Thread-1 (]: 14 of 17 SKIP test not_null_int__daily_aggregated_sales_warehouse_sk ........... [[33mSKIP[0m]
[0m04:57:18.847759 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_warehouse_sk.3c0ff08411
[0m04:57:18.848468 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:57:18.849262 [info ] [Thread-1 (]: 15 of 17 SKIP test not_null_int__daily_aggregated_sales_wk_num ................. [[33mSKIP[0m]
[0m04:57:18.850005 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_wk_num.ec0efbb1ec
[0m04:57:18.850739 [debug] [Thread-1 (]: Began running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:57:18.851534 [info ] [Thread-1 (]: 16 of 17 SKIP test not_null_int__daily_aggregated_sales_yr_num ................. [[33mSKIP[0m]
[0m04:57:18.852274 [debug] [Thread-1 (]: Finished running node test.capstone.not_null_int__daily_aggregated_sales_yr_num.4e4fb1b2a7
[0m04:57:18.853678 [debug] [Thread-1 (]: Began running node model.capstone.weekly_sales_inventory
[0m04:57:18.854410 [info ] [Thread-1 (]: 17 of 17 SKIP relation analytics.weekly_sales_inventory ........................ [[33mSKIP[0m]
[0m04:57:18.855153 [debug] [Thread-1 (]: Finished running node model.capstone.weekly_sales_inventory
[0m04:57:18.857550 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:57:18.858126 [debug] [MainThread]: Connection 'model.capstone.customer_dim' was properly closed.
[0m04:57:18.858767 [info ] [MainThread]: 
[0m04:57:18.859369 [info ] [MainThread]: Finished running 9 view models, 1 snapshot, 3 incremental models, 4 tests in 0 hours 0 minutes and 17.99 seconds (17.99s).
[0m04:57:18.863032 [debug] [MainThread]: Command end result
[0m04:57:18.886668 [info ] [MainThread]: 
[0m04:57:18.887503 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m04:57:18.888065 [info ] [MainThread]: 
[0m04:57:18.888646 [error] [MainThread]:   Database Error in model int__daily_aggregated_sales (models/intermediate/int__daily_aggregated_sales.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/intermediate/int__daily_aggregated_sales.sql
[0m04:57:18.889233 [info ] [MainThread]: 
[0m04:57:18.889791 [error] [MainThread]:   Database Error in model customer_dim (models/analytics/customer_dim.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/capstone/models/analytics/customer_dim.sql
[0m04:57:18.890422 [info ] [MainThread]: 
[0m04:57:18.891030 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=2 SKIP=5 TOTAL=17
[0m04:57:18.892414 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 19.197971, "process_user_time": 7.140997, "process_kernel_time": 0.373618, "process_mem_max_rss": "166728", "process_out_blocks": "4024", "command_success": false, "process_in_blocks": "0"}
[0m04:57:18.893281 [debug] [MainThread]: Command `dbt build` failed at 04:57:18.893064 after 19.20 seconds
[0m04:57:18.893878 [debug] [MainThread]: Flushing usage events
